function _createForOfIteratorHelper(e,a){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var o=0,n=function(){};return{s:n,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,l=!0,r=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){r=!0,i=e},f:function(){try{l||null==t.return||t.return()}finally{if(r)throw i}}}}function _unsupportedIterableToArray(e,a){if(e){if("string"==typeof e)return _arrayLikeToArray(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,a):void 0}}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,o=new Array(a);t<a;t++)o[t]=e[t];return o}var statusPixel={1:"success",0:"danger"},srcPlatforms={google_analytics:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/old-analytics",google_analytics_four:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/analytics",google_adwords:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/google-ads",facebook:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/facebook",outbrain:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/outbrain",taboola:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/taboola",pinterest:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/pinterest",uol_ads:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/uol-ads",tiktok:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/tiktok"};$((function(){var e,a=$(window.location.pathname.split("/")).get(-1);function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!=a?"1"==a||"true"==a?e.prop("checked",!0).change():e.prop("checked",!1).change():e.is(":checked")?e.attr("checked",!1):e.attr("checked","checked")}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t,t=null==t?"/api/project/"+a+"/pixels":"/api/project/"+a+"/pixels"+t,loadOnTable("#data-table-pixel","#table-pixel"),$("#pagination-pixels").html(""),$("#tab_pixels-panel").find(".no-gutters").css("display","none"),$("#table-pixel").find("thead").css("display","none"),$.ajax({method:"GET",url:t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#data-table-pixel").html(e.message)},success:function(e){$("#data-table-pixel, #pagination-pixels").html(""),""==e.data?($("#table-pixel").addClass("table-striped"),$("#data-table-pixel").html("\n                        <tr class=\"text-center\">\n                            <td colspan=\"8\" style=\"height: 70px; vertical-align: middle;\">\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.png' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum pixel configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro pixel para poder\n                                        <br>gerenciá-los nesse painel.</p>\n                                        <button type='button' style='width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-pixel' data-toggle=\"modal\" data-target=\"#modal-create-pixel\">Adicionar pixel</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    ")):($("#tab_pixels-panel").find(".no-gutters").css("display","flex"),$("#table-pixel").find("thead").css("display","contents"),$.each(e.data,(function(e,a){$("#data-table-pixel").append("\n                            <tr>\n                                <td>".concat(a.name,"</td>\n                                <td>").concat(a.code,"</td>\n                                <td>").concat(a.platform_enum,'</td>\n                                <td class="text-center"><span class="badge badge-').concat(statusPixel[a.status],'">').concat(a.status_translated,"</span></td>\n                                <td style='text-align:center'>\n                                    <div class='d-flex justify-content-end align-items-center'>\n                                        <a role='button' title='Visualizar' class='mg-responsive details-pixel pointer' pixel='").concat(a.id,"' data-target='#modal-details-pixel' data-toggle='modal'><span class=\"o-eye-1\"></span></a>\n                                        <a role='button' title='Editar' class='mg-responsive edit-pixel pointer' pixel='").concat(a.id,"' data-toggle='modal' type='a'><span class=\"o-edit-1\"></span></a>\n                                        <a role='button' title='Excluir' class='mg-responsive delete-pixel pointer' pixel='").concat(a.id,"' data-toggle='modal' data-target='#modal-delete-pixel' type='a'><span class='o-bin-1'></span></a>\n                                    </div>\n                                </td>\n                            </tr>\n                        ")),$("#table-pixel").addClass("table-striped")})),pagination(e,"pixels",o))}})}$(".tab_pixels").on("click",(function(){$("#previewimage").imgAreaSelect({remove:!0}),o(e),$(this).off()})),$(document).on("click",".details-pixel",(function(){var e=$(this).attr("pixel");$.ajax({method:"GET",url:"/api/project/"+a+"/pixels/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){errorAjaxResponse(response)},success:function(e){!function(e){$("#modal-detail-pixel .pixel-description").html(e.name),$("#modal-detail-pixel .pixel-code").html(e.code),$("#modal-detail-pixel .pixel-platform").html(e.platform_enum),$("#modal-detail-pixel .pixel-status").html(1==e.status?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>'),$("#modal-detail-pixel").modal("show")}(e)}})}));var n={};function i(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;l();var o=$(".img-edit-selected"),n=$(".code-edit"),i=$(".conversional-edit"),s=d(e.platform,e.code,"",!0);null==a&&(a=e.platform),$(".platform-edit").val(a),o.attr("src",srcPlatforms[a]),$(".description-edit").val(e.name),Array.isArray(s)?(n.val(s[0]),i.val(s[1])):(n.val(s),i.val("")),$(".percentage-boleto-value-edit").val(e.value_percentage_purchase_boleto);var p=$(".apply_plans");p.val(null).trigger("change"),p.html("");var m,f=[],h=_createForOfIteratorHelper(e.apply_on_plans);try{for(h.s();!(m=h.n()).done;){var g=m.value;f.push(g.id),p.append('\n                <option value="'.concat(g.id,'">\n                    ').concat(g.name+(g.description?" - "+g.description:""),"\n                </option>\n            "))}}catch(e){h.e(e)}finally{h.f()}switch(p.val(f),t($(".status-edit"),e.status),t($(".checkout-edit"),e.checkout),t($(".purchase-boleto-edit"),e.purchase_boleto),t($(".purchase-card-edit"),e.purchase_card),t($(".purchase-pix-edit"),e.purchase_pix),u(a,n,$("#text-type-code-edit"),$("#conversional-pixel-edit")),a){case"facebook":r(e);break;case"taboola":case"outbrain":c(e)}}function l(){$(".input-purchase-event-name-edit").val(),$("#select-facebook-integration-edit, #div-facebook-token-api-edit, #facebook-token-api-edit, .div-purchase-event-name-edit").hide()}function r(e){e.is_api?($("#facebook-token-api-edit").prop("readonly",!1).val(e.facebook_token),$(".facebook-api-edit").prop("checked","checked"),$(".url_facebook_domain_edit").val(e.url_facebook_domain),$(".url_facebook_api_div_edit").show()):($(".url_facebook_domain_edit").val(""),$(".url_facebook_api_div_edit").hide(),$(".facebook-api-default-edit").prop("checked","checked"),$("#facebook-token-api-edit").prop("readonly",!0).val("")),$("#select-facebook-integration-edit, #div-facebook-token-api-edit, #facebook-token-api-edit").show()}function c(e){$(".input-purchase-event-name-edit").val(e.purchase_event_name),$(".div-purchase-event-name-edit").show()}function s(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?($("#modal-edit-pixel #configure-edit-pixel").hide(),$("#modal-edit-pixel #select-platform-edit-pixel").show()):($("#modal-edit-pixel #select-platform-edit-pixel").hide(),$("#modal-edit-pixel #configure-edit-pixel").show())}function d(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return"google_adwords"===e?o?a.split("/"):"".concat(a,"/").concat(t):a}function p(){$("#configure-new-pixel").hide(),$("#select-platform-pixel").show()}function u(e,a,t,o){switch(t.html("").hide(),o.hide(),e){case"facebook":a.attr("placeholder","52342343245553"),a.parent().parent().find("label").html("Código");break;case"google_adwords":t.html("AW-").show(),o.show(),a.attr("placeholder","8981445741-4"),a.parent().parent().find("label").html("Código de conversão");break;case"google_analytics":a.attr("placeholder","UA-8984567741-3"),a.parent().parent().find("label").html("Código");break;case"google_analytics_four":a.attr("placeholder","G-KZSV4LMBAC"),a.parent().parent().find("label").html("Código");break;case"taboola":a.attr("placeholder","1010100"),a.parent().parent().find("label").html("Código");break;case"outbrain":a.attr("placeholder","00de2748d47f2asdl39877mash"),a.parent().parent().find("label").html("Código");break;case"uol_ads":a.attr("placeholder","hutu27"),a.parent().parent().find("label").html("Código");break;case"tiktok":a.attr("placeholder","C5OSDKKVNBDLN9M5C6UG"),a.parent().parent().find("label").html("ID");break;default:a.attr("placeholder","Código"),a.parent().parent().find("label").html("Código")}}function m(e){return e.name.length>100?(alertCustom("error","O campo Descrição permite apenas 100 caracteres"),!1):e.name.length<1?(alertCustom("error","O campo Descrição é obrigatório"),!1):e.code.length<1?(alertCustom("error","O campo Código é obrigatório"),!1):"google_adwords"==e.platform&&e.conversional.length<1?(alertCustom("error","O campo de Rótulo de conversão é obrigatório"),!1):e.value_percentage_purchase_boleto.length>3?(alertCustom("error","O valore do campo % Valor Boleto está incorreto!"),!1):e.value_percentage_purchase_boleto.length>0&&(e.value_percentage_purchase_boleto>100||e.value_percentage_purchase_boleto<10)?(alertCustom("error","O valores permitidos para o campo % Valor Boleto deve ser entre 10 e 100"),!1):"facebook"===e.platform&&"api"===e.is_api&&e.facebook_token_api.length<1?(alertCustom("error","O campo Token Acesso API de Conversões é obrigatório"),!1):["taboola","outbrain"].includes(e.platform)&&e.purchase_event_name.length<1?(alertCustom("error","O campo Nome evento de conversão é obrigatório"),!1):null!=e.plans_apply||(alertCustom("error","É obrigatório selecionar um ou mais planos"),!1)}function f(){return{placeholder:"Nome do plano",multiple:!0,language:{noResults:function(){return"Nenhum plano encontrado"},searching:function(){return"Procurando..."},loadingMore:function(){return"Carregando mais planos..."}},ajax:{data:function(e){return{list:"plan",search:e.term,project_id:a,page:e.page||1}},method:"GET",url:"/api/plans/user-plans",delay:300,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processResults:function(e){if(1===e.meta.current_page){e.data.unshift({id:"all",name:"Qualquer plano",description:""})}return{results:$.map(e.data,(function(e){return{id:e.id,text:e.name+(e.description?" - "+e.description:"")}})),pagination:{more:e.meta.current_page!==e.meta.last_page}}}}}}$(document).on("click",".edit-pixel",(function(){$.ajax({method:"GET",url:"/api/project/".concat(a,"/pixels/").concat($(this).attr("pixel"),"/edit"),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var a=e.data;n=a,i(a),s(),$("#modal-edit-pixel").modal("show")}})})),$("#modal-edit-pixel input[type=radio]").change((function(){"api"===this.value?($(".url_facebook_api_div_edit").show(),$("#facebook-token-api-edit").prop("readonly",!1).val(n.facebook_token)):($(".url_facebook_api_div_edit").hide(),$("#facebook-token-api-edit").prop("readonly",!0).val())})),$("#modal-edit-pixel .img-edit-selected").on("click",(function(){s(!0)})),$("#modal-edit-pixel img.logo-pixels-edit").on("click",(function(){i(n,$(this).data("value")),s()})),$("#btn-update-pixel").on("click",(function(){var t=$("#modal-edit-pixel .description-edit").val(),i=$("#modal-edit-pixel .platform-edit").val(),l=$("#modal-edit-pixel input[type=radio]:checked").val(),r=$("#modal-edit-pixel .code-edit").val(),c=$("#modal-edit-pixel .conversional-edit").val(),s=$("#modal-edit-pixel .percentage-boleto-value-edit").val(),p=$("#modal-edit-pixel #facebook-token-api-edit").val(),u=$("#modal-edit-pixel .input-purchase-event-name-edit").val(),f=$("#modal-edit-pixel .apply_plans").val();if(!m({name:t,platform:i,is_api:l,code:r,conversional:c,value_percentage_purchase_boleto:s,facebook_token_api:p,purchase_event_name:u,plans_apply:f}))return!1;var h=d(i,r,c);console.log(h),$.ajax({method:"PUT",url:"/api/project/".concat(a,"/pixels/").concat(n.id_code),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{name:t,code:h,platform:i,status:$("#modal-edit-pixel .status-edit").is(":checked"),checkout:$("#modal-edit-pixel .checkout-edit").is(":checked"),purchase_card:$("#modal-edit-pixel .purchase-card-edit").is(":checked"),purchase_boleto:$("#modal-edit-pixel .purchase-boleto-edit").is(":checked"),purchase_pix:$("#modal-edit-pixel .purchase-pix-edit").is(":checked"),edit_pixel_plans:f,purchase_event_name:u,is_api:l,facebook_token_api:p,value_percentage_purchase_boleto:s,url_facebook_domain_edit:$("#modal-edit-pixel .url_facebook_domain_edit").val()},error:function(e){errorAjaxResponse(e)},success:function(){$("#modal-edit-pixel").modal("hide"),alertCustom("success","Pixel atualizado com sucesso"),o(e)}})})),$(document).on("click",".delete-pixel",(function(t){t.preventDefault();var n=$(this).attr("pixel");$("#btn-delete").unbind("click"),$("#btn-delete").on("click",(function(){$.ajax({method:"DELETE",url:"/api/project/"+a+"/pixels/"+n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function a(){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e){errorAjaxResponse(e)})),success:function(){alertCustom("success","Pixel Removido com sucesso"),o(e)}})}))})),$(".add-pixel").on("click",(function(){p(),$("#modal-create-pixel").modal("show")})),$("img.img-selected").on("click",(function(){p()})),$("img.logo-pixels-create").on("click",(function(){var e=$(this).data("value");$("#platform").val("").val(e),$(".form-control").val(""),$(".img-logo").attr("src",this.src),$("#select-facebook-integration, #div-facebook-token-api, .purchase-event-name-div, .url_facebook_api_div").hide(),u(e,$("#code-pixel"),$("#input-code-pixel"),$("#conversional-pixel")),"facebook"===e?($("#select-facebook-integration, #div-facebook-token-api").show(),"api"==$("input[type=radio]").val()?($(".url_facebook_api_div").show(),$("#facebook-token-api").attr("readonly",!1)):"default"==$("input[type=radio]").val()&&($(".select-default-facebook").click(),$("#facebook-token-api").attr("readonly",!0))):["taboola","outbrain"].includes(e)&&$(".purchase-event-name-div").show(),$("input[type=radio]").change((function(){$(".url_facebook_api_div").hide(),"api"===this.value?($(".url_facebook_api_div").show(),$("#facebook-token-api").attr("readonly",!1)):$("#facebook-token-api").attr("readonly",!0)})),$("#add_pixel_plans").val(null).trigger("change"),t($("#modal-create-pixel .status"),!0),t($("#modal-create-pixel .checkout"),!0),t($("#modal-create-pixel .purchase-boleto"),!0),t($("#modal-create-pixel .purchase-card"),!0),t($("#modal-create-pixel .purchase-pix"),!0),$("#select-platform-pixel").hide(),$("#configure-new-pixel").show()})),$("#modal-create-pixel #btn-store-pixel").on("click",(function(){var e=new FormData(document.querySelector("#modal-create-pixel  #form-register-pixel"));if(e.append("status",$("#modal-create-pixel .status").is(":checked")),e.append("checkout",$("#modal-create-pixel .checkout").is(":checked")),e.append("purchase_card",$("#modal-create-pixel .purchase-card").is(":checked")),e.append("purchase_boleto",$("#modal-create-pixel .purchase-boleto").is(":checked")),e.append("purchase_pix",$("#modal-create-pixel .purchase-pix").is(":checked")),!m({name:e.get("name"),platform:e.get("platform"),is_api:e.get("api-facebook"),code:e.get("code"),conversional:e.get("conversional"),value_percentage_purchase_boleto:e.get("value_percentage_purchase_boleto"),facebook_token_api:e.get("facebook-token-api"),purchase_event_name:e.get("purchase-event-name"),plans_apply:e.get("add_pixel_plans[]")}))return!1;var t=d(e.get("platform"),e.get("code"),e.get("conversional"));e.set("code",t),$.ajax({method:"POST",url:"/api/project/"+a+"/pixels",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:e,processData:!1,contentType:!1,cache:!1,error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-create-pixel").modal("hide"),alertCustom("success",e.message),o()}})})),$("#add_pixel_plans").select2(Object.assign(f(),{dropdownParent:$("#modal-create-pixel")})),$(".edit-plans").select2(Object.assign(f(),{dropdownParent:$("#modal-edit-pixel")})),$("#add_pixel_plans, .edit-plans").on("select2:select",(function(){var e=$(this);(e.val().length>1&&e.val().includes("all")||e.val().includes("all")&&"all"!=e.val())&&e.val("all").trigger("change")})),$(".btn-config-pixel").on("click",(function(){$.ajax({method:"GET",url:"/api/projects/"+a+"/pixels/configs",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#metatag-verification-facebook").val(e.data.metatags_facebook),$("#modal-config-pixel").modal("show")}})})),$(".btn-save-config-pixel").on("click",(function(){$.ajax({method:"POST",url:"/api/projects/"+a+"/pixels/saveconfigs",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{"metatag-verification-facebook":$("#metatag-verification-facebook").val()},error:function(e){errorAjaxResponse(e)},success:function(e){alertCustom("success",e.message),$("#modal-config-pixel").modal("hide")}})}))}));
