function _createForOfIteratorHelper(e,a){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=_unsupportedIterableToArray(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,l=!0,r=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return l=e.done,e},e:function(e){r=!0,n=e},f:function(){try{l||null==t.return||t.return()}finally{if(r)throw n}}}}function _unsupportedIterableToArray(e,a){if(e){if("string"==typeof e)return _arrayLikeToArray(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,a):void 0}}function _arrayLikeToArray(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,o=new Array(a);t<a;t++)o[t]=e[t];return o}var statusPixel={1:"success",0:"danger"},srcPlatforms={google_analytics:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/old-analytics",google_analytics_four:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/analytics",google_adwords:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/google-ads",facebook:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/facebook",outbrain:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/outbrain",taboola:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/taboola",pinterest:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/pixel/pinterest",uol_ads:"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/uol-ads"};$((function(){var e,a=$(window.location.pathname.split("/")).get(-2),t=$(window.location.pathname.split("/")).get(-1);function o(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null!=a?"1"==a||"true"==a?e.prop("checked",!0):e.prop("checked",!1):e.is(":checked")?e.attr("checked",!1):e.attr("checked","checked")}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=t,t=null==t?"/api/project/"+a+"/pixels":"/api/project/"+a+"/pixels"+t,$("#pagination-pixels").html(""),$("#tab_pixels-panel").find(".no-gutters").css("display","none"),$("#table-pixel").find("thead").css("display","none"),loadOnTable("#data-table-pixel","#table-pixel"),$.ajax({method:"GET",url:t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#data-table-pixel").html(e.message)},success:function(e){if($("#data-table-pixel, #pagination-pixels").html(""),""==e.data)return $("#table-pixel").addClass("table-striped"),void $("#data-table-pixel").html("\n                        <tr class=\"text-center\">\n                            <td colspan=\"8\" style=\"height: 70px; vertical-align: middle;\">\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.png' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum pixel configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro pixel para poder<br>gerenciá-los nesse painel.</p>\n                                        <button type='button' style='margin: 0; width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-pixel' data-toggle=\"modal\" data-target=\"#modal_add_plan\">Adicionar pixel</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    ");""!=e.data&&($("#tab_pixels-panel").find(".no-gutters").css("display","flex"),$("#table-pixel").find("thead").css("display","contents")),$.each(e.data,(function(e,a){"Google Adwords"===a.platform_enum&&(a.platform_enum="Google Ads"),$("#data-table-pixel").append("\n                        <tr>\n                            <td>".concat(a.name_short,"</td>\n                            <td>").concat(a.code,"</td>\n                            <td>").concat(a.platform_enum,'</td>\n                            <td>\n                                <span class="badge badge-').concat(statusPixel[a.status],'">\n                                    ').concat(a.status_translated,"\n                                </span>\n                            </td>\n                            <td style='text-align:center'>\n                                <div class='d-flex justify-content-end align-items-center'>\n                                    <a role='button' title='Visualizar' class='mg-responsive details-pixel pointer' pixel='").concat(a.id,"' data-target='#modal-details-pixel' data-toggle='modal'><span class=\"o-eye-1\"></span></a>\n                                    <a role='button' title='Editar' class='mg-responsive edit-pixel pointer' pixel='").concat(a.id,"' data-toggle='modal' type='a'><span class=\"o-edit-1\"></span></a>\n                                    <a role='button' title='Excluir' class='mg-responsive delete-pixel pointer' pixel='").concat(a.id,"' data-toggle='modal' type='a'><span class='o-bin-1'></span></a>\n                                </div>\n                            </td>\n                        </tr>\n                    ")),$("#table-pixel").addClass("table-striped")})),pagination(e,"pixels",i)}})}i(e),$(".tab_pixels").on("click",(function(){$("#previewimage").imgAreaSelect({remove:!0}),i(e),$(this).off()})),$(document).on("click",".details-pixel",(function(){var e=$(this).attr("pixel");$.ajax({method:"GET",url:"/api/project/"+a+"/pixels/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){errorAjaxResponse(response)},success:function(e){!function(e){$("#modal-detail-pixel .pixel-description").html(e.name),$("#modal-detail-pixel .pixel-code").html(e.code),$("#modal-detail-pixel .pixel-platform").html(e.platform_enum),$("#modal-detail-pixel .pixel-status").html(1==e.status?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>'),$("#modal-detail-pixel").modal("show")}(e)}})}));var n={};function l(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r();var t=$(".img-edit-selected"),i=$(".code-edit");null==a&&(a=e.platform),$(".platform-edit").val(a),t.attr("src",srcPlatforms[a]),$(".description-edit").val(e.name),i.val(e.code),$(".percentage-boleto-value-edit").val(e.value_percentage_purchase_boleto);var n=$(".apply_plans");n.val(null).trigger("change"),n.html("");var l,s=[],p=_createForOfIteratorHelper(e.apply_on_plans);try{for(p.s();!(l=p.n()).done;){var u=l.value;s.push(u.id),n.append('\n                <option value="'.concat(u.id,'">\n                    ').concat(u.name+(u.description?" - "+u.description:""),"\n                </option>\n            "))}}catch(e){p.e(e)}finally{p.f()}switch(n.val(s),o($(".status-edit"),e.status),o($(".checkout-edit"),e.checkout),o($(".purchase-boleto-edit"),e.purchase_boleto),o($(".purchase-card-edit"),e.purchase_card),o($(".purchase-pix-edit"),e.purchase_pix),m(a,i,$("#text-type-code-edit")),a){case"facebook":c(e);break;case"taboola":case"outbrain":d(e)}}function r(){$(".input-purchase-event-name-edit").val(),$("#select-facebook-integration-edit, #div-facebook-token-api-edit, #facebook-token-api-edit, .div-purchase-event-name-edit").hide()}function c(e){e.is_api?($("#facebook-token-api-edit").prop("readonly",!1).val(e.facebook_token),$(".facebook-api-edit").prop("checked","checked"),$(".url_facebook_domain_edit").val(e.url_facebook_domain),$(".url_facebook_api_div_edit").show()):($(".url_facebook_domain_edit").val(""),$(".url_facebook_api_div_edit").hide(),$(".facebook-api-default-edit").prop("checked","checked"),$("#facebook-token-api-edit").prop("readonly",!0).val("")),$("#select-facebook-integration-edit, #div-facebook-token-api-edit, #facebook-token-api-edit").show()}function d(e){$(".input-purchase-event-name-edit").val(e.purchase_event_name),$(".div-purchase-event-name-edit").show()}function s(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e?($("#modal-edit-pixel #configure-edit-pixel").hide(),$("#modal-edit-pixel #select-platform-edit-pixel").show()):($("#modal-edit-pixel #select-platform-edit-pixel").hide(),$("#modal-edit-pixel #configure-edit-pixel").show())}function p(e){return e.name.length>100?(alertCustom("error","O campo Descrição permite apenas 100 caracteres"),!1):e.name.length<1?(alertCustom("error","O campo Descrição é obrigatório"),!1):e.code.length<1?(alertCustom("error","O campo Código é obrigatório"),!1):e.value_percentage_purchase_boleto.length>3?(alertCustom("error","O valore do campo % Valor Boleto está incorreto!"),!1):e.value_percentage_purchase_boleto.length>0&&(e.value_percentage_purchase_boleto>100||e.value_percentage_purchase_boleto<10)?(alertCustom("error","O valores permitidos para o campo % Valor Boleto deve ser entre 10 e 100"),!1):"facebook"===e.platform&&"api"===e.is_api&&e.facebook_token_api.length<1?(alertCustom("error","O campo Token Acesso API de Conversões é obrigatório"),!1):["taboola","outbrain"].includes(e.platform)&&e.purchase_event_name.length<1?(alertCustom("error","O campo Nome evento de conversão é obrigatório"),!1):null!=e.plans_apply||(alertCustom("error","É obrigatório selecionar um ou mais planos"),!1)}function u(){$("#configure-new-pixel").hide(),$("#select-platform-pixel").show()}function m(e,a,t){switch(t.html("").hide(),e){case"facebook":a.attr("placeholder","52342343245553");break;case"google_adwords":t.html("AW-").show(),a.attr("placeholder","8981445741-4/AN7162ASNSG");break;case"google_analytics":a.attr("placeholder","UA-8984567741-3");break;case"google_analytics_four":a.attr("placeholder","G-KZSV4LMBAC");break;case"taboola":a.attr("placeholder","1010100");break;case"outbrain":a.attr("placeholder","00de2748d47f2asdl39877mash");break;case"uol_ads":a.attr("placeholder","hutu27");break;default:a.attr("placeholder","Código")}}function h(){return{placeholder:"Nome do plano",multiple:!0,language:{noResults:function(){return"Nenhum plano encontrado"},searching:function(){return"Procurando..."},loadingMore:function(){return"Carregando mais planos..."}},ajax:{data:function(e){return{list:"plan",search:e.term,project_id:a,page:e.page||1}},method:"GET",url:"/api/plans/user-plans",delay:300,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processResults:function(e){if(1===e.meta.current_page){e.data.unshift({id:"all",name:"Qualquer plano",description:""})}return{results:$.map(e.data,(function(e){return{id:e.id,text:e.name+(e.description?" - "+e.description:"")}})),pagination:{more:e.meta.current_page!==e.meta.last_page}}}}}}$(document).on("click",".edit-pixel",(function(){$.ajax({method:"GET",url:"/api/project/".concat(a,"/pixels/").concat($(this).attr("pixel"),"/edit"),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var a=e.data;n=a,l(a),s(),$("#modal-edit-pixel").modal("show")}})})),$("#modal-edit-pixel input[type=radio]").change((function(){"api"===this.value?($(".url_facebook_api_div_edit").show(),$("#facebook-token-api-edit").prop("readonly",!1).val(n.facebook_token)):($(".url_facebook_api_div_edit").hide(),$("#facebook-token-api-edit").prop("readonly",!0).val())})),$("#modal-edit-pixel .img-edit-selected").on("click",(function(){s(!0)})),$("#modal-edit-pixel img.logo-pixels-edit").on("click",(function(){l(n,$(this).data("value")),s()})),$("#btn-update-pixel").on("click",(function(){var t=$("#modal-edit-pixel .description-edit").val(),o=$("#modal-edit-pixel .platform-edit").val(),l=$("#modal-edit-pixel input[type=radio]:checked").val(),r=$("#modal-edit-pixel .code-edit").val(),c=$("#modal-edit-pixel .percentage-boleto-value-edit").val(),d=$("#modal-edit-pixel #facebook-token-api-edit").val(),s=$("#modal-edit-pixel .input-purchase-event-name-edit").val(),u=$("#modal-edit-pixel .apply_plans").val();if(!p({name:t,platform:o,is_api:l,code:r,value_percentage_purchase_boleto:c,facebook_token_api:d,purchase_event_name:s,plans_apply:u}))return!1;$.ajax({method:"PUT",url:"/api/project/".concat(a,"/pixels/").concat(n.id_code),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{name:t,code:r,platform:o,status:$("#modal-edit-pixel .status-edit").is(":checked"),checkout:$("#modal-edit-pixel .checkout-edit").is(":checked"),purchase_card:$("#modal-edit-pixel .purchase-card-edit").is(":checked"),purchase_boleto:$("#modal-edit-pixel .purchase-boleto-edit").is(":checked"),purchase_pix:$("#modal-edit-pixel .purchase-pix-edit").is(":checked"),edit_pixel_plans:u,purchase_event_name:s,is_api:l,facebook_token_api:d,value_percentage_purchase_boleto:c,url_facebook_domain_edit:$("#modal-edit-pixel .url_facebook_domain_edit").val()},error:function(e){errorAjaxResponse(e)},success:function(){$("#modal-edit-pixel").modal("hide"),alertCustom("success","Pixel atualizado com sucesso"),i(e)}})})),$(document).on("click",".delete-pixel",(function(e){$("#modal-delete-pixel #btn-delete").attr("pixel",$(this).attr("pixel")),$("#modal-delete-pixel").modal("show")})),$(document).on("click","#modal-delete-pixel #btn-delete",(function(){loadingOnScreen();var t=$(this).attr("pixel");$.ajax({method:"DELETE",url:"/api/project/"+a+"/pixels/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function a(){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}((function(e){loadingOnScreenRemove(),errorAjaxResponse(e)})),success:function(){loadingOnScreenRemove(),alertCustom("success","Pixel Removido com sucesso"),i(e)}})})),$(document).on("click",".add-pixel",(function(){u(),$("#modal-create-pixel").modal("show")})),$("img.img-selected").on("click",(function(){u()})),$("img.logo-pixels-create").on("click",(function(){var e=$(this).data("value");$("#platform").val("").val(e),$(".img-logo").attr("src",this.src),$("#select-facebook-integration, #div-facebook-token-api, .purchase-event-name-div, .url_facebook_api_div").hide(),m(e,$("#code-pixel"),$("#input-code-pixel")),"facebook"===e?($("#select-facebook-integration, #div-facebook-token-api").show(),"api"==$("input[type=radio]").val()?($(".url_facebook_api_div").show(),$("#facebook-token-api").attr("readonly",!1)):"default"==$("input[type=radio]").val()&&($(".select-default-facebook").click(),$("#facebook-token-api").attr("readonly",!0))):["taboola","outbrain"].includes(e)&&$(".purchase-event-name-div").show(),$("input[type=radio]").change((function(){$(".url_facebook_api_div").hide(),"api"===this.value?($(".url_facebook_api_div").show(),$("#facebook-token-api").attr("readonly",!1)):$("#facebook-token-api").attr("readonly",!0)})),$("#select-platform-pixel").hide(),$("#configure-new-pixel").show()})),$("#modal-create-pixel #btn-store-pixel").on("click",(function(){var e=new FormData(document.querySelector("#modal-create-pixel  #form-register-pixel"));if(e.append("status",$("#modal-create-pixel .pixel-status").is(":checked")),e.append("checkout",$("#modal-create-pixel .checkout").is(":checked")),e.append("purchase_card",$("#modal-create-pixel .purchase-card").is(":checked")),e.append("purchase_boleto",$("#modal-create-pixel .purchase-boleto").is(":checked")),e.append("purchase_pix",$("#modal-create-pixel .purchase-pix").is(":checked")),e.append("affiliate_id",t),!p({name:e.get("name"),platform:e.get("platform"),is_api:e.get("api-facebook"),code:e.get("code"),value_percentage_purchase_boleto:e.get("value_percentage_purchase_boleto"),facebook_token_api:e.get("facebook-token-api"),purchase_event_name:e.get("purchase-event-name"),plans_apply:e.get("add_pixel_plans[]")}))return!1;loadingOnScreen(),$.ajax({method:"POST",url:"/api/project/"+a+"/pixels",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:e,processData:!1,contentType:!1,cache:!1,error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),$("#modal-create-pixel").modal("hide"),alertCustom("success",e.message),i()}})})),$("#add_pixel_plans").select2(Object.assign(h(),{dropdownParent:$("#modal-create-pixel")})),$(".edit-plans").select2(Object.assign(h(),{dropdownParent:$("#modal-edit-pixel")})),$("#add_pixel_plans, .edit-plans").on("select2:select",(function(){var e=$(this);(e.val().length>1&&e.val().includes("all")||e.val().includes("all")&&"all"!=e.val())&&e.val("all").trigger("change")}))}));
