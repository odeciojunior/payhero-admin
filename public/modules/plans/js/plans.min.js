$((function(){var t,o={0:"default",1:"success"},a=$(window.location.pathname.split("/")).get(-1),e=[],n=[],i="",s=0,d=0,l=0,r=!1,c=[];function p(){$("#tab_plans-panel").find(".no-gutters").css("display","none"),$("#table-plans").find("thead").css("display","none")}function u(t){return 0===Object.keys(t).length}function m(t){var o="";switch(t){case"Text":o='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M3.9 1.8C2.7402 1.8 1.8 2.7402 1.8 3.9V7.5C1.8 7.99705 1.39705 8.4 0.9 8.4C0.402948 8.4 0 7.99705 0 7.5V3.9C0 1.74608 1.74608 0 3.9 0H7.5C7.99705 0 8.4 0.402948 8.4 0.9C8.4 1.39705 7.99705 1.8 7.5 1.8H3.9ZM3.9 22.2C2.7402 22.2 1.8 21.2598 1.8 20.1V16.5C1.8 16.003 1.39705 15.6 0.9 15.6C0.402948 15.6 0 16.003 0 16.5V20.1C0 22.2539 1.74608 24 3.9 24H7.5C7.99705 24 8.4 23.597 8.4 23.1C8.4 22.603 7.99705 22.2 7.5 22.2H3.9ZM22.2 3.9C22.2 2.7402 21.2598 1.8 20.1 1.8H16.5C16.003 1.8 15.6 1.39705 15.6 0.9C15.6 0.402948 16.003 0 16.5 0H20.1C22.2539 0 24 1.74608 24 3.9V7.5C24 7.99705 23.597 8.4 23.1 8.4C22.603 8.4 22.2 7.99705 22.2 7.5V3.9ZM20.1 22.2C21.2598 22.2 22.2 21.2598 22.2 20.1V16.5C22.2 16.003 22.603 15.6 23.1 15.6C23.597 15.6 24 16.003 24 16.5V20.1C24 22.2539 22.2539 24 20.1 24H16.5C16.003 24 15.6 23.597 15.6 23.1C15.6 22.603 16.003 22.2 16.5 22.2H20.1ZM6.9 4.8C6.40295 4.8 6 5.20295 6 5.7V7.2C6 7.69705 6.40295 8.1 6.9 8.1C7.39705 8.1 7.8 7.69705 7.8 7.2V6.6H11.1V17.4H9.3C8.80295 17.4 8.4 17.803 8.4 18.3C8.4 18.797 8.80295 19.2 9.3 19.2H14.7C15.197 19.2 15.6 18.797 15.6 18.3C15.6 17.803 15.197 17.4 14.7 17.4H12.9V6.6H16.2V7.2C16.2 7.69705 16.603 8.1 17.1 8.1C17.597 8.1 18 7.69705 18 7.2V5.7C18 5.20295 17.597 4.8 17.1 4.8H6.9Z" fill="#636363"/>\n                </svg>';break;case"Image":o='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M16.6645 4C18.5055 4 19.9979 5.4924 19.9979 7.33333C19.9979 9.17427 18.5055 10.6667 16.6645 10.6667C14.8236 10.6667 13.3312 9.17427 13.3312 7.33333C13.3312 5.4924 14.8236 4 16.6645 4ZM14.9979 7.33333C14.9979 8.2538 15.7441 9 16.6645 9C17.585 9 18.3312 8.2538 18.3312 7.33333C18.3312 6.41287 17.585 5.66667 16.6645 5.66667C15.7441 5.66667 14.9979 6.41287 14.9979 7.33333ZM0 3.16667C0 1.41777 1.41777 0 3.16667 0H20.8333C22.5823 0 24 1.41777 24 3.16667V20.8333C24 21.6251 23.7094 22.3491 23.229 22.9043C23.1932 22.9687 23.1482 23.0294 23.094 23.0845C23.0365 23.1429 22.9726 23.1911 22.9044 23.2289C22.3492 23.7093 21.6252 24 20.8333 24H3.16667C2.37332 24 1.64812 23.7083 1.09249 23.2262C1.02613 23.1888 0.963833 23.1415 0.90772 23.0845C0.855053 23.0311 0.811093 22.9722 0.77582 22.9099C0.29256 22.3539 0 21.6278 0 20.8333V3.16667ZM22.3333 20.8333V3.16667C22.3333 2.33824 21.6617 1.66667 20.8333 1.66667H3.16667C2.33824 1.66667 1.66667 2.33824 1.66667 3.16667V20.8333C1.66667 20.9377 1.67732 21.0395 1.69759 21.1378L10.2465 12.7234C11.2194 11.7657 12.7807 11.7657 13.7537 12.7233L22.3027 21.1365C22.3228 21.0386 22.3333 20.9372 22.3333 20.8333ZM3.16667 22.3333H20.8333C20.9299 22.3333 21.0243 22.3242 21.1157 22.3068L12.5847 13.9112C12.2603 13.592 11.7399 13.592 11.4156 13.9112L2.8856 22.3071C2.97667 22.3243 3.0706 22.3333 3.16667 22.3333Z" fill="#636363"/>\n                </svg>';break;case"File":o='<svg width="21" height="22" viewBox="0 0 21 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M9.77024 2.7431C12.1117 0.399509 15.9106 0.399509 18.2538 2.74266C20.5369 5.02572 20.5954 8.69093 18.4294 11.0449L18.2413 11.2422L9.44124 20.0404L9.40474 20.0707C7.94346 21.3875 5.68946 21.3427 4.28208 19.9353C2.96306 18.6163 2.84095 16.5536 3.91574 15.0969C3.93908 15.0516 3.96732 15.0078 4.00054 14.9667L4.0541 14.907L4.14101 14.8193L4.28208 14.6714L4.28501 14.6743L11.7207 7.21998C11.9866 6.95336 12.4032 6.9286 12.6971 7.14607L12.7814 7.21857C13.048 7.48449 13.0727 7.90112 12.8553 8.19502L12.7828 8.27923L5.1882 15.8923C4.47056 16.7679 4.52044 18.0622 5.33784 18.8796C6.1669 19.7087 7.48655 19.7481 8.36234 18.998L17.195 10.1676C18.9505 8.40992 18.9505 5.56068 17.1931 3.80332C15.4907 2.10087 12.7635 2.04767 10.9971 3.64371L10.8292 3.80332L10.8166 3.81763L1.28033 13.354C0.987435 13.6468 0.512565 13.6468 0.219665 13.354C-0.0465948 13.0877 -0.0708047 12.671 0.147055 12.3774L0.219665 12.2933L9.76854 2.74266L9.77024 2.7431Z" fill="#636363"/>\n                </svg>'}return o}function f(t,o,n,i){$(".tooltip").remove(),$(n).find(".product-photo").unbind("load");var s="create"==i?"#stage1":"#stage2";$(n).find(".modal-body").css("height","auto"),$(n).find(s).find(".box-review").html("").css("margin-bottom","0px"),$(n).find(s).find(".box-products").html("").css({height:"auto","padding-right":"0px"}),$(n).find(s).find(".box-products").mCustomScrollbar("destroy"),$(n).find(s).find(".box-products").mCustomScrollbar("update"),$(n).find(s).find(".box-products").html(loadingProducts).promise().done((function(){$.ajax({method:"POST",url:"/api/products/topselling",data:{project:a,product:t,description:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){var o='<div class="row" style="display: none;">';t.data.length>0?t.data.forEach((function(t){var a=e.map((function(t){return t.id})).indexOf(t.id);o+='<div class="col-sm-6">',o+="<div "+(t.name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.name+'"':"")+' data-code="'+t.id+'" class="box-product '+(-1!=a?"selected":"")+" "+(1==t.status_enum||3==t.status_enum?"review":"")+' d-flex justify-content-between align-items-center">',o+='<div class="d-flex align-items-center">',o+='<div class="background-photo">',o+='<img class="product-photo" src="'+t.photo+'">',o+="</div>",o+="<div>",o+='<h1 class="title" '+(1==t.status_enum||3==t.status_enum?'style="color: #C5C5C5"':"")+">"+t.name_short+"</h1>",o+='<p class="description" '+(1==t.status_enum||3==t.status_enum?'style="color: #C7C7C7"':"")+">"+t.description+"</p>",o+="</div>",o+="</div>",1!=t.status_enum&&3!=t.status_enum&&(o+='<div class="check">',-1!=a&&(o+='<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),o+="</div>"),o+="</div>",o+="</div>"})):($(".tooltip").remove(),o+='<div class="col-sm-12">',o+='<div class="text-center" style="height: 150px; margin-bottom: 25px; margin-top: 15px;"><img style="margin: 0 auto;" class="product-photo" src="/modules/global/img/search-product_not-found.png" ></div>',o+='<p class="m-0 text-center" style="font-size: 24px; line-height: 30px; color: #636363;">Nenhum resultado encontrado.</p>',o+='<p class="text-center" style="font-size: 16px; line-height: 20px; color: #9A9A9A; margin-bottom: 20px;">Por aqui, nenhum produto com esse nome.</p>',o+="</div>");var a=$(n).find(".modal-body").height();$(n).find(s).find(".box-products").append(o).promise().done((function(){$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-select" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),t.data.length>6&&$(n).find(s).find(".box-products").mCustomScrollbar(),$(n).find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg")})),$(n).find(s).find(".product-photo").on("load",(function(){$(n).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(n).find(s).find(".box-products").find(".row").css("display","flex").promise().done((function(){t.data.length>6&&$(n).find(s).find(".box-products").css({height:"316px"});var o=$(n).find(".height-auto").height()+18;$(n).find(".modal-body").stop(!0,!0).height(a).animate({height:o},300).promise().done((function(){$(n).find(".product-photo").unbind("load")}))}))}))}))}))}})}))}function h(t,o){$(t).find(".modal-dialog").css({right:"-17px"}),$(t).find(".product-photo").unbind("load"),$(t).find(".box-description").find(".selecteds span").html(""),$(t).find(".box-description").find(".selecteds").css("display","none"),$(t).find(".modal-body").css("height","auto").attr("style","padding-bottom: 0px !important"),$(t).find(".modal-body").find(".height-auto").css("margin-top","");var i="create"==o?"#stage1":"#stage2";k(t),"edit"==o?($(t).find(".nav-tabs-horizontal").css("display","none"),$(t).find(".modal-footer").html('<button id="btn-modal-plan-return" type="button" data-type="edit" class="btn btn-default btn-lg" role="button">Voltar</button><button id="btn-modal-plan-next" type="button" data-type="edit" class="btn btn-primary btn-lg">Continuar</button>').removeClass("justify-content-between")):($(t).find("#btn-modal-plan-return").html("Voltar"),$(t).find("#btn-modal-plan-next").html("Continuar")),$(t).find(".tab-pane").removeClass("show active"),$(t).find(i).find(".box-products").html("").css({height:"316px","padding-right":"0px"}),$(t).find(i).find(".box-products").mCustomScrollbar("destroy"),$(t).find(i).find(".box-products").mCustomScrollbar("update"),$(t).find(".modal-body").mCustomScrollbar("destroy"),$(t).find(".modal-body").mCustomScrollbar("update"),$(t).find(i).find("#search-product").val(""),$(t).find(i).find(".box-review").html(""),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){"create"==o?$(t).find(".modal-body").append(loadingCreateStage1):$(t).find(".modal-body").append(loadingEditStage2),$.ajax({method:"POST",url:"/api/products/topselling",data:{project:a},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(a){var s='<div class="row">';a.data.length>0?a.data.forEach((function(t){var o=e.map((function(t){return t.id})).indexOf(t.id);s+='<div class="col-sm-6">',s+="<div "+(t.name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.name+'"':"")+' data-code="'+t.id+'" class="box-product '+(-1!=o?"selected":"")+" "+(1==t.status_enum||3==t.status_enum?"review":"")+' d-flex justify-content-between align-items-center">',s+='<div class="d-flex align-items-center">',s+='<div class="background-photo">',s+='<img class="product-photo" src="'+t.photo+'" style="display: none;">',s+="</div>",s+="<div>",s+='<h1 class="title" '+(1==t.status_enum||3==t.status_enum?'style="color: #C5C5C5"':"")+">"+t.name_short+"</h1>",s+='<p class="description" '+(1==t.status_enum||3==t.status_enum?'style="color: #C7C7C7"':"")+">"+t.description+"</p>",s+="</div>",s+="</div>",1!=t.status_enum&&3!=t.status_enum&&(s+='<div class="check">',-1!=o&&(s+='<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),s+="</div>"),s+="</div>",s+="</div>"})):(s+='<div class="col-sm-12">',s+='<div class="text-center" style="height: 150px; margin-bottom: 25px; margin-top: 15px;"><img style="margin: 0 auto;" class="product-photo" src="/modules/global/img/search-product_not-found.png" ></div>',s+='<p class="m-0 text-center" style="font-size: 24px; line-height: 30px; color: #636363;">Nenhum resultado encontrado.</p>',s+='<p class="text-center" style="font-size: 16px; line-height: 20px; color: #9A9A9A;">Por aqui, nenhum produto com esse nome.</p>',s+="</div>");var d=$(t).find(".modal-body").height();$(t).find(i).find(".box-products").html(s).promise().done((function(){if($('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-select" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),a.data.length>6&&$(t).find(i).find(".box-products").mCustomScrollbar(),"edit"==o){n.map((function(t){var o=e.map((function(t){return t.id})).indexOf(t.product_id);o>-1&&(e[o].name=t.product_name,e[o].photo=t.photo)}));var s='<div class="d-flex">';e.forEach((function(t){e.map((function(t){return t.id})).indexOf(t.id)>-1&&(s+='<div class="background-photo" data-toggle="tooltip" data-placement="top" data-id="'+t.id+'" title="'+t.name+'">',s+='<img class="product-photo" src="'+t.photo+'">',s+="</div>")})),s+="</div>",$(t).find(".box-photos-products").html(s).promise().done((function(){var o="auto";e.length>8&&(o=68*e.length+"px",$(t).find(".box-photos-products").mCustomScrollbar({axis:"x"})),$(t).find(".box-photos-products").find(".d-flex").css("width",o),$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-details" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'})}))}$(t).find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find(".product-photo").on("load",(function(){$(this).fadeIn(300)})),$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find("#tab-general-data_panel").addClass("show active").promise().done((function(){$(t).find(i).addClass("show active").promise().done((function(){var o=$(t).find(".height-auto").height()+18;$(t).find(".modal-body").stop(!0,!0).height(d).animate({height:o},300)}))}))}))}))}})}))}function g(t,o){$(t).find(".product-photo").unbind("load");var a="create"==o?"#stage2":"#stage3";$(t).find(".modal-body").css("height","auto"),$(t).find(a).find(".box-products").html("").css({overflow:"unset",height:"unset","padding-right":"0px"}),$(t).find(a).find(".box-products").find(".body").mCustomScrollbar("destroy"),$(t).find(a).find(".box-products").find(".body").mCustomScrollbar("update"),$(t).find(a).find(".box-review").html(""),$(t).find("#btn-modal-plan-return").html("Voltar"),"create"==o?$(t).find("#btn-modal-plan-next").html("Continuar"):$(t).find("#btn-modal-plan-next").html("Finalizar"),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingEditStage3).promise().done((function(){var n=0,s="";e.forEach((function(d){var l=e.map((function(t){return t.id})).indexOf(d.id),r=0;"edit"==o&&e[l].currency_type_enum&&(r=i),$.ajax({method:"GET",url:"/api/product/"+d.id,data:{plan_id:r},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){alertCustom("error","Ocorreu um erro, por favor, refaça a operação")},success:function(i){var d=1,r=i.data.cost.replace("R$ ","").replace("$ ","").replace(",","").replace(".",","),c=i.data.currency_type_enum;if(e[l].currency_type_enum&&(d=e[l].amount,r=e[l].value,c="USD"==e[l].currency_type_enum?2:1),s+='<div class="product d-flex align-items-center" data-code="'+i.data.id+'">',s+='<div class="div-product d-flex align-items-center" '+(i.data.name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+i.data.name+'"':"")+">",s+='<div class="div-photo" data-type="'+o+'"><img class="product-photo" src="'+i.data.photo+'" style="display: none;"></div>',s+='<h1 class="title">'+i.data.name_short+"</h1>",s+="</div>",s+='<div class="div-amount">',s+='<div class="d-flex align-items-center justify-content-center ">',s+='<div class="input-number">',s+='<button class="btn-sub">',s+='<img src="/modules/global/img/minus.svg">',s+="</button>",s+='<input type="number" class="form-control" name="amount" value="'+d+'" min="1" max="99" step="1">',s+='<button class="btn-add">',s+='<img src="/modules/global/img/plus.svg">',s+="</button>",s+="</div>",s+="</div>",s+="</div>",s+='<div class="div-value"><input class="form-control form-control-lg" autocomplete="off" value="'+r+'" type="text" name="value" placeholder="Valor un."></div>',s+='<div class="div-currency">',s+='<select class="sirius-select" type="text" name="currency_type_enum">',s+='<option value="BRL" '+(1==c?"selected":"")+">BRL (R$)</option>",s+='<option value="USD" '+(2==c?"selected":"")+">USD ($)</option>",s+="</select>",s+="</div>",s+="</div>",e.length==++n){var p=$(t).find(".modal-body").height();$(t).find(a).find(".box-products").html('<div class="box-details"><div class="head d-flex"><div>Produto</div><div>Quantidade<span style="color: #FF0000;">*</span></div><div>Custo (un)</div><div>Moeda</div></div><div class="body"><div class="row"><div class="col-sm-12">'+s+"</div></div></div></div>").promise().done((function(){$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-details" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),$(t).find(".sirius-select").each((function(){$(this).siriusSelect()})),$(t).find(a).find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find(a).find(".product-photo").on("load",(function(){$(this).fadeIn(300)})),$('input[name="value"]').mask("#.##0,00",{reverse:!0,onKeyPress:function(t,o,a,e){t.replace(/\./g,"").replace(",",".")>1e7&&(a.val("10.000.000,00"),alertCustom("error","Valor máximo de 10.000.000,00 por produto"))}}),e.length>4&&($(t).find(a).find(".box-products").find(".body").css({height:"278px",position:"relative",overflow:"hidden"}),$(t).find(a).find(".box-products").find(".body").mCustomScrollbar()),e.length>1?$(t).find(a).find(".box-review").html('<div class="switch-holder d-flex">\n                                                <label class="switch">\n                                                    <input type="checkbox" id="check-values" name="check-values" class="check" value="0">\n                                                    <span class="slider round"></span>\n                                                </label>\n                                                <label for="product_amount_selector" style="margin: 0;">Todos os produtos têm o mesmo custo</label>\n                                            </div>').css({"margin-top":"25px"}):$(t).find(a).find(".box-review").html(""),"edit"==o&&$(t).find(".modal-footer").find("#btn-modal-plan-next").html("Finalizar"),$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find("#tab-general-data_panel").addClass("show active").promise().done((function(){$(t).find(a).addClass("show active").promise().done((function(){var o=$(t).find(".height-auto").height()+40;$(t).find(".modal-body").stop(!0,!0).height(p).animate({height:o},300)}))}))}))}))}}})}))}))}))}function v(t){var o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=[],$(t).find(".product-photo").unbind("load"),$(t).find(".modal-body").css({height:"auto"}).attr("style","padding-top: 0 !important"),$(t).find(".informations-data").attr("style","height: auto !important"),$(t).find("#tab-customizations").removeClass("clicked show active").addClass("disabled"),$(t).find("#tab-general-data").removeClass("clicked").addClass("show active"),$(t).find(".nav-tabs-horizontal").css("display","block"),$(t).find("#tab-general-data_panel").removeClass("show active"),$(t).find(".modal-body").mCustomScrollbar("destroy"),$(t).find(".modal-body").mCustomScrollbar("update"),$(t).find("#stage1").find(".box-products").mCustomScrollbar("destroy"),$(t).find("#stage1").find(".box-products").mCustomScrollbar("update"),$(t).find(".products-data").css("height","148px"),$(t).find(".modal-title").html("Detalhes"),$(t).find(".modal-footer").html('<button plan="'+i+'" id="btn-modal-plan-delete" type="button" class="btn btn-default btn-lg px-0" style="box-shadow: none !important; color: #838383; align-items: center !important; display: flex; padding: 10px 32px; background: transparent; border: none;" role="button"><svg width="22" height="26" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.8846 4.2L17.7692 23.04C17.7594 23.5566 17.5577 24.0492 17.2064 24.4146C16.855 24.78 16.3814 24.9898 15.8846 25H6.11538C5.61864 24.9898 5.14497 24.78 4.79365 24.4146C4.44232 24.0492 4.24061 23.5566 4.23077 23.04L3.11538 4.2M1 4.2H21H1ZM7.15385 4.2V2.56C7.15385 2.14626 7.31188 1.74947 7.59319 1.45691C7.87449 1.16436 8.25602 1 8.65385 1H13.3462C13.5431 1 13.7382 1.04035 13.9202 1.11875C14.1022 1.19715 14.2675 1.31205 14.4068 1.45691C14.5461 1.60177 14.6566 1.77375 14.732 1.96301C14.8074 2.15228 14.8462 2.35514 14.8462 2.56V4.2H7.15385Z" stroke="#838383" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.9997 7.22223V20.5556M8.27246 7.22223L8.81792 20.5556M13.727 7.22223L13.1816 20.5556" stroke="#838383" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg><span style="margin-left: 10px;">Excluir plano</span></button><button id="btn-modal-plan-close" type="button" data-dismiss="modal" class="btn btn-primary btn-lg">Fechar</button>').removeClass("justify-content-end").addClass("justify-content-between"),$(t).find("#stage1").find(".products-edit").find("a").remove(),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingEditStage1),$.ajax({method:"GET",url:"/api/project/"+a+"/plans/"+i,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(a){n=a.data.products,e=[],n.map((function(t){e.push({id:t.product_id,currency_type_enum:t.currency,value:t.product_cost.replace("R$ ","").replace("$ ","").replace(/\,/g,"").replace(".",","),amount:t.amount})}));var i=parseFloat(a.data.price.replace("R$","").replace("$ ","").replace(/\./g,"").replace(",",".")).toFixed(2),l=(i*(s+1)/100).toFixed(2),r=x(),c=(i-l).toFixed(2),p=(c-r).toFixed(2),u=$(t).find(".modal-body").height(),m=a.data.products,f="74px";m.length>2&&m.length<=10&&(f="148px"),m.length>10&&(f="63px"),$(t).find(".products-data").css("height",f);var h='<div class="row">';if(m.length<=10)m.forEach((function(t){h+='<div class="col-sm-6">',h+="<div "+(t.product_name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.product_name+'"':"")+' class="box-product d-flex justify-content-between align-items-center" style="cursor: inherit;">',h+='<div class="d-flex align-items-center">',h+='<div class="background-photo"><img class="product-photo" src="'+t.photo+'" style="display: none;"></div>',h+="<div>",h+='<h1 class="title">'+t.product_name_short+"</h1>",h+='<p class="description">Qtd: '+t.amount+"</p>",h+="</div>",h+="</div>",h+="</div>",h+="</div>"}));else{h+='<div class="col-sm-12 d-flex align-items-center">';var g=0;m.forEach((function(t){++g<=8&&(h+='<div data-toggle="tooltip" data-placement="top" title="'+t.product_name+'" class="box-product" style="cursor: inherit;">',h+='<div class="background-photo" style="width: 43px; height: 43px;"><img class="product-photo" src="'+t.photo+'" style="display: none;"></div>',h+="</div>")}));var v=m.length-8;h+='<div style="margin-bottom: 18px;">',h+='<a type="button" id="all-products" style="cursor: pointer; color: #2E85EC; font-weight: bold; font-size: 16px;">+'+v+"</a>",h+="</div>",h+="</div>"}h+="</div>",$(t).find("#stage1").find(".box-products").html(h).promise().done((function(){m.length>4&&m.length<=10&&$(t).find("#stage1").find(".box-products").mCustomScrollbar(),$(t).find("#tab-customizations").removeClass("disabled"),$(t).find(".modal-title").html("Detalhes de "+a.data.name_short),$(t).find(".modal-title").attr("data-title","Detalhes de "+a.data.name),$(t).find("#btn-edit-informations-plan").attr("data-code",a.data.id),$(t).find("#name").val(a.data.name_short),$(t).find("#name").attr("data-short",a.data.name_short).attr("data",a.data.name),a.data.name_short_flag?$(t).find("#name").attr("data-toggle","tooltip").attr("title",a.data.name):($(t).find("#name").removeAttr("data-toggle").removeAttr("title"),$(t).find("#name").tooltip("dispose")),$(t).find("#price").val(a.data.price),$(t).find("#price").attr("data",a.data.price),$(t).find("#description").val(a.data.description_short),$(t).find("#description").attr("data-short",a.data.description_short).attr("data",a.data.description),a.data.description_short_flag?$(t).find("#description").attr("data-toggle","tooltip").attr("title",a.data.description):($(t).find("#description").removeAttr("data-toggle").removeAttr("title"),$(t).find("#description").tooltip("dispose")),$(t).find("#stage1").find(".price-plan p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i)),$(t).find("#stage1").find(".costs-plan p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)),$(t).find("#stage1").find(".tax-plan p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(l)),$(t).find("#stage1").find(".comission-plan p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)),p<0?$(t).find("#stage1").find(".profit-plan").find("p").css("color","#F10800"):$(t).find("#stage1").find(".profit-plan").find("p").css("color","#41DC8F"),$(t).find("#stage1").find(".profit-plan p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p)),$(t).find("#stage1").find(".description-tax p span").html(s.toString().replace(".",",")),$(t).find("#stage1").find(".release_money_days").html(d),$(t).find("#stage1").find(".products-edit").find(".title").find("span").html(" "+a.data.products.length+(a.data.products.length>1?" produtos":" produto")),$(t).find("#stage1").find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find("#stage1").find(".product-photo").on("load",(function(){$(this).fadeIn(300)})),1==o?b(t):$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-select" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),$("#modal_edit_plan .modal-body").css("overflow","hidden"),$(t).find(".modal-body").mCustomScrollbar(),$(t).find("#tab-general-data_panel").addClass("show active").promise().done((function(){$(t).find("#stage1").addClass("show active").promise().done((function(){$(t).find(".modal-body").stop(!0,!0).height(u).animate({height:"485px"},300)}))}))}))}))}})}))}function b(t){var o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];$(t).find(".product-photo").unbind("load"),$(t).find(".modal-body").mCustomScrollbar("destroy"),$(t).find(".modal-body").mCustomScrollbar("update"),$(t).find("#stage1-customization").find(".body-products").mCustomScrollbar("destroy"),$(t).find("#stage1-customization").find(".body-products").mCustomScrollbar("update"),$(t).find(".modal-body").css("height","auto").attr("style","padding-bottom: 0px !important").attr("style","padding-top: 0 !important"),$(t).find("#stage1-customization").find(".box-products").css({height:"auto"}),$(t).find(".modal-footer").html('<button plan="'+i+'" id="btn-modal-plan-delete" type="button" class="btn btn-default btn-lg px-0" style="box-shadow: none !important; color: #838383; align-items: center !important; display: flex; padding: 10px 32px; background: transparent; border: none;" role="button"><svg width="22" height="26" viewBox="0 0 22 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18.8846 4.2L17.7692 23.04C17.7594 23.5566 17.5577 24.0492 17.2064 24.4146C16.855 24.78 16.3814 24.9898 15.8846 25H6.11538C5.61864 24.9898 5.14497 24.78 4.79365 24.4146C4.44232 24.0492 4.24061 23.5566 4.23077 23.04L3.11538 4.2M1 4.2H21H1ZM7.15385 4.2V2.56C7.15385 2.14626 7.31188 1.74947 7.59319 1.45691C7.87449 1.16436 8.25602 1 8.65385 1H13.3462C13.5431 1 13.7382 1.04035 13.9202 1.11875C14.1022 1.19715 14.2675 1.31205 14.4068 1.45691C14.5461 1.60177 14.6566 1.77375 14.732 1.96301C14.8074 2.15228 14.8462 2.35514 14.8462 2.56V4.2H7.15385Z" stroke="#838383" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M10.9997 7.22223V20.5556M8.27246 7.22223L8.81792 20.5556M13.727 7.22223L13.1816 20.5556" stroke="#838383" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg><span style="margin-left: 10px;">Excluir plano</span></button><button id="btn-modal-plan-close" type="button" data-dismiss="modal" class="btn btn-primary btn-lg">Fechar</button>').removeClass("justify-content-end").addClass("justify-content-between"),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){o&&$(t).find(".modal-body").append(loadingCustomStage1);var a="";a+='<div class="row header">',a+='<div class="col-sm-6">',a+='<h1 class="title">Produtos no plano</h1>',a+="</div>",a+='<div class="col-sm-6">',a+='<h1 class="title">Tipo de customização</h1>',a+="</div>",a+="</div>",a+='<div class="row body-products" style="padding: 0;">',a+='<div class="col-sm-12">',n.forEach((function(t){a+='<div class="row box-product body align-items-center" style="cursor: inherit;">',a+='<div class="col-sm-6" '+(t.product_name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.product_name+'"':"")+">",a+='<div class="product d-flex align-items-center">',a+='<div class="background-photo">',a+='<img class="product-photo" src="'+t.photo+'" style="display: none;">',a+="</div>",a+="<div>",a+='<h1 class="title">'+t.product_name_short+"</h1>",a+='<p class="description m-0">Qtd: '+t.amount+"</p>",a+="</div>",a+="</div>",a+="</div>",a+='<div class="col-sm-6">',a+='<div class="d-flex '+(t.custom_configs.length>0?"justify-content-between":"justify-content-end")+' align-items-center">',t.custom_configs.length>0&&(a+='<div class="d-flex customs">',-1!=t.custom_configs.map((function(t){return t.type})).indexOf("Text")&&(a+='<div class="d-flex align-items-center">',a+='<div class="custom-type">',a+='<img src="/modules/global/img/icon-custom-product-text.svg">',a+="</div>",a+="</div>"),-1!=t.custom_configs.map((function(t){return t.type})).indexOf("Image")&&(a+='<div class="d-flex align-items-center">',a+='<div class="custom-type">',a+='<img src="/modules/global/img/icon-custom-product-image.svg">',a+="</div>",a+="</div>"),-1!=t.custom_configs.map((function(t){return t.type})).indexOf("File")&&(a+='<div class="d-flex align-items-center">',a+='<div class="custom-type">',a+='<img src="/modules/global/img/icon-custom-product-file.svg">',a+="</div>",a+="</div>"),a+="</div>"),a+='<div class="d-flex align-items-center">',a+='<a class="btn-customizations" data-product="'+t.product_id+'" type="button" style="cursor: pointer; '+(t.custom_configs.length>0?"margin-right: 14px;":"")+'">'+(t.custom_configs.length>0?"Editar":"Adicionar")+"</a>",t.custom_configs.length>0&&(a+='<div class="switch-holder active_custom d-flex align-items-center">',a+='<label class="switch m-0">',a+='<input type="checkbox" data-product="'+t.product_id+'" name="check-values" class="check active_custom_product" value="'+t.is_custom+'" '+(t.is_custom?"checked":"")+">",a+='<span class="slider round"></span>',a+="</label>",a+="</div>"),a+="</div>",a+="</div>",a+="</div>",a+="</div>"})),a+="</div>",a+="</div>",$(t).find("#tab-general-data").removeClass("show active"),$(t).find("#tab-customizations").addClass("show active");var e=$(t).find(".modal-body").height();$(t).find("#stage1-customization").find(".box-products").html(a).promise().done((function(){n.length>2&&($(t).find("#stage1-customization").find(".body-products").css({height:"214px",position:"relative",overflow:"hidden"}),$(t).find("#stage1-customization").find(".body-products").mCustomScrollbar()),$(t).find(".customizations").find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find(".customizations").find(".product-photo").fadeIn(300),$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find(".product-photo").unbind("load"),$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-select" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),$(t).find("#tab-customizations_panel").addClass("show active").promise().done((function(){$(t).find("#stage1-customization").addClass("show active").promise().done((function(){var o=$(t).find(".height-auto").height();$(t).find(".modal-body").stop(!0,!0).height(e).animate({height:o},300)}))}))}))}))}))}function y(t,o){if("create"==o)$.ajax({method:"POST",url:"/api/project/"+a+"/plans",dataType:"JSON",headers:{Authorization:$('meta[name="access-token"]').attr("content")},data:{project_id:a,products:e,name:$(t).find("#name").val(),price:$(t).find("#price").val(),description:$(t).find("#description").val()},error:function(t){errorAjaxResponse(t)},success:function(o){j(),$(t).find("#name").val(""),$(t).find("#price").val(""),$(t).find("#description").val(""),alertCustom("success","Plano adicionado com sucesso"),$(t).modal("hide")}});else{var n=$("#pagination-plans").find(".active").text();$(".box-products .form-control").each((function(){var t=$(this).parents(".product").attr("data-code"),o=$(this).attr("name"),a=$(this).val();e.map((function(e){if(t==e.id){if("amount"==o)return Object.assign(e,{amount:a});if("value"==o)return Object.assign(e,{value:a})}}))})),$(".box-products .sirius-select").each((function(){var t=$(this).parents(".product").attr("data-code"),o=$(this).attr("name"),a=$(this).val();e.map((function(e){if(t==e.id&&"currency_type_enum"==o)return Object.assign(e,{currency_type_enum:a})}))})),$.ajax({method:"PUT",url:"/api/plans/"+i+"/products",dataType:"JSON",headers:{Authorization:$('meta[name="access-token"]').attr("content")},data:{products:e},error:function(t){errorAjaxResponse(t)},success:function(o){j(n),alertCustom("success","Produtos do plano atualizados"),$(t).modal("hide")}})}}function _(){$.ajax({async:!1,method:"GET",url:"/api/project/"+a+"/plans/"+i,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){n=t.data.products}})}function x(){for(var t=0,o=0;o<e.length;o++)if(e[o].value){var a=e[o].value.replace(/\./g,"").replace(",",".");"USD"==e[o].currency_type_enum&&(a*=l/100),t+=a*e[o].amount}return t}$(".tab_plans").on("click",(function(){p(),$("#previewimage").imgAreaSelect({remove:!0}),$("#plan-name").val(""),j(),$(this).off(),$.ajax({async:!1,method:"GET",url:"/api/projects/"+a+"/companie",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){console.log(t)},success:function(t){s=parseFloat(t.data.gateway_tax),d=t.data.gateway_release_money_days,l=t.data.currency_quotation}})}));var C=null;$("body").on("keyup","#search-product",(function(t){clearTimeout(C);var o="#"+$(this).parents(".modal").attr("id"),a="create";"#modal_edit_plan"==o&&(a="edit");var e=t.target.value,n=$(o).find("#search-product-description").val();C=setTimeout((function(){f(e,n,o,a)}),800)}));var w=null;function k(t){e.length>0?"#modal_add_plan"==t?($(t).find(".box-description").find(".selecteds span").html(e.length),$(t).find(".box-description").find(".selecteds").css("display","block")):$(t).find("#stage2").find(".box-breadcrumbs").find(".title span").html(" "+e.length+(e.length>1?" produtos":" produto")):"#modal_add_plan"==t?($(t).find(".box-description").find(".selecteds span").html(""),$(t).find(".box-description").find(".selecteds").css("display","none")):$(t).find("#stage2").find(".box-breadcrumbs").find(".title span").html(" 0 produtos")}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t=n,loadOnTable("#data-table-plan","#table-plans"),n=null==n?"/api/project/"+a+"/plans":e>0?"/api/project/"+a+"/plans?page="+e+"&plan=":"/api/project/"+a+"/plans"+n;var i=$("#plan-name").val();$.ajax({method:"GET",url:n,dataType:"json",data:{plan:i},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){function o(){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){$("#data-table-plan").html("Erro ao encontrar dados"),errorAjaxResponse(t)})),success:function(t){$("#pagination-plans").html(""),u(t.data)?(""!=i?$("#data-table-plan").html("\n                            <tr class='text-center'>\n                                <td colspan='11' style='height: 70px; vertical-align: middle;'>\n                                    Nenhum dado encontrado\n                                </td>\n                            </tr>\n                        "):$("#data-table-plan").html("\n                            <tr class='text-center'>\n                                <td colspan='11' style='height: 70px; vertical-align: middle;'>\n                                    <div class='d-flex justify-content-center align-items-center'>\n                                        <img src='/modules/global/img/empty-state-table.svg' style='margin-right: 60px;'>\n                                        <div class='text-left'>\n                                            <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum plano configurado</h1>\n                                            <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro plano para poder\n                                            <br>gerenciá-los nesse painel.</p>\n                                            <button type='button' style='margin: 0; width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-plan' data-toggle=\"modal\" data-target=\"#modal_add_plan\">Adicionar plano</button>\n                                        </div>\n                                    </div>\n                                </td>\n                            </tr>\n                        "),$("#table-plans").addClass("table-striped"),$("#pagination-plans").html("")):($("#tab_plans-panel").find(".no-gutters").css("display","flex"),$("#table-plans").find("thead").css("display","contents"),$("#data-table-plan").html(""),$("#count-plans").html(t.meta.total),"approved"==t.data[0].document_status?($.each(t.data,(function(t,a){data="",data+="<tr>",data+='<td id="" class="" style="vertical-align: middle; line-height: 1;"><span '+(a.name_short_flag?'data-toggle="tooltip" title="'+a.name+'"':"")+">"+a.name_short+'</span><div style="color: #8B8B8B; line-height: 1;"><small>com '+(a.products_length>1?a.products_length+" produtos":a.products_length+" produto")+"</small></div></td>",data+="<td id='' class='' style='vertical-align: middle;'><span "+(a.description_short_flag?"data-toggle='tooltip' title='"+a.description+"'":"")+">"+a.description_short+"</span></td>",data+='<td id="" class="" style="vertical-align: middle;">'+a.price+"</td>",data+='<td id="link" data-status="'+a.status+'" class="copy_link text-center" title="Copiar Link" style="vertical-align: middle; '+(1==a.status?"cursor:pointer;":"")+'" link="'+a.code+'">',data+="<span "+(0==a.status?'data-toggle="tooltip" title="Domínio não confirugado"':"")+">",data+='<span class="display-sm-none display-m-none">Copiar </span><img src="/modules/global/img/icon-copy-c.svg">',data+="</span>",data+="</td>",data+='<td id="" class="text-center"><span class="badge badge-'+o[a.status]+'">'+a.status_translated+"</span></td>",data+="<td class='mg-responsive text-center' style='line-height: 1;'>",data+="<div class='d-flex justify-content-end align-items-center'>",data+="<a title='Visualizar' class='mg-responsive pointer details-plan' plan='"+a.id+"' role='button'><span class='o-eye-1'></span></a>",data+="<a title='Excluir' class='mr-0 mg-responsive pointer delete-plan' plan='"+a.id+"' role='button'><span class='o-bin-1'></span></a>",data+="</div>",data+="</td>",data+="</tr>",$("#data-table-plan").append(data),$("#table-plans").addClass("table-striped"),$("#currency_type_project").val(a.currency_project)})),pagination(t,"plans",j)):($("#data-table-plan").html("<tr class='text-center'><td colspan='11' style='height: 70px; vertical-align: middle;'>Link de pagamento só ficará disponível quando seus documentos e da sua empresa estiverem aprovados</td></tr>"),$("#table-plans").addClass("table-striped")),$('[data-toggle="tooltip"]').tooltip({container:".page"}))}})}$("body").on("keyup","#search-product-description",(function(t){clearTimeout(w);var o="#"+$(this).parents(".modal").attr("id"),a="create";"#modal_edit_plan"==o&&(a="edit");var e=t.target.value,n=$(o).find("#search-product").val();w=setTimeout((function(){f(n,e,o,a)}),800)})),$("body").on("keyup",".box-products #price",(function(){if(""!=$(this).val()){var t=$(this).val().replace(/\./g,"").replace(",","."),o=(t*(s+1)/100).toFixed(2),a=x(),e=(t-o).toFixed(2),n=(e-a).toFixed(2);$(".price-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t)),$(".tax-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o)),$(".comission-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)),n<0?$(".profit-plan").find("p").css("color","#F10800"):$(".profit-plan").find("p").css("color","#41DC8F"),$(".profit-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n))}else{n=(a=x()).toFixed(2);$(".price-plan").find("p").html("R$0,00"),$(".tax-plan").find("p").html("R$0,00"),$(".comission-plan").find("p").html("R$0,00"),$(".profit-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format("-"+n))}})),$("body").on("click",".box-product",(function(){var t=this,o=$(this).data("code"),a=$(this).parents(".tab-content").attr("id"),n=$(this).parents(".tab-pane").attr("id"),s="#"+$(this).parents(".modal").attr("id"),d="auto";if($(this).hasClass("review"))alertCustom("error","Não é possível selecionar este produto.");else if("tabs-modal-edit-plans"==a&&"stage2"==n||"tabs-modal-create-plans"==a&&"stage1"==n)if($(this).hasClass("selected"))if("tabs-modal-create-plans"==a&&"stage1"==n){$(t).removeClass("selected"),$(t).find(".check img").remove();var l=e.map((function(t){return t.id})).indexOf(o);e.splice(l,1),k(s)}else $.ajax({method:"POST",url:"/api/products/verifyproductinplansale",dataType:"json",data:{product_id:o,plan_id:i},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(a){if(a.product_in_plan_sale)alertCustom("error","Não é possível remover o produto, possui vendas associadas a este plano.");else{$(t).removeClass("selected"),$(t).find(".check img").remove();var n=e.map((function(t){return t.id})).indexOf(o);e.splice(n,1),$(s).find(".box-photos-products").find(".d-flex").find('[data-id="'+o+'"]').remove(),e.length>8?(d=68*e.length+"px",$(s).find(".box-photos-products").find(".d-flex").css("width",d),$(s).find(".box-photos-products").mCustomScrollbar({axis:"x",advanced:{autoExpandHorizontalScroll:!0}})):($(s).find(".box-photos-products").children(":first").css("margin-left",""),$(s).find(".box-photos-products").find(".d-flex").css("width","586px"),$(s).find(".box-photos-products").mCustomScrollbar("destroy"),$(s).find(".box-photos-products").mCustomScrollbar("update")),k(s)}}});else{if($(this).addClass("selected"),$(this).find(".check").append('<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),e.push({id:o}),"tabs-modal-edit-plans"==a&&"stage2"==n){var r=$(t).attr("data-original-title"),c=$(t).find("img").attr("src");$(s).find(".box-photos-products").find(".d-flex").append('<div class="background-photo" data-toggle="tooltip" data-placement="top" data-id="'+o+'" title="'+r+'"><img class="product-photo" src="'+c+'"></div>'),$('[data-toggle="tooltip"]').tooltip({container:".page"}),e.length>8?(d=68*e.length+"px",$(s).find(".box-photos-products").find(".d-flex").css("width",d),$(s).find(".box-photos-products").mCustomScrollbar({axis:"x",advanced:{autoExpandHorizontalScroll:!0}})):($(s).find(".box-photos-products").children(":first").css("margin-left",""),$(s).find(".box-photos-products").find(".d-flex").css("width","586px"),$(s).find(".box-photos-products").mCustomScrollbar("destroy"),$(s).find(".box-photos-products").mCustomScrollbar("update"))}k(s)}})),$("body").on("click",".box-products .div-photo",(function(){var t=$(this).parent().parent().data("code"),o=$(this).attr("data-type"),a="#modal_add_plan",n=e.map((function(t){return t.id})).indexOf(t);"edit"==o?($.ajax({method:"POST",url:"/api/products/verifyproductinplansale",dataType:"json",data:{product_id:t,plan_id:i},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){t.product_in_plan_sale?alertCustom("error","Não é possível remover o produto, possui vendas associadas a este plano."):(e.splice(n,1),e.length>0?($(".tooltip").remove(),g(a,o)):h(a,o))}}),a="#modal_edit_plan"):(e.splice(n,1),e.length>0?($(".tooltip").remove(),g(a,o)):h(a,o))})),$("body").on("click","#check-values",(function(){var t=$(this).val();if(0==t){$(this).val(1);var o=$(".box-products").find(".product").first().find('.form-control[name="value"]').val();$('.box-products .form-control[name="value"]').val(o)}else 1==t&&$(this).val(0)})),$("body").on("keyup",'.form-control[name="value"]',(function(t){1==$("#check-values").val()&&$('.box-products .form-control[name="value"]').val($(this).val())})),$("body").on("click","#btn-modal-plan-next",(function(){var t="#"+$(this).parents(".modal").attr("id"),o=$(this).attr("data-type"),a="create"==o?"#tabs-modal-create-plans":"#tabs-modal-edit-plans",n=$(t).find(a).find(".tab-pane.active").attr("id");"custom"==o?function(){var t="#modal_edit_plan";$(t).find(".modal-body").css("height","auto"),$(t).find(".modal-footer").find(".btn").prop("disabled",!0),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingCustomStage2);var o=new FormData(document.getElementById("form-update-custom-config"));o.append("plan",i),$.ajax({method:"POST",url:"/api/plans/config-custom-product",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:o,processData:!1,contentType:!1,cache:!1,error:function(o){$(t).find(".modal-footer").find(".btn").prop("disabled",!1),_(),b(t,!1),alertCustom("error","Erro ao atualizar configurações do plano")},success:function(o){$(t).find(".modal-footer").find(".btn").prop("disabled",!1),_(),b(t,!1),alertCustom("success","Configurações do plano atualizado com sucesso")}})}))}():e.length>0?"create"==o?"stage1"==n?g(t,o):"stage2"==n?function(t){$(t).find(".product-photo").unbind("load"),$(t).find(".modal-body").css("height","auto"),$(t).find("#btn-modal-plan-next").html("Finalizar"),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingCreateStage3),$(".box-products .form-control").each((function(){var t=$(this).parents(".product").attr("data-code"),o=$(this).attr("name"),a=$(this).val();e.map((function(e){if(t==e.id){if("amount"==o)return Object.assign(e,{amount:a});if("value"==o)return Object.assign(e,{value:a})}}))})),$(".box-products .sirius-select").each((function(){var t=$(this).parents(".product").attr("data-code"),o=$(this).attr("name"),a=$(this).val();e.map((function(e){if(t==e.id&&"currency_type_enum"==o)return Object.assign(e,{currency_type_enum:a})}))}));var o=$(t).find(".modal-body").height();$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$('input[name="price"]').mask("#.##0,00",{reverse:!0}),$(t).find(".costs-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(x())),$(t).find(".box-review").find(".tax").html(s.toString().replace(".",",")),$(t).find(".box-review").find(".release_money_days").html(d),$(t).find("#stage3").addClass("show active").promise().done((function(){var a=$(t).find(".height-auto").height()+40;$(t).find(".modal-body").stop(!0,!0).height(o).animate({height:a},300).promise().done((function(){$(t).find(".product-photo").unbind("load")}))}))}))}))}(t):"stage3"==n&&y(t,o):"stage1"==n?h(t,o):"stage2"==n?g(t,o):"stage3"==n&&y(t,o):alertCustom("error","Selecione um produto para prosseguir")})),$("body").on("click","#btn-modal-plan-return",(function(){var t="#"+$(this).parents(".modal").attr("id"),o=$(this).attr("data-type"),a="create"==o?"#tabs-modal-create-plans":"#tabs-modal-edit-plans",e=$(t).find(a).find(".tab-pane.active").attr("id");"create"==o?"stage1"==e?($(t).modal("hide"),$.when(t).done((function(){$(t).find(".tab-pane").removeClass("show active")}))):"stage2"==e?h(t,o):"stage3"==e&&g(t,o):"edit"==o?"stage2"==e?v(t):"stage3"==e?h(t,o):"stage4"==e&&v(t):b(t,!1)})),$(document).on("click",".add-plan",(function(){e=[];var t="#modal_add_plan";$(t).find(".tab-pane").removeClass("show active"),$(t).attr("data-backdrop","static"),$(t).modal("show"),h(t,"create")})),$("#table-plans").on("click",".copy_link",(function(){if("1"==$(this).attr("data-status")){var t=$("<input>");$("#table-plans").append(t),t.val($(this).attr("link")).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Link copiado!")}})),$("#table-plans").on("click",".details-plan",(function(){n=[],i=$(this).attr("plan");var t="#modal_edit_plan";$(t).find("#btn-cancel-update-informations-plan").trigger("click").promise().done((function(){$(t).find(".informations-data").stop(!0,!0).css("height",""),$(t).find(".height-auto").stop(!0,!0).css("margin-top","")})),$(t).attr("data-backdrop","static"),$(t).modal("show"),v(t)})),$("#table-plans").on("click",".edit-plan",(function(){n=[],i=$(this).attr("plan");var t="#modal_edit_plan";$(t).attr("data-backdrop","static"),$(t).modal("show"),v(t)})),$("body").on("click","#btn-edit-informations-plan",(function(){var t=$(this).parent().parent().parent(),o=t.find(".informations-data").css("height","auto").height();t.find(".informations-data").hasClass("edit")||setTimeout((function(){$(t).find("#name").tooltip("disable"),$(t).find("#description").tooltip("disable"),$("#btn-edit-products-plan").hide(),$("#btn-edit-informations-plan").hide(),$("#modal_edit_plan #stage1 .box-products").off("wheel"),$("#modal_edit_plan #stage1 .box-products .scrollbox").remove(),$("#modal_edit_plan #stage1 .box-products .scrollbox-bar").remove(),$("#modal_edit_plan #stage1 .informations-edit .icon").attr("style","border-color: #2E85EC !important"),t.find(".informations-data").addClass("edit"),t.find(".informations-data").find(".form-control").attr("readonly",!1),t.find("#price").val((function(t,o){return o.replace("R$ ","")})),t.find("#price").mask("#.##0,00",{reverse:!0}),t.find(".informations-data").append('<div class="buttons-update"><div class="d-flex mt-20" style="justify-content: flex-end !important;"><button type="button" class="btn btn-default btn-lg mr-10" id="btn-cancel-update-informations-plan">Cancelar</button><button type="button" class="btn btn-primary btn-lg" id="btn-update-informations-plan">Atualizar</button></div></div>').promise().done((function(){var a=t.find(".informations-data").height();t.find(".informations-data").height(o).animate({height:a},300)}));var a=t.find("#name").attr("data"),e=t.find("#price").val(),n=t.find("#description").attr("data");t.find("#name").val(a),t.find("#price").val(e.replace("R$","")),t.find("#description").val(n)}),0)})),$("body").on("click","#btn-cancel-update-informations-plan",(function(){var t=$(this).parents(".informations-edit"),o=t.find(".informations-data").height();$("#btn-edit-products-plan").show(),$("#btn-edit-informations-plan").show(),$(t).find("#name").tooltip("enable"),$(t).find("#description").tooltip("enable"),$(t).find(".icon").css("border-color","#F8F8F8"),t.find(".informations-data").removeClass("edit"),t.find(".form-control").attr("readonly",!0);var a=t.find("#name").attr("data-short"),e=t.find("#price").attr("data"),n=t.find("#description").attr("data-short");t.find("#name").val(a),t.find("#price").val(e),t.find("#description").val(n),$(this).parents(".buttons-update").remove().promise().done((function(){var a=t.find(".informations-data").css("height","auto").height();t.find(".informations-data").height(o).animate({height:a},300),$("#modal_edit_plan").find(".height-auto").stop(!0,!0).animate({"margin-top":0},300)}))})),$("body").on("click","#tab-general-data",(function(){if(!$(this).hasClass("clicked")){v("#modal_edit_plan")}$("#tab-customizations").removeClass("clicked"),$(this).addClass("clicked")})),$("body").on("click","#tab-customizations",(function(){if(!$(this).hasClass("clicked")){b("#modal_edit_plan",!0)}$("#tab-general-data").removeClass("clicked"),$(this).addClass("clicked")})),$("body").on("click",".btn-customizations",(function(){!function(t,o){$(t).find(".modal-body").css("height","auto"),$(t).find("#product_id").val(o),$(t).find(".modal-footer").html('<button id="btn-modal-plan-return" type="button" data-type="custom" class="btn btn-default btn-lg" role="button">Voltar</button><button id="btn-modal-plan-next" type="button" data-type="custom" class="btn btn-primary btn-lg">Salvar e fechar</button>').removeClass("justify-content-between").addClass("justify-content-end"),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingCustomStage2);var a,e=$(t).find(".modal-body").height();a=n.map((function(t){return t.product_id})).indexOf(o),$(t).find("#stage2-customization").find(".product-custom").removeAttr("data-toggle").removeAttr("title"),$(".product-custom").tooltip("dispose"),$(t).find("#stage2-customization").find(".box-breadcrumbs").find(".title").html("Personalização de "+n[a].product_name_short),n[a].product_name_short_flag&&($(t).find("#stage2-customization").find(".product-custom").attr("data-toggle","tooltip").attr("title",n[a].product_name),$('[data-toggle="tooltip"]').tooltip({container:".page"})),$(t).find("#stage2-customization").find(".background-photo").html('<img src="'+n[a].photo+'" class="product-photo">'),$(t).find("#stage2-customization").find(".name-product").html(n[a].product_name_short),$(t).find("#stage2-customization").find(".qtd-product").html("Qtd: "+n[a].amount),$(t).find("#stage2-customization").find(".active_custom").attr("name","is_custom["+o+"]"),$(t).find("#stage2-customization").find(".active_custom").prop("checked",!!n[a].is_custom).val(n[a].is_custom).change(),$(t).find("#add-list-custom-product").attr("product",o),n[a].shopify_id>0&&(r=!0);var i="";n[a].custom_configs.length>0?n[a].custom_configs.forEach((function(t){i+='<div class="row custom" style="margin-bottom: 20px;">',i+='<input type="hidden" name="productsPlan[]" value="'+o+'">',i+='<div class="col-sm-12">',i+='<div class="d-flex">',i+='<div class="d-flex">',i+='<div style="margin-right: 8px;">',i+='<input type="hidden" name="type['+o+'][]" value="'+t.type+'">',i+='<button style="width: 45px; height: 45px;" type="button" class="btn btn-outline-secondary btn-type-custom border-light-gray">',i+=m(t.type),i+="</button>",i+="</div>",i+="</div>",i+='<div style="width: 100%; margin-right: 16px;">',i+='<input readonly type="text" name="label['+o+'][]" class="form-control input-pad edit-input added-custom-title" data-index="'+o+'" placeholder="Nome para personalização" value="'+t.label+'">',i+="</div>",i+="<div>",i+='<button style="width: 45px; height: 45px;" type="button" data-index="'+o+'" class="btn btn-outline btn-delete btn-trash-custom d-flex justify-content-around align-items-center align-self-center flex-row">',i+='<span class="o-bin-1"></span>',i+="</button>",i+="</div>",i+="</div>",i+="</div>",i+="</div>"})):i+='<div class="row custom-empty"><div class="col-sm-12">Nenhuma personalização adicionada</div></div>',r?$(".custom_products_checkbox").html('\n                <div class="d-flex align-items-center" style="line-height: 1;">\n                    <div class="switch-holder">\n                        <label class="switch">\n                            <input type="checkbox" class="allow_change_in_block" name="allow_change_in_block" value="true">\n                            <span class="slider round"></span>\n                        </label>\n                    </div>\n                    <span>Aplicar personalização nas outras variantes deste produto</span>\n                </div>\n                ').css({margin:"20px 0 0"}):$(".custom_products_checkbox").html(""),$(t).find("#stage2-customization").find(".list-custom-products").html(i).promise().done((function(){$(t).find("#stage2-customization").find(".product-photo").on("load",(function(){$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find("#tab-customizations_panel").addClass("show active").promise().done((function(){$(t).find("#stage2-customization").addClass("show active").promise().done((function(){var o=$(t).find(".modal-body").css("height","auto").height()+(n.length>2?45:35);$(t).find(".modal-body").height(e).animate({height:o},300).promise().done((function(){$(t).find(".product-photo").unbind("load")}))}))}))}))}))}))}))}("#modal_edit_plan",$(this).attr("data-product"))})),$("body").on("click",".btn-type",(function(){$(".btn-type").removeClass("btn-active"),$(this).addClass("btn-active"),$("#custom-type").val($(this).attr("typeCustom"))})),$("body").on("click","#add-list-custom-product",(function(){var t=$(".list-custom-products").find(".custom").length,o=$("#custom-type").val(),a=$("#custom-title").val();if(""!=a&&""!=o){if(t>=5)return void alertCustom("error",5==t?"Você pode adicionar no máximo 5 personalizações ao seu produto":"Número máximo de personalizações do seu produto excedida");$(".list-custom-products").find(".custom-empty").length>0&&$(".list-custom-products").html(""),$("#modal_edit_plan").find(".modal-body").css("height","auto");var e=m(o),n=$(this).attr("product"),i="";i+='<div class="row custom" style="margin-bottom: 20px;">',i+='<input type="hidden" name="productsPlan[]" value="'+n+'">',i+='<div class="col-sm-12">',i+='<div class="d-flex">',i+='<div class="d-flex">',i+='<div style="margin-right: 8px;">',i+='<input type="hidden" name="type['+n+'][]" value="'+o+'">',i+='<button style="width: 45px; height: 45px;" type="button" class="btn btn-outline-secondary btn-type-custom border-light-gray">',i+=e,i+="</button>",i+="</div>",i+="</div>",i+='<div style="width: 100%; margin-right: 16px;">',i+='<input readonly type="text" name="label['+n+'][]" class="form-control input-pad edit-input" placeholder="Nome para personalização" value="'+a+'">',i+="</div>",i+="<div>",i+='<button style="width: 45px; height: 45px;" type="button" class="btn btn-outline btn-delete btn-trash-custom d-flex justify-content-around align-items-center align-self-center flex-row">',i+='<span class="o-bin-1"></span>',i+="</button>",i+="</div>",i+="</div>",i+="</div>",i+="</div>",$(".list-custom-products").append(i),$("#custom-title").val(""),$("#custom-type").val(""),$(".btn-type").removeClass("btn-active")}})),$("body").on("click",".edit-input",(function(){$(this).prop("readonly",!1);var t=$(this).parent().parent().parent().parent();t.find(".btn-type-custom").addClass("btn-edit"),t.find(".btn-trash-custom").removeClass("btn-delete").addClass("btn-edit-row").html('\n            <svg width="22" height="16" viewBox="0 0 22 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M20 2L8.92308 14L2 7.33333" stroke="white" stroke-width="2.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n        ')})),$("body").on("click",".btn-edit-row",(function(){var t=$(this).parent().parent().parent().parent();t.find(".edit-input").prop("readonly",!0),t.find(".btn-type-custom").removeClass("btn-edit"),t.find(".btn-trash-custom").removeClass("btn-edit-row").addClass("btn-delete").html('<span class="o-bin-1"></span>')})),$("body").on("click",".btn-delete",(function(t){t.preventDefault(),$(this).parent().parent().parent().parent().remove(),$("#modal_edit_plan").find(".modal-body").css("height","auto"),0==$(".list-custom-products").find(".row").length&&$(".list-custom-products").html('<div class="row custom-empty" style="margin-bottom: 20px;"><div class="col-sm-12">Nenhum personalização adicionada</div></div>')})),$("#table-plans").on("click",".delete-plan",(function(t){t.preventDefault();var o=$(this).attr("plan"),e=$("#modal_delete_plan");e.modal("show"),$("#btn-delete-plan").unbind("click"),$("#btn-delete-plan").on("click",(function(){e.modal("hide"),$.ajax({method:"DELETE",url:"/api/project/"+a+"/plans/"+o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){errorAjaxResponse(t)})),success:function(t){p(),j(),alertCustom("success",t.message)}})}))})),$("body").on("click","#btn-modal-plan-delete",(function(t){t.preventDefault();var o=$(this).attr("plan"),e=$("#modal_delete_plan");$("#modal_edit_plan").modal("hide"),e.modal("show"),$("#btn-delete-plan").unbind("click"),$("#btn-delete-plan").on("click",(function(){e.modal("hide"),$.ajax({method:"DELETE",url:"/api/project/"+a+"/plans/"+o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){errorAjaxResponse(t)})),success:function(t){alertCustom("success",t.message),j()}})}))})),$("body").on("click","#all-products",(function(){var t="#modal_edit_plan";$(t).find(".modal-body").css("height","auto"),$(t).find(".modal-body").find(".height-auto").css("margin-top",""),$(t).find(".nav-tabs-horizontal").css("display","block"),$(t).find("#stage4").find(".body-products").mCustomScrollbar("destroy"),$(t).find("#stage4").find(".body-products").mCustomScrollbar("update"),$(t).find(".box-breadcrumbs").find("span").html(" "+n.length+" produtos"),$(t).find(".modal-footer").html('<button id="btn-modal-plan-return" type="button" data-type="edit" class="btn btn-default btn-lg" role="button">Voltar</button><button id="btn-modal-plan-close" type="button" data-dismiss="modal" class="btn btn-primary btn-lg">Fechar</button>').addClass("justify-content-between"),$(t).find(".tab-pane").removeClass("show active").promise().done((function(){$(t).find(".modal-body").append(loadingEditStage4);var o="";o+='<div class="row">',o+='<div class="col-sm-12">',n.forEach((function(t){o+='<div class="box-product align-items-center" style="cursor: inherit;margin-bottom: 16px;padding: 16px 29px 0px;border-radius: 0;border-left: none;border-right: none;border-bottom: none; border-color: #EBEBEB;">',o+="<div "+(t.product_name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.product_name+'"':"")+">",o+='<div class="product d-flex align-items-center">',o+='<div class="background-photo">',o+='<img class="product-photo" src="'+t.photo+'" style="display: none;">',o+="</div>",o+="<div>",o+='<h1 class="title">'+t.product_name_short+"</h1>",o+='<p class="description m-0">Qtd: '+t.amount+"</p>",o+="</div>",o+="</div>",o+="</div>",o+="</div>"})),o+="</div>",o+="</div>";var a=$(t).find(".modal-body").height();$(t).find("#stage4").find(".box-products").html(o).promise().done((function(){$(t).find("#stage4").find(".box-products").css({"max-height":"314px",position:"relative",overflow:"hidden"}),$(t).find("#stage4").find(".body-products").mCustomScrollbar(),$(t).find("#stage4").find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find("#stage4").find(".product-photo").fadeIn(300),$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find(".product-photo").unbind("load"),$('[data-toggle="tooltip"]').tooltip({container:".page",template:'<div class="tooltip product-select" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),$(t).find("#tab-general-data_panel").addClass("show active").promise().done((function(){$(t).find("#stage4").addClass("show active").promise().done((function(){var o=$(t).find(".height-auto").height();$(t).find(".modal-body").stop(!0,!0).height(a).animate({height:o},300)}))}))}))}))}))})),$("body").on("click","#btn-update-informations-plan",(function(){var t="#modal_edit_plan",o=$(this).parents(".informations-edit"),a=o.find(".informations-data").height(),e=$("#pagination-plans").find(".active").text();$.ajax({method:"PUT",url:"/api/plans/"+i+"/informations",dataType:"json",data:{name:$(t).find("#name").val(),price:$(t).find("#price").val(),description:$(t).find("#description").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(o){$(t).find("#name").tooltip("enable"),$(t).find("#description").tooltip("enable"),$("#btn-edit-products-plan").show(),$("#btn-edit-informations-plan").show(),loadOnModalRemove("#modal_edit_plan"),errorAjaxResponse(o)},success:function(n){console.log(n.plan.products),$(t).find("#name").tooltip("enable"),$(t).find("#description").tooltip("enable"),$("#btn-edit-products-plan").show(),$("#btn-edit-informations-plan").show(),$(o).find(".icon").css("border-color","#F8F8F8"),$(t).find(".modal-title").html("Detalhes de "+n.plan.name_short),$(t).find("#name").val(n.plan.name_short),$(t).find("#name").attr("data",n.plan.name).attr("data-short",n.plan.name_short),$(t).find("#price").val(n.plan.price),$(t).find("#price").attr("data",n.plan.price),$(t).find("#description").val(n.plan.description_short),$(t).find("#description").attr("data",n.plan.description).attr("data-short",n.plan.description_short);var i=n.plan.price.replace("R$","").replace(/\./g,"").replace(",","."),d=(i*(s+1)/100).toFixed(2),l=x(),r=(i-d).toFixed(2),c=(r-l).toFixed(2);$(t).find(".price-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i)),$(t).find(".tax-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(d)),$(t).find(".comission-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r)),c<0?$(t).find(".profit-plan").find("p").css("color","#F10800"):$(t).find(".profit-plan").find("p").css("color","#41DC8F"),$(t).find(".profit-plan").find("p").html(new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(c)),$(t).find(".informations-data").removeClass("edit"),$(t).find(".informations-edit").find(".form-control").attr("readonly",!0),$(t).find(".buttons-update").remove().promise().done((function(){var e=o.find(".informations-data").css("height","auto").height();o.find(".informations-data").height(a).animate({height:e},300),n.plan.products.length>4&&n.plan.products.length<=10&&$(t).find("#stage1").find(".body-products").mCustomScrollbar()})),j(e),alertCustom("success",n.message)}})})),$("body").on("click","#btn-edit-products-plan",(function(){h("#modal_edit_plan","edit")})),$("#btn-search-plan").on("click",(function(){j()})),$(".active_custom").on("change",(function(){this.checked?($(".active_custom").attr("checked",!0).val(!0),$(".btn-type").removeAttr("disabled"),$("#custom-title").removeAttr("disabled"),$("#add-list-custom-product").removeAttr("disabled"),$(".added-custom-title").removeAttr("readonly")):($(".active_custom").removeAttr("checked").val(!1),$(".btn-type").removeClass("btn-active"),$(".btn-type").attr("disabled","disabled"),$("#custom-title").attr("disabled","disabled"),$("#add-list-custom-product").attr("disabled","disabled"),$(".added-custom-title").attr("readonly","readonly"))})),$(document).on("keypress",(function(t){$("body").hasClass("modal-open")||13==t.keyCode&&j()})),$("body").on("click","#tab_configuration",(function(){$("#modal_config_cost_plan").find(".tab-pane").removeClass("active show").promise().done((function(){$("#modal_config_cost_plan").find("#tab_update_cost_block-panel").css("display","none"),$("#modal_config_cost_plan").find(".tab-pane").addClass("active show").promise().done((function(){$("#modal_config_cost_plan").find(".modal-body").css("height","auto")}))}))})),$("body").on("click","#tab_update_cost_block",(function(){if(!$(this).hasClass("active")){!function(t){$(t).find(".product-photo").unbind("load"),$(t).find(".modal-body").css("height","auto").attr("style","padding-bottom: 0px !important"),$(t).find("#search-product_config").val(""),$(t).find("#search-product-description_config").val(""),$(t).find(".box-plans").css({height:"232px"}),$(t).find(".tab-pane").removeClass("active show").promise().done((function(){$(t).find("#tab_update_cost_block-panel").css("display","none").promise().done((function(){$(t).find(".modal-body").append(loadingPlansConfigCost).promise().done((function(o){$.ajax({method:"POST",url:"/api/products/products-variants",data:{project_id:a,variants:!0},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(o){"my_products"==$("#project_type").val()?$(t).find(".search-type").html('<div class="d-flex"><input class="form-control form-control-lg" type="text" id="search-product_config" placeholder="Pesquisa por nome" style="border-top-right-radius: 0;border-bottom-right-radius: 0; height: 48px !important; border-right: 0;"><div class="input-group input-group-lg" style="width: 650px;"><input class="form-control" type="text" id="search-product-description_config" placeholder="Pesquisa por descrição" style="border-top-left-radius: 0;border-bottom-left-radius: 0;"><div class="input-group-append"><span class="input-group-text"><img src="/modules/global/img/icon-search.svg" alt="Icon Search"></span></div></div></div>'):$(t).find(".search-type").html('<div class="input-group input-group-lg"><input class="form-control" type="text" id="search-product_config" placeholder="Pesquisa por nome"><div class="input-group-append"><span class="input-group-text"><img src="/modules/global/img/icon-search.svg" alt="Icon Search"></span></div></div>');var a='<div class="row">';o.data.length>0?o.data.forEach((function(t){var o=c.map((function(t){return t.id})).indexOf(t.id);a+='<div class="col-sm-6">',a+="<div "+(t.name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.name+'"':"")+' data-code="'+t.id+'" class="box-plan d-flex justify-content-between align-items-center '+(1==t.status_enum||3==t.status_enum?"review":"")+'">',a+='<div class="d-flex align-items-center">',a+='<div class="background-photo">',a+='<img class="product-photo" src="'+t.photo+'" style="display: none;">',a+="</div>",a+="<div>",a+='<h1 class="title" '+(1==t.status_enum||3==t.status_enum?'style="color: #C5C5C5"':"")+">"+t.name_short+"</h1>",a+='<p class="description" '+(1==t.status_enum||3==t.status_enum?'style="color: #C7C7C7"':"")+">"+t.description+"</p>",a+="</div>",a+="</div>",1!=t.status_enum&&3!=t.status_enum&&(a+='<div class="check">',-1!=o&&(a+='<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),a+="</div>"),a+="</div>",a+="</div>"})):($(t).find(".modal-body").find(".box-plans").css("height","274px").css("max-height","274px"),a+='<div class="col-sm-12">',a+='<div class="text-center" style="height: 150px; margin-bottom: 25px; margin-top: 15px;"><img style="margin: 0 auto;" class="product-photo" src="/modules/global/img/search-product_not-found.png" ></div>',a+='<p class="m-0 text-center" style="font-size: 24px; line-height: 30px; color: #636363;">Nenhum resultado encontrado.</p>',a+='<p class="text-center" style="font-size: 16px; line-height: 20px; color: #9A9A9A;">Por aqui, nenhum plano com esse nome.</p>',a+="</div>");var e=$(t).find(".modal-body").height();$(t).find("#tab_update_cost_block-panel").find(".box-plans").html(a).promise().done((function(){$('[data-toggle="tooltip"]').tooltip({container:".page"}),o.data.length>4&&$(t).find("#tab_update_cost_block-panel").find(".box-plans").mCustomScrollbar(),$(t).find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(t).find(".product-photo").on("load",(function(){$(this).fadeIn(300)})),$(t).find(".product-photo").on("load",(function(){$(t).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(t).find("#tab_update_cost_block-panel").css("display","block").promise().done((function(){var o=$(t).find(".height-auto").height()+20;$(t).find(".modal-body").stop(!0,!0).height(e).animate({height:o},300).promise().done((function(){$(t).find(".product-photo").unbind("load")}))}))}))}))}))}})}))}))}))}("#modal_config_cost_plan")}}));var z=null;$("body").on("keyup","#search-product_config",(function(t){clearTimeout(z);var o="#modal_config_cost_plan",a=t.target.value,e=$(o).find("#search-product-description_config").val();z=setTimeout((function(){A(a,e,o)}),800)}));var S=null;function A(t,o,e){$(e).find(".product-photo").unbind("load"),$(e).find(".modal-body").css("height","auto"),$(e).find(".box-plans").css({height:"auto","padding-right":"0px"}),$(e).find(".box-plans").mCustomScrollbar("destroy"),$(e).find(".box-plans").mCustomScrollbar("update"),$(e).find(".box-plans").html(loadingPlans).promise().done((function(){$.ajax({method:"POST",url:"/api/products/products-variants",data:{project_id:a,variants:!0,search:t,description:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$(".tooltip").remove();var o='<div class="row">';t.data.length>0?t.data.forEach((function(t){var a=c.map((function(t){return t.id})).indexOf(t.id),e=$("#select-all").attr("data-selected");o+='<div class="col-sm-6">',o+="<div "+(t.name_short_flag?'data-toggle="tooltip" data-placement="top" title="'+t.name+'"':"")+' data-code="'+t.id+'" class="box-plan d-flex justify-content-between align-items-center '+(1==t.status_enum||3==t.status_enum?"review":"")+" "+("true"==e?"selected":"")+'">',o+='<div class="d-flex align-items-center">',o+='<div class="background-photo">',o+='<img class="product-photo" src="'+t.photo+'" style="display: none;">',o+="</div>",o+="<div>",o+='<h1 class="title" '+(1==t.status_enum||3==t.status_enum?'style="color: #C5C5C5"':"")+">"+t.name_short+"</h1>",o+='<p class="description" '+(1==t.status_enum||3==t.status_enum?'style="color: #C7C7C7"':"")+">"+t.description+"</p>",o+="</div>",o+="</div>",1!=t.status_enum&&3!=t.status_enum&&(o+='<div class="check">',-1!=a&&(o+='<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),o+="</div>"),o+="</div>",o+="</div>"})):($(".tooltip").remove(),$(e).find(".modal-body").find(".box-plans").css("height","274px"),o+='<div class="col-sm-12">',o+='<div class="text-center" style="height: 150px; margin-bottom: 25px; margin-top: 15px;"><img style="margin: 0 auto;" class="product-photo" src="/modules/global/img/search-product_not-found.png" ></div>',o+='<p class="m-0 text-center" style="font-size: 24px; line-height: 30px; color: #636363;">Nenhum resultado encontrado.</p>',o+='<p class="text-center" style="font-size: 16px; line-height: 20px; color: #9A9A9A; margin-bottom: 40px;">Por aqui, nenhum plano com esse nome.</p>',o+="</div>");var a=$(e).find(".modal-body").height();$(e).find("#tab_update_cost_block-panel").find(".box-plans").html(o).promise().done((function(){$('[data-toggle="tooltip"]').tooltip({container:".page"}),t.data.length>4&&$(e).find(".box-plans").mCustomScrollbar(),$(e).find(".product-photo").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg").fadeIn(300)})),$(e).find(".product-photo").on("load",(function(){$(this).fadeIn(300)})),$(e).find(".ph-item").fadeOut(100,(function(){this.remove()})).promise().done((function(){$(e).find(".tab-content").css("display","block").promise().done((function(){t.data.length>4&&$(e).find("#tab_update_cost_block-panel").find(".box-plans").css({height:"232px"});var o=$(e).find(".height-auto").height()+20;$(e).find(".modal-body").stop(!0,!0).height(a).animate({height:o},300)}))}))}))}})}))}function R(t){var o=parseInt(t.val());t.val(o)}$("body").on("keyup","#search-product-description_config",(function(t){clearTimeout(S);var o="#modal_config_cost_plan",a=t.target.value,e=$(o).find("#search-product_config").val();S=setTimeout((function(){A(e,a,o)}),800)})),$("body").on("click","#select-all",(function(){$(this).hasClass("selected")?($(this).attr("data-selected",!1),$(this).removeClass("selected"),$(this).find(".check").html(""),$("#modal_config_cost_plan").find(".box-plan").removeClass("selected"),$("#modal_config_cost_plan").find(".box-plan").find(".check").html("")):($(this).attr("data-selected",!0),$(this).addClass("selected"),$(this).find(".check").html('<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),$("#modal_config_cost_plan").find(".box-plan").addClass("selected"),$("#modal_config_cost_plan").find(".box-plan").find(".check").html('<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'))})),$("body").on("click",".box-plan",(function(){var t=$(this).data("code");if($(this).hasClass("review"))alertCustom("error","Não é possível selecionar este produto.");else if($(this).hasClass("selected")){$("#select-all").attr("data-selected",!1),$("#select-all").removeClass("selected"),$("#select-all").find(".check").html(""),$(this).removeClass("selected"),$(this).find(".check img").remove();var o=c.map((function(t){return t.id})).indexOf(t);c.splice(o,1)}else $(this).addClass("selected"),$(this).find(".check").html('<img src="/modules/global/img/icon-product-selected.svg" alt="Icon Check">'),c.push({id:t})})),$(".div-cost_shopify").find(".label-text").on("click",(function(t){t.preventDefault()})),$(document).on("click","#config-cost-plan",(function(){c=[];var t="#modal_config_cost_plan";$("#check-custom").hide(),1==$("#cost_currency_type_all_plans").val()&&$("#check-custom").find(".switch").trigger("click"),$(t).find("#cost_plan").val(""),$(t).find("#search-plan").val(""),$(t).find("#select-all").removeClass("selected"),$(t).find("#select-all").find(".check").html(""),$(t).find("#tab_update_cost_block-panel").css("display","none"),$(t).find(".modal-body").css("height","auto"),$(t).find("#tab_configuration").addClass("active"),$(t).find("#tab_update_cost_block").removeClass("show active"),$(t).find("#tab_configuration_cost-panel").addClass("show active"),$(t).find("#tab_update_cost_block-panel").removeClass("show active"),$.ajax({method:"GET",url:"/api/projects/".concat(a),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){errorAjaxResponse(response)},success:function(o){null==o.data.shopify_id&&($(".div-cost_currency").removeClass("col-sm-6").addClass("col-sm-12"),$(".div-cost_currency").find(".sirius-select-container").css("width","100%"),$(".div-cost_shopify").remove()),$(".div-cost_currency").find(".icon").attr("data-toggle","tooltip").attr("data-original-title","Definir uma moeda padrão para a configuração dos seus planos. Configuração utilizada para emissão de notas fiscais."),$(".div-cost_shopify").find(".icon").attr("data-toggle","tooltip").attr("data-original-title","Se configurado como sim, os custos serão atualizados sempre que houver alteração no shopify."),$('[data-toggle="tooltip"]').tooltip({container:".page"});var a="BRL"==o.data.cost_currency_type?"R$ - Real Brasileiro (BRL)":"$ - Dólar Americano (USD)";$("#tab_configuration_cost-panel").find(".sirius-select-text").text(a),$("#cost_currency_type").val(o.data.cost_currency_type),$("#update_cost_shopify").prop("selectedIndex",o.data.update_cost_shopify);var e="USD"==o.data.cost_currency_type?"US$":"R$";$("#cost_plan").attr("placeholder",e),$("#cost_plan").maskMoney({thousands:".",decimal:",",allowZero:!0,prefix:e}),$(t).find("#cost_currency_type").on("change",(function(){$(this).val()!==o.data.cost_currency_type&&$("#check-custom").show()})),$("#modal_config_cost_plan").modal("show")}})})),$(document).on("click",".bt-update-cost-block",(function(t){var o=$("#cost_currency_type").val(),e=$("#update_cost_shopify").val(),n=$("#cost_currency_type_all_plans").val(),i=$("#cost_plan").val();$.ajax({method:"POST",url:"/api/plans/update-bulk-cost",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{project:a,costCurrency:o,updateCostShopify:e,updateAllCurrency:n,cost:i,products:c},error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){errorAjaxResponse(t)})),success:function(t){alertCustom("success",t.message),$("#modal_config_cost_plan").modal("hide")}})})),$("body").on("click",".input-number button",(function(){var t=$(this).parent().find("input");$(this).hasClass("btn-add")?t[0].stepUp():$(this).hasClass("btn-sub")&&t[0].stepDown(),R(t)})),$("body").on("keyup",".input-number input",(function(){var t=parseInt($(this).prop("max"))||99,o=parseInt($(this).prop("min"))||1,a=parseInt($(this).val()||1);a<=o&&$(this).val(o),a>t&&$(this).val(t),R($(this))})),$("#tab-customizations_panel").on("change",".active_custom_product",(function(t){var o=$(this).attr("data-product"),a=this;a.checked?$(a).attr("checked",!0).val(1):$(a).removeAttr("checked").val(0);var e=$(a).val();$.ajax({method:"PUT",url:"/api/products/"+o+"/update-custom",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{plan:i,productCustom:e},error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){errorAjaxResponse(t)})),success:function(t){v("modal_edit_plan",!0),alertCustom("success","Customização do produto atualizada")}})})),$(document).on("click",".bt-update-cost-configs",(function(t){$.ajax({method:"POST",url:"/api/plans/update-config-cost",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{project:a,costCurrency:$("#cost_currency_type").val(),updateCostShopify:$("#update_cost_shopify").val(),updateAllCurrency:$("#update_all_currency_cost").val()},error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){errorAjaxResponse(t)})),success:function(t){var o="USD"==$("#cost_currency_type").val()?"US$":"R$";$("#cost_plan").maskMoney({thousands:".",decimal:",",allowZero:!0,prefix:o}),$("#currency_type_project").val("USD"==$("#cost_currency_type").val()?2:1),alertCustom("success","Configuração atualizada com sucesso"),$("#modal_config_cost_plan").modal("hide")}})})),$(document).on("change","#cost_currency_type",(function(t){$("#div_update_cost_shopify").show();var o="USD"==$(this).val()?"US$":"R$";$("#cost_plan").maskMoney({thousands:".",decimal:",",allowZero:!0,prefix:o}).attr("placeholder",o)})),$(document).on("click",".btn-update-plan",(function(){var o;if($("#tab_plans-panel").loading({message:"...",start:!0}),$(".products_amount").each((function(){""!=$(this).val()&&0!=$(this).val()||(o=!0)})),o)return alertCustom("error","Dados informados inválidos"),!1;var e=new FormData(document.getElementById("form-update-plan-tab-1"));e.append("project_id",a),$.ajax({method:"POST",url:"/api/project/"+a+"/plans/"+$("#plan_id").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:e,processData:!1,contentType:!1,cache:!1,error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(o){$("#tab_plans-panel").loading("stop"),errorAjaxResponse(o),j(t)})),success:function(o){$("#tab_plans-panel").loading("stop"),alertCustom("success","Plano atualizado com sucesso"),j(t)}})})),$(document).on("click",".btn-update-config-custom",(function(){$("#tab_plans-panel").loading({message:"...",start:!0});var t=new FormData(document.getElementById("form-update-plan-tab-2"));t.append("plan",$("#plan_id").val()),$.ajax({method:"POST",url:"/api/plans/config-custom-product",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:t,processData:!1,contentType:!1,cache:!1,error:function(t){function o(o){return t.apply(this,arguments)}return o.toString=function(){return t.toString()},o}((function(t){$("#tab_plans-panel").loading("stop"),errorAjaxResponse(t)})),success:function(t){$("#tab_plans-panel").loading("stop"),alertCustom("success","Configurações do Plano atualizado com sucesso")}})}))}));
