var statusCupons={1:"success",0:"danger"};$((function(){var t=$(window.location.pathname.split("/")).get(-1),o=0;function e(t){if(1==$(t).val().length){var o="0,0"+$(t).val();$(t).val(o)}else if(2==$(t).val().length){var e="0,"+$(t).val();$(t).val(e)}}function a(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;o=null==o?"/api/project/"+t+"/couponsdiscounts":"/api/project/"+t+"/couponsdiscounts"+o,loadOnTable("#data-table-coupon","#tabela-coupom"),$("#tab_coupons-panel").find(".no-gutters").css("display","none"),$("#tabela-coupon").find("thead").css("display","none"),$.ajax({method:"GET",url:o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#data-table-coupon").html(""),""==t.data?$("#data-table-coupon").html("\n                        <tr class='text-center'>\n                            <td colspan='8' style='height: 70px; vertical-align: middle;'>\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.png' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum cupom configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro cupom para poder\n                                        <br>gerenci√°-los nesse painel.</p>\n                                        <button type='button' style='width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-order-bump' data-toggle=\"modal\" data-target=\"#modal-create-coupon\">Adicionar cupom</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    "):($("#tab_coupons-panel").find(".no-gutters").css("display","flex"),$("#tabela-coupon").find("thead").css("display","contents"),$("#count-coupons").html(t.meta.total),$.each(t.data,(function(t,o){var e='<tr>\n                            <td class="shipping-id">'.concat(o.name,'</td>\n                            <td class="shipping-type">').concat(o.type,'</td>\n                            <td class="shipping-value">').concat(o.value,'</td>\n                            <td class="shipping-zip-code-origin">').concat(o.code,'</td>\n                            <td class="shipping-status text-center" style="vertical-align: middle">\n                                <span class="badge badge-').concat(statusCupons[o.status],'">').concat(o.status_translated,'</span>\n                            </td>\n                            <td style="text-align:center">\n                                <div class=\'d-flex justify-content-end align-items-center\'>\n                                    <a role="button" title=\'Visualizar\' class="mg-responsive details-coupon pointer" coupon="').concat(o.id,'"><span class="o-eye-1"></span></a>\n                                    <a role="button" title=\'Editar\' class="mg-responsive edit-coupon pointer" coupon="').concat(o.id,'"><span class="o-edit-1"></span> </a>\n                                    <a role="button" title=\'Excluir\' class="mg-responsive delete-coupon pointer" coupon="').concat(o.id,'" data-toggle="modal" data-target="#modal-delete-coupon"><span class=\'o-bin-1\'></span></a>\n                                </div>\n                            </td>\n                        </tr>');$("#data-table-coupon").append(e)})),pagination(t,"coupons",a))}})}$(".coupon-value").mask("00%",{reverse:!0}),$(document).on("change","#edit-coupon-type",(function(t){1==$(this).val()?(o=1,$(".coupon-value").mask("#.##0,00",{reverse:!0}).removeAttr("maxlength")):(o=0,$(".coupon-value").mask("00%",{reverse:!0}))})),$(document).on("change","#create-coupon-type",(function(t){1==$(this).val()?(o=1,$(".coupon-value").mask("#.##0,00",{reverse:!0}).removeAttr("maxlength")):(o=0,$(".coupon-value").mask("00%",{reverse:!0}))})),$(".rule-value").mask("#.##0,00",{reverse:!0}).removeAttr("maxlength"),$(".rule-value").on("blur",(function(){e(this)})),$(".coupon-value").on("blur",(function(){1==o&&e(this)})),$(".tab_coupons").on("click",(function(){a(),$(this).off()})),$(document).on("click",".details-coupon",(function(){var o=$(this).attr("coupon");$("#btn-modal").hide(),$.ajax({method:"GET",url:"/api/project/"+t+"/couponsdiscounts/"+o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#modal-detail-coupon .coupon-name").html(t.data.name),$("#modal-detail-coupon .coupon-code").html(t.data.code),$("#modal-detail-coupon .coupon-type").html(t.data.type),$("#modal-detail-coupon .coupon-value").html("Valor"==t.data.type?"R$ "+t.data.value:t.data.value+"%"),$("#modal-detail-coupon .rule-value").html("R$ "+t.data.rule_value),$("#modal-detail-coupon .coupon-status").html("1"==t.data.status?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>'),$("#modal-detail-coupon").modal("show")}})})),$(document).on("click",".edit-coupon",(function(){var o=$(this).attr("coupon");$.ajax({method:"GET",url:"/api/project/"+t+"/couponsdiscounts/"+o+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#modal-edit-coupon .coupon-id").val(o),$("#modal-edit-coupon .coupon-name").val(t.name),$("#modal-edit-coupon .coupon-value").val(t.value),$("#modal-edit-coupon .rule-value").val(t.rule_value),$("#modal-edit-coupon .rule-value").trigger("input"),1==t.type?$("#edit-coupon-type").prop("selectedIndex",1).change():$("#edit-coupon-type").prop("selectedIndex",0).change(),$("#modal-edit-coupon .coupon-code").val(t.code),1==t.status?$("#edit-coupon-status").prop("selectedIndex",0).change():$("#edit-coupon-status").prop("selectedIndex",1).change(),$("#modal-edit-coupon").modal("show")}})})),$(document).on("click",".delete-coupon",(function(o){o.preventDefault();var e=$(this).attr("coupon");$("#btn-delete-coupon").unbind("click"),$("#btn-delete-coupon").on("click",(function(){$.ajax({method:"DELETE",url:"/api/project/"+t+"/couponsdiscounts/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){a(),alertCustom("success","Cupom Removido com sucesso")}})}))})),$("#modal-create-coupon .btn-save").on("click",(function(){var o=new FormData(document.getElementById("form-register-coupon"));$.ajax({method:"POST",url:"/api/project/"+t+"/couponsdiscounts",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:o,processData:!1,contentType:!1,cache:!1,error:function(t){errorAjaxResponse(t)},success:function(){$(".loading").css("visibility","hidden"),alertCustom("success","Cupom Adicionado!"),a(),$(".coupon-name").val(""),$(".coupon-value").val(""),$(".coupon-code").val(""),$(".rule-value").val("")}})})),$("#modal-edit-coupon .btn-update").on("click",(function(){var o=new FormData(document.getElementById("form-update-coupon")),e=$("#modal-edit-coupon .coupon-id").val();$.ajax({method:"POST",url:"/api/project/"+t+"/couponsdiscounts/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:o,processData:!1,contentType:!1,cache:!1,error:function(t){400===t.status&&a(),errorAjaxResponse(t)},success:function(t){alertCustom("success",t.message),a()}})}))}));
