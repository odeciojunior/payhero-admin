loadingOnScreen(),$(document).ready((function(){var e=window.location.href.split("/")[4];function t(e,t){$(e).on("focus",(function(){$("#caixinha-img")[0].src=$("#caixinha-img")[0].src.replace("caixinha",t)})),$(e).on("focusout",(function(){$("#caixinha-img")[0].src=$("#caixinha-img")[0].src.replace(t,"caixinha")}))}dropifyOptions={messages:{default:"Arraste e solte uma imagem ou ",replace:"Arraste e solte uma imagem ou selecione um arquivo",remove:"Remover",error:""},error:{fileSize:"O tamanho máximo do arquivo deve ser {{ value }}.",minWidth:"A imagem deve ter largura maior que 651px.",maxWidth:"A imagem deve ter largura menor que 651px.",minHeight:"A imagem deve ter altura maior que 651px.",maxHeight:"A imagem deve ter altura menor que 651px.",fileExtension:"A imagem deve ser algum dos formatos permitidos. ({{ value }})."},tpl:{message:'<div class="dropify-message"><span class="file-icon" /> <p>{{ default }}<span style="color: #2E85EC;">selecione um arquivo</span></p></div>',clearButton:'<button type="button" class="dropify-clear o-bin-1"></button>'},imgFileExtensions:["png","jpg","jpeg","gif","bmp","webp","svg"]},$.ajax({method:"GET",url:"/api/products/"+e+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e),$("#product_photo").dropify(dropifyOptions)},success:function(e){isEmpty(e.data.product)?alertCustom("success","Ocorreu um erro, tente novamente mais tarde"):($.each(e.data.categories,(function(e,t){$("#select-categories").append($("<option>",{value:t.id,text:t.name}))})),$("#select-categories  option[value='"+e.data.product.category_id+"']").prop("selected",!0),e.data.product.shopify_variant_id||$(".converte-product").parent().hide(),$(".converte-product").attr("product",e.data.product.id),$(".converte-product").attr("productname",e.data.product.name),e.data.product.shopify_variant_id&&$(".delete-product").parent().hide(),$(".delete-product").attr("product",e.data.product.id),$(".delete-product").attr("productname",e.data.product.name),$("#product_photo").attr("src",e.data.product.photo),$("img").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg")})),$("#name").val(e.data.product.name),$("#description").text(e.data.product.description),isEmpty(e.data.product.sku)?$("#sku").hide():($("#sku input").val(e.data.product.sku),$("#sku").show()),$("#cost").unmask().val(e.data.product.cost).mask("000.000.000.000.000,00",{reverse:!0}),$("#price").unmask().val(e.data.product.price).mask("000.000.000.000.000,00",{reverse:!0}),$("#height").unmask().val(e.data.product.height),$("#length").unmask().val(e.data.product.length),$("#width").unmask().val(e.data.product.width),$("#weight").unmask().val(e.data.product.weight),1==e.data.product.currency_type_enum?$("#select-currency .select-currency-brl").attr("selected",!0):$("#select-currency .select-currency-usd").attr("selected",!0),e.data.product.type_enum,""!=e.data.product.photo&&(dropifyOptions.defaultFile=e.data.product.photo),$("#product_photo").dropify(dropifyOptions),""!=e.data.product.digital_product_url&&($(".btn-view-product-url").attr("link",e.data.product.digital_product_url),$(".btn-view-product-url").show()),$(".div-expiration-time").show(),$("#url_expiration_time").val(e.data.product.url_expiration_time),removeImageButton=!1,$("#my-form").submit((function(t){t.preventDefault();var a=document.getElementById("my-form"),o=new FormData(a);1==e.data.product.type_enum?o.append("type_enum","physical"):o.append("type_enum","digital"),function(e){var t=!0;if(""===$.trim($("#name").val())&&($("#nav-basic-tab").click(),$("#name").focus(),alertCustom("error","O campo Nome é obrigatório"),t=!1),""===$.trim($("#description").val())&&($("#nav-basic-tab").click(),$("#description").focus(),alertCustom("error","O campo Descrição é obrigatório"),t=!1),2==e){var a=$.trim($("#url_expiration_time").val());parseInt(a)>=168&&(alertCustom("error","Expiração do link deve ser menor que 1 semana (168 HORAS)"),t=!1),""===a&&(alertCustom("error","Preencha o campo Tempo de expiração da url"),t=!1,$("#url_expiration_time").focus())}return t}(e.data.product.type_enum)&&(loadOnAny(".page",!1),$.ajax({method:"POST",url:"/api/products/"+e.data.product.id+"?product_photo_remove="+removeImageButton,processData:!1,cache:!1,contentType:!1,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:o,error:function(e){loadOnAny(".page",!0),errorAjaxResponse(e)},success:function(e){loadOnAny(".page",!0),alertCustom("success",e.message),$(".btn-view-product-url").attr("link",e.digital_product_url),window.location="/products"}}))}))),loadingOnScreenRemove()}}),$(".money").mask("#.###,#0",{reverse:!0}),$("#shipping").on("change",(function(){"proprio"==$(this).val()?$("#div_carrier_id").hide():$("#div_carrier_id").show()})),$(".delete-product").on("click",(function(e){e.preventDefault();var t=$(".delete-product").attr("product");$("#bt_excluir").unbind("click"),$("#bt_excluir").on("click",(function(){$("#close-modal-delete").click(),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/products/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){loadingOnScreenRemove(),errorAjaxResponse(e)})),success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),window.location="/products"}})}))})),$(".converte-product").on("click",(function(e){e.preventDefault();var t=$(".converte-product").attr("product");$("#bt_converter").unbind("click"),$("#bt_converter").on("click",(function(){$("#close-modal-converte").click(),loadingOnScreen(),$.ajax({method:"POST",url:"/api/products/updateproducttype/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){loadingOnScreenRemove(),errorAjaxResponse(e)})),success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),window.location="/products"}})}))})),$(".btn-view-product-url").on("click",(function(e){e.preventDefault();var t=$(this).attr("link"),a=$("#url_expiration_time").val();loadingOnScreen(),$.ajax({method:"POST",url:"/api/products/getsignedurl",dataType:"json",data:{digital_product_url:t,url_expiration_time:a},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),window.open(e.signed_url,"_blank")}})})),$("#url_expiration_time").mask("0#"),$("#product_photo").on("dropify.afterClear",(function(e,t){removeImageButton=!0})),t("#height","caixinha-altura"),t("#width","caixinha-largura"),t("#length","caixinha-comprimento"),t("#weight","caixinha-peso"),null!=$("#digital_product_url")[0]&&$("#digital_product_url")[0].addEventListener("change",(function(){productName=this.value.split("\\")[2]||"",$("#file_return")[0].innerHTML=productName.length>25?productName.substring(0,21)+productName.substring(productName.length-4):productName}))}));
