$(document).ready((function(){loadingOnScreen(),$(".page").show(),loadingOnScreenRemove(),$("#digital_product_url").dropify({messages:{default:"Arraste e solte ou clique para adicionar um arquivo",replace:"Arraste e solte ou clique para substituir"}}),$("#my-form-add-product").submit((function(a){if("0"==$("#photo_w").val()||"0"==$("#photo_h").val())return alertCustom("error","Selecione as dimensões da imagem"),!1;if($("#digital").is(":checked")&&""==$("#digital_product_url").val())return alertCustom("error","Selecione o produto digital"),!1;if($("#digital").is(":checked")&&""==$("#url_expiration_time").val())return alertCustom("error","Preencha o campo Tempo de expiração da url"),!1;if(a.preventDefault(),e=!0,""===$.trim($("#name").val())&&(alertCustom("error","O campo Nome é obrigatório"),e=!1,$("#nav-basic-tab").click(),$("#name").focus()),""===$.trim($("#description").val())&&(alertCustom("error","O campo Descrição é obrigatório"),e=!1,$("#nav-basic-tab").click(),$("#description").focus()),e){loadOnAny(".page",!1);var t=document.getElementById("my-form-add-product"),i=new FormData(t);$("#physical").is(":checked")?i.append("type_enum","physical"):i.append("type_enum","digital"),$.ajax({method:"POST",url:"/api/products",processData:!1,cache:!1,contentType:!1,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:i,error:function(a){loadOnAny(".page",!0),errorAjaxResponse(a)},success:function(a){loadOnAny(".page",!0),alertCustom("success",a.message),window.location="/products"}})}var e}));var a=$("#previewimage");$("#photo").on("change",(function(){var t=new FileReader;t.readAsDataURL(document.getElementById("photo").files[0]),t.onload=function(t){a.attr("src",t.target.result).fadeIn(),a.on("load",(function(){var a,t,i,e,o=document.getElementById("previewimage");o.naturalWidth>o.naturalHeight?(i=Math.floor(o.naturalHeight/100*10),e=o.naturalHeight-Math.floor(o.naturalHeight/100*10),t=(a=Math.floor(o.naturalWidth/2)-Math.floor((e-i)/2))+(e-i)):o.naturalWidth<o.naturalHeight?(a=Math.floor(o.naturalWidth/100*10),t=o.naturalWidth-Math.floor(o.naturalWidth/100*10),e=(i=Math.floor(o.naturalHeight/2)-Math.floor((t-a)/2))+(t-a)):(a=Math.floor(o.naturalWidth/100*10),t=o.naturalWidth-Math.floor(o.naturalWidth/100*10),i=Math.floor(o.naturalHeight/100*10),e=o.naturalHeight-Math.floor(o.naturalHeight/100*10)),$('input[name="photo_x1"]').val(a),$('input[name="photo_y1"]').val(i),$('input[name="photo_w"]').val(t-a),$('input[name="photo_h"]').val(e-i),$("#previewimage").imgAreaSelect({x1:a,y1:i,x2:t,y2:e,aspectRatio:"1:1",handles:!0,imageHeight:this.naturalHeight,imageWidth:this.naturalWidth,onSelectEnd:function(a,t){$('input[name="photo_x1"]').val(t.x1),$('input[name="photo_y1"]').val(t.y1),$('input[name="photo_w"]').val(t.width),$('input[name="photo_h"]').val(t.height)}})}))}})),$("#previewimage").on("click",(function(){$("#photo").click()})),$(".money").mask("#.###,#0",{reverse:!0}),$("#next_step").on("click",(function(){"visible"==$("#nav-logistic-tab").css("visibility")?$("#nav-logistic-tab").click():$("#nav-logistic-tab").submit(),$("#previewimage").imgAreaSelect({remove:!0})})),$("#url_expiration_time").mask("0#"),$("#div_digital_product_upload").addClass("d-none"),$("#physical").on("change",(function(){$("#div_digital_product_upload").css("visibility","hidden"),$("#nav-logistic-tab").css("visibility","visible"),$("#div_digital_product_upload").addClass("d-none"),$(".div-expiration-time").hide(),$("#url_expiration_time").val("")})),$("#digital").on("change",(function(){$("#div_digital_product_upload").css("visibility","visible"),$("#nav-logistic-tab").css("visibility","hidden"),$("#div_digital_product_upload").removeClass("d-none"),$(".div-expiration-time").show(),$("#url_expiration_time").val("24")}))}));
