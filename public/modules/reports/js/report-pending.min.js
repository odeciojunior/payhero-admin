var currentPage=null,_atualizar=null,hasSale=!1;$(document).ready((function(){$("#filtros").on("click",(function(){$("#div_filtros").is(":visible")?$("#div_filtros").slideUp():$("#div_filtros").slideDown()})),$("#bt_filtro").on("click",(function(t){t.preventDefault(),_atualizar()})),$(".btn-light-1").click((function(){var t=$("#icon-filtro"),e=$("#text-filtro");e.fadeOut(10),"matrix(1, 0, 0, 1, 0, 0)"==t.css("transform")||"none"==t.css("transform")?(t.css("transform","rotate(180deg)"),e.text("Minimizar filtros").fadeIn()):(t.css("transform","rotate(0deg)"),e.text("Filtros avançados").fadeIn())}));moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");function t(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={company:$("#company").val(),project:$("#project").val(),client:$("#comprador").val(),customer_document:$("#customer_document").val(),payment_method:$("#forma").val(),sale_code:$("#sale_code").val().replace("#",""),date_type:$("#date_type").val(),date_range:$("#date_range").val(),statement:0==hasSale?"automatic_liquidation":$("#type_statement").val(),acquirer:$("#acquirer").val(),is_security_reserve:$("#is-security-reserve").is(":checked")?1:0};if(t){var a="";for(var n in e)a+="&"+n+"="+e[n];return encodeURI(a)}return e}function e(){loadOnAny(".number",!1,{styles:{container:{minHeight:"32px",height:"auto"},loader:{width:"20px",height:"20px",borderWidth:"4px"}}}),$.ajax({method:"GET",url:"/api/reports/resume-pending-balance",data:t(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny(".number",!0),errorAjaxResponse(t)},success:function(t){if(loadOnAny(".number",!0),$("#total_sales").text("0"),$("#commission_pending, #total").html('R$ <strong class="font-size-30">0,00</strong>'),t.total_sales){$("#total_sales, #commission_blocked, #total").text(""),$("#total_sales").text(t.total_sales);var e=t.commission.split(/\s/g);$("#commission_pending").html(e[0]+' <span class="font-size-30 bold">'+e[1]+"</span>");var a=t.total.split(/\s/g);$("#total").html(a[0]+' <span class="font-size-30 bold">'+a[1]+"</span>")}}})}$("#date_range").daterangepicker({startDate:moment("2018-01-01 00:00:00"),endDate:moment(),opens:"center",maxDate:moment().endOf("day"),alwaysShowCalendar:!0,showCustomRangeLabel:"Customizado",autoUpdateInput:!0,locale:{locale:"pt-br",format:"DD/MM/YYYY",applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Até",customRangeLabel:"Customizado",weekLabel:"W",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],firstDay:0},ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 dias":[moment().subtract(6,"days"),moment()],"Últimos 30 dias":[moment().subtract(29,"days"),moment()],"Este mês":[moment().startOf("month"),moment().endOf("month")],"Mês passado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Vitalício":[moment("2018-01-01 00:00:00"),moment()]}},(function(t,e){t.format("YYYY-MM-DD"),e.format("YYYY-MM-DD")})),loadingOnScreen(),$.ajax({method:"GET",url:"/api/companies?select=true",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)||($.each(t.data,(function(t,e){e.company_has_sale_before_getnet&&(hasSale=!0),$("#company").append('<option value="'+e.id+'">'+e.name+"</option>")})),hasSale&&$("#select-statement-div").show(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)?($("#export-excel").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#export-excel").show(),$.each(t.data,(function(t,e){$("#project").append($("<option>",{value:e.id,text:e.name}))})),_atualizar()),loadingOnScreenRemove()}}),$.ajax({method:"GET",url:"/api/finances/acquirers/"+$("#company").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){$.each(t.data,(function(t,e){$("#acquirer").append($("<option>",{value:e,text:e}))})),_atualizar(),loadingOnScreenRemove()}}))}}),_atualizar=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;currentPage=a;var n=!0;loadOnTable("#body-table-pending",".table-pending"),null==a?a="/api/reports/pending-balance?"+t(!0).substr(1):(a="/api/reports/pending-balance"+a+t(!0),n=!1),$.ajax({method:"GET",url:a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#body-table-pending").html(""),$(".table-pending").addClass("table-striped"),isEmpty(t.data)?$("#body-table-pending").html("<tr class='text-center'><td colspan='10' style='vertical-align: middle;height:257px;'><img style='width:124px;margin-right:12px;' src='"+$("#body-table-pending").attr("img-empty")+"'> Nenhuma venda encontrada </td></tr>"):($.each(t.data,(function(t,e){var a="";e.start_date&&(a="<strong class='bold-mobile'>"+(a=e.start_date.split(/\s/g))[0]+" </strong> <br> <small class='gray font-size-12'>"+a[1]+" </small>");var n="";e.end_date&&(n="<strong class='bold-mobile'>"+(n=e.end_date.split(/\s/g))[0]+" </strong> <br> <small class='gray font-size-12'>"+n[1]+" </small>");var o="";e.is_security_reserve&&(o='<br><label data-toggle="tooltip" title="Reserva de Segurança">\n                                                       <img width="12px" src="/modules/global/img/money_lock.svg" alt="Reserva de Segurança">\n                                                   </label>'),dados='  <tr>\n                                    <td class="text-center">\n                                        '.concat(e.sale_code,"\n                                        ").concat(o,'\n                                    </td>\n                                    <td class="text-left font-size-14">').concat(e.project,'</td>\n                                    <td class="text-left font-size-14">').concat(e.client,'</td>\n                                    <td class="display-sm-none display-m-none display-lg-none">\n                                        <img src=\'/modules/global/img/cartoes/').concat(e.brand,".png' alt=\"").concat(e.brand,'"  style=\'width: 45px\'>\n                                    </td>\n                                    <td class="display-sm-none display-m-none display-lg-none text-left font-size-14">').concat(a,'</td>\n                                    <td class="text-left font-size-14">').concat(n,'</td>\n                                    <td><b class="font-md-size-20">').concat(e.total_paid,"</b></td>\n                                    <td>\n                                        <a role='button' class='detalhes_venda pointer' venda='").concat(e.id,'\'><span class="o-eye-1"></span></button></a>\n                                    </td>\n                                </tr>'),$("#body-table-pending").append(dados)})),$("#date").val(moment(new Date).add(3,"days").format("YYYY-MM-DD")),$("#date").attr("min",moment(new Date).format("YYYY-MM-DD"))),pagination(t,"pending",_atualizar)}}),n&&e()},$(document).on("keypress",(function(t){13==t.keyCode&&_atualizar()}))}));
