$(document).ready((function(){var e=$(window.location.pathname.split("/")).get(-1),a=($(".add-domain"),$("#btn-delete-domain")),t=$("#btn-modal-add-domain"),o=$(".info-domain");function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;loadOnTable("#domain-table-body","#tabela-dominios"),a=null==a?"/api/project/"+e+"/domains":"/api/project/"+e+"/domains"+a,$("#tab_domains").find(".no-gutters").css("display","none"),$("#tabela-dominios").find("thead").css("display","none"),$.ajax({method:"GET",url:a,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#domain-table-body").html(""),isEmpty(e.data)||""==e.data?($("#domain-table-body").html("\n                        <tr class='text-center'>\n                            <td colspan='4' style='height: 70px; vertical-align: middle;'>\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.png' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum domínio configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro domínio para poder\n                                        <br>gerenciá-los nesse painel.</p>\n                                        <button type='button' style='width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-domain' data-toggle=\"modal\" data-target=\"#modal-add-domain\">Adicionar domínio</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    "),$("#tabela-dominios").addClass("table-striped")):($("#tab_domains").find(".no-gutters").css("display","flex"),$("#tabela-dominios").find("thead").css("display","contents"),$("#count-cupons").html(e.meta.total),$.each(e.data,(function(e,a){i(a)})),$("#tabela-dominios").addClass("table-striped"),pagination(e,"domain",n),m(e),$(".delete-domain").on("click",(function(){d($(this).attr("domain"))})),$(".edit-domain").on("click",(function(){$("#btn-modal-add-input").show();var e=$(this).attr("domain");$("#modal-content-domain").css("overflow-y","auto").modal("show"),$("#domain").val(e),r(e)})),$(".details-domain").on("click",(function(){var e=$(this).attr("domain");$("#domain").val(""),$("#domain").val(e),$("#content-modal-recheck-dns-error").hide(),$("#content-modal-recheck-dns").show(),c()})))}})}function d(t){$(".btn-delete-modal-domain").css("opacity",1),$("#modal-delete-domain-body, #title-delete-domain, #description-delete-domain, .btn-delete-modal-domain").show(),$("#modal-delete-domain").modal("show"),a.unbind("click"),a.on("click",(function(){$(".btn-delete-modal-domain").css("opacity",0),loadOnAny("#modal-delete-domain-body",!1,{styles:{container:{minHeight:"240px"}},insertBefore:".modal-delete-footer"}),$.ajax({method:"DELETE",url:"/api/project/"+e+"/domains/"+t,dataType:"json",data:{project:e,domain:t},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#close-modal-delete-domain").click(),loadOnAny("#modal-delete-domain-body",!0),errorAjaxResponse(e),n()},success:function(e){$("#close-modal-delete-domain").click(),loadOnAny("#modal-delete-domain-body",!0),alertCustom("success",e.message),n()}})}))}function i(e){var a="";a+="<tr>",a+='<td class="text-center">'+e.domain+"</td>",a+='<td class="text-center"><span class="badge badge-'+l[e.status]+'">'+e.status_translated+"</span></td>",a+="<td style='text-align:center;'>",a+="<div class='d-flex justify-content-end align-items-center'>",a+="<a title='Visualizar' role='button' class='mg-responsive details-domain pointer' status='"+e.status+"' domain='"+e.id+"' ><span class='o-eye-1'></span> </a>",a+="<a title='Editar' role='button' class='mg-responsive edit-domain    pointer' status='"+e.status+"' domain='"+e.id+"' data-toggle='modal'><span class='o-edit-1'></span> </a>",a+="<a title='Excluir' role='button' class='mg-responsive delete-domain  pointer' status='' domain='"+e.id+"' data-toggle='modal'><span class='o-bin-1'></span> </a>",a+="</div>",a+="</td>",a+="</tr>",$("#domain-table-body").append(a)}function s(){$("#loaderModal").remove(),$("#especialModalTitle").remove()}function r(a){loadOnTable("#table-body-new-records","#new-registers-table"),$.ajax({method:"GET",url:"/api/project/"+e+"/domain/"+a+"/records",processData:!1,contentType:!1,cache:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){errorAjaxResponse(e)},success:function(t){$("#table-body-new-records").html(""),function(e,a){var t="",o=0,n="checked",d="";$.each(e,(function(e,i){if(t+="<tr>",t+="<td >"+i.type+"</td>",t+='<td style="word-break: break-word;">'+i.name+"</td>",t+='<td style="word-break: break-word;">\n                        <div class="row align-items-center">\n                            \x3c!-- Target --\x3e\n                            <input id="copy-data-'.concat(e,'"\n                                   class="col-8 mr-1 input-pad"\n                                   data-toggle="tooltip"\n                                   data-placement="left"\n                                   title="').concat(i.content_complete,'"\n                                   value="').concat(i.content_complete,'"\n                                   readonly>\n\n                                \x3c!-- Trigger --\x3e\n                                <button class="btn copy-data col-2" data-clipboard-target="#copy-data-').concat(e,'">\n                                    <span class="material-icons icon-copy-1"> content_copy </span>\n                                </button>\n                        </div>\n                    </td>'),n=i.proxy?"checked":"","MX"!==i.type&&"TXT"!==i.type||(d="disabled"),i.system_flag){o++;var s="",r="disabled";s="A"===i.type&&i.name===i.domain_name||"CNAME"===i.type&&"www"===i.name||"CNAME"===i.type&&0===i.name.indexOf("mail.")?"<td><button style='background-color: transparent;' role='button' title='Excluir' class='btn mg-responsive delete-domain-record pointer' data-domain='"+a+"' data-system='"+i.system_flag+"' data-record='"+i.id+"'><span class='o-bin-1'></span> </button></td>":"<td><button style='background-color: transparent;' role='button' class='btn mg-responsive pointer'  "+r+"><span class='o-bin-1'></span> </a></td>",t+='<td><div class="switch-holder" style=" opacity: 0.5;">                    <label class="switch" style="cursor: not-allowed">                        <input type="checkbox" style="cursor: not-allowed" value="'+i.proxy+'" name="proxy" id="proxy" class="check check-proxy" '+n+"  "+r+' >                        <span class="slider round" style="cursor: not-allowed"></span>                    </label>                </div></td>',t+=s}else t+='<td><div class="switch-holder"><label class="switch">',t+='<input type="checkbox" value="'+i.proxy+'" name="proxy" id="proxy"  class="check check-proxy" data-domain="'+a+'" data-system="'+i.system_flag+'" data-record="'+i.id+'"  '+n+d+'  ><span class="slider round"></span></label></div></td>',t+="<td><button style='background-color: transparent;' role='button' title='Excluir' class='btn mg-responsive delete-domain-record pointer' data-domain='"+a+"' data-system='"+i.system_flag+"' data-record='"+i.id+"'><span class='o-bin-1'></span> </button></td>";t+="</td>",t+="</tr>"})),$((function(){$('[data-toggle="tooltip"]').tooltip(),$(".copy-data").on("click",(function(){new ClipboardJS(".copy-data").on("success",(function(e){console.info("Action:",e.action),console.info("Text:",e.text),console.info("Trigger:",e.trigger),alertCustom("success","Link copiado!"),e.clearSelection()}))}))})),$("#loaderLine").remove(),$("#new-registers-table").addClass("table-striped"),o>0?$("#empty-info").hide():$("#empty-info").show();$("#table-body-new-records").append(t)}(t.data.domainRecords,a),$(".delete-domain-record").unbind("click"),$(".delete-domain-record").on("click",(function(){isEmptyValue($(this).data("domain"))&&isEmptyValue($(this).data("record"))&&function(e,a,t){isEmptyValue(e)&&isEmptyValue(a)&&isEmptyValue(t)?$.ajax({method:"DELETE",url:"/api/project/"+e+"/domain/"+a+"/records/"+t,processData:!1,contentType:!1,cache:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){errorAjaxResponse(e),$("#table-body-new-records").html(""),r(a)},success:function(e){alertCustom("success",e.message),$("#table-body-new-records").html(""),r(a)}}):alertCustom("error","Ocorreu um erro, tente novamente mais tarde!")}(e,$(this).data("domain"),$(this).data("record"))})),$(".check-proxy").bind("change",(function(){$(this).is(":checked")?$(this).val(1):$(this).val(0),$(this).data("system")||$.ajax({method:"PUT",url:"/api/project/"+e+"/domain/"+$(this).data("domain")+"/records/"+$(this).data("record"),data:{proxy:this.value},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){},success:function(e){alertCustom("success",e.message)}})}))}})}function c(){$.ajax({method:"GET",url:"/api/project/"+e+"/domains/"+$("#domain").val(),headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){if($(".table-title-entry").remove(),3===e.data.status)$("#content-modal-recheck-dns").hide(),$("#modal-info-dsn-success-body, #content-modal-recheck-dns-success").show();else{var a="";$.each(e.data.zones,(function(e,t){a+='<tr class="table-title-entry"><td class= "table-title" > <b>Novo servidor DNS: </b></td><td> '+t+" </td></tr>"})),$("#table-zones-add").append(a),e.data.domainHost?$("#nameHost").html(e.data.domainHost):$("#nameHost").html(""),$("#content-modal-recheck-dns-success").hide(),$("#modal-title-dns-recheck, #modal-info-dsn-body, #content-modal-recheck-dns").show()}$("#modal-info-dns").modal("show")}})}$("#previewimage").imgAreaSelect({remove:!0}),n(),$(".add-domain").unbind("click"),$(document).on("click",".add-domain",(function(){$("#btn-modal-add-input").show(),$("#loaderModal").remove(),$("#modal-title-add-domain").html("Novo domínio"),$("#btn-modal-add-domain").show(),$("#form-add-domain").submit((function(){return!1})),$("#modal-body-add-domain").show(),$("#modal-add-domain").modal("show"),$("#btn-modal-add-domain").unbind("click"),$(document).on("click","#btn-modal-add-domain",(function(){0===$.trim($(".name-domain").val()).length?o.addClass("text-danger").html("Preencha corretamente o domínio").show():($(".info-domain").html(""),function(){$("#especialModalTitle").remove(),$("#modal-title-add-domain").html(""),a="#modal-body-add-domain",$("#modal-title-add-domain").after('<h3 id="especialModalTitle" style="font-weight:bold; color:black"></h3>'),$("#modal-title-add-domain").hide(),loadOnAny(a,!1,{styles:{container:{minHeight:"180px"}}}),$("#especialModalTitle").html("Iniciando ... "),setTimeout((function(){$("#especialModalTitle").html("Configurando domínio")}),1e3),setTimeout((function(){$("#especialModalTitle").html("Configurando entradas DNS")}),6e3),setTimeout((function(){$("#especialModalTitle").html("Preparando servidores de Email")}),13e3),setTimeout((function(){$("#especialModalTitle").html("Preparando checkout transparente")}),2e4),setTimeout((function(){$("#especialModalTitle").html("Finalizando ... ")}),25e3),$("#btn-modal-add-domain").hide(),t.hide();var a;var d=new FormData(document.getElementById("form-add-domain"));d.append("project_id",e),$.ajax({method:"POST",url:"/api/project/"+e+"/domains",processData:!1,contentType:!1,cache:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",data:d,error:function(e){$("#especialModalTitle").remove(),loadOnAny("#modal-body-add-domain",!0),$("#modal-title-add-domain").html("Novo domínio").show(),$("#form-add-domain, #btn-modal-add-domain").show(),errorAjaxResponse(e)},success:function(e){loadOnAny("#modal-body-add-domain",!0),$("#modal-button-close").click(),alertCustom("success",e.message),n(),$(".btn-continue-domain").show(),o=e.data,function(e){$("#domain").val(""),$("#domain").val(e.data.id_code),$("#btn-modal-continue-domain").show(),$("#modal-content-domain").css("overflow-y","auto").modal("show"),r(e.data.id_code)}(e)}})}())}))})),$("#type-register").change((function(){"MX"===$("#type-register option:selected").val()?($("#name-register").parent().removeClass("col-lg-10").addClass("col-lg-8"),$("#div-input-priority").remove(),$("#name-register").parent().after(' <div id="div-input-priority" class="col-sm-12 col-md-5 col-lg-2 mb-3"><input id="value-priority" name="priority" class="input-pad" data-mask="0#" placeholder="Prioridade"></div>'),$("#proxy-active").attr("disabled",!0),$("#proxy-select ").val("0").change(),$("#value-priority").mask("0#")):"TXT"===$("#type-register option:selected").val()?($("#div-input-priority").remove(),$("#proxy-active").attr("disabled",!0),$("#proxy-select").val("0").change()):($("#div-input-priority").remove(),$("#proxy-active").removeAttr("disabled"),$("#div-input-priority").remove(),$("#name-register").parent().removeClass("col-lg-8").addClass("col-lg-10"))})),$("#form-modal-add-domain-record").submit((function(){return!1})),$("#bt-add-record").on("click",(function(){if(t=!1,0===$("#name-register").val().length?($("#error-name-register-dns").show(),t=!0):$("#error-name-register-dns").hide(),0===$("#value-record").val().length?($("#error-value-record").show(),t=!0):$("#error-value-record").hide(),t)return!1;$("#error-name-register-dns, #error-value-record").hide();var a=$("#domain").val();loadOnTable("#table-body-new-records","#new-registers-table");var t,o=new FormData(document.getElementById("form-modal-add-domain-record"));o.append("project",e),o.append("domain",a),$.ajax({method:"POST",url:"/api/project/"+e+"/domain/"+a+"/records",processData:!1,contentType:!1,cache:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:o,dataType:"json",error:function(e){$(".swal2-container, #modal-backdrop, #loaderLine").remove(),s(),errorAjaxResponse(e),r(a)},success:function(e){$(".swal2-container").remove(),s(),alertCustom("success",e.message),$("#name-register, #value-record").val(""),r(a)}})})),$(".btn-continue-domain").on("click",(function(){$("#modal-button-close-edit-domain-record").click(),$("#content-modal-recheck-dns-error").hide(),$("#content-modal-recheck-dns").show(),c()})),$(".btn-verify-domain").unbind("click"),$(document).on("click",".btn-verify-domain",(function(){var a=$("#domain").val();$("#modal-title-dns-recheck").hide(),loadOnModal(".content-dns"),$.ajax({method:"GET",url:"/api/project/"+e+"/domain/"+a+"/recheck",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$(".swal2-container").remove(),s(),$("#loaderModal").remove(),errorAjaxResponse(e),$("#content-modal-recheck-dns").hide(),$("#content-modal-recheck-dns-error").show()},success:function(e){$(".swal2-container").remove(),s(),$("#loaderModal").remove(),alertCustom("success",e.message),$("#content-modal-recheck-dns").hide(),$("#modal-info-dsn-success-body, #content-modal-recheck-dns-success").show(),n()}})}));var l={1:"warning",2:"warning",3:"success",4:"danger"};function m(e){"approved"==e.data[0].document_status?$("#div-recheck-dns").html("<button class='btn btn-success btn-verify-domain' domain='' style='font-size: 25px;'>Verificar</button>"):$("#div-recheck-dns").html('<span class="table-title">A aprovação do domínio só ficará disponível quando seus documentos e da sua empresa estiverem aprovados</span>')}$(".modal").on("hidden.bs.modal",(function(){var e;$(e).html(""),$(".modal-footer").css("display",""),$("#btn-modal").show(),$("#modal-title").show(),$("#especialModalTitle").remove()}))}));
