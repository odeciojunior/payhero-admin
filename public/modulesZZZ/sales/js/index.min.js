var currentPage=null,_atualizar=null,exportFormat=null;$(document).ready((function(){$(".applySelect2").select2({width:"100%",multiple:!0,language:{noResults:function(){return"Nenhum resultado encontrado"}}}),$(".check").on("click",(function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)})),$(".transaction-value").mask("#.##0,00",{reverse:!0}).removeAttr("maxlength"),$(".transaction-value").on("blur",(function(){if(1==$(this).val().length){var t="0,0"+$(this).val();$(".transaction-value").val(t)}else if(2==$(this).val().length){var e="0,"+$(this).val();$(".transaction-value").val(e)}})),$("#transaction").on("change paste keyup select",(function(){""===$(this).val()?($("#date_type").attr("disabled",!1).removeClass("disableFields"),$("#date_range").attr("disabled",!1).removeClass("disableFields")):($("#date_type").attr("disabled",!0).addClass("disableFields"),$("#date_range").attr("disabled",!0).addClass("disableFields"))})),$("#bt_get_csv").on("click",(function(){$("#modal-export-sale").modal("show"),exportFormat="csv"})),$("#bt_get_xls").on("click",(function(){$("#modal-export-sale").modal("show"),exportFormat="xlsx"})),$(".btn-confirm-export-sale").on("click",(function(){var t,a,n=new RegExp(/^[A-Za-z0-9_\-\.]+@[A-Za-z0-9_\-\.]{2,}\.[A-Za-z0-9]{2,}(\.[A-Za-z0-9])?/),o=$("#email_export").val();if(""==o||!n.test(o))return alertCustom("error","Preencha o email corretamente"),!1;t=exportFormat,(a=e()).format=t,a.email=$("#email_export").val(),$.ajax({method:"POST",url:"/api/sales/export",data:a,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#export-email").text(t.email),$("#alert-export").show().shake()}}),$("#modal-export-sale").modal("hide")})),$("#filtros").on("click",(function(){$("#div_filtros").is(":visible")?$("#div_filtros").slideUp():$("#div_filtros").slideDown()})),$("#bt_filtro").on("click",(function(t){t.preventDefault(),_atualizar()}));moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");function t(){1==verifyAccountFrozen()?$(document).on({mouseenter:function(){var t=$(this).attr("status");$(this).removeAttr("style"),$(this).text(t)},mouseleave:function(){var t=$(this).attr("status");$(this).removeAttr("style"),$(this).text(t)}},".boleto-pending"):$(document).on({mouseenter:function(){$(this).css("cursor","pointer").text("Regerar"),$(this).css("background","#545B62")},mouseleave:function(){var t=$(this).attr("status");$(this).removeAttr("style"),$(this).text(t)}},".boleto-pending")}function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=$("#transaction").val().replace("#",""),a=$("#date_range").val();e.length>0&&(a=moment("2018-01-01").format("DD/MM/YYYY")+" - "+moment().format("DD/MM/YYYY"));var n={project:$("#projeto").val(),payment_method:$("#forma").val(),status:$("#status").val(),client:$("#comprador").val(),customer_document:$("#customer_document").val(),date_type:$("#date_type").val(),date_range:a,transaction:e,cashback:$("#cashback").val(),plan:$("#plan").val(),coupon:$("#cupom").val(),company:$("#empresa").val(),value:$("#valor").val().replace(/[^\d]+/g,""),email_client:$("#email_cliente").val(),upsell:$("#upsell").val(),order_bump:$("#order-bump").val()};if(Object.keys(n).forEach((function(t){Array.isArray(n[t])&&(n[t]=n[t].filter((function(t){return t})).join(","))})),t){var o="";for(var s in n)o+="&"+s+"="+n[s];return encodeURI(o)}return n}function a(){loadOnAny(".number",!1,{styles:{container:{minHeight:"32px",height:"auto"},loader:{width:"20px",height:"20px",borderWidth:"4px"}}}),$.ajax({method:"GET",url:"/api/sales/resume",data:e(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny(".number",!0),errorAjaxResponse(t)},success:function(t){loadOnAny(".number",!0),$("#total-sales").html('<span class="font-size-30 bold">0</span>'),$("#commission, #total").html('<span style="color:#959595">R$</span> <span class="font-size-30 bold">0,00</span>'),t.total_sales&&($("#total-sales, #commission, #total").text(""),$("#total-sales").html('<span class="font-size-30 bold"> '.concat(t.total_sales," </span>")),$("#commission").html('<span style="color:#959595">R$</span> <span class="font-size-30 bold"> '.concat(t.commission," </span>")),"".concat(t.total).length>=13?$("#total").html('<span style="color:#959595">R$</span><span class="font-size-30 bold">&nbsp;</span><span style="font-size:27px !important" class="bold">'.concat(t.total,"</span>")):$("#total").html('<span style="color:#959595">R$</span> <span class="font-size-30 bold"> '.concat(t.total," </span>")))}})}$("#date_range").daterangepicker({startDate:moment().subtract(30,"days"),endDate:moment(),opens:"center",maxDate:moment().endOf("day"),alwaysShowCalendar:!0,showCustomRangeLabel:"Customizado",autoUpdateInput:!0,locale:{locale:"pt-br",format:"DD/MM/YYYY",applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Até",customRangeLabel:"Customizado",weekLabel:"W",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],firstDay:0},ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 dias":[moment().subtract(6,"days"),moment()],"Últimos 30 dias":[moment().subtract(29,"days"),moment()],"Este mês":[moment().startOf("month"),moment().endOf("month")],"Mês passado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Vitalício":[moment("2018-01-01 00:00:00"),moment()]}},(function(t,e){t.format("YYYY-MM-DD"),e.format("YYYY-MM-DD")})),loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)?($("#export-excel > div >").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#export-excel > div >").show(),$.each(t.data,(function(t,e){$("#projeto").append($("<option>",{value:e.id,text:e.name}))})),_atualizar()),loadingOnScreenRemove()}}),loadingOnScreen(),$.ajax({method:"GET",url:"/api/companies?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){isEmpty(t.data)||($.each(t.data,(function(t,e){$("#empresa").append($("<option>",{value:e.id,text:e.name}))})),_atualizar()),loadingOnScreenRemove()}}),$(document).on("click",".boleto-pending",(function(){if(0==verifyAccountFrozen()){var t=$(this).attr("sale");$("#modal_regerar_boleto #bt_send").attr("sale",t),$("#modal_regerar_boleto").modal("show")}})),$("#bt_send").on("click",(function(){loadingOnScreen();var t=$(this).attr("sale");$.ajax({method:"POST",url:"/api/recovery/regenerateboleto",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{saleId:t,date:$("#date").val(),discountType:$("#discount_type").val(),discountValue:$("#discount_value").val()},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),$(".loading").css("visibility","hidden"),$("#modal_regerar_boleto").modal("hide"),_atualizar(currentPage)}})})),_atualizar=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;currentPage=n;var o=!0;loadOnTable("#dados_tabela","#tabela_vendas"),null==n?n="/api/sales?"+e(!0).substr(1):(n="/api/sales"+n+e(!0),o=!1),$.ajax({method:"GET",url:n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#dados_tabela").html(""),$("#tabela_vendas").addClass("table-striped");var e={1:"success",6:"primary",7:"danger",8:"warning",4:"danger",3:"danger",2:"pendente",12:"success",20:"antifraude",21:"danger",22:"danger",23:"warning",24:"antifraude"};isEmpty(t.data)?($("#dados_tabela").html("<tr class='text-center'><td colspan='10' style='vertical-align: middle;height:257px;'><img style='width:124px;margin-right:12px;' src='"+$("#dados_tabela").attr("img-empty")+"'>Nenhuma venda encontrada</td></tr>"),$("#export-excel").hide()):($("#export-excel").show(),$.each(t.data,(function(t,a){var n="";a.start_date&&(n="<strong class='bold-mobile'>"+(n=a.start_date.split(/\s/g))[0]+" </strong> <br> <small class='gray font-size-12'>"+n[1]+" </small>");var o="";a.end_date&&(o="<strong class='bold-mobile'>"+(o=a.end_date.split(/\s/g))[0]+" </strong> <br> <small class='gray font-size-12'>"+o[1]+" </small>");var s="";s=null!=a.has_shopify_integration&&null==a.shopify_order&&20!=a.status&&a.date_before_five_minutes_ago?"table-warning-roll":"",s=null!=a.woocommerce_retry_order?"table-warning-roll":"";var l="";(!isEmpty(a.observation)||(a.observation,0)||(a.observation,0))&&(l='<a data-toggle="tooltip" title="'.concat(a.observation,'"\n                                                role="button" class="sale_observation" venda="').concat(a.id,'">\n                                                    <span style="color: #44a44b" class="o-info-help-1"></span>\n                                            </a>'));var r="";(!isEmpty(a.cupom_code)||(a.cupom_code,0)||(a.cupom_code,0))&&(r='\n                                    <a data-toggle="tooltip" title="Utilizado o cupom '.concat(a.cupom_code,'"\n                                        role="button" style=\'margin-left: 5px;\' >\n                                            <img width="20px" src="/modules/global/img/coupon.svg">\n                                    </a>'));var c="";a.upsell&&(c='\n                                    <a data-toggle="tooltip" title="Upsell"\n                                        role="button" style=\'margin-left: 5px;\' >\n                                            <img width="20px" src="/modules/global/img/upsell.svg">\n                                    </a>');var i="";a.has_order_bump&&(i='\n                                            <a data-toggle="tooltip" title="Order Bump"\n                                                role="button" style=\'margin-left: 5px;\' >\n                                                    <img width="20px" src="/modules/global/img/order-bump.svg">\n                                            </a>');var d="",m="";"0.00"!=a.cashback_value&&(m='<a data-toggle="tooltip" title="'.concat(a.cashback_value,'" role="button" style=\'margin-left: 5px;\'>\n                                                <span style="color: #5EE2A1; font-size: 26px; -webkit-text-stroke: 2px rgba(94, 226, 161, 0.1);" class="o-reload-1"></span>\n                                            </a>'),d='<b style="color: #5EE2A1;">'.concat(a.total_paid,"</b>")),dados="  <tr class='"+s+"'>\n                                    <td class='text-center'>\n                                        <br class=\"d-sm-none\"/>\n                                        ".concat(a.sale_code,' <br>\n                                        <div class="d-flex flex-row align-items-center justify-content-center">\n                                            ').concat(m,"\n                                            ").concat(c,"\n                                            ").concat(i,"\n                                            ").concat(r,'\n                                        </div>\n                                    </td>\n                                    <td>\n                                    <strong class="bold-mobile">').concat(a.product,"</strong>\n                                    ").concat(null!=a.affiliate&&"producer"==a.user_sale_type?'<br><small class="gray font-size-12">(Afiliado: '.concat(a.affiliate,")</small>"):"",'\n                                    <br> <small class="gray font-size-12">').concat(a.project,"</small></td>\n\n                                    <td class='display-sm-none display-m-none display-lg-none'>").concat(a.client,"</td>\n                                    <td>\n                                        <img src='/modules/global/img/cartoes/").concat(a.brand,".png'  style='width: 45px'>\n                                    </td>\n                                    <td class='text-center'>\n                                            <span class=\"status-sale badge badge-").concat(e[a.status]," ").concat("Pendente"===a.status_translate&&"pix"!=a.brand?"boleto-pending":"",'" ').concat("Pendente"===a.status_translate?'status="'+a.status_translate+'" sale="'+a.id_default+'"':"",">").concat(a.status_translate,"</span>\n\n                                    </td>\n                                    <td class='display-sm-none display-m-none text-left font-size-14'>").concat(n,"</td>\n                                    <td class='display-sm-none text-left font-size-14'>").concat(o,"</td>\n                                    <td style='white-space: nowrap;' class=\"text-center text-md-right\">\n                                        ").concat(d||"<b>".concat(a.total_paid,"</b> <br>"),'\n                                    </td>\n                                    <td style="text-align: center">\n                                        ').concat(l,"\n                                        <a role='button' class='detalhes_venda pointer' venda='").concat(a.id,'\'>\n                                            <span class="o-eye-1"></span>\n                                        </a>\n                                    </td>\n                                </tr>'),$((function(){$('[data-toggle="tooltip"]').tooltip({container:".page"})})),$("#dados_tabela").append(dados)})),$("#date").val(moment(new Date).add(3,"days").format("YYYY-MM-DD")),$("#date").attr("min",moment(new Date).format("YYYY-MM-DD"))),pagination(t,"sales",_atualizar)}}),o&&a(),t()},$(".applySelect2").on("select2:select",(function(t){var e=t.params.data,a=$(this).attr("id");!function(t,e){var a=$("#".concat(e)),n=a.val();if(""!=t.id){if(n){var o=n.indexOf("");o>=0&&(n.splice(o,1),a.val(n).change())}}else n&&(n.splice(0,n.lenght),a.val(null).change(),n.push(""),a.val("").change())}(e,a),$("#".concat(a)).focus(),$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$(".applySelect2").on("change",(function(){var t,e,a=$(this).attr("id");t=a,e=$("#".concat(t)).val(),0===$("#".concat(t)).val().length&&(e.push(""),e=$("#".concat(t)).val("").trigger("change"))})),$(document).on("focusout",".select2-selection__rendered",(function(){$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$(document).on("focusin",".select2-selection__rendered",(function(){$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$("#projeto").on("change",(function(){$(this).val();$("#plan").val(null).trigger("change")})),$("#plan").select2({language:{noResults:function(){return"Nenhum plano encontrado"},searching:function(){return"Procurando..."},errorLoading:function(){return"Os resultados não puderam ser carregados"}},ajax:{data:function(t){return{list:"plan",search:t.term,project_id:$("#projeto").val()}},method:"GET",url:"/api/sales/user-plans",delay:300,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processResults:function(t){return result=$.map(t.data,(function(t){return{id:t.id,text:t.name+(t.description?" - "+t.description:"")}})),t.data.length>0&&result.splice(0,0,{id:"",text:"Todos os Planos"}),{results:result}}}}),$(".btn-light-1").on("click",(function(){var t=$("#icon-filtro"),e=$("#text-filtro");e.fadeOut(10),"matrix(1, 0, 0, 1, 0, 0)"==t.css("transform")||"none"==t.css("transform")?(t.css("transform","rotate(180deg)"),e.html("Minimizar <br class='d-flex d-sm-none'> filtros").fadeIn()):(t.css("transform","rotate(0deg)"),e.text("Filtros avançados").fadeIn())})),$(document).on("keypress",(function(t){13==t.keyCode&&_atualizar()}))}));
