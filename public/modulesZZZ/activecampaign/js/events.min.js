function getIdAddList(e){try{return e.event.add_list.id}catch(e){return 0}}function getIdRemoveList(e){try{return e.event.remove_list.id}catch(e){return 0}}$((function(){var e=$(window.location.pathname.split("/")).get(-1),t=$("#form-register-event").html(),a=$("#form-update-event").html();function n(){$("#form-register-event").html(""),$("#form-register-event").html(t)}function o(){$.ajax({method:"GET",url:"/api/apps/activecampaignevent",dataType:"json",data:{integration:e},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){$("#data-table-event").html("Erro ao encontrar dados"),errorAjaxResponse(e)})),success:function(t){var n;n=t.data,0===Object.keys(n).length?$("#data-table-event").html("<tr class='text-center'><td colspan='11' style='height: 70px; vertical-align: middle;'>Nenhum registro encontrado</td></tr>"):($("#data-table-event").html(""),$.each(t.data,(function(e,t){data="",data+="<tr>",data+='<td id="" class="" style="vertical-align: middle;">'+t.event_text+"</td>",data+='<td id="" class="" style="vertical-align: middle;">',$.each(t.add_tags,(function(e,t){data+='<div class="badge badge-success mr-1 mb-1">'+t.tag+"</div>"})),data+="</td>",data+='<td id="" class="" style="vertical-align: middle;">',$.each(t.remove_tags,(function(e,t){data+='<div class="badge badge-danger mr-1 mb-1">'+t.tag+"</div>"})),data+="</td>";var a=null!=t.add_list?t.add_list.list:"",n=null!=t.remove_list?t.remove_list.list:"";data+='<td id="" class="" style="vertical-align: middle;">'+a+"</td>",data+='<td id="" class="" style="vertical-align: middle;">'+n+"</td>",data+="<td style='text-align:center' class='mg-responsive'>",data+="<a title='Visualizar' class='mg-responsive pointer details-event' event='"+t.id+"' role='button'><span class='o-eye-1'></span></a>",data+="<a title='Editar' class='mg-responsive pointer edit-event' event='"+t.id+"' role='button'data-toggle='modal' data-target='#modal-content'><span class='o-edit-1'></span></a>",data+="<a title='Excluir' class='mg-responsive pointer delete-event' event='"+t.id+"' role='button'data-toggle='modal' data-target='#modal-delete'><span class='o-bin-1'></span></a>",data+="</td>",data+="</tr>",$("#data-table-event").append(data),$("#table-events").addClass("table-striped")})),t.data.length<6?($("#add-event").removeClass("d-none"),$("#add-event").addClass("d-flex")):($("#add-event").addClass("d-none"),$("#add-event").removeClass("d-flex"))),$(".details-event").unbind("click"),$(".details-event").on("click",(function(){var e=$(this).attr("event");console.log("entrei 1"),$.ajax({method:"GET",url:"/api/apps/activecampaignevent/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){errorAjaxResponse(e),loadingOnScreenRemove()})),success:function(e){if("error"==e.message)alertCustom("error","Ocorreu um erro ao tentar buscar dados do evento!");else{$("#modal-title-details").html("Detalhes do Evento <br>");var t=null!=e.data.add_list?e.data.add_list.list:"",a=null!=e.data.remove_list?e.data.remove_list.list:"";$("#add_list_text").text(t),$("#remove_list_text").text(a),data="",$.each(e.data.add_tags,(function(e,t){data+=t.tag+", "})),$("#add_tags_text").text(data),$("#event_sale").text(e.data.event_text),data="",$.each(e.data.remove_tags,(function(e,t){data+=t.tag+", "})),$("#remove_tags_text").text(data),$("#modal_details_event").modal("show")}}})})),$(".edit-event").unbind("click"),$(".edit-event").on("click",(function(){loadOnModal("#modal-add-body"),$("#modal-add-body").html("");var n=$(this).attr("event");$("#modal-title-event").html('<span class="ml-15">Editar Evento</span>'),$("#modal_add_event").modal("show"),$("#form-update-event").hide(),$("#form-register-event").hide(),$(".load-list-tags").show(),$("#btn-modal").addClass("d-none"),$.ajax({method:"GET",url:"/api/apps/activecampaignevent/"+n+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){errorAjaxResponse(t),loadingOnScreenRemove()},success:function(t){$("#form-update-event").html(""),$("#form-update-event").html(a),$("#event_id_edit").val(t.event.id),$("#event_name_edit").html(t.event.event_text),$(".load-list-tags").hide(),$("#btn-modal").removeClass("d-none");var d=t.lists;$("#add_list_edit").html("<option>Selecione a lista</option>"),$("#remove_list_edit").html("<option>Selecione a lista</option>"),null!==d&&($(d.lists).each((function(e,a){var n="",o=getIdAddList(t);a.id==o&&(n="selected"),$("#add_list_edit").append("<option value='"+a.id+";"+a.name+"' "+n+">"+a.name+"</option>")})),$(d.lists).each((function(e,a){var n="",o=getIdRemoveList(t);a.id==o&&(n="selected"),$("#remove_list_edit").append("<option value='"+a.id+";"+a.name+"' "+n+">"+a.name+"</option>")})));var i=t.tags;if($("#add_tags_edit").html(""),$("#remove_tags_edit").html(""),null!==i){var s=[];$(t.event.add_tags).each((function(e,t){s.push(t.id)}));var l=[];$(t.event.remove_tags).each((function(e,t){l.push(t.id)})),$(i.tags).each((function(e,t){var a="",n="";s.indexOf(t.id)>=0&&(a="selected"),l.indexOf(t.id)>=0&&(n="selected"),$("#add_tags_edit").append("<option value='"+t.id+";"+t.tag+"' "+a+">"+t.tag+"</option>"),$("#remove_tags_edit").append("<option value='"+t.id+";"+t.tag+"' "+n+">"+t.tag+"</option>")}))}$("#add_tags_edit").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a(s) tag(s)"}),$("#remove_tags_edit").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a(s) tag(s)"}),$("#add_list_edit").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a lista"}),$("#remove_list_edit").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a lista"}),$("#modal_add_event").modal("show"),$("#form-register-event").hide(),$("#form-update-event").show(),$("#btn-modal").removeClass("btn-save-event"),$("#btn-modal").addClass("btn-update-event"),$("#btn-modal").text("Atualizar"),$("#btn-modal").show(),loadingOnScreenRemove(),$(document).on("click",".btnDelete",(function(e){e.preventDefault(),$(this).parent().parent().remove()})),$(".btn-update-event").unbind("click"),$(".btn-update-event").on("click",(function(){var t=new FormData(document.getElementById("form-update-event"));t.append("integration_id",e),loadingOnScreen(),$.ajax({method:"POST",url:"/api/apps/activecampaignevent/"+n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:t,processData:!1,contentType:!1,cache:!1,error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){loadingOnScreenRemove(),errorAjaxResponse(e),o()})),success:function(e){loadingOnScreenRemove(),alertCustom("success","Evento atualizado com sucesso"),o()}})}))}})})),$(".delete-event").on("click",(function(e){e.preventDefault();var t=$(this).attr("event");$("#modal-delete-event").modal("show"),$("#btn-delete-event").unbind("click"),$("#btn-delete-event").on("click",(function(){$("#modal-delete-event").modal("hide"),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/apps/activecampaignevent/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){loadingOnScreenRemove(),errorAjaxResponse(e)})),success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),o()}})}))}))}})}$("#tab_events").on("click",(function(){o()})),$("#add-event").on("click",(function(){$("#modal_add_event").attr("data-backdrop","static"),$("#modal_add_event").modal("show"),$("#modal-title-event").html('<span class="ml-15">Adicionar Evento</span>'),$("#form-update-event").hide(),$("#form-register-event").hide(),$(".load-list-tags").show(),$("#btn-modal").addClass("d-none"),$.ajax({method:"GET",url:"/api/apps/activecampaignevent/create",data:{integration:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#modal-content").hide(),errorAjaxResponse(e)},success:function(t){$("#events").html(""),$(".load-list-tags").hide(),$(t.events).each((function(e,t){$("#events").append("<option value='"+t.id+"'>"+t.name+"</option>")}));var a=t.lists;$("#add_list").html("<option>Selecione a lista</option>"),$("#remove_list").html("<option>Selecione a lista</option>"),null!==a&&($(a.lists).each((function(e,t){$("#add_list").append("<option value='"+t.id+";"+t.name+"'>"+t.name+"</option>")})),$(a.lists).each((function(e,t){$("#remove_list").append("<option value='"+t.id+";"+t.name+"'>"+t.name+"</option>")})));var d=t.tags;$("#add_tags").html("<option>Selecione a(s) tag(s)</option>"),$("#remove_tags").html("<option>Selecione a(s) tag(s)</option>"),null!==d&&($(d.tags).each((function(e,t){$("#add_tags").append("<option value='"+t.id+";"+t.tag+"'>"+t.tag+"</option>")})),$(d.tags).each((function(e,t){$("#remove_tags").append("<option value='"+t.id+";"+t.tag+"'>"+t.tag+"</option>")}))),$("#add_tags").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a(s) tag(s)"}),$("#remove_tags").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a(s) tag(s)"}),$("#add_list").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a lista"}),$("#remove_list").select2({dropdownParent:$("#modal_add_event"),placeholder:"Selecione a lista"}),$("#btn-modal").addClass("btn-save-event"),$("#btn-modal").html('<i class="material-icons btn-fix"> save </i>Salvar'),$("#btn-modal").removeClass("d-none"),$("#form-update-event").hide(),$("#form-register-event").show(),$(".btn-save-event").unbind("click"),$(".btn-save-event").on("click",(function(){if(""==$("#events").val())return alertCustom("error","Dados informados inválidos"),!1;var t=new FormData(document.getElementById("form-register-event"));t.append("integration_id",e),loadingOnScreen(),$.ajax({method:"POST",url:"/api/apps/activecampaignevent",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:t,processData:!1,contentType:!1,cache:!1,error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),o(),n(),alertCustom("success","Evento Adicionado!")}})}))}}),$(".btn-close-add-event").on("click",(function(){n(),$("#modal_add_event").removeAttr("data-backdrop")}))}))}));
