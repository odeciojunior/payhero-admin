function _createForOfIteratorHelper(t,a){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=_unsupportedIterableToArray(t))||a&&t&&"number"==typeof t.length){e&&(t=e);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){c=!0,r=t},f:function(){try{i||null==e.return||e.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(t,a){if(t){if("string"==typeof t)return _arrayLikeToArray(t,a);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?_arrayLikeToArray(t,a):void 0}}function _arrayLikeToArray(t,a){(null==a||a>t.length)&&(a=t.length);for(var e=0,n=new Array(a);e<a;e++)n[e]=t[e];return n}var chartDefaultColorsLabel=["rgba(51, 99, 143, 1)","rgba(255, 205, 27, 1)","rgba(0, 177, 255, 1)","rgba(255, 47, 47, 1)","rgba(185, 185, 185, 1)","rgba(27, 228, 168, 1)"],tracking_id="undefined",statusEnum={1:"statusPosted",2:"statusInTransit",3:"statusDelivered",4:"statusOnDelivery",5:"statusProblem","":"statusWithoutInfo"},systemStatus={1:"",2:'<i class="material-icons ml-2 red-gradient" data-toggle="tooltip" data-container=".page" title="O código foi reconhecido pela transportadora mas, ainda não teve nenhuma movimentação. Essa informação pode ser atualizada nos próximos dias">report_problem</i>',3:'<i class="material-icons ml-2 red-gradient" data-toggle="tooltip" data-container=".page" title="O código não foi reconhecido por nenhuma transportadora">report_problem</i>',4:'<i class="material-icons ml-2 red-gradient" data-toggle="tooltip" data-container=".page" title="A data de postagem da remessa é anterior a data da venda">report_problem</i>',5:'<i class="material-icons ml-2 red-gradient" data-toggle="tooltip" data-container=".page" title="Já existe uma venda com esse código de rastreio cadastrado">report_problem</i>',"":""};$((function(){$(".applySelect2").select2({width:"100%",multiple:!0,language:{noResults:function(){return"Nenhum resultado encontrado"},searching:function(){return"Procurando..."}}}),$("#tracking-product-image").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg")})),$("#sale").on("change paste keyup select",(function(){""===$(this).val()?$("#date_updated").attr("disabled",!1).removeClass("disableFields"):($("#date_updated").val(moment("2018-01-01").format("DD/MM/YYYY")+" - "+moment().format("DD/MM/YYYY")),$("#date_updated").attr("disabled",!0).addClass("disableFields"))})),$(document).on("click",".copy",(function(){var t=$("<input>");$("body").append(t),t.val($(this).html()).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Código copiado!")})),$(document).on("click",".tracking-add, .tracking-edit",(function(t){$(t.target).closest(".edit-detail").removeClass("col-5");var a=$(this).parent().parent();a.find(".input-tracking-code").removeClass("fake-label").prop("readonly",!1).focus().removeAttr("placeholder"),a.find(".tracking-save, .tracking-close").show(),a.find(".tracking-detail, .tracking-add").hide(),$(this).hide()})),$(document).on("click",".tracking-close",(function(t){$(t.target).parent().prev().addClass("col-5");var a=$(this).parent().parent();a.find(".input-tracking-code").prop("readonly",!0).blur().removeClass("border-danger").attr("placeholder","Clique para adicionar"),$(this).attr("data-code").length<1&&a.find(".input-tracking-code").addClass("fake-label").val("");var e=$(this).attr("data-code");a.find(".input-tracking-code").val()!==e&&a.find(".input-tracking-code").val(e),a.find(".tracking-add, .tracking-detail, .tracking-edit").show(),a.find(".tracking-save, .tracking-close").hide(),$(this).hide()})),$("#bt_filtro").on("click",(function(){r(),o()}));moment().subtract(30,"days").format("YYYY-MM-DD"),moment().format("YYYY-MM-DD");function t(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a={tracking_code:$("#tracking_code").val(),status:$("#status").val(),project:$("#project-select").val(),date_updated:$("#date_updated").val(),sale:$("#sale").val().replace("#",""),transaction_status:$("#status_commission").val(),problem:$("#tracking_problem").prop("checked")?1:0};if(t){var e="";for(var n in a)e+="&"+n+"="+a[n];return encodeURI(e)}return a}function a(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}$("#date_updated").daterangepicker({startDate:moment().subtract(30,"days"),endDate:moment(),opens:"right",maxDate:moment().endOf("day"),alwaysShowCalendar:!0,showCustomRangeLabel:"Customizado",autoUpdateInput:!0,locale:{locale:"pt-br",format:"DD/MM/YYYY",applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Até",customRangeLabel:"Customizado",weekLabel:"W",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],firstDay:0},ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 dias":[moment().subtract(6,"days"),moment()],"Últimos 30 dias":[moment().subtract(30,"days"),moment()],"Este mês":[moment().startOf("month"),moment().endOf("month")],"Mês passado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Vitalício":[moment("2018-01-01 00:00:00"),moment()]}},(function(t,a){t.format("YYYY-MM-DD"),a.format("YYYY-MM-DD")})),loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true&affiliate=false",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),loadingOnScreenRemove()},success:function(t){isEmpty(t.data)?($("#export-excel").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#export-excel").show(),"api sales"!=t.data&&$.each(t.data,(function(t,a){$("#project-select").append($("<option>",{value:a.id,text:a.name}))})),r(),o()),loadingOnScreenRemove()}});var e=null;function n(t,n){null!==e&&e.destroy();var o=document.getElementById("myChart");e=new Chart(o,{id:"custom_canvas_background_color",type:"doughnut",data:{labels:["Postados: ","Em trânsito: ","Saiu para entrega: ","Problema na entrega: ","Não informado: ","Entregues: "],datasets:[{data:n,backgroundColor:t,borderColor:t,borderWidth:1,cutout:"83%"}]},options:{responsive:!0,plugins:{legend:{display:!1},tooltip:{enabled:!0,callbacks:{title:function(t){return"".concat(t[0].label)},label:function(t){return t.dataset.data[t.dataIndex]>1e4?Math.round(t.dataset.data[t.dataIndex]/1e3,1)+"K":a(t.dataset.data[t.dataIndex])}}}}}})}function o(){var e="#percentual-posted, #percentual-dispatched, #percentual-out, #percentual-exception, #percentual-unknown, #percentual-delivered, #graphic-loading";!function(t,a,e){t(a,!1,e),$("#graphic-loading").append($(".loader-any-container")[6]).show().css("z-index","2")}(loadOnAny,e,{styles:{container:{height:"36px",minHeight:"0px",justifyContent:"center"},loader:{width:"20px",height:"20px",borderWidth:"3px"}}}),$.ajax({method:"GET",url:"/api/tracking/resume?"+t(!0).substr(1),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),n(chartDefaultColorsLabel,[1,0,0,0,0,0]),loadOnAny(e,!0),$("#graphic-loading").append($(".loader-any-container")[6]).hide()},success:function(t){if(isEmpty(t.data))return alertCustom("error","Erro ao carregar resumo dos rastreios"),void n(chartDefaultColorsLabel,[1,0,0,0,0,0]);!function(t){var e=t.total,o=t.posted,r=t.dispatched,i=t.out_for_delivery,c=t.delivered,s=t.exception,d=t.unknown,l=1e4;if(function(t){if(t<1||null==typeof t)return!0;return!1}(t.total)){if($("#noData").length>0)return;$("#dataCharts").append('<img id="noData" src="/modules/global/img/sem-dados.svg" />'),$("#data-labels").append('<span id="warning-text" class="d-flex"> Nenhum rastreamento encontrado </span>'),$("#myChart, .labels, .total-container").hide()}else $("#noData").length>0&&$("#noData, #warning-text").remove(),$("#myChart, .labels, .total-container").show(),n(chartDefaultColorsLabel,[o,r,i,s,d,c]);var p="<div>Total:<br> <b>"+a(e)+"</b> </div>";$("#total-products").text(e>l?"".concat(parseFloat(a(e)).toFixed(1),"K"):a(e)).attr("data-original-title",p),$("#percentual-posted .resume-number").html(o=o<=0?0:a(o)),$("#percentual-dispatched .resume-number").html(r=r<=0?0:a(r)),$("#percentual-out .resume-number").html(i=i<=0?0:a(i)),$("#percentual-exception .resume-number").html(s=s<=0?0:a(s)),$("#percentual-unknown .resume-number").html(d=d<=0?0:a(d)),$("#percentual-delivered .resume-number").html(c=c<=0?0:a(c))}(t.data),loadOnAny(e,!0),$("#graphic-loading").append($(".loader-any-container")[6]).hide()}})}function r(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a=null==a?"/api/tracking?"+t(!0).substr(1):"/api/tracking"+a+t(!0),loadOnTable("#dados_tabela","#tabela_trackings"),$.ajax({method:"GET",url:a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){if($("#dados_tabela").html(""),$("#tabela_trackings").addClass("table-striped"),$("#pagination-trackings").html(""),isEmpty(t.data))$("#dados_tabela").html('\n                    <tr class="text-center">\n                      <td colspan="6" style="vertical-align: middle;height:257px;">\n                        <img style="width:124px;margin-right:12px;" src="'.concat($("#dados_tabela").attr("img-empty"),'">\n                        Nenhum rastreamento encontrado\n                      </td>\n                    </tr>'));else{var a=!1,e="";$.each(t.data,(function(t,n){e!==n.sale&&(a=!a);var o='\n                        <input maxlength="18" minlength="10" class="mr-10 col-sm-7 form-control font-weight-bold input-tracking-code fake-label" placeholder="Clique para adicionar" value="'.concat(n.tracking_code,'" style="padding-bottom: 5px;border-radius: 8px;max-height:38px;">\n\n                        <a class=\'tracking-add pointer mt-1 ml-10 px-0 default-buttons\' title="Adicionar">\n                            <span id="add-tracking-code" class=\'o-add-1 text-primary border border-primary\'></span>\n                        </a>'),r='\n                        <div class="edit-detail d-flex justify-content-between px-0 col-5">\n\n                            <a class=\'tracking-edit pointer default-buttons\' title="Editar">\n                                <span class="text-right o-edit-1"></span>\n                            </a>\n\n                            <a class=\'tracking-detail pointer\' title="Visualizar" tracking=\''.concat(n.id,'\'>\n                                <span class="o-eye-1"></span>\n                            </a>\n                        </div>'),i="\n                        <tr ".concat(a?'class="td-odd"':"",">\n\n                            ").concat(e!==n.sale?'\n                                <td class="detalhes_venda pointer table-title col-sm-1" venda="'.concat(n.sale,'">\n                                    #').concat(n.sale,"\n                                </td>"):"<td>\n                                </td>",'\n\n                            <td class="col-sm-4">\n                                <span style="max-width: 330px; display:block; margin: 0px 0px 0px 0px;">\n                                    ').concat(n.product.amount,"x ").concat(n.product.name," ").concat(n.product.description?"("+n.product.description+")":"",'\n                                </span>\n                            </td>\n\n                            <td class="col-sm-1">').concat(n.approved_date,'</td>\n\n                            <td class="text-center col-sm-2">\n                                <span class="badge ').concat(statusEnum[n.tracking_status_enum],'">\n                                    ').concat(n.tracking_status,'\n                                </span>\n                            </td>\n\n                            <td style="width: 2%;padding: 0px !important;">\n                                ').concat(systemStatus[n.system_status_enum],"\n                                ").concat(n.is_chargeback_recovered?'<img class="orange-gradient ml-10" width="20px" src="/modules/global/img/svg/chargeback.svg" title="Chargeback recuperado">':"",'\n                            </td>\n\n                            <td class="text-left mb-0" style="max-height:74px!important;">\n                                <div class="d-flex">\n\n                                    ').concat(n.tracking_status_enum?'\n                                    <input maxlength="18" minlength="10" class="mr-10 col-7 form-control font-weight-bold input-tracking-code" readonly placeholder="Informe o código de rastreio" style="border-radius: 8px;" value="'.concat(n.tracking_code,'">')+r:o,'\n\n                                    <div class="save-close buttons d-flex px-0 col-5" style="max-height: 38px;">\n\n                                        <a id=\'pencil\' class=\'o-checkmark-1 text-white tracking-save pointer mr-10 text-center default-buttons\' title="Salvar" pps=\'').concat(n.pps_id,"'style=\"display:none\"></a>\n\n                                        <div class='tracking-close pointer' data-code='").concat(n.tracking_code,'\' title="Fechar" style="display:none">\n                                            &#x2715\n                                        </div>\n\n                                    </div>\n                                </div>\n                            </td>\n\n                        </tr>');$("#dados_tabela").append(i),e=n.sale})),pagination(t,"trackings",r)}}})}function i(a){var e=t();e.format=a,$.ajax({method:"POST",url:"/api/tracking/export",data:e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#export-email").text(t.email),$("#alert-export").show().shake()}})}$(document).on("click",".tracking-detail",(function(){tracking_id=$(this).attr("tracking"),loadOnAny("#modal-tracking-details"),$("#modal-tracking").modal("show"),$.ajax({method:"GET",url:"/api/tracking/"+$(this).attr("tracking"),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny("#modal-tracking-details",!0),errorAjaxResponse(t)},success:function(t){var a=t.data;if($("#tracking-code").text(a.tracking_code),$("#tracking-product-image").attr("src",a.product.photo),$("#tracking-product-name").text(a.product.name+(a.product.description?"("+a.product.description+")":"")),$("#tracking-product-amount").text(a.amount+"x"),$("#tracking-delivery-address").text("Endereço: "+a.delivery.street+", "+a.delivery.number),$("#tracking-delivery-neighborhood").text("Bairro: "+a.delivery.neighborhood),$("#tracking-delivery-zipcode").text("CEP: "+a.delivery.zip_code),$("#tracking-delivery-city").text("Cidade: "+a.delivery.city+"/"+a.delivery.state),$("#modal-tracking-details .btn-notify-trackingcode").attr("tracking",a.id),a.link?($("#link-tracking a").attr("href",a.link),$("#link-tracking").show()):$("#link-tracking").hide(),$("#table-checkpoint").html(""),!isEmpty(a.checkpoints)){var e,n=_createForOfIteratorHelper(a.checkpoints);try{for(n.s();!(e=n.n()).done;){var o=e.value;$("#table-checkpoint").append("<tr>\n                              <td>".concat(o.created_at,'</td>\n                              <td>\n                                  <span class="text-secondary badge badge-').concat(statusEnum[o.tracking_status_enum],'">').concat(o.tracking_status,"</span>\n                              </td>\n                              <td>").concat(o.event,"</td>\n                          </tr>"))}}catch(t){n.e(t)}finally{n.f()}}loadOnAny("#modal-tracking-details",!0)}})})),$(document).on("click",".input-tracking-code",(function(){var t=$(this).parent().parent();$(".tracking-close").click(),t.find(".tracking-edit, .tracking-add").click()})),$(document).on("click",".tracking-save",(function(){var t=$(this);t.prop("disabled",!0);var a=t.parent().parent().find(".input-tracking-code").val(),e=t.attr("pps");$.ajax({method:"POST",url:"/api/tracking",data:{tracking_code:a,product_plan_sale_id:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){t.prop("disabled",!1),errorAjaxResponse(a),t.parent().parent().find(".input-tracking-code").addClass("border-danger"),setTimeout((function(){t.parent().parent().find(".input-tracking-code").val("").removeClass("border-danger").attr("placeholder","Clique para adicionar"),t.parent().parent().find(".tracking-close").trigger("click")}),1e3)},success:function(a){if(!isEmpty(a.data.tracking_status)){var e=a.data,n=t.parent().parent(),o=n.find(".save-close");n.find(".tracking-add, .edit-detail").remove(),n.find(".tracking-close").attr("data-code",a.data.tracking_code).trigger("click"),n.find(".input-tracking-code").removeClass("fake-label, border-danger");var r='\n                        <div class="edit-detail d-flex justify-content-between px-0 col-5">\n\n                            <a class=\'tracking-edit pointer\' title="Editar">\n                                <span class="text-right o-edit-1"></span>\n                            </a>\n\n                            <a class=\'tracking-detail pointer\' title="Visualizar" tracking=\''.concat(e.id,'\'>\n                                <span class="o-eye-1"></span>\n                            </a>\n                        </div>');$(r).insertBefore(o),t.parent().parent().parent().find(".badge").removeClass("statusPosted statusOnDelivery statusDelivered statusInTransit statusProblem statusWithoutInfo").addClass(statusEnum[e.tracking_status_enum]).html(e.tracking_status),alertCustom("success","Código de rastreio salvo com sucesso")}t.prop("disabled",!1).hide()}})})),$(document).on("click","#modal-tracking-details .btn-notify-trackingcode",(function(){$.ajax({method:"POST",url:"/api/tracking/notify/"+tracking_id,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(){alertCustom("success","Notificação enviada com sucesso")}})})),$("#btn-export-csv").on("click",(function(){i("csv")})),$("#btn-export-xls").on("click",(function(){i("xlsx")})),$("#btn-import-xls").on("click",(function(){$("#input-import-xls").click()})),$("#input-import-xls").on("change",(function(){$("#btn-import-xls").prop("disabled",!0);var t=new FormData;t.append("import.xlsx",this.files[0]),$(this).val(null),$.ajax({url:"/api/tracking/import",type:"post",processData:!1,contentType:!1,cache:!1,data:t,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){$("#btn-import-xls").prop("disabled",!1),errorAjaxResponse(t)},success:function(t){$("#btn-import-xls").prop("disabled",!1),alertCustom("success","A importação começou! Você receberá uma notificação quando tudo estiver pronto!")}})})),$(".btn-light-1").click((function(){var t=$("#icon-filtro"),a=$("#text-filtro");a.fadeOut(10),"matrix(1, 0, 0, 1, 0, 0)"==t.css("transform")||"none"==t.css("transform")?(t.css("transform","rotate(180deg)"),a.text("Minimizar filtros").fadeIn()):(t.css("transform","rotate(0deg)"),a.text("Filtros avançados").fadeIn())})),$(document).on("keypress",(function(t){13==t.keyCode&&(r(),o())})),$(".applySelect2").on("select2:select",(function(t){var a=t.params.data,e=$(this).attr("id");!function(t,a){var e=$("#"+a),n=e.val();if("all"==$("#".concat(a)).val()[0]||""==$("#".concat(a)).val()[0])var o=$("#".concat(a)).val()[0];if(t.id!=o){if(n){var r=n.indexOf(o);r>=0&&(n.splice(r,1),e.val(n).change())}}else n&&(n.splice(0,n.lenght),e.val(null).change(),n.push(o),e.val(o).change())}(a,e),$("#".concat(e)).focus().scrollTop(0),$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$(document).on("focusout",".select2-selection__rendered",(function(){$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$(document).on("focusin",".select2-selection__rendered",(function(){$(".select2-selection.select2-selection--multiple").scrollTop(0)})),$(".applySelect2").on("change",(function(){var t,a,e=$(this).attr("id");t=e,a=$("#".concat(t)).val(),0===$("#".concat(t)).val().length&&("project"==t?(a.push("all"),a=$("#".concat(t)).val("all").trigger("change")):(a.push(""),a=$("#".concat(t)).val("").trigger("change")))}))}));
