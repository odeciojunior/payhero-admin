var documentType="",bagder="",badgeArray={pending:"badge-primary",analyzing:"badge-pending",approved:"badge-success",refused:"badge-danger"},statusArray={pending:"Pendente",analyzing:"Em análise",approved:"Aprovado",refused:"Recusado"},getDataProfile="";$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip();function e(){$("#message_not_verified_cellphone").css("display","none"),$("#input_group_cellphone").css("border-color","forestgreen"),$("#cellphone").css("border-color","forestgreen"),$("#input_group_cellphone").append().html("<i class='fas fa-check' data-toggle='tooltip' data-placement='left' title='Celular verificado!' style='color:forestgreen;'></i>")}function a(){$("#message_not_verified_email").css("display","none"),$("#input_group_email").css("border-color","forestgreen"),$("#email").css("border-color","forestgreen"),$("#input_group_email").append().html("<i class='fas fa-check' data-toggle='tooltip' data-placement='left' title='Email verificado!' style='color:forestgreen;'></i>")}2==window.location.search.split("?").length&&"tab=documents"==window.location.search.split("?")[1]&&($("#user-nav").removeClass("active"),$("#tab_user").removeClass("active"),$("#documents-nav").addClass("active"),$("#tab_documentos").addClass("active"),$("#tab_documentos").addClass("show")),(getDataProfile=function(){$.ajax({url:"/api/profile",type:"GET",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},cache:!1,async:!1,error:function(e){errorAjaxResponse(e)},success:function(t){t.countries;if($("#name").val(t.user.name),$("#email").val(t.user.email),$("#document").val(t.user.document),$("#cellphone").val(t.user.cellphone),$("#previewimage").attr("src",t.user.photo?t.user.photo:"/modules/global/img/user-default.png"),$("#previewimage").on("error",(function(){$(this).attr("src","/modules/global/img/user-default.png")})),$("#sex").val(t.user.sex),$("#mother_name").val(t.user.mother_name),$("#zip_code").val(t.user.zip_code),$("#street").val(t.user.street),$("#number").val(t.user.number),$("#neighborhood").val(t.user.neighborhood),$("#complement").val(t.user.complement),$("#city").val(t.user.city),$("#state").val(t.user.state),$("#country").find("option").each((function(){t.user.country==$(this).val()&&$(this).attr("selected",!0)})),"brazil"!=t.user.country&&"usa"!=t.user.country||$(".div-state").show(),t.user.boleto_compensated&&$("#boleto_compensated_switch").attr("checked","checked"),t.user.sale_approved&&$("#sale_approved_switch").attr("checked","checked"),t.user.domain_approved&&$("#domain_approved_switch").attr("checked","checked"),t.user.shopify&&$("#shopify_switch").attr("checked","checked"),t.user.billet_generated&&$("#billet_generated_switch").attr("checked","checked"),t.user.affiliation&&$("#affiliation_switch").attr("checked","checked"),t.user.cellphone_verified?e():($("#message_not_verified_cellphone").css("display",""),$("#input_group_cellphone").css("border-color","red"),$("#cellphone").css("border-color","red"),$("#input_group_cellphone").append().html("<i class='fas fa-times' data-toggle='tooltip' data-placement='left' title='Celular não verificado!' style='color:red;'></i>")),"account_owner"!==t.user.role.name?($("#nav_notifications").hide(),$("#nav_taxs").hide()):($("#nav_notifications").show(),$("#nav_taxs").show()),t.user.email_verified?a():($("#message_not_verified_email").css("display",""),$("#input_group_email").css("border-color","red"),$("#email").css("border-color","red"),$("#input_group_email").append().html("<i class='fas fa-times' data-toggle='tooltip' data-placement='left' title='Email não verificado!' style='color:red;'></i>")),"pending"===t.user.personal_document_translate||"refused"===t.user.personal_document_translate?$("#text-alert-documents-cpf").show():$("#text-alert-documents-cpf").hide(),"approved"===t.user.personal_document_translate||"analyzing"===t.user.personal_document_translate){var o=$("#name"),r=$("#document");o.prop("readonly",!0),r.prop("readonly",!0),$("#personal-document-id").hide()}if("refused"==t.user.address_document_translate&&($("#text-alert-documents-cpf").show(),$("#address-document-id").show()),"approved"===t.user.address_document_translate||"analyzing"==t.user.address_document_translate){var s=$("#zip_code"),c=$("#street"),l=$("#number"),i=$("#neighborhood"),d=$("#complement"),u=$("#city"),p=$("#state"),m=$("#country");s.prop("readonly",!0),c.prop("readonly",!0),l.prop("readonly",!0),i.prop("readonly",!0),d.prop("readonly",!0),u.prop("readonly",!0),p.prop("readonly",!0),m.attr("readonly","readonly")}"approved"!=t.user.address_document_translate&&"analyzing"!=t.user.address_document_translate||$("#address-document-id").hide(),$("#td_personal_status").html("").append("<span class='badge ".concat(badgeArray[t.user.personal_document_translate],"'>").concat(statusArray[t.user.personal_document_translate],"</span>")),$("#td_address_status").html("").append("<span class='badge ".concat(badgeArray[t.user.address_document_translate],"'>").concat(statusArray[t.user.address_document_translate],"</span>")),t.user.id_code,function(e){3==e.address_document_status&&3==e.personal_document_status&&($(".dz-hidden-input").prop("disabled",!0),$("#dropzoneDocuments").css({cursor:"not-allowed"}),$(".text-dropzone").css({cursor:"not-allowed"}))}(t.user),function(e){null==e.zip_code||null==e.street||null==e.neighborhood||null==e.city?($("#row_dropzone_documents").hide(),$("#div_address_pending").show()):($("#row_dropzone_documents").show(),$("#div_address_pending").hide())}(t.user),function(e){"brazil"==e.country?($("#zip_code").mask("00000-000"),$("#cellphone").mask("+55 (00) 00000-0000"),$("#document").mask("000.000.000-00"),n()):$("#cellphone").mask("+0#")}(t.user),function(e){var a={brazil:"CPF",portugal:"NIF (Número de Identificação Fiscal)",usa:"SSN (Social Security Number)",germany:"STEUERNUMMER",spain:"DNI (Documento Nacional de Identidade)",france:"CI",italy:"Codice Fiscale",chile:"RUT (Rol Único Tributario)"};$(".label-document").text(a[e.country]),$("#document").attr("placeholder",a[e.country])}(t.user)}})})(),$("#btn_verify_cellphone").on("click",(function(){event.preventDefault(),loadingOnScreen();var e=$("#cellphone").val();$.ajax({method:"POST",url:"/api/profile/verifycellphone",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{cellphone:e},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show()},success:function(e){loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show(),alertCustom("success",e.message),$("#progress-bar-register").css("width","66%"),$("#jump").show()}})})),$("#btn_verify_email").on("click",(function(){event.preventDefault(),loadingOnScreen();var e=$("#email").val();$.ajax({method:"POST",url:"/api/profile/verifyemail",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{email:e},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show()},success:function(e){loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show(),alertCustom("success",e.message),$("#progress-bar-register").css("width","66%"),$("#jump").show()}})})),$(".notification_switch").on("click",(function(){var e=this;e.getAttribute("checked")?(e.removeAttribute("checked"),e.value=0):(e.setAttribute("checked","checked"),e.value=1),loadingOnScreen(),$.ajax({method:"POST",url:"/api/profile/updatenotification",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{column:e.name,value:e.value},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove()},success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message)}})})),$("#profile_update_form").on("submit",(function(e){$(".dados-residenciais").removeAttr("disabled"),$("#document").removeAttr("disabled"),$("#sex").removeAttr("disabled"),$("#mother_name").removeAttr("disabled"),e.preventDefault(),"0"!=$('input[name="photo_x1"]').val()&&"0"!=$('input[name="photo_y1"]').val()||($('input[name="photo_x1"]').val("30"),$('input[name="photo_y1"]').val("30"));var a=new FormData(document.getElementById("profile_update_form"));loadingOnScreen(),$.ajax({method:"POST",url:"/api/profile/uploaddocuments",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:a,error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show(),alertCustom("success",e.message),$("#progress-bar-register").css("width","66%"),$("#jump").show(),getDataProfile()}})})),$("#match_cellphone_verifycode_form").on("submit",(function(a){a.preventDefault();var t=$("#cellphone_verify_code").val();loadingOnScreen(),$.ajax({method:"POST",url:"/api/profile/matchcellphoneverifycode",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{verifyCode:t},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show()},success:function(a){$("#modal_verify_cellphone").modal("hide"),$("#cellphone_verify_code").val(""),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show(),alertCustom("success",a.message),$("#progress-bar-register").css("width","66%"),$("#jump").show(),e()}})})),$("#match_email_verifycode_form").on("submit",(function(e){e.preventDefault();var t=$("#email_verify_code").val();loadingOnScreen(),$.ajax({method:"POST",url:"/api/profile/matchemailverifycode",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{verifyCode:t},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show()},success:function(e){$("#modal_verify_email").modal("hide"),$("#email_verify_code").val(""),loadingOnScreenRemove(),$(".div1").hide(),$(".div2").show(),alertCustom("success",e.message),$("#progress-bar-register").css("width","66%"),$("#jump").show(),a()}})}));var t=$("#previewimage");function o(e){$.ajax({url:"/api/profile/getdocuments",type:"POST",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{document_type:e},error:function(e){errorAjaxResponse(e),$("#loaderLine").remove()},success:function(e){var a,t;a=e.data,t="",0==a.length?$("#profile-documents-modal").append('<tr><td class="text-center" colspan="4">Nenhum documento enviado</td></tr>'):($("#document-refused-motived").html(""),$.each(a,(function(e,a){t="<tr>\n                        <td class='text-center'>".concat(a.date,"</td>\n                        <td class='text-center' style='cursor: pointer;'>\n                            <span class='badge ").concat(badgeArray[a.status],"'>\n                                    ").concat(statusArray[a.status],"</td>\n                               </span>\n                        </td>"),""!=a.refused_reason&&null!=a.refused_reason?t+="\n                                <td class='text-center' style='color:red;'>".concat(a.refused_reason,"</td>\n                             "):t+="\n                                <td class='text-center' style='color:red;'></td>\n                             ",t+="<td class='text-center'>\n                            <a href='".concat(a.document_url,"' target='_blank' role='button' class='detalhes_document'><span class=\"o-eye-1\"></span></a>\n                        </td>\n\n                    </tr>"),$("#profile-documents-modal").append(t)}))),$("#loaderLine").remove()}})}function n(){$("#zip_code").on("input",(function(){var e=$("#zip_code").val().replace(/[^0-9]/g,"");if(8!=e.length)return!1;$.ajax({url:"https://viacep.com.br/ws/"+e+"/json/",type:"GET",cache:!1,async:!1,error:function(e){errorAjaxResponse(e)},success:function(e){e.localidade&&$("#city").val(unescape(e.localidade)),e.bairro&&$("#neighborhood").val(unescape(e.bairro)),e.uf&&$("#state").val(unescape(e.uf)),e.logradouro&&$("#street").val(unescape(e.logradouro))}})}))}$("#profile_photo").on("change",(function(){var e=new FileReader;e.readAsDataURL(document.getElementById("profile_photo").files[0]),e.onload=function(e){t.attr("src",e.target.result).fadeIn(),t.on("load",(function(){var e,a,t,o,n=document.getElementById("previewimage");n.naturalWidth>n.naturalHeight?(t=Math.floor(n.naturalHeight/100*10),o=n.naturalHeight-Math.floor(n.naturalHeight/100*10),a=(e=Math.floor(n.naturalWidth/2)-Math.floor((o-t)/2))+(o-t)):n.naturalWidth<n.naturalHeight?(e=Math.floor(n.naturalWidth/100*10),a=n.naturalWidth-Math.floor(n.naturalWidth/100*10),o=(t=Math.floor(n.naturalHeight/2)-Math.floor((a-e)/2))+(a-e)):(e=Math.floor(n.naturalWidth/100*10),a=n.naturalWidth-Math.floor(n.naturalWidth/100*10),t=Math.floor(n.naturalHeight/100*10),o=n.naturalHeight-Math.floor(n.naturalHeight/100*10)),$('input[name="photo_x1"]').val(e),$('input[name="photo_y1"]').val(t),$('input[name="photo_w"]').val(a-e),$('input[name="photo_h"]').val(o-t),$("#previewimage").imgAreaSelect({x1:e,y1:t,x2:a,y2:o,aspectRatio:"1:1",handles:!0,imageHeight:this.naturalHeight,imageWidth:this.naturalWidth,onSelectEnd:function(e,a){$('input[name="photo_x1"]').val(a.x1),$('input[name="photo_y1"]').val(a.y1),$('input[name="photo_w"]').val(a.width),$('input[name="photo_h"]').val(a.height)}})}))}})),$("#previewimage").on("click",(function(){$("#profile_photo").click()})),$("#new_password").on("input",(function(){$("#new_password").val().length>5&&$("#new_password_confirm").val().length>5&&$("#new_password").val()==$("#new_password_confirm").val()?$("#password_update").attr("disabled",!1):$("#password_update").attr("disabled",!0)})),$("#new_password_confirm").on("input",(function(){$("#new_password").val().length>5&&$("#new_password_confirm").val().length>5&&$("#new_password").val()==$("#new_password_confirm").val()?$("#password_update").attr("disabled",!1):$("#password_update").attr("disabled",!0)})),$("#password_update").on("click",(function(){$("#new_password").val().length>5&&$("#new_password_confirm").val().length>5&&$("#new_password").val()==$("#new_password_confirm").val()&&$.ajax({method:"POST",url:"/api/profile/changepassword",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{new_password:$("#new_password").val(),new_password_confirm:$("#new_password_confirm").val()},error:function(e){swal({position:"bottom",type:"error",toast:"true",title:"Não foi possivel alterar a senha!",showConfirmButton:!1,timer:6e3})},success:function(e){swal({position:"bottom",type:"success",toast:"true",title:"Senha alterada com sucesso !",showConfirmButton:!1,timer:6e3}),$("#new_password").val(""),$("#new_password_confirm").val("")}})})),$("#nav_documents").on("click",(function(){$("#tab_documentos").click(),$("#previewimage").imgAreaSelect({remove:!0})})),$("#nav_users").on("click",(function(){$("#tab_user").click(),$("#previewimage").imgAreaSelect({remove:!0})})),$("#update_taxes").on("click",(function(){$.ajax({method:"POST",url:"/api/profile/updatetaxes",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{credit_card_plan:$("#credit-card-release").val(),boleto_plan:$("#boleto-release").val()},error:function(e){errorAjaxResponse(e)},success:function(e){alertCustom("success",e.message),$("#credit-card-tax").val(e.data.new_card_tax_value),$("#debit-card-tax").val(e.data.new_card_tax_value),$("#debit-card-release").val($("#credit-card-release option:selected").html())}})})),$(".document-url").on("click",(function(e){e.preventDefault();var a=$(this).attr("href");loadingOnScreen(),$.ajax({method:"POST",url:"/api/profile/opendocument",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{document_url:a},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),window.open(e.data,"_blank")}})})),function(){var e={brazil:"CPF",portugal:"NIF (Número de Identificação Fiscal)",usa:"SSN (Social Security Number)",germany:"STEUERNUMMER",spain:"DNI (Documento Nacional de Identidade)",france:"CI",italy:"Codice Fiscale",chile:"RUT (Rol Único Tributario)"};"brazil"==$("#country").val()||"usa"==$("#country").val()?$(".div-state").show():$(".div-state").hide();"brazil"==$("#country").val()?($("#zip_code").mask("00000-000"),$("#cellphone").mask("+55 (00) 00000-0000"),$("#document").mask("000.000.000-00"),n()):($("#cellphone").mask("+0#"),$("#document").unmask(),$("#zip_code").unmask());$(".label-document").text(e[$("#country").val()]),$("#document").attr("placeholder",e[$("#country").val()])}(),$("#country").on("change",(function(){var e={brazil:"CPF",portugal:"NIF (Número de Identificação Fiscal)",usa:"SSN (Social Security Number)",germany:"STEUERNUMMER",spain:"DNI (Documento Nacional de Identidade)",france:"CI",italy:"Codice Fiscale",chile:"RUT (Rol Único Tributario)"};"brazil"==$(this).val()||"usa"==$(this).val()?$(".div-state").show():$(".div-state").hide(),"brazil"==$(this).val()?($("#zip_code").mask("00000-000"),$("#cellphone").mask("+55 (00) 00000-0000"),$("#document").mask("000.000.000-00"),n()):($("#cellphone").mask("+0#"),$("#document").unmask(),$("#zip_code").unmask()),$(".label-document").text(e[$(this).val()]),$("#document").attr("placeholder",e[$(this).val()])})),$(".details-document").on("click",(function(){$("#profile-documents-modal").html(""),$("#document-refused-motived").css("display","none"),loadOnTable("#profile-documents-modal","#table-documents"),o(documentType=$(this).data("document")),Dropzone.forElement("#dropzoneDocuments").removeAllFiles(!0),$("#document_type").val($(this).data("document")),"personal_document"==$(this).data("document")?($("#modal-title-documents").html("Documento Pessoal"),$("#modal-title-documents-info").html("<br><small class=\"\" style=\"line-height: 1.5;\">'\n                                                                            <br><b>Documentos aceitos (Desde que contenham o CPF):</b><br>\n                                                                            <ul>\n                                                                            <li class='text-left'><b>RG (Carteira de Identidade )</b></li>\n                                                                            <li class='text-left'><b>CNH (Carteira Nacional de Habilitação)</b></li>\n                                                                            <li class='text-left'><b>Carteira Funcional</b></li>\n                                                                            <li class='text-left'><b>CPTS (Carteira de Trabalho e Previdência Social)</b></li>\n                                                                            <li class='text-left'><b>Passaporte</b></li>\n                                                                            </ul>\n\n\n                                                                        </small>")):($("#modal-title-documents").html("Documento Compravante de Residência"),$("#modal-title-documents-info").html("<br><small class=\"\" style=\"line-height: 1.5;\">\n                <br><b>Comp. de Residência aceitos:</b><br>\n                <ul>\n                <li class='text-left'><b>Água</b></li>\n                <li class='text-left'><b>Energia</b></li>\n                <li class='text-left'><b>Gás Encanado</b></li>\n                <li class='text-left'><b>Internet</b></li>\n                <li class='text-left'><b>Telefone Fixo ou Móvel</b></li>\n                <li class='text-left'><b>Contrato de Locação em nome do usuário ou dos Pais</b></li>\n                </ul>\n                <b>Se nome de terceiro, anexar junto declaração de endereço do titular da conta e RG do titular da conta.</b>\n                </small>")),$("#modal-details-document").modal("show")}))})),Dropzone.autoDiscover=!1;var myDropzone=new Dropzone("#dropzoneDocuments",{headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},paramName:"file",maxFilesize:2,url:"/api/profile/uploaddocuments",acceptedFiles:".jpg,.jpeg,.doc,.pdf,.png",previewsContainer:".dropzone-previews",success:function(e,a){if(alertCustom("success",a.message),e.previewElement)return e.previewElement.classList.add("dz-success")},error:function(e,a){a.search("Max filesize")>0?a="O documento é muito grande. Tamanho maximo: 2mb.":a.search("upload files of this type")>0&&(a="O documento deve estar em um dos seguintes formatos: jpeg, jpg, png."),errorAjaxResponse(a),myDropzone.removeFile(e)},complete:function(){loadOnTable("#profile-documents-modal","#table-documents"),$.ajax({url:"/api/profile/getdocuments",type:"POST",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{document_type:documentType},error:function(e){errorAjaxResponse(e),$("#loaderLine").remove()},success:function(e){$("#loaderLine").remove();var a="";0==e.data.length?$("#profile-documents-modal").append("<span>Nenhum documento enviado</span>"):($("#document-refused-motived").html(""),$.each(e.data,(function(e,t){a="<tr>\n                        <td class='text-center'>".concat(t.date,"</td>\n                        <td class='text-center' style='cursor: pointer;'>\n                            <span class='badge ").concat(badgeArray[t.status],"'>\n                                    ").concat(statusArray[t.status],"</td>\n                               </span>\n                        </td>"),""!=t.refused_reason&&null!=t.refused_reason?a+="\n                                <td class='text-center' style='color:red;'>".concat(t.refused_reason,"</td>\n                             "):a+="\n                                <td class='text-center' style='color:red;'></td>\n                             ",a+="<td class='text-center'>\n                            <a href='".concat(t.document_url,"' target='_blank' role='button' class='detalhes_document'><span class=\"o-eye-1\"></span></a>\n                        </td>\n\n                    </tr>"),$("#profile-documents-modal").append(a)}))),getDataProfile()}}),ajaxVerifyDocumentPending()}});
