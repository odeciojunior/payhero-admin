$((function(){loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),$("#modal-content").hide(),errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($("#export-excel").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#export-excel").show(),$.each(e.data,(function(e,t){$("#select_projects").append($("<option>",{value:t.id,text:t.name}))})),t()),loadingOnScreenRemove()}}),$("#select_projects").on("change",(function(){t()})),$("#origin").on("change",(function(){$("#origin").val($(this).val()),a()}));var e="";function t(){$("#date_range_requests").val();$("#revenue-generated, #qtd-aproved, #qtd-boletos, #qtd-recusadas, #qtd-chargeback, #qtd-reembolso, #qtd-pending, #qtd-canceled, #percent-credit-card, #percent-values-boleto,#credit-card-value,#boleto-value, #percent-boleto-convert#percent-credit-card-convert, #percent-desktop, #percent-mobile, #qtd-cartao-convert, #qtd-boleto-convert, #ticket-medio").html("<span><span class='loaderSpan' ></span></span>"),loadOnTable("#origins-table-itens",".table-vendas-itens"),$.ajax({url:"/api/reports",type:"GET",data:{project:$("#select_projects").val(),endDate:n,startDate:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(t){if(e=t.currency,"R$ 0,00"!=t.totalPaidValueAproved&&0!=t.totalPaidValueAproved&&t.totalPaidValueAproved){var o=t.totalPaidValueAproved.split(/\s/g);t.totalPaidValueAproved=o[0]+' <span class="font-size-30 bold">'+o[1]+"</span>"}else t.totalPaidValueAproved='R$ <span class="font-size-30 bold">0,00</span>';$("#revenue-generated").html(t.totalPaidValueAproved),$("#qtd-aproved").html(t.contAproved),$("#qtd-boletos").html(t.contBoleto),$("#qtd-pix").html(t.contPix),$("#qtd-recusadas").html(t.contRecused),$("#qtd-reembolso").html(t.contRefunded),$("#qtd-chargeback").html(t.contChargeBack),$("#qtd-dispute").html(t.contInDispute),$("#qtd-pending").html(t.contPending),$("#qtd-canceled").html(t.contCanceled),$("#percent-credit-card").html("\n                    ".concat(parseFloat(t.totalPercentCartao).toFixed(1)," %\n                ")),$("#percent-values-boleto").html("\n                    ".concat(parseFloat(t.totalPercentPaidBoleto).toFixed(1)," %\n                ")),$("#percent-values-pix").html("\n                    ".concat(parseFloat(t.totalPercentPaidPix).toFixed(1)," %\n                ")),$("#credit-card-value").html(t.totalValueCreditCard),$("#boleto-value").html(t.totalValueBoleto),$("#pix-value").html(t.totalValuePix),$("#percent-boleto-convert").html('\n                    <span class="money-td"> '.concat(parseFloat(t.convercaoBoleto).toFixed(1)," % </span>\n                ")),$("#percent-credit-card-convert").html('\n                    <span class="money-td"> '.concat(parseFloat(t.convercaoCreditCard).toFixed(1)," % </span>\n                ")),$("#percent-pix-convert").html('\n                    <span class="money-td"> '.concat(parseFloat(t.convercaoPix).toFixed(1)," % </span>\n                ")),$("#percent-desktop").html("\n                    ".concat(parseFloat(t.conversaoDesktop).toFixed(1)," %\n                ")),$("#percent-mobile").html("\n                    ".concat(parseFloat(t.conversaoMobile).toFixed(1)," %\n                ")),$("#qtd-cartao-convert").html(t.cartaoConvert),$("#qtd-boleto-convert").html(t.boletoConvert),$("#qtd-pix-convert").html(t.pixConvert),$("#ticket-medio").html(t.currency+" "+t.ticketMedio),$("#conversion-items").asScrollable(),$("#payment-type-items").asScrollable();var n="";isEmpty(t.plans)?n+="<tr class='text-center'><td colspan='3' style='vertical-align: middle'><img style='height:90px' src='"+$("#origins-table-itens").attr("img-empty")+"'>Nenhuma venda encontrada</td></tr>":$.each(t.plans,(function(e,t){n+="<tr>",n+="<td><img src="+t.photo+' width="50px;" style="border-radius:6px;"></td>',n+="<td>"+t.name+"</td>",n+="<td> x "+t.quantidade+"</td>",n+="</tr>"})),$("#origins-table-itens").html(""),$("#origins-table-itens").append(n);var r,i,s,c,l,d,p=!1;$.each(t.chartData.boleto_data,(function(e,t){0!=t&&(p=!0)})),$.each(t.chartData.credit_card_data,(function(e,t){0!=t&&(p=!0)})),$.each(t.chartData.pix_data,(function(e,t){0!=t&&(p=!0)})),1==p?($("#empty-graph>").hide(),$("#scoreLineToDay").show(),$("#scoreLineToWeek").show(),$("#scoreLineToMonth").show(),r=t.chartData,i=function(e,t,a,o,n){var i=new Chartist.Line("#"+e,{labels:t,series:[a,o,n]},{lineSmooth:Chartist.Interpolation.simple({divisor:2}),fullWidth:!0,chartPadding:{right:30,left:40},series:{"credit-card-data":{showArea:!0},"boleto-data":{showArea:!0},"pix-data":{showArea:!0}},axisX:{showGrid:!1},axisY:{labelInterpolationFnc:function(e){var t=(e*=100).toString(),a=3-(t=t.replace(".","")).length;return 1==a?t="0"+t:2==a&&(t="00"+t),(t=t.replace(/([0-9]{2})$/g,",$1")).length>6&&(t=t.replace(/([0-9]{3}),([0-9]{2}$)/g,".$1,$2")),r.currency+t},scaleMinSpace:40},plugins:[Chartist.plugins.tooltip({position:"bottom"}),Chartist.plugins.legend()],low:0,height:300});i.on("created",(function(t){var a=t.svg.querySelector("defs")||t.svg.elem("defs"),o=(t.svg.width(),t.svg.height(),a.elem("filter",{x:0,y:"-10%",id:"shadow"+e},"",!0));return o.elem("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"800",result:"offsetBlur"}),o.elem("feOffset",{dx:"0",dy:"800"}),o.elem("feBlend",{in:"SourceGraphic",mode:"multiply"}),a})).on("draw",(function(t){"line"===t.type?t.element.attr({filter:"url(#shadow"+e+")"}):"point"===t.type&&new Chartist.Svg(t.element._node.parentNode).elem("line",{x1:t.x,y1:t.y,x2:t.x+.01,y2:t.y,class:"ct-point-content"}),"line"!==t.type&&"area"!=t.type||t.element.animate({d:{begin:1e3*t.index,dur:1e3,from:t.path.clone().scale(1,0).translate(0,t.chartRect.height()).stringify(),to:t.path.clone().stringify(),easing:Chartist.Svg.Easing.easeOutQuint}})}))},s=r.label_list,c={name:"Cartão de crédito",data:r.boleto_data},l={name:"Boleto",data:r.credit_card_data},d={name:"PIX",data:r.pix_data},createChart=function(e){i("scoreLineToDay",s,c,l,d)},createChart(),$(".chart-action li a").on("click",(function(){createChart($(this))}))):($("#empty-graph>").show(),$("#scoreLineToDay").hide(),$("#scoreLineToWeek").hide(),$("#scoreLineToMonth").hide()),a()}})}function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;loadOnTable("#origins-table",".table-vendas"),t=null==t?"/api/reports/getsalesbyorigin?project_id="+$("#select_projects").val()+"&start_date="+o+"&end_date="+n+"&origin="+$("#origin").val():"/api/reports/getsalesbyorigin"+t+"&project_id="+$("#select_projects").val()+"&start_date="+o+"&end_date="+n+"&origin="+$("#origin").val(),$.ajax({url:t,type:"GET",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(t){if(0==t.data.length)$("#origins-table").html("<td colspan='3' class='text-center'><img style='height:90px' src='"+$("#origins-table-itens").attr("img-empty")+"'><br> Nenhuma venda encontrada</div>"),$("#pagination").html("");else{var o="";$.each(t.data,(function(t,a){o+="<tr>",o+="<td>"+a.origin+"</td>",o+="<td>"+a.sales_amount+"</td>",o+="<td>"+e+" "+a.balance+"</td>",o+="</tr>"})),$("#origins-table").html(""),$("#origins-table").append(o),$(".table-vendas").addClass("table-striped"),pagination(t,"origins",a)}}})}var o=moment().subtract(30,"days").format("YYYY-MM-DD"),n=moment().format("YYYY-MM-DD");$('input[name="daterange"]').daterangepicker({startDate:moment().subtract(30,"days"),endDate:moment(),opens:"left",maxDate:moment().endOf("day"),alwaysShowCalendar:!0,showCustomRangeLabel:"Customizado",autoUpdateInput:!0,locale:{locale:"pt-br",format:"DD/MM/YYYY",applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Até",customRangeLabel:"Customizado",weekLabel:"W",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],firstDay:0},ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 dias":[moment().subtract(6,"days"),moment()],"Últimos 30 dias":[moment().subtract(29,"days"),moment()],"Este mês":[moment().startOf("month"),moment().endOf("month")],"Mês passado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},(function(e,a){o=e.format("YYYY-MM-DD"),n=a.format("YYYY-MM-DD"),t()}))}));
