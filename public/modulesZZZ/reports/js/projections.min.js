$((function(){function e(e){loadingOnScreen(),$.ajax({method:"POST",url:"/api/reports/projectionsexport",xhrFields:{responseType:"blob"},data:{format:e,company:$("#select_companies").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e,t,n){loadingOnScreenRemove(),function(e,t){var n=t.getResponseHeader("Content-Type"),a=t.getResponseHeader("Content-Disposition").match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);a=a?a[0].replace("filename=",""):"";var o=document.createElement("a");o.style.display="none",document.body.appendChild(o),o.href=window.URL.createObjectURL(new Blob([e],{type:n})),o.setAttribute("download",a),o.click(),window.URL.revokeObjectURL(o.href),document.body.removeChild(o)}(e,n)}})}function t(){$("#projection-total, #projection-billet, #projection-card").html("<span class='loaderSpan' ></span>"),loadOnTable("#body-table-transaction-itens"),$.ajax({url:"/api/reports/projections",type:"GET",data:{company:$("#select_companies").val()},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#projection-total").html(e.chartData.currency+" "+e.totalValue),$("#projection-billet").html(e.chartData.currency+" "+e.valueBillet),$("#projection-card").html(e.chartData.currency+" "+e.valueCard);var t,n,a,o,r="";$.each(e.transactions,(function(t,n){r+="<tr>",r+="<td>"+n.date+"</td>",r+="<td>"+e.chartData.currency+" "+n.value+"</td>",r+="</tr>"})),$("#body-table-transaction-itens").html(""),$("#body-table-transaction-itens").append(r),t=e.chartData,n=function(e,n,a){var o=new Chartist.Line("#"+e,{labels:n,series:[a]},{lineSmooth:Chartist.Interpolation.simple({divisor:2}),fullWidth:!0,chartPadding:{right:30,left:40},series:{"credit-card-data":{showArea:!0}},axisX:{showGrid:!1},axisY:{labelInterpolationFnc:function(e){var n=(e=Math.round(e,1)).toString(),a=3-(n=n.replace(".","")).length;return 1==a?n="0"+n:2==a&&(n="00"+n),(n=n.replace(/([0-9]{2})$/g,",$1")).length>6&&(n=n.replace(/([0-9]{3}),([0-9]{2}$)/g,".$1,$2")),t.currency+n},scaleMinSpace:40},plugins:[Chartist.plugins.tooltip({position:"bottom"}),Chartist.plugins.legend()],low:0,height:300});o.on("created",(function(t){var n=t.svg.querySelector("defs")||t.svg.elem("defs"),a=(t.svg.width(),t.svg.height(),n.elem("filter",{x:0,y:"-10%",id:"shadow"+e},"",!0));return a.elem("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"800",result:"offsetBlur"}),a.elem("feOffset",{dx:"0",dy:"800"}),a.elem("feBlend",{in:"SourceGraphic",mode:"multiply"}),n})).on("draw",(function(t){"line"===t.type?t.element.attr({filter:"url(#shadow"+e+")"}):"point"===t.type&&new Chartist.Svg(t.element._node.parentNode).elem("line",{x1:t.x,y1:t.y,x2:t.x+.01,y2:t.y,class:"ct-point-content"}),"line"!==t.type&&"area"!=t.type||t.element.animate({d:{begin:1e3*t.index,dur:1e3,from:t.path.clone().scale(1,0).translate(0,t.chartRect.height()).stringify(),to:t.path.clone().stringify(),easing:Chartist.Svg.Easing.easeOutQuint}})}))},a=t.label_list,o={name:"Saldo a liberar",data:t.transaction_data},createChart=function(e){n("scoreLineToDay",a,o)},createChart(),$(".chart-action li a").on("click",(function(){createChart($(this))}))}})}$("#bt_get_csv").on("click",(function(){e("csv")})),$("#bt_get_xls").on("click",(function(){e("xls")})),$.ajax({method:"GET",url:"/api/companies/?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#modal-content").hide(),errorAjaxResponse(e)},success:function(e){0===Object.keys(e.data).length?$("#project-empty").show():($(e.data).each((function(e,t){$("#select_companies").append("<option value='"+t.id+"'>"+t.name+"</option>")})),$("#reports-content").show(),t())}}),$("#select_companies").on("change",(function(){t()}))}));
