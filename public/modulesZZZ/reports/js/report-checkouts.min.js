$((function(){loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#modal-content").hide(),loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(t){isEmpty(t.data)?($("#export-excel").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#export-excel").show(),$.each(t.data,(function(e,t){$("#select_projects").append($("<option>",{value:t.id,text:t.name}))})),e()),loadingOnScreenRemove()}}),$("#select_projects").on("change",(function(){e()})),$("#origin").on("change",(function(){$("#origin").val($(this).val()),t()}));function e(){$("#date_range_requests").val();$("#revenue-generated, #qtd-aproved, #qtd-boletos, #qtd-recusadas, #qtd-chargeback, #qtd-reembolso, #qtd-pending, #qtd-canceled#percent-credit-card, #percent-values-boleto, #credit-card-value, #boleto-value, #percent-boleto-convert#percent-credit-card-convert, #percent-desktop, #percent-mobile, #qtd-cartao-convert, #qtd-boleto-convert, #ticket-medio, #qtd-canceled").html("<span class='loading'><span class='loaderSpan' ></span></span>"),loadOnTable("#origins-table-itens",".table-vendas-itens"),$.ajax({url:"/api/reports/checkouts",type:"GET",data:{project:$("#select_projects").val(),endDate:n,startDate:a},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#qtd-abandoned").html('<span class="font-size-30 bold">'+e.contAbandoned+'</span> <span style="color:#959595">('+e.percentAbandoned+")</span>"),$("#qtd-recovered").html('<span class="font-size-30 bold">'+e.contRecovered+'</span> <span style="color:#959595">('+e.percentRecovered+")</span>"),$("#qtd-finalized").html('<span class="font-size-30 bold">'+e.contFinalized+'</span> <span style="color:#959595">('+e.percentFinalized+")</span>"),$("#qtd-total-checkouts").html(e.contCheckouts),$("#percent-desktop").html(e.conversaoDesktop+"%"),$("#percent-mobile").html(e.conversaoMobile+"%");var a="";isEmpty(e.plans)?a+="<tr> <td colspan='3' class='text-center' style='vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#origins-table-itens").attr("img-empty")+"'>Nenhuma venda encontrada</td> </tr>":$.each(e.plans,(function(e,t){a+="<tr>",a+="<td><img src="+t.photo+' width="50px;" style="border-radius:6px;"></td>',a+="<td>"+t.name+"</td>",a+="<td> x "+t.quantidade+"</td>",a+="</tr>"})),$("#origins-table-itens").html(""),$("#origins-table-itens").append(a);var n,o,r,s,i=!1;$.each(e.chartData.checkout_data,(function(e,t){t>0&&(i=!0)})),1==i?($("#empty-graph>").hide(),$("#scoreLineToDay").show(),$("#scoreLineToWeek").show(),$("#scoreLineToMonth").show(),n=e.chartData,o=function(e,t,a){var n=new Chartist.Line("#"+e,{labels:t,series:[a]},{lineSmooth:Chartist.Interpolation.simple({divisor:2}),fullWidth:!0,chartPadding:{right:30},series:{"credit-card-data":{showArea:!0}},axisX:{showGrid:!1},axisY:{labelInterpolationFnc:function(e){return e},scaleMinSpace:40},plugins:[Chartist.plugins.tooltip({position:"bottom"}),Chartist.plugins.legend()],low:0,height:300});n.on("created",(function(t){var a=t.svg.querySelector("defs")||t.svg.elem("defs"),n=(t.svg.width(),t.svg.height(),a.elem("filter",{x:0,y:"-10%",id:"shadow"+e},"",!0));return n.elem("feGaussianBlur",{in:"SourceAlpha",stdDeviation:"800",result:"offsetBlur"}),n.elem("feOffset",{dx:"0",dy:"800"}),n.elem("feBlend",{in:"SourceGraphic",mode:"multiply"}),a})).on("draw",(function(t){"line"===t.type?t.element.attr({filter:"url(#shadow"+e+")"}):"point"===t.type&&new Chartist.Svg(t.element._node.parentNode).elem("line",{x1:t.x,y1:t.y,x2:t.x+.01,y2:t.y,class:"ct-point-content"}),"line"!==t.type&&"area"!=t.type||t.element.animate({d:{begin:1e3*t.index,dur:1e3,from:t.path.clone().scale(1,0).translate(0,t.chartRect.height()).stringify(),to:t.path.clone().stringify(),easing:Chartist.Svg.Easing.easeOutQuint}})}))},r=n.label_list,s={name:"Acessos",data:n.checkout_data},createChart=function(e){o("scoreLineToDay",r,s)},createChart(),$(".chart-action li a").on("click",(function(){createChart($(this))}))):($("#empty-graph>").show(),$("#scoreLineToDay").hide(),$("#scoreLineToWeek").hide(),$("#scoreLineToMonth").hide()),t()}})}function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;loadOnTable("#origins-table",".table-vendas"),e=null==e?"/api/reports/getcheckoutsbyorigin?project_id="+$("#select_projects").val()+"&start_date="+a+"&end_date="+n+"&origin="+$("#origin").val():"/api/reports/getcheckoutsbyorigin"+e+"&project_id="+$("#select_projects").val()+"&start_date="+a+"&end_date="+n+"&origin="+$("#origin").val(),$.ajax({url:e,type:"GET",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){if(""==e.data)$("#origins-table").html("<td colspan='3' class='text-center' style='vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#origins-table-itens").attr("img-empty")+"'>Nenhuma venda encontrada</div>"),$("#pagination").html("");else{var a="";$.each(e.data,(function(e,t){a+="<tr>",a+="<td>"+t.origin+"</td>",a+="<td>"+t.qtd_checkout+"</td>",a+="</tr>"})),$("#origins-table").html(""),$("#origins-table").append(a),$(".table-vendas").addClass("table-striped"),pagination(e,"origins",t)}}})}var a=moment().subtract(30,"days").format("YYYY-MM-DD"),n=moment().format("YYYY-MM-DD");$('input[name="daterange"]').daterangepicker({startDate:moment().subtract(30,"days"),endDate:moment(),opens:"left",maxDate:moment().endOf("day"),alwaysShowCalendar:!0,showCustomRangeLabel:"Customizado",autoUpdateInput:!0,locale:{locale:"pt-br",format:"DD/MM/YYYY",applyLabel:"Aplicar",cancelLabel:"Limpar",fromLabel:"De",toLabel:"Até",customRangeLabel:"Customizado",weekLabel:"W",daysOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],monthNames:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],firstDay:0},ranges:{Hoje:[moment(),moment()],Ontem:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 dias":[moment().subtract(6,"days"),moment()],"Últimos 30 dias":[moment().subtract(29,"days"),moment()],"Este mês":[moment().startOf("month"),moment().endOf("month")],"Mês passado":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},(function(t,o){a=t.format("YYYY-MM-DD"),n=o.format("YYYY-MM-DD"),e()}))}));
