$((function(){loadingOnScreen();var e=$(window.location.pathname.split("/")).get(-1);$(".percentage-affiliates").mask("###",{translation:{0:{pattern:/[0-9*]/}}});var t=!1;$("#tab-info").click((function(){s()})),$(".tab_configuration").click((function(){$("#image-logo-email").imgAreaSelect({remove:!0}),$("#previewimage").imgAreaSelect({remove:!0}),n(),$(this).off()})),$(".toggler").on("click",(function(){var e=$(this).data("target");$(e).hasClass("show")?$(this).find(".showMore").html("add"):$(this).find(".showMore").html("remove")})),$("#shippement").on("change",(function(){0==$(this).val()?($("#div-carrier").hide(),$("#div-shipment-responsible").hide()):($("#div-carrier").show(),$("#div-shipment-responsible").show())}));var o="",a="",r=$("#update-project");function i(e,t){return e<t?($("#error-juros").css("display","block"),!0):($("#error-juros").css("display","none"),!1)}$(".installment_amount").on("change",(function(){o=parseInt($(".installment_amount option:selected").val()),a=parseInt($(".parcelas-juros option:selected").val()),i(o,a)})),$(".parcelas-juros").on("change",(function(){o=parseInt($(".installment_amount option:selected").val()),a=parseInt($(".parcelas-juros option:selected").val()),i(o,a)}));function s(){$(".page").addClass("low-opacity"),$.ajax({url:"/api/projects/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){window.location.replace("".concat(location.origin,"/projects")),$(".page-content").show(),$(".page").removeClass("low-opacity")},success:function(e){var t,o=e.data,a="my_products";null!=o.shopify_id&&(a="shopify"),null!=o.woocommerce_id&&(a="woocommerce"),$("#project_type").val(a),$(".title-pad").text(o.name),$("#show-photo").attr("src",(t=o.photo)?dropifyOptions.defaultFile=t:"/modules/global/img/produto.svg"),$("#created_at").text("Criado em "+o.created_at),"1"==o.status?$("#show-status").text("Ativo").addClass("badge-success"):$("#show-status").text("Inativo").addClass("badge-danger"),$("#show-description").text(o.description);var r=parseFloat(o.approved_sales_value).toLocaleString("pt-BR"),i=parseFloat(o.chargeback_count).toLocaleString("pt-BR"),s=parseFloat(o.without_tracking).toLocaleString("pt-BR"),n=parseFloat(o.approved_sales).toLocaleString("pt-BR");$("#value-chargeback").text(i),$("#value-open-tickets").text(o.open_tickets),$("#value-without-tracking").text(s),$("#total-approved").text(n),$("#total-approved-value").text(r),$(".page-content").show(),$(".page").removeClass("low-opacity"),loadingOnScreenRemove()}})}function n(){loadOnAny("#update-project"),$.ajax({method:"GET",url:"/api/projects/"+e+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),loadOnAny("#update-project",!0),$("#trash").removeClass("d-none"),errorAjaxResponse(e)},success:function(e){localStorage.setItem("projectConfig",JSON.stringify(e)),m(e),loadingOnScreenRemove(),loadOnAny("#update-project",!0),$("#trash").removeClass("d-none")}})}var c=["tab-domains","tab_plans","tab-fretes","tab-checkout"],l=["tab_pixels","tab_upsell","tab_order_bump","tab_coupons","tab_reviews"],p=["tab_sms"];$(".nav-tabs-horizontal .nav-link").click((function(e){var t=$(".nav-link.active"),o=e.target.id;t.attr("id")!==o&&t.removeClass("active"),-1!==$.inArray(o,c)&&($("#first-category").css("color","#2E85EC"),$("#second-category").css("color","#9C9C9C"),$("#third-category").css("color","#9C9C9C")),-1!==$.inArray(o,l)&&($("#first-category").css("color","#9C9C9C"),$("#second-category").css("color","#2E85EC"),$("#third-category").css("color","#9C9C9C")),-1!==$.inArray(o,p)&&($("#first-category").css("color","#9C9C9C"),$("#second-category").css("color","#9C9C9C"),$("#third-category").css("color","#2E85EC"))})),$(".slick-track").on("click",(function(){$(".nav-tabs-horizontal .tab-pane").removeClass("active show")})),dropifyOptions={messages:{default:"",replace:"Arraste e solte uma imagem ou selecione um arquivo",remove:"Remover",error:""},error:{fileSize:"O tamanho máximo do arquivo deve ser {{ value }}.",minWidth:"A imagem deve ter largura maior que 651px.",maxWidth:"A imagem deve ter largura menor que 651px.",minHeight:"A imagem deve ter altura maior que 651px.",maxHeight:"A imagem deve ter altura menor que 651px.",fileExtension:"A imagem deve ser algum dos formatos permitidos. ({{ value }})."},tpl:{message:'<div class="dropify-message"><span class="file-icon" /> <p class="msg">{{ default }}<span class="text-primary font-size-16">Clique ou arraste seu <br> arquivo aqui</span></p></div>',clearButton:'<button type="button" class="dropify-clear o-bin-1"></button>'},imgFileExtensions:["png","jpg","jpeg","gif","bmp","webp","svg"]},$("img").on("error",(function(){$(this).attr("src","https://cloudfox-files.s3.amazonaws.com/produto.svg")}));var d=new Quill("#termsaffiliates",{theme:"snow",modules:{toolbar:["bold","italic","underline"]}});$(document).ready((function(){$(".ql-toolbar.ql-snow").addClass("d-flex justify-content-center")})),$(".ql-editor").on("focus",(function(){$(".h-200, .ql-container, .ql-snow").css("border-color","#88BFFF")})),$(".ql-editor").on("focusout",(function(){$(".h-200, .ql-container, .ql-snow").css("border-color","#cccccc")}));var u,f=r.find("#status-url-affiliates");function m(e){var o=e.project,a=f.prop("checked");1==o.status_url_affiliates&&0==a&&(f.trigger("click"),$(".affiliation").children("img").attr("src","/modules/global/img/projects/afiliatesIcon.svg").css("background-color","#F2F8FF"),$("#affiliation-access").show()),0==o.status_url_affiliates&&($(".affiliation").children("img").attr("src","/modules/global/img/projects/affiliationDisable.svg").css("background-color","#F2F8FF"),$("#affiliation-access").hide(),0==o.status_url_affiliates&&1==a&&f.trigger("click")),function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=$('input[id="'+e+'"]'),r=a.closest(".dropify-wrapper"),i=r.find(".dropify-preview"),s=r.find(".dropify-filename-inner"),n=r.find(".dropify-render").html("");a.val("").attr("title",o),r.removeClass("has-error").addClass("has-preview"),s.html(o),n.append($('<img style="width: 100%; border-radius: 8px; object-fit: cover;" />').attr("src",t).css("height",a.attr("height"))),i.fadeIn()}("project_photo",o.photo,""),o.photo||($(".dropify-render > img").remove(),$(".dropify-wrapper").removeClass("has-preview"),$(".dropify-preview").css("display","none")),$("#project_photo").dropify(dropifyOptions),r.find("#name").val(o.name),r.find("#description").val(o.description),r.find("#url-page").val(o.url_page?o.url_page:"https://"),0==o.cookie_duration?($(".sirius-select").prop("selectedIndex",0).change(),$(".sirius-select-text").text("Eterno")):7==o.cookie_duration?($(".sirius-select").prop("selectedIndex",1).change(),$(".sirius-select-text").text("7 dias")):15==o.cookie_duration?($(".sirius-select").prop("selectedIndex",2).change(),$(".sirius-select-text").text("15 dias")):30==o.cookie_duration?($(".sirius-select").prop("selectedIndex",3).change(),$(".sirius-select-text").text("1 mês")):60==o.cookie_duration?($(".sirius-select").prop("selectedIndex",4).change(),$(".sirius-select-text").text("2 meses")):180==o.cookie_duration?($(".sirius-select").prop("selectedIndex",5).change(),$(".sirius-select-text").text("6 meses")):365==o.cookie_duration&&($(".sirius-select").prop("selectedIndex",6).change(),$(".sirius-select-text").text("1 ano")),$("#percentage-affiliates").mask("000",{reverse:!0,onKeyPress:function(e,t,o,a){e>100&&$("#percentage-affiliates").val("")}}),r.find("#percentage-affiliates").val(o.percentage_affiliates),r.find(".commission-type-enum input").filter("[value=".concat(o.commission_type_enum,"]")).prop("checked",!0),d.setContents([{insert:"\n"}]),d.clipboard.dangerouslyPasteHTML(0,o.terms_affiliates?o.terms_affiliates:" "),1==o.automatic_affiliation&&r.find(".automatic-affiliation input").prop("checked",!0),r.find("#url-affiliates").val(o.url_affiliates),t||(r.on("input change",(function(){$("#confirm-changes").fadeIn("slow")})),$(".dropify-clear, .o-bin-1").on("click",(function(){$(".dropify-errors-container > ul > li").remove(),localStorage.setItem("photo_remove",!0),$("#confirm-changes").fadeIn("slow")})),t=!0),$("#confirm-changes").hide()}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";$("#confirm-changes").fadeOut(3e3),""!=t?($("#data-error span").html(t),$("#data-error").fadeIn(1e3).delay(2e3).fadeOut(2e3),setTimeout((function(){$("#data-error span").html(e)}),5e3)):($("#data-error span").html(e),$("#data-error").fadeIn(2e3).delay(2e3).fadeOut(2e3)),$("#confirm-changes").fadeIn(2e3)}f.on("click",(function(){1==$(this).prop("checked")?$("#affiliation-access").show():$("#affiliation-access").hide()}));var h=$("#data-error span").html(),v=r.find("#name");function y(e){if(v.val().length<=2){v.addClass("error-alert");return g(h,"<strong>Ops!</strong> Você precisa preencher os campos indicados."),!1}return!1===e?(g(h),!1):(v.removeClass("error-alert"),!0)}$("#project_photo").on("dropify.errors",(function(){g(h),u=!1})),$("#project_photo").on("dropify.fileReady",(function(){y(u=!0)&&$("#bt-update-project").prop("disabled",!1)})),f.on("click",(function(){var e=f.prop("checked");0==e?$(".affiliation").children("img").attr("src","/modules/global/img/projects/affiliationDisable.svg"):1==e&&$(".affiliation").children("img").attr("src","/modules/global/img/projects/afiliatesIcon.svg")})),$("#copy-link-affiliation").on("click",(function(){document.getElementById("url-affiliates").select(),document.execCommand("copy"),alertCustom("success","Link copiado!")})),$("#bt-delete-project").on("click",(function(t){t.preventDefault();var o=$("#name").val();$("#modal_excluir_titulo").html("Remover loja "+o+" ?"),$("#modal-delete-project .btn-delete").on("click",(function(){$("#modal-delete").modal("hide"),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/projects/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e),loadingOnScreenRemove()},success:function(e){loadingOnScreenRemove(),"success"==e?window.location="/projects":alertCustom("error","Erro ao deletar loja")}})}))})),r.on("submit",(function(t){if(!y(u))return!1;var c=$(".final-card span").html();$(".final-card span").html("Um momento... <strong>Estamos salvando suas alterações.</strong>"),$("#options-buttons").children().hide(),$(".loader").show(),t.preventDefault(),$(".page").addClass("low-opacity");var l=d.root.innerHTML;$("#terms_affiliates").val(l);var p=i(o,a),m=0;f.prop("checked")&&(m=1);var g=0;r.find(".automatic-affiliation input").prop("checked")&&(g=1);var h=new FormData(document.getElementById("update-project"));h.append("status_url_affiliates",m),h.append("automatic_affiliation",g),$("#project_photo").prop("files").length||h.delete("project_photo"),"true"==localStorage.getItem("photo_remove")&&h.append("remove_project_photo",!0),p?($("#error-juros").css("display","block"),loadingOnScreenRemove()):$.ajax({method:"POST",url:"/api/projects/"+e+"/settings",processData:!1,contentType:!1,cache:!1,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:h,error:function(e){$(".page").removeClass("low-opacity"),errorAjaxResponse(e)},success:function(e){localStorage.setItem("photo_remove",!1),n(),$("html, body").animate({scrollTop:410}),setTimeout((function(){$("#confirm-changes").hide(),$(".final-card span").html(c),$("#options-buttons").children().show(),$(".loader").hide(),$("#saved-alterations").fadeIn("slow").delay(2500).fadeOut("slow")}),1500),s(),$(".page").removeClass("low-opacity")}})})),$("#cancel-edit").on("click",(function(){m(JSON.parse(localStorage.getItem("projectConfig"))),$("#confirm-changes").fadeOut("slow"),$("html, body").animate({scrollTop:410}),localStorage.setItem("photo_remove",!1),$("#bt-update-project").prop("disabled",!1)})),s()}));
