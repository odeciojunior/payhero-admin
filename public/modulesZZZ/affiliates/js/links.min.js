$((function(){var a=$(window.location.pathname.split("/")).get(-2),t=$(window.location.pathname.split("/")).get(-1);function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t,loadOnTable("#data-table-link","#table-links"),t=null==t?"/api/affiliatelinks":"/api/affiliatelinks"+t;var i=$("#plan-name").val();$.ajax({method:"GET",url:t,dataType:"json",data:{plan:i,projectId:a},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){function t(){return a.apply(this,arguments)}return t.toString=function(){return a.toString()},t}((function(a){$("#data-table-link").html("Erro ao encontrar dados"),errorAjaxResponse(a)})),success:function(a){isEmpty(a.data)?(""!=i?$("#data-table-link").html("\n                            <tr class='text-center'>\n                                <td colspan='11' style='height: 70px; vertical-align: middle;'>\n                                    Nenhum dado encontrado\n                                </td>\n                            </tr>\n                        "):$("#data-table-link").html("\n                            <tr class='text-center'>\n                                <td colspan='11' style='height: 70px; vertical-align: middle;'>\n                                    <div class='d-flex justify-content-center align-items-center'>\n                                        <img src='/modules/global/img/empty-state-table.svg' style='margin-right: 60px;'>\n                                        <div class='text-left'>\n                                            <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum link configurado</h1>\n                                            <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro link para poder<br>gerenciá-los nesse painel.</p>\n                                            <button data-toggle=\"modal\" data-target=\"#modal-create-link\" type='button' style='margin: 0; width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-link' data-toggle=\"modal\" data-target=\"#modal_add_plan\">Adicionar link</button>\n                                        </div>\n                                    </div>\n                                </td>\n                            </tr>\n                        "),$("#table-links").addClass("table-striped"),$("#pagination-links").html("")):($("#tab_links-panel").find(".no-gutters").css("display","flex"),$("#table-links").find("thead").css("display","contents"),$("#data-table-link").html(""),"approved"==a.data[0].document_status?2==a.data[0].status_affiliate?($("#data-table-link").html("<tr class='text-center'><td colspan='11' style='height: 70px; vertical-align: middle;'>Sua afiliação a loja foi desativada</td></tr>"),$("#table-links").addClass("table-striped")):($.each(a.data,(function(a,t){data="",data+="<tr>",data+='<td class="display-sm-none display-m-none" title="Copiar Link" link="'+t.link+'">',data+=t.plan_name_short+"<br><small>"+t.description+"</small> </td>",data+='<td class="display-lg-none display-xlg-none" title="Copiar Link"><a class="pointer copy_link_plan" link="'+t.link+'"> <span class="material-icons icon-copy-1"> content_copy </span> </a></td>',data+='<td class="display-sm-none display-m-none copy_link" title="Copiar Link" style="cursor:pointer;" link="'+t.link_affiliate+'">Copiar </span><img src="/modules/global/img/icon-copy-c.svg"></td>',data+='<td class="display-lg-none display-xlg-none" title="Copiar Link"><a class="material-icons pointer gradient copy_link" link="'+t.link_affiliate+'"> </a></td>',""!=t.price&&""!=t.commission?data+='<td class="text-center" >'+t.price+"<br><small>("+t.commission+" comissão)<small></td>":data+='<td class="text-center" ></td>',data+='<td style="text-align:center">',data+="<div class='d-flex justify-content-end align-items-center'>",data+='<a title="Visualizar" class="mg-responsive details-link pointer" link="'+t.id+'" data-target="#modal-details-link" data-toggle="modal"><span class="o-eye-1"></span></a>',""==t.plan_name&&null!=t.link?(data+='<a title="Editar" class="mg-responsive edit-link pointer" link="'+t.id+'" data-toggle="modal"><span class="o-edit-1"></span></a>',data+='<a title="Excluir" class="mg-responsive delete-link pointer" link="'+t.id+'" data-toggle="modal"><span class="o-bin-1"></span></a>'):(data+='<a title="Editar" class="mg-responsive pointer disabled"><span class="o-edit-1"></span></a>',data+='<a title="Excluir" class="mg-responsive pointer disabled"><span class="o-bin-1"></span></a>'),data+="</div>",data+="</td>",data+="</tr>",$("#data-table-link").append(data),$("#table-links").addClass("table-striped"),$(".domain-project-link").html(t.domain)})),pagination(a,"links",n)):($("#data-table-link").html("<tr class='text-center'><td colspan='11' style='height: 70px; vertical-align: middle;'>Link de pagamento só ficará disponível quando seus documentos e da sua empresa estiverem aprovados</td></tr>"),$("#table-links").addClass("table-striped")))}}),$(".table-links").on("click",".copy_link",(function(){var a=$("<input>");$("#table-links").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(".table-links").on("click",".copy_link_plan",(function(){var a=$("<input>");$("#table-links").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")}))}$(".tab_links-panel").on("click",(function(){n(),$(this).off()})),$("#btn-search-link").on("click",(function(){n()})),$("#modal-create-link .btn-save").on("click",(function(){var a=new FormData(document.querySelector("#modal-create-link  #form-register-link"));a.append("affiliate",t),loadingOnScreen(),$.ajax({method:"POST",url:"/api/affiliatelinks",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:a,processData:!1,contentType:!1,cache:!1,error:function(a){function t(t){return a.apply(this,arguments)}return t.toString=function(){return a.toString()},t}((function(a){loadingOnScreenRemove(),$("#modal_add_link").hide(),$(".loading").css("visibility","hidden"),errorAjaxResponse(a)})),success:function(){loadingOnScreenRemove(),$(".loading").css("visibility","hidden"),alertCustom("success","Link Adicionado!"),n(),$("#link-affiliate").val("")}})})),$(document).on("click",".edit-link",(function(){var a=$(this).attr("link");$.ajax({method:"GET",url:"/api/affiliatelinks/"+a+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){$("#modal-edit-link .link-id").val(a.data.id),$("#modal-edit-link #link-affiliate-update").val(a.data.link),$("#modal-edit-link").modal("show")}})})),$(document).on("click","#modal-edit-link .btn-update",(function(){loadingOnScreen();var a=$("#modal-edit-link .link-id").val();$.ajax({method:"PUT",url:"/api/affiliatelinks/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{link:$("#modal-edit-link #link-affiliate-update").val()},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(){loadingOnScreenRemove(),alertCustom("success","Link atualizado com sucesso"),n()}})})),$(document).on("click","#modal-delete-link .btn-delete",(function(){loadingOnScreen();var a=$(this).attr("link");$.ajax({method:"DELETE",url:"/api/affiliatelinks/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){function t(){return a.apply(this,arguments)}return t.toString=function(){return a.toString()},t}((function(a){loadingOnScreenRemove(),errorAjaxResponse(a)})),success:function(){loadingOnScreenRemove(),alertCustom("success","Link removido com sucesso"),n()}})})),$(document).on("click",".delete-link",(function(a){var t=$(this).attr("link");$("#modal-delete-link .btn-delete").attr("link",t),$("#modal-delete-link").modal("show")})),$(document).on("click",".details-link",(function(){var a=$(this).attr("link");$.ajax({method:"GET",url:"/api/affiliatelinks/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){errorAjaxResponse(response)},success:function(a){$("#modal-detail-link .link-plan").html(a.data.plan_name),$("#modal-detail-link .link-description").html(a.data.description),$("#modal-detail-link .link-clicks").html(a.data.clicks),$("#modal-detail-link .link-price").html(a.data.price),$("#modal-detail-link .link-commission").html(a.data.commission),$("#modal-detail-link .link-project").html(a.data.link_project),$("#modal-detail-link .link-plan-link").html(a.data.link_plan),null!=a.data.link?$("#modal-detail-link .link-affiliate-link").val(a.data.link):$("#modal-detail-link .link-affiliate-link").val(a.data.link_affiliate),$("#modal-detail-link").modal("show")}})})),$("#link-affiliate").on("keypress",(function(a){if(13==a.keyCode)return!1}))}));
