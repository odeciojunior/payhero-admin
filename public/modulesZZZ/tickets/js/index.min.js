function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var n,o,r=[],i=!0,s=!1;try{for(a=a.call(t);!(i=(n=a.next()).done)&&(r.push(n.value),!e||r.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{i||null==a.return||a.return()}finally{if(s)throw o}}return r}}function _arrayWithHoles(t){if(Array.isArray(t))return t}function _createForOfIteratorHelper(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,s=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return i=t.done,t},e:function(t){s=!0,r=t},f:function(){try{i||null==a.return||a.return()}finally{if(s)throw r}}}}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}var statusEnum={1:"Aberto",2:"Finalizado",3:"Em mediação"},categoryEnum={1:"Reclamação",2:"Dúvida",3:"Sugestão"},typeEnum={1:"customer",2:"admin",3:"system"},statusColor={1:"open",2:"closed",3:"mediation"},resumeLoader={styles:{container:{justifyContent:"flex-start",minHeight:33},loader:{width:20,height:20,borderWidth:4}}},loader={width:"60px",height:"60px",borderWidth:"5px",borderColor:"#d3d3d3",borderLeftColor:"transparent"},ticketLoader={styles:{loader:loader,container:{minHeight:"430px"}},insertBefore:".pagination-container"},messageLoader={styles:{loader:loader,container:{minHeight:"520px"}}},attachments2send=[];$((function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;loadOnAny(".tickets-container",!1,ticketLoader),o(),$.ajax({method:"GET",url:"/api/tickets?"+getFilters(t),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){loadOnAny(".tickets-container",!0),t.data.length?(e(t.data),d()||(a(t.data[0].id),$(".ticket-item").removeClass("active"),$(".ticket-item:first").addClass("active")),$(".current-page-text .per-page").text(t.data.length),$(".current-page-text .total").text(t.meta.total)):r(),l("#tickets-pagination",t.meta)}})}function e(t){var e,a="",n=_createForOfIteratorHelper(t);try{for(n.s();!(e=n.n()).done;){var o=e.value;a+='<div class="ticket-item" data-id="'.concat(o.id,'">\n                         <div class="px-30">\n                             <span class="ticket-status-icon ').concat(statusColor[o.ticket_status_enum]||"answered",'"></span>\n                         </div>\n                         <div class="d-flex flex-column">\n                             <div class="customer-name">').concat(o.customer_name,'</div>\n                             <small class="ticket-subject">').concat(o.subject,'</small>\n                             <div class="ticket-last-message">').concat(o.description,"</div>\n                         </div>\n                     </div>")}}catch(t){n.e(t)}finally{n.f()}$(".tickets-container").html(a),$(".pagination-container").show()}function a(t){d()||loadOnAny(".tickets-grid-right",!1,messageLoader),$.ajax({method:"GET",url:"/api/tickets/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){loadOnAny(".tickets-grid-right",!0),function(t){$("#ticket-id").val(t.id),$(".ticket-customer").text(t.customer_name),$(".ticket-status .ticket-status-text").text(statusEnum[t.ticket_status_enum]),$(".ticket-status .ticket-status-icon").removeClass("open closed mediation answered").addClass(statusColor[t.ticket_status_enum]||"answered"),$(".ticket-category-text").text(categoryEnum[t.ticket_category_enum]),$(".ticket-start-date").text(t.created_at),$(".ticket-project").text(t.project_name),$(".ticket-header *").show();var e="";d()&&(e+='<div class="ticket-messages-resume"><b>'.concat(categoryEnum[t.ticket_category_enum],"</b> aberta em ").concat(t.created_at," para <b>").concat(t.project_name,"</b></div>"));var a,o=_createForOfIteratorHelper(t.messages);try{for(o.s();!(a=o.n()).done;){e+=n(a.value)}}catch(t){o.e(t)}finally{o.f()}$(".messages-container").html(e).scrollTop((function(){return this.scrollHeight})),"closed"===statusColor[t.ticket_status_enum]?($(".write-container .inputs-container").children().hide(),$("#btn-send").hide(),$(".ticket-closed-info").show()):($(".write-container .inputs-container").children().show(),$("#btn-send").show(),$(".ticket-closed-info").hide());$(".write-container").show()}(t.data),d()&&($(".tickets-grid-left").css("grid-area","1 / 2"),$(".tickets-grid-right").css("grid-area","1 / 1"),$(".search-box").removeClass("show"))}})}function n(t){return"text"===t.type?'<div class="ticket-message '.concat(typeEnum[t.from],'">\n                        <span>').concat(t.content,'</span>\n                        <div class="ticket-message-date">').concat(t.created_at,"</div>\n                    </div>"):"file"===t.type?'<div class="ticket-message file '.concat(typeEnum[t.from],'">\n                        <a download="').concat(t.content,'"  href="').concat(t.link,'" target="_blank" class="file-download">\n                           <span>').concat(t.content,'</span>\n                           <i class="material-icons">file_download</i>\n                        </a>\n                        <div class="d-flex justify-content-between">\n                            <div class="file-extension">').concat(t.content.split(".")[1],'</div>\n                            <div class="ticket-message-date">').concat(t.created_at,"</div>\n                        </div>\n                    </div>"):void 0}function o(){$(".tickets-container").html(""),$(".messages-container").html(""),$(".ticket-header *").hide(),$(".write-container").hide(),$(".pagination-container").hide()}function r(){$(".tickets-container").html('<div class="tickets-empty">\n                               <img src="/modules/global/img/tickets.svg">\n                               <h3>Tudo tranquilo por aqui!</h3>\n                               <div>Por enquanto, não há nenhum atendimento a ser resolvido. Volte mais tarde!</div>\n                             </div>');$(".messages-container").html('<div class="messages-empty">\n                                <img src="/modules/global/img/chat.svg">\n                                <h3>Esse é o seu espaço de chat.</h3>\n                                <div>\n                                  Para usar o chat e responder seus clientes, basta selecionar algum dos tickets\n                                  na aba aqui no lado direito. Nesse espaço, você poderá tirar dúvidas, responder\n                                  reclamações e sugestões de seus compradores.\n                                </div>\n                              </div>')}function i(){$("#ticket-open .detail").html(""),$("#ticket-mediation .detail").html(""),$("#ticket-closed .detail").html(""),loadOnAny(".number",!1,resumeLoader),$.ajax({method:"GET",url:"/api/tickets/getvalues?project="+$("#project-select").val(),dataType:"json",data:{date:$("#date_range").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny(".number",!0),errorAjaxResponse(t)},success:function(t){$("#ticket-open .number").html(t.open);var e=100/t.total*t.open||0;$("#ticket-open .detail").html("(".concat(e.toFixed(1),"%)")),$("#ticket-mediation .number").html(t.mediation),e=100/t.total*t.mediation||0,$("#ticket-mediation .detail").html("(".concat(e.toFixed(1),"%)")),$("#ticket-closed .number").html(t.closed),e=100/t.total*t.closed||0,$("#ticket-closed .detail").html("(".concat(e.toFixed(1),"%)")),$("#ticket-total .number").html(t.total),loadOnAny(".number",!0)}})}function s(){d()&&($(".tickets-grid-left").css("grid-area","1 / 1"),$(".tickets-grid-right").css("grid-area","1 / 2"))}function c(){$("#btn-send").prop("disabled",!0);var t=$("#write-area");if(t.val().length||attachments2send.length){var e=new FormData;e.append("ticket_id",$("#ticket-id").val()),e.append("message",t.val()),attachments2send.forEach((function(t,a){e.append("attachments[".concat(a,"]"),t)})),$.ajax({method:"POST",url:"/api/tickets/sendmessage",data:e,contentType:!1,processData:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),$("#btn-send").prop("disabled",!1)},success:function(e){t.val(""),function(){for(;attachments2send.length;)attachments2send.pop();$(".attachments-container").html("").hide()}();var a,o=$(".messages-container"),r=_createForOfIteratorHelper(e);try{for(r.s();!(a=r.n()).done;){var i=a.value;o.append(n(i))}}catch(t){r.e(t)}finally{r.f()}o.scrollTop((function(){return this.scrollHeight})),$("#btn-send").prop("disabled",!1)}})}}function l(t,e){var a=e.current_page,n=e.last_page,o=e.per_page,r=e.total,i=[];if($(t).html(""),!(o>=r)){if(n<=4)for(var s=1;s<=n;s++)i.push(s);else if(a<3){for(var c=1;c<4;c++)i.push(c);i.push(n)}else{var l=a-1,d=a+1;i.push(1),l>1&&i.push(l),i.push(a),d<n&&i.push(d),a<n&&i.push(n)}i.forEach((function(e){var n="<button ".concat(e===a?'class="active"':"",">").concat(e,"</button>");$(t).append(n)}))}}function d(){return window.innerWidth<768}loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(e){if(e.data.length){var a,n=_createForOfIteratorHelper(e.data);try{for(n.s();!(a=n.n()).done;){var o=a.value;$("#project-select").append('<option value="'.concat(o.id,'">').concat(o.name,"</option>"))}}catch(t){n.e(t)}finally{n.f()}t(),i(),$(".page-header").show(),$("#project-not-empty").show(),$("#project-empty").hide()}else $(".page-header").hide(),$("#project-not-empty").hide(),$("#project-empty").show();loadingOnScreenRemove()}}),window.getFilters=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=$("#project-select").val(),a=$("#filter-plan").data("value")||"",n=[];$("#category-complaint.active").length&&n.push(1),$("#category-doubt.active").length&&n.push(2),$("#category-suggestion.active").length&&n.push(3);var o=$("#filter-document").data("value")||"",r=$("#filter-name").data("value")||"",i=$("#filter-answer").data("value")||"",s=$("#filter-date").data("value")||"",c=$("#filter-status").val(),l=$("#name-or-document").val(),d={project:e,plan:a,category:n,document:o,name:r,answered:i,period:s,status:c,nameOrDocument:l,page:t};return Object.entries(d).map((function(t){var e=_slicedToArray(t,2),a=e[0],n=e[1];return"".concat(a,"=").concat(n)})).join("&")},$("#project-select").on("change",(function(){$("#plan-select").clear(),t(),i()})),$("#filter-status").on("change",(function(){t()})),$(".filter-badge").on("click",(function(e){var a=$(this);if(a.hasClass("editable")){var n=$(a.data("target"));if(a.hasClass("active")&&e.offsetX>=this.offsetWidth-32)a.removeClass("active").removeClass("focused"),a.text(a.data("original-text")),a.data("value",""),n.length&&(n.removeClass("show").find("input").val(""),a.hasClass("dropdown")&&n.find("select").val("").clear(),t()),a.hasClass("daterange")&&(a.data("dateRangePicker").clear(),a.data("dateRangePicker").close(),t(),e.stopImmediatePropagation());else if(a.hasClass("active")||a.addClass("focused"),n.length){$(".filter-badge-input").not(n).removeClass("show");var o=n.width(),r=n[0].parentNode.getBoundingClientRect(),i=r.left,c=r.width-o-55,l=this.getBoundingClientRect().left-i;l=(l=l>c?c:l)<0?0:l,n.css("margin-left",l+"px").addClass("show"),n.find("input").focus()}}else a.toggleClass("active"),t();s()})),$(".filter-badge-input button").on("click",(function(){var e=$(this).parent(),a=e.attr("id"),n=e.find("input, select"),o=n.val();if(o){var r=$("[data-target='#".concat(a,"']"));"SELECT"===n.prop("tagName")&&(r.data("original-text",r.text()),r.text(n.find("option:selected").text())),r.data("value",o).addClass("active"),t()}e.removeClass("show")})),$(document).on("click",".filter-badge-input .select3-option",(function(){var e=$(this).parents(".filter-badge-input"),a=e.attr("id"),n=$("[data-target='#".concat(a,"']")),o=$(this).data("value");o?n.addClass("active"):n.removeClass("active"),n.data("value",o).addClass("active"),t(),e.removeClass("show")})),$(document).on("click",(function(t){var e=$(t.target);e.is(".filter-badge-input")||(e.is(".filter-badge.editable")||e.parents(".filter-badge-input").length||$(".filter-badge-input").removeClass("show"),e.is(".filter-badge-input input")||e.is(".filter-badge-input select")||$(".filter-badge").not(e).removeClass("focused"))})),$("#input-document input").on("keyup",(function(){var t=["00.000.000/0000-00","000.000.000-000"];$(this).mask(this.value.length>14?t[0]:t[1])})),$(".btn-search").on("click",(function(){var t=$(".search-box");t.toggleClass("show"),t.hasClass("show")&&t.find("input").focus()})),$(".search-box button").on("click",(function(){t(),$(".search-box").removeClass("show")})),$(document).on("click",".ticket-item",(function(){a($(this).data("id")),$(".ticket-item").removeClass("active"),$(this).addClass("active")})),$(".ticket-back").on("click",(function(){s()})),$(window).resize((function(){d()||($(".tickets-grid-left").css("grid-area","1 / 1"),$(".tickets-grid-right").css("grid-area","1 / 2"))})),$("#btn-file").on("click",(function(){$("#input-file").click()})),$("#btn-image").on("click",(function(){$("#input-image").click()})),$("#input-file, #input-image").on("change",(function(){var t,e;t=this.files,(e=$(".attachments-container")).html(""),attachments2send.push.apply(attachments2send,_toConsumableArray(Array.from(t))),attachments2send.forEach((function(t,a){var n=t.name;n.length>=10&&(n=n.slice(0,3)+"..."+n.slice(-6)),e.append('<div class="attachment" data-id="'.concat(a,'">').concat(n,"</div>"))})),e.show()})),$(document).on("click",".attachment",(function(){var t=$(this),e=t.data("id");attachments2send.splice(e,1),t.remove(),$(".attachment").length||$(".attachments-container").hide()})),$("#btn-send").on("click",(function(){c()})),$("#write-area").on("keypress",(function(t){13!==t.which||t.shiftKey||(t.preventDefault(),c())})),$(document).on("click",".pagination button:not(.active)",(function(){$(".pagination button").removeClass("active"),$(this).addClass("active"),t(parseInt($(this).text()))})),$("#plan-select").select3({placeholder:"Selecione o plano",language:{noResults:"Nenhum plano encontrado",searching:"Procurando...",loadingMore:"Carregando mais planos..."},ajax:{url:"/api/plans/user-plans",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:function(t){return{search:t.term,page:t.page||1,project_id:$("#project-select").val()}},processResults:function(t){return{results:$.map(t.data,(function(t){return{id:t.id,text:t.name+(t.description?" - "+t.description:"")}})),pagination:{more:t.meta.current_page<t.meta.last_page}}}}}),$("#filter-date").dateRangePicker({setValue:function(t){if(t){var e=t.replace(/(\d{2}\/\d{2}\/)(\d{2}) à (\d{2}\/\d{2}\/)(\d{2})/,"$120$2-$320$4");$(this).html(t).data("value",e)}else $(this).html("Selecionar").data("value","")}}).on("datepicker-change",(function(){t()})).on("datepicker-open",(function(){$(".filter-badge-input").removeClass("show")})).on("datepicker-close",(function(){$(this).removeClass("focused"),$(this).data("value")&&$(this).addClass("active")}));var u=new EmojiButton;u.on("emoji",(function(t){var e=document.querySelector("#write-area");e.value+=t,setTimeout((function(){e.focus()}),100)})),$("#btn-emoji").on("click",(function(){u.togglePicker(this)}))}));
