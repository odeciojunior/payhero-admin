$(document).ready((function(){var e="daily",a="weekly",s="monthly",n="period",d="amount",t={company_id:null,rule:null,frequency:null,weekday:null,day:null,amount:0},l=$("#finances-settings-form"),i=$("#transfers_company_select"),r=$("#withdrawal_by_period"),o=$(".frequency-container"),c=o.find(".btn"),u=$(".weekdays-container"),m=u.find(".btn"),f=$(".day-container"),v=f.find(".btn"),C=$("#withdrawal_by_value"),g=$("#withdrawal_amount");window.getSettings=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];clearSettingsForm(),$.ajax({method:"GET",url:"/api/withdrawals/settings/"+e+(a?"/"+a:""),headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){s&&alertCustom("warning","Nenhuma configuração de saque automático encontrada para a empresa selecionada"),clearSettingsForm()},success:function(e){t=e.data,fillSettingsForm(t)}})},window.saveSettings=function(e){if(t=Object.assign(t,{company_id:i.val(),amount:g.val()}),!validateSettingsData(e))return alertCustom("error","Dados inválidos, verifique novamente as Configurações de Saque Automático"),!1;var a=t.id?"PUT":"POST",s=t.id?"/"+t.id:"";$.ajax({method:a,url:"/api/withdrawals/settings"+s,data:e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){t=Object.assign(t,e.data),alertCustom("success",e.message)}})},window.deleteSettings=function(e){if(!e)return!1;$.ajax({method:"DELETE",url:"/api/withdrawals/settings/"+e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){t=Object.assign(t,{id:null,rule:null,frequency:null,weekday:null,day:null,amount:0}),alertCustom("success",e.message)}})},window.validateSettingsData=function(e){if(e.rule===n){if(!e.frequency)return!1;if(e.frequency===a&&null===e.weekday)return!1;if(e.frequency===s&&!e.day)return!1}var t=Number.parseInt(e.amount.replace(/\D/g,""));return!(e.rule===d&&t<1e4)},window.fillSettingsForm=function(t){if((null==t?void 0:t.rule)===n&&(r.prop("checked",!0).trigger("change"),c.each((function(e,a){(a=$(a)).data("frequency")===t.frequency&&a.addClass("active")})),t.frequency===e?(m.addClass("active"),u.addClass("d-flex").removeClass("d-none"),f.addClass("d-none").removeClass("d-flex")):t.frequency===a?(m.removeClass("active"),m.each((function(e,a){(a=$(a)).data("weekday")==t.weekday&&a.addClass("active")})),u.addClass("d-flex").removeClass("d-none"),f.addClass("d-none").removeClass("d-flex")):t.frequency===s&&(m.removeClass("active"),v.removeClass("active"),v.each((function(e,a){(a=$(a)).data("day")==t.day&&a.addClass("active")})),u.addClass("d-none").removeClass("d-flex"),f.addClass("d-flex").removeClass("d-none"))),(null==t?void 0:t.rule)===d){var l=t.amount.toFixed(2).replace(".",",");C.prop("checked",!0).trigger("change"),g.val(l).focus()}},window.clearSettingsForm=function(){t={company_id:i.val(),rule:null,frequency:null,weekday:null,day:null,amount:0},r.prop("checked",!1),C.prop("checked",!1),onWithdrawalByPeriodChange(),onWithdrawalByAmountChange()},window.onWithdrawalByPeriodChange=function(){var e=r.closest(".card");r.is(":checked")?(t.rule=n,C.prop("checked",!1).trigger("change"),c.removeClass("disabled").prop("disabled",!1),m.removeClass("disabled").prop("disabled",!1),v.removeClass("disabled").prop("disabled",!1),e.find("[type=submit]").removeClass("disabled").addClass("btn-success").prop("disabled",!1),e.addClass("bg-light").removeClass("bg-lighter"),t.frequency||o.find('[data-frequency="daily"]').trigger("click")):(t.rule===n&&(t.rule=null),c.addClass("disabled").removeClass("active").prop("disabled",!0),m.addClass("disabled").removeClass("active").prop("disabled",!0),v.addClass("disabled").removeClass("active").prop("disabled",!0),e.find("[type=submit]").addClass("disabled").removeClass("btn-success").prop("disabled",!0),e.addClass("bg-lighter").removeClass("bg-light"),t=Object.assign(t,{frequency:null,weekday:null,day:null}))},window.onWithdrawalByAmountChange=function(){var e=C.closest(".card");C.is(":checked")?(t.rule=d,r.prop("checked",!1).trigger("change"),e.find("[type=submit]").addClass("btn-success").removeClass("disabled btn-default").prop("disabled",!1),e.addClass("bg-light").removeClass("bg-lighter"),g.removeClass("disabled").prop("disabled",!1).focus()):(t.rule===d&&(t.rule=null),e.find("[type=submit]").removeClass("btn-default").addClass("disabled btn-default").prop("disabled",!0),e.addClass("bg-lighter").removeClass("bg-light"),g.addClass("disabled").prop("disabled",!0).val(""),t=Object.assign(t,{amount:0}))},i.on("change",(function(){getSettings($(this).val())})),c.on("click",(function(){c.removeClass("active"),m.removeClass("active"),t.frequency=$(this).addClass("active").data("frequency"),t.weekday=null,t.day=null,t.frequency===e?(m.addClass("active"),u.addClass("d-flex").removeClass("d-none"),f.addClass("d-none").removeClass("d-flex"),v.removeClass("active")):t.frequency===a?(u.addClass("d-flex").removeClass("d-none"),u.find('[data-weekday="1"]').trigger("click"),f.addClass("d-none").removeClass("d-flex"),v.removeClass("active")):t.frequency===s&&(u.addClass("d-none").removeClass("d-flex"),f.addClass("d-flex").removeClass("d-none"),f.find('[data-day="01"]').trigger("click"))})),m.on("click",(function(){"weekly"===t.frequency&&(m.removeClass("active"),$(this).addClass("active"),t.weekday=$(this).data("weekday"))})),v.on("click",(function(){"monthly"===t.frequency&&(v.removeClass("active"),$(this).addClass("active"),t.day=$(this).data("day"))})),r.on("change",(function(){onWithdrawalByPeriodChange(),!t.rule&&t.id&&deleteSettings(t.id)})),C.on("change",(function(){onWithdrawalByAmountChange(),!t.rule&&t.id&&deleteSettings(t.id)})),l.on("submit",(function(e){return e.preventDefault(),saveSettings(t),!1})),g.maskMoney({thousands:".",decimal:",",allowZero:!0}),c.removeClass("active"),isEmpty(i.val())?(onWithdrawalByAmountChange(),onWithdrawalByPeriodChange()):getSettings(i.val())}));
