function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,l=function(){};return{s:l,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,r=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return s=e.done,e},e:function(e){r=!0,o=e},f:function(){try{s||null==a.return||a.return()}finally{if(r)throw o}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}$(document).ready((function(){var e,t=$(window.location.pathname.split("/")).get(-1),a=null;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=null==e?"/api/projectupsellrule":"/api/projectupsellrule"+e,loadOnTable("#data-table-upsell","#table-upsell"),$("#tab_upsell-panel").find(".no-gutters").css("display","none"),$("#table-upsell").find("thead").css("display","none"),$.ajax({method:"GET",url:e,dataType:"json",data:{project_id:t},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=$("#data-table-upsell");if(t.html(""),""==e.data)$(".div-config").hide(),$("#data-table-upsell").html("\n                        <tr class='text-center'>\n                            <td colspan='3' style='height: 70px;vertical-align: middle'>\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.svg' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum upsell configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro upsell para poder\n                                        <br>gerenci√°-los nesse painel.</p>\n                                        <button type='button' style='width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-upsell' data-toggle=\"modal\" data-target=\"#modal_add_upsell\">Adicionar upsell</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    "),$("#table-upsell").addClass("table-striped");else{$("#tab_upsell-panel").find(".no-gutters").css("display","flex"),$("#table-upsell").find("thead").css("display","contents"),$("#table-upsell").addClass("table-striped"),$("#count-upsell").html(e.meta.total);var a="";$.each(e.data,(function(e,t){a+="\n                        <tr>\n                            <td>".concat(t.description,'</td>\n                            <td class="text-center">').concat(t.active_flag?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>',"</td>\n                            <td style='text-align:center'>\n                                <div class='d-flex justify-content-end align-items-center'>\n                                    <a role='button' title='Visualizar' class='mg-responsive details-upsell pointer' data-upsell=\"").concat(t.id,"\" data-target='#modal-detail-upsell' data-toggle='modal'><span class=\"o-eye-1\"></span></a>\n                                    <a role='button' title='Editar' class='pointer edit-upsell mg-responsive' data-upsell=\"").concat(t.id,"\"><span class='o-edit-1'></span></a>\n                                    <a role='button' title='Excluir' class='pointer delete-upsell mg-responsive' data-upsell=\"").concat(t.id,'" data-toggle="modal" data-target="#modal-delete-upsell"><span class=\'o-bin-1\'></span></a>\n                                </div>\n                            </td>\n                        </tr>\n                        ')})),t.append(a),$(".div-config").show(),pagination(e,"upsell",n)}}})}ClassicEditor.create(document.querySelector("#description_config"),{language:"pt-br",uiColor:"#F1F4F5",toolbar:["heading","|","bold","italic","|","link","|","undo","redo"]}).then((function(t){e=t})).catch((function(e){console.error(e)})),$(".tab_upsell").on("click",(function(){n(),$(this).off()})),$(document).on("click",".add-upsell",(function(){$("#modal_add_upsell .modal-title").html("Novo upsell"),$(".bt-upsell-save").show(),$(".bt-upsell-update").hide(),$("#form_add_upsell").show(),$("#form_edit_upsell").hide(),$("#add_description_upsell").val(""),$("#add_discount_upsell").val("")})),$(document).on("click",".edit-upsell",(function(e){e.preventDefault();var t=$(this).data("upsell");$("#modal_add_upsell .modal-title").html("Editar upsell"),$(".bt-upsell-save").hide(),$(".bt-upsell-update").show(),$("#form_add_upsell").hide(),$("#form_edit_upsell").show(),$("#edit_description_upsell").val(""),$("#edit_discount_upsell").val(""),$("#form_edit_upsell .upsell-id").val(t),$.ajax({method:"GET",url:"/api/projectupsellrule/"+t+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){},success:function(e){var t=e.data;$("#edit_description_upsell").val("".concat(t.description)),$("#edit_discount_upsell").val("".concat(t.discount)),t.active_flag?$("#edit_active_flag").val(1).prop("checked",!0):$("#edit_active_flag").val(0).prop("checked",!1),$("#edit_apply_on_plans, #edit_offer_on_plans").html("");var a,n=[],l=_createForOfIteratorHelper(t.apply_on_plans);try{for(l.s();!(a=l.n()).done;){var o=a.value;n.push(o.id),$("#edit_apply_on_plans").append('<option value="'.concat(o.id,'">').concat(o.name+(o.description?" - "+o.description:""),"</option>"))}}catch(e){l.e(e)}finally{l.f()}$("#edit_apply_on_plans").val(n);var s,r=[],c=_createForOfIteratorHelper(t.offer_on_plans);try{for(c.s();!(s=c.n()).done;){var i=s.value;r.push(i.id),$("#edit_offer_on_plans").append('<option value="'.concat(i.id,'">').concat(i.name+(i.description?" - "+i.description:""),"</option>"))}}catch(e){c.e(e)}finally{c.f()}$("#edit_offer_on_plans").val(r),$("#modal_add_upsell").modal("show")}})})),$(document).on("click",".bt-upsell-save",(function(){var e=new FormData(document.getElementById("form_add_upsell"));e.append("project_id",t),$.ajax({method:"POST",url:"/api/projectupsellrule",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:e,error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal_add_upsell").modal("hide"),n(),alertCustom("success",e.message),$("#add_apply_on_plans, #add_offer_on_plans").val(null).trigger("change")}})})),$(document).on("click",".delete-upsell",(function(e){e.preventDefault();var t=$(this).data("upsell");$("#btn-delete-upsell").unbind("click"),$("#btn-delete-upsell").on("click",(function(){$.ajax({method:"DELETE",url:"/api/projectupsellrule/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){n(),alertCustom("success",e.message)}})}))})),$(document).on("click",".bt-upsell-update",(function(e){e.preventDefault();var t=new FormData(document.getElementById("form_edit_upsell")),a=$("#form_edit_upsell .upsell-id").val();$.ajax({method:"POST",url:"/api/projectupsellrule/"+a,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:t,error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal_add_upsell").modal("hide"),n(),alertCustom("success",e.message)}})})),$(document).on("click",".details-upsell",(function(e){e.preventDefault();var t=$(this).data("upsell");$.ajax({method:"GET",url:"/api/projectupsellrule/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=e.data;$(".upsell-description").html(""),$(".upsell-discount").html(""),$(".upsell-status").html(""),$(".upsell-apply-plans").html(""),$(".upsell-offer-plans").html(""),$(".upsell-description").html("".concat(t.description)),$(".upsell-discount").html("".concat(0!=t.discount?"".concat(t.discount,"%"):"Valor sem desconto")),$(".upsell-status").html("".concat(t.active_flag?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>'));var a,n=_createForOfIteratorHelper(t.apply_on_plans);try{for(n.s();!(a=n.n()).done;){var l=a.value;$(".upsell-apply-plans").append("<span>".concat(l.name,"</span><br>"))}}catch(e){n.e(e)}finally{n.f()}var o,s=_createForOfIteratorHelper(t.offer_on_plans);try{for(s.s();!(o=s.n()).done;){var r=o.value;$(".upsell-offer-plans").append("<span>".concat(r.name,"</span><br>"))}}catch(e){s.e(e)}finally{s.f()}}})})),$("#add_apply_on_plans, #edit_apply_on_plans, #add_offer_on_plans, #edit_offer_on_plans").select2({placeholder:"Nome do plano",multiple:!0,dropdownParent:$("#modal_add_upsell"),language:{noResults:function(){return"Nenhum plano encontrado"},searching:function(){return"Procurando..."},loadingMore:function(){return"Carregando mais planos..."}},ajax:{data:function(e){return{list:"plan",search:e.term,project_id:t,page:e.page||1}},method:"GET",url:"/api/plans/user-plans",delay:300,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processResults:function(e){var t=this.$element.attr("id");if(["add_apply_on_plans","edit_apply_on_plans"].includes(t)&&1===e.meta.current_page){e.data.unshift({id:"all",name:"Qualquer plano",description:""})}return{results:$.map(e.data,(function(e){return{id:e.id,text:e.name+(e.description?" - "+e.description:"")}})),pagination:{more:e.meta.current_page!==e.meta.last_page}}}}}),$("#add_apply_on_plans, #edit_apply_on_plans").on("select2:select",(function(){var e=$(this);(e.val().length>1&&e.val().includes("all")||e.val().includes("all")&&"all"!==e.val())&&e.val("all").trigger("change")})),$(document).on("click","#config-upsell",(function(a){a.preventDefault(),$.ajax({method:"GET",url:"/api/projectupsellconfig/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(t){var a,n=t.data;$("#header_config").val("".concat(n.header)),$("#title_config").val("".concat(n.title)),e.setData("".concat(null!==(a=n.description)&&void 0!==a?a:" ")),$("#countdown_time").val("".concat(n.countdown_time)),n.countdown_flag?$("#countdown_flag").prop("checked",!0):$("#countdown_flag").prop("checked",!1),n.has_upsell&&$(".btn-view-config").show(),$("#modal_config_upsell").modal("show")}})})),$(document).on("click",".bt-upsell-config-update",(function(a){if(a.preventDefault(),$("#countdown_flag").is(":checked")&&""==$("#countdown_time").val())return alertCustom("error","Preencha o campo Contagem"),!1;var n=new FormData(document.getElementById("form_config_upsell")),l=e.getData();n.set("description",l),$.ajax({method:"POST",url:"/api/projectupsellconfig/"+t,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:n,error:function(e){errorAjaxResponse(e)},success:function(e){alertCustom("success",e.message),$("#modal_config_upsell").modal("hide")}})})),$(document).on("click",".btn-return-to-config",(function(e){e.preventDefault(),$("#modal-view-upsell-config").modal("hide"),$("#modal_config_upsell").modal("show")})),$(document).on("click",".btn-view-config",(function(e){e.preventDefault(),$("#modal_config_upsell").modal("hide"),$.ajax({method:"POST",url:"/api/projectupsellconfig/previewupsell",dataType:"json",data:{project_id:t},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=e.data;$("#div-upsell-products").html(""),$("#upsell-header").html(t.header),$("#upsell-title").html(t.title),$("#upsell-description").html(t.description),t.countdown_flag?($("#timer").show(),function(e){var t=(new Date).getTime()+6e4*e;null!==a&&clearInterval(a);n=function(){var a=(new Date).getTime(),n=t-a;if(n>0){var l=Math.floor(n%36e5/6e4),o=Math.floor(n%6e4/1e3);$("#minutes").text(l.toString().padStart(2,"0")),$("#seconds").text(o.toString().padStart(2,"0"))}else t=(new Date).getTime()+6e4*e},l=1e3,n(),a=setInterval(n,l);var n,l}(t.countdown_time)):$("#timer").hide();var n="";for(var l in t.plans){var o=t.plans[l];n+='<div class="product-info">\n                                <div class="d-flex flex-column">';var s,r=_createForOfIteratorHelper(o.products);try{for(r.s();!(s=r.n()).done;){var c=s.value,i=Object.keys(c)[0];if(n+='<div class="product-row">\n                                    <img src="'.concat(c[i].photo,'" class="product-img">\n                                    <div class="ml-4">\n                                        <h3>').concat(c[i].amount,"x ").concat(c[i].name,"</h3>"),Object.keys(c).length>1){for(var p in n+='<select class="product-variant">',c)n+='<option value="'.concat(p,'">').concat(c[p].description,"</option>");n+="</select>"}else n+='<span class="text-muted">'.concat(c[i].description,"</span>");n+="</div>\n                             </div>"}}catch(e){r.e(e)}finally{r.f()}if(n+='</div>\n                                <div class="d-flex flex-column mt-4 mt-md-0">',o.discount&&(n+='<span class="original-price line-through">R$ '.concat(o.original_price,'</span>\n                                                 <div class="d-flex mb-2">\n                                                     <span class="price font-30 mr-1" style="line-height: .8">R$ ').concat(o.price,'</span>\n                                                     <span class="discount text-success font-weight-bold">').concat(o.discount,"% OFF</span>\n                                                 </div>")),isEmpty(o.installments))n+='<h2 class="text-primary mb-md-4"><b>R$ '.concat(o.price,"</b></h2>");else{n+='<div class="form-group">\n                                    <select class="installments">';var d,u=_createForOfIteratorHelper(o.installments);try{for(u.s();!(d=u.n()).done;){var m=d.value;n+='<option value="'.concat(m.amount,'">').concat(m.amount,"X DE R$ ").concat(m.value,"</option>")}}catch(e){u.e(e)}finally{u.f()}n+="</select>\n                             </div>"}n+='<button class="btn btn-success btn-lg btn-buy">COMPRAR AGORA</button>\n                         </div>\n                    </div>',parseInt(l)!==t.plans.length-1&&(n+='<hr class="plan-separator">')}$("#div-upsell-products").append(n),$("#modal-view-upsell-config").modal("show")}})}))}));
