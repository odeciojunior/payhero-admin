$(document).ready((function(){function e(){loadingOnScreen(),$.ajax({method:"GET",url:"/api/apps/notazz",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){loadingOnScreenRemove(),alertCustom("error","Ocorreu algum erro")},success:function(t){$("#content").html(""),0===Object.keys(t.data).length?$("#no-integration-found").show():($("#no-integration-found").hide(),$(t.data).each((function(e,t){$("#content").append('\n                            <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3">\n                                <div class="card shadow show-integration" integration='+t.id+">\n                                    <a href='/apps/notazz/".concat(t.id,"' class=''>\n                                        <img class=\"card-img-top img-fluid w-full\" src=\"").concat(t.project_photo?t.project_photo:"/modules/global/img/produto.png","\" style='cursor:pointer'/>\n                                    </a>\n                                    <div class=\"card-body\">\n                                        <div class='row'>\n                                            <div class='col-md-10'>\n                                                <h4 class=\"card-title\">")+t.project_name+'</h4>\n                                                <p class="card-text sm">Criado em '+t.created_at+"</p>\n                                            </div>\n                                            <div class='col-md-2'>\n                                                <a role='button' class='edit-integration pointer float-right' integration="+t.id+" data-toggle='modal' data-target='#modal-edit' type='a'>\n                                                    <span class=\"o-edit-1\"></span>\n                                                </a>\n                                                 <a role='button' class='delete-integration pointer float-right mt-10' integration="+t.id+" data-toggle='modal' data-target='#modal-delete' type='a'>\n                                                    <span class='o-bin-1'></span>\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        "),$("#active_flag_"+t.id).val(t.active_flag),$("#active_flag_"+t.id).prop("checked","1"==$("#active_flag_"+t.id).val())})),$(".delete-integration").unbind("click"),$(document).on("click",".delete-integration",(function(e){e.stopPropagation();var t=$(this).attr("integration");$("#modal-delete-integration .btn-delete").attr("integration",t),$("#modal-delete-integration").modal("show")})),$("#modal-delete-integration .btn-delete").on("click",(function(t){t.preventDefault();var a=$(this).attr("integration");$("a[class='delete-integration pointer float-right mt-10'][integration='"+a+"']").parent().parent().parent().parent().parent().find(".edit-integration").unbind("click"),$.ajax({method:"DELETE",url:"/api/apps/notazz/"+a,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(422===e.status)for(error in e.responseJSON.errors)alertCustom("error",String(e.responseJSON.errors[error]));else alertCustom("error",String(e.responseJSON.message))})),success:function(t){e(),alertCustom("success",t.message)}})})),$(".edit-integration").unbind("click"),$(".edit-integration").on("click",(function(){var t=$(this).attr("integration");$.ajax({method:"GET",url:"/api/projects?select=true",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){alertCustom("error","Ocorreu algum erro")},success:function(a){$("#select_projects_edit").html(""),$(a.data).each((function(e,t){$("#select_projects_edit").append("<option value='"+t.id+"'>"+t.name+"</option>")})),$(".modal-title").html("Editar Integração com Notazz"),$.ajax({method:"GET",url:"/api/apps/notazz/"+t,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){},success:function(t){$("#select_projects_edit").val(t.data.project_id),$("#select_invoice_type_edit").val(t.data.invoice_type),$("#integration_id").val(t.data.id),$("#token_api_edit").val(t.data.token_api),$("#token_webhook_edit").val(t.data.token_webhook),$("#token_logistics_edit").val(t.data.token_logistics),$("#start_date_edit").val(t.data.start_date),$("#select_pending_days_edit").val(t.data.pending_days),$("#emit_zero_edit").val(t.data.emit_zero),$("#emit_zero_edit").prop("checked","1"==$("#emit_zero_edit").val()),$("#remove_tax_edit").val(t.data.remove_tax),$("#remove_tax_edit").prop("checked","1"==$("#remove_tax_edit").val()),$("#active_flag").val(t.data.active_flag),$("#active_flag").prop("checked","1"==$("#active_flag").val()),$("#modal_add_integracao").modal("show"),$("#form_add_integration").hide(),$("#form_update_integration").show(),$("#bt_integration").addClass("btn-update"),$("#bt_integration").removeClass("btn-save"),$("#bt_integration").text("Atualizar"),$("#btn-modal").show(),$(".btn-update").unbind("click"),$(".btn-update").on("click",(function(){var t=$("#integration_id").val(),a=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/notazz/"+t,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",processData:!1,contentType:!1,cache:!1,data:a,error:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){if(console.log(e),422===e.status)for(error in e.responseJSON.errors)alertCustom("error",String(e.responseJSON.errors[error]));else 403===e.status?alertCustom("error",e.responseJSON.message):alertCustom("error",e.message)})),success:function(t){e(),alertCustom("success",t.message)}})}))}})}})}))),loadingOnScreenRemove()}})}function t(){$("#integration_id").val(""),$("#start_date_create").val(moment().format("YYYY-MM-DD")),$("#token_api_create").val(""),$("#token_webhook_create").val(""),$("#token_logistics_create").val(""),$(":checkbox").prop("checked",!1).val(0),$("#select_projects_create").prop("selectedIndex",0).change(),$("#select_invoice_type_create").prop("selectedIndex",0).change(),$("#select_pending_days_create").prop("selectedIndex",0).change(),$.ajax({method:"GET",url:"/api/projects?select=true",data:{status:"active"},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",error:function(e){$("#modal-content").hide(),alertCustom("error","Ocorreu algum erro")},success:function(t){if(0===Object.keys(t.data).length){$("#modal-project").modal("show"),$("#modal-project-title").text("Oooppsssss!"),$("#modal_project_body").html('<div class="swal2-icon swal2-error swal2-animate-error-icon" style="display: flex;"><span class="swal2-x-mark"><span class="swal2-x-mark-line-left"></span><span class="swal2-x-mark-line-right"></span></span></div><h3 align="center"><strong>Você não possui lojas para realizar integração</strong></h3><h5 align="center">Deseja criar sua primeira loja? <a class="red pointer" href="/projects/create">clique aqui</a></h5>'),$("#modal-withdraw-footer").html('<div style="width:100%;text-align:center;padding-top:3%"><span class="btn btn-success" data-dismiss="modal" style="font-size: 25px">Retornar</span></div>')}else $("#select_projects_create").html(""),$(t.data).each((function(e,t){$("#select_projects_create").append("<option value='"+t.id+"'>"+t.name+"</option>")})),$(".modal-title").html("Adicionar nova Integração com Notazz"),$("#bt_integration").addClass("btn-save"),$("#bt_integration").text("Adicionar integração"),$("#modal_add_integracao").modal("show"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$(".btn-save").unbind("click"),$(".btn-save").on("click",(function(){if(""==$("#token_api_create").val())return alertCustom("error","Datos invalidos, o campo Token Api é obrigatorio."),!1;var t=$("#select_projects_create").val(),a=$("#select_invoice_type_create").val(),o=$("#token_api_create").val(),n=$("#token_webhook_create").val(),r=$("#token_logistics_create").val(),i=$("#start_date_create").val(),s=$("#select_pending_days_create").val(),c=$("#emit_zero").is(":checked"),l=$("#remove_tax").is(":checked");""!=$("#start_date_create").val()?swal({title:"Data inicial de geração de notas fiscais foi definida.",type:"warning",text:"Uma data inicial para geração de notas fiscais foi selecionada, será gerada as notas fiscais de todas as vendas aprovadas apartir da data selecionada, deseja continuar?",showCancelButton:!0,confirmButtonColor:"#3085D6",cancelButtonColor:"#DD3333",cancelButtonText:"Cancelar",confirmButtonText:"Continuar"}).then((function(d){d.value&&$.ajax({method:"POST",url:"/api/apps/notazz",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",data:{select_projects_create:t,select_invoice_type_create:a,token_api_create:o,token_webhook_create:n,token_logistics_create:r,start_date_create:i,select_pending_days_create:s,remove_tax:l,emit_zero:c},error:function(e){e.status,alertCustom("error",e.responseJSON.message)},success:function(t){$("#no-integration-found").hide(),e(),alertCustom("success",t.message)}})})):$.ajax({method:"POST",url:"/api/apps/notazz",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},dataType:"json",data:{select_projects_create:t,select_invoice_type_create:a,token_api_create:o,token_webhook_create:n,token_logistics_create:r,start_date_create:i,select_pending_days_create:s,remove_tax:l,emit_zero:c},error:function(e){if(422===e.status)for(var t in e.responseJSON.errors)alertCustom("error",String(e.responseJSON.errors[t]));else alertCustom("error",e.responseJSON.message)},success:function(t){$("#no-integration-found").hide(),e(),alertCustom("success",t.message)}})}))}})}e(),$(".check").on("click",(function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)})),$("#btn-add-integration").on("click",(function(){t()}))}));
