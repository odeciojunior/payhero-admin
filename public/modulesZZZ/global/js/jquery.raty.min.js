!function(t,e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof module&&module.exports?module.exports=e(require("jquery")):e(t.jQuery)}(this,(function(t){"use strict";function e(e,s){this.element=e,this.self=t(e),this.opt=t.extend(!0,{},t.raty,s,this.self.data())}t.raty={cancelButton:!1,cancelClass:"raty-cancel",cancelHint:"Cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:void 0,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"},t.fn.raty=function(e){return this.each((function(){return new t.raty.Raty(this,e)._create()}))},t.raty.Raty=(e.prototype={_create:function(){this._executeCallbacks(),this._adjustNumber(),this._adjustHints(),this.opt.score=this._adjustedScore(this.opt.score),"img"!==this.opt.starType&&this._adjustStarName(),this._setPath(),this._createStars(),this.opt.cancelButton&&this._createCancel(),this.opt.precision&&this._adjustPrecision(),this._createScore(),this._apply(this.opt.score),this._setTitle(this.opt.score),this._target(this.opt.score),this.opt.readOnly?this._lock():(this.element.style.cursor="pointer",this._binds()),this.self.data("raty",this)},_adjustedScore:function(t){if(t||0===t)return this._between(t,0,this.opt.number)},_adjustHints:function(){if(this.opt.hints||(this.opt.hints=[]),this.opt.halfShow||this.opt.half)for(var t=this.opt.precision?10:2,e=0;e<this.opt.number;e++){var s=this.opt.hints[e];"[object Array]"!==Object.prototype.toString.call(s)&&(s=[s]),this.opt.hints[e]=[];for(var i=0;i<t;i++){var o=s[i],n=s[s.length-1];void 0===n&&(n=null),this.opt.hints[e][i]=void 0===o?n:o}}},_adjustNumber:function(){this.opt.number=this._between(this.opt.number,1,this.opt.numberMax)},_adjustPrecision:function(){this.opt.half=!0},_adjustStarName:function(){var t=["cancelOff","cancelOn","starHalf","starOff","starOn"];this.opt.path="";for(var e=0;e<t.length;e++)this.opt[t[e]]=this.opt[t[e]].replace(".","-")},_apply:function(t){this._fill(t),t&&(0<t&&this.scoreField.val(t),this._roundStars(t))},_attributesForIndex:function(t){var e=this._nameForIndex(t),s={alt:t,src:this.opt.path+this.opt[e]};return"img"!==this.opt.starType&&(s={"data-alt":t,class:this.opt[e]}),s.title=this._getHint(t),s},_between:function(t,e,s){return Math.min(Math.max(parseFloat(t),e),s)},_binds:function(){this.cancelButton&&(this._bindOverCancel(),this._bindClickCancel(),this._bindOutCancel()),this._bindOver(),this._bindClick(),this._bindOut()},_bindClick:function(){var e=this;this.stars.on("click.raty",(function(s){var i,o;e.self.data("readonly")||(i=!0,o=e.opt.half||e.opt.precision?e.self.data("score"):this.alt||t(this).data("alt"),e.opt.half&&!e.opt.precision&&(o=e._roundHalfScore(o)),e.opt.click&&(i=e.opt.click.call(e.element,+o,s)),!i&&void 0!==i||e._apply(+o))}))},_bindClickCancel:function(){this.cancelButton.on("click.raty",function(t){this.scoreField.removeAttr("value"),this.opt.click&&this.opt.click.call(this.element,null,t)}.bind(this))},_bindOut:function(){this.self.on("mouseleave.raty",function(t){var e=+this.scoreField.val()||void 0;this._apply(e),this._target(e,t),this._resetTitle(),this.opt.mouseout&&this.opt.mouseout.call(this.element,e,t)}.bind(this))},_bindOutCancel:function(){var t=this;this.cancelButton.on("mouseleave.raty",(function(e){var s,i=t.opt.cancelOff;"img"!==t.opt.starType&&(i=t.opt.cancelClass+" "+i),t._setIcon(this,i),t.opt.mouseout&&(s=+t.scoreField.val()||void 0,t.opt.mouseout.call(t.element,s,e))}))},_bindOver:function(){var t=this,e=t.opt.half?"mousemove.raty":"mouseover.raty";this.stars.on(e,(function(e){var s=t._getScoreByPosition(e,this);t._fill(s),t.opt.half&&(t._roundStars(s,e),t._setTitle(s,e),t.self.data("score",s)),t._target(s,e),t.opt.mouseover&&t.opt.mouseover.call(t.element,s,e)}))},_bindOverCancel:function(){var t=this;this.cancelButton.on("mouseover.raty",(function(e){var s,i;t.self.data("readonly")||(s=t.opt.path+t.opt.starOff,i=t.opt.cancelOn,"img"===t.opt.starType?t.stars.attr("src",s):(i=t.opt.cancelClass+" "+i,t.stars.attr("class",s)),t._setIcon(this,i),t._target(null,e),t.opt.mouseover&&t.opt.mouseover.call(t.element,null))}))},_buildScoreField:function(){return t("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this.self)},_createCancel:function(){var e=this.opt.path+this.opt.cancelOff,s=t("<"+this.opt.starType+" />",{title:this.opt.cancelHint,class:this.opt.cancelClass});"img"===this.opt.starType?s.attr({src:e,alt:"x"}):s.attr("data-alt","x").addClass(e),"left"===this.opt.cancelPlace?this.self.prepend("&#160;").prepend(s):this.self.append("&#160;").append(s),this.cancelButton=s},_createScore:function(){var e=t(this.opt.targetScore);this.scoreField=e.length?e:this._buildScoreField()},_createStars:function(){for(var e=1;e<=this.opt.number;e++){var s=this._attributesForIndex(e);t("<"+this.opt.starType+" />",s).appendTo(this.element),this.opt.space&&e<this.opt.number&&this.self.append("&#160;")}this.stars=this.self.children(this.opt.starType)},_error:function(e){t(this).text(e),t.error(e)},_executeCallbacks:function(){for(var t,e=["number","readOnly","score","scoreName","target","path"],s=0;s<e.length;s++)"function"==typeof this.opt[e[s]]&&((t=this.opt[e[s]].call(this.element))?this.opt[e[s]]=t:delete this.opt[e[s]])},_fill:function(t){for(var e=0,s=1;s<=this.stars.length;s++){var i,o,n=this.stars[s-1],a=this._turnOn(s,t);this.opt.iconRange&&this.opt.iconRange.length>e?(i=this.opt.iconRange[e],o=this._getRangeIcon(i,a),s<=i.range&&this._setIcon(n,o),s===i.range&&e++):(o=this.opt[a?"starOn":"starOff"],this._setIcon(n,o))}},_getDecimal:function(t,e){var s=t.toString().split(".")[1],i=0;return s&&(i=parseInt(s.slice(0,e),10),"9999"===s.slice(1,5)&&i++),i},_getRangeIcon:function(t,e){return e?t.on||this.opt.starOn:t.off||this.opt.starOff},_getScoreByPosition:function(e,s){var i,o=parseInt(s.alt||s.getAttribute("data-alt"),10);return this.opt.half&&(i=this._getWidth(),o=o-1+parseFloat((e.pageX-t(s).offset().left)/i)),o},_getHint:function(t,e){if(0!==t&&!t)return this.opt.noRatedMsg;var s=this._getDecimal(t,1),i=Math.ceil(t),o=this.opt.hints[(i||1)-1],n=o,a=!e||this.isMove;return this.opt.precision?(a&&(s=0===s?9:s-1),n=o[s]):(this.opt.halfShow||this.opt.half)&&(n=o[s=a&&0===s||5<s?1:0]),""===n?"":n||t},_getWidth:function(){var t=this.stars[0].width||parseFloat(this.stars.eq(0).css("font-size"));return t||this._error("Could not get the icon width!"),t},_lock:function(){var t=this._getHint(this.scoreField.val());this.element.style.cursor="",this.element.title=t,this.scoreField.prop("readonly",!0),this.stars.prop("title",t),this.cancelButton&&this.cancelButton.hide(),this.self.data("readonly",!0)},_nameForIndex:function(t){return this.opt.score&&this.opt.score>=t?"starOn":"starOff"},_resetTitle:function(){for(var t=0;t<this.opt.number;t++)this.stars[t].title=this._getHint(t+1)},_roundHalfScore:function(t){var e=parseInt(t,10),s=this._getDecimal(t,1);return 0!==s&&(s=5<s?1:.5),e+s},_roundStars:function(t,e){var s,i,o=this._starName(t,e);o&&(s=this.opt[o],i=this.stars[Math.ceil(t)-1],this._setIcon(i,s))},_setIcon:function(t,e){t["img"===this.opt.starType?"src":"className"]=this.opt.path+e},_setPath:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.slice(-1)[0]&&(this.opt.path+="/")},_setTarget:function(t,e){e=e&&this.opt.targetFormat.toString().replace("{score}",e),t.is(":input")?t.val(e):t.html(e)},_setTitle:function(t,e){var s;t&&(s=parseInt(Math.ceil(t),10),this.stars[s-1].title=this._getHint(t,e))},_starName:function(t,e){var s=+(t%1).toFixed(2);return e||this.isMove?.5<s?"starOn":"starHalf":s<=this.opt.round.down?void 0:this.opt.halfShow&&s<this.opt.round.up?"starHalf":s<this.opt.round.full?"starOff":"starOn"},_target:function(e,s){var i,o,n;this.opt.target&&((i=t(this.opt.target)).length||this._error("Target selector invalid or missing!"),o=s&&"mouseover"===s.type,void 0===e?e=this.opt.targetText:null===e?e=o?this.opt.cancelHint:this.opt.targetText:("hint"===this.opt.targetType?e=this._getHint(e,s):this.opt.precision&&(e=parseFloat(e).toFixed(1)),n=s&&"mousemove"===s.type,o||n||this.opt.targetKeep||(e=this.opt.targetText)),this._setTarget(i,e))},_turnOn:function(t,e){return this.opt.single?t===e:t<=e},_unlock:function(){this.element.style.cursor="pointer",this.element.removeAttribute("title"),this.scoreField.removeAttr("readonly"),this.self.data("readonly",!1),this._resetTitle(),this.cancelButton&&this.cancelButton.css("display","")},cancel:function(t){!0!==this.self.data("readonly")&&(this[t?"click":"score"].call(this,null),this.scoreField.removeAttr("value"))},click:function(e){!0!==this.self.data("readonly")&&(e=this._adjustedScore(e),this._apply(e),this.opt.click&&this.opt.click.call(this.element,e,t.Event("click")),this._target(e))},getScore:function(){var t=[],e=this.scoreField.val();return t.push(e?+e:void 0),1<t.length?t:t[0]},move:function(e){var s=parseInt(e,10),i=this._getDecimal(e,1);s>=this.opt.number&&(s=this.opt.number-1,i=10);var o=this._getWidth()/10,n=t(this.stars[s]),a=n.offset().left+o*i,r=t.Event("mousemove",{pageX:a});this.isMove=!0,n.trigger(r),this.isMove=!1},readOnly:function(t){this.self.data("readonly")!==t&&(t?(this.self.off(".raty").children(this.opt.starType).off(".raty"),this._lock()):(this._binds(),this._unlock()),this.self.data("readonly",t))},score:function(){return arguments.length?this.setScore.apply(this,arguments):this.getScore()},setScore:function(t){!0!==this.self.data("readonly")&&(t=this._adjustedScore(t),this._apply(t),this._target(t))}},e)}));
