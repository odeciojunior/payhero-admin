function _createForOfIteratorHelper(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return i=e.done,e},e:function(e){c=!0,r=e},f:function(){try{i||null==a.return||a.return()}finally{if(c)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}$(document).ready((function(){var e=$(window.location.pathname.split("/")).get(-1),t=$("#previewimagereview"),a=$("#photoReview");$(".tab_reviews").on("click",(function(){$.ajax({method:"GET",url:"/api/projectreviewsconfig/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},success:function(e){var t=e.data;localStorage.setItem("reviews_config_icon_type",t.reviews_config_icon_type),localStorage.setItem("reviews_config_icon_color",t.reviews_config_icon_color)}}),t.imgAreaSelect({remove:!0}),r(),$(this).off()}));var n=t;a.off().on("change",(function(){var e=new FileReader;e.readAsDataURL(document.getElementById("photoReview").files[0]),e.onload=function(e){n.attr("src",e.target.result).fadeIn(),n.on("load",(function(){var e,a,n,o,r=document.getElementById("previewimagereview");r.naturalWidth>r.naturalHeight?(n=Math.floor(r.naturalHeight/100*10),o=r.naturalHeight-Math.floor(r.naturalHeight/100*10),a=(e=Math.floor(r.naturalWidth/2)-Math.floor((o-n)/2))+(o-n)):r.naturalWidth<r.naturalHeight?(e=Math.floor(r.naturalWidth/100*10),a=r.naturalWidth-Math.floor(r.naturalWidth/100*10),o=(n=Math.floor(r.naturalHeight/2)-Math.floor((a-e)/2))+(a-e)):(e=Math.floor(r.naturalWidth/100*10),a=r.naturalWidth-Math.floor(r.naturalWidth/100*10),n=Math.floor(r.naturalHeight/100*10),o=r.naturalHeight-Math.floor(r.naturalHeight/100*10)),$("#photo_x1").val(e),$("#photo_y1").val(n),$("#photo_w").val(a-e),$("#photo_h").val(o-n),t.imgAreaSelect({x1:e,y1:n,x2:a,y2:o,aspectRatio:"1:1",handles:!0,imageHeight:this.naturalHeight,imageWidth:this.naturalWidth,parent:$("#modal_content_review_form"),onSelectEnd:function(e,t){$("#photo_x1").val(t.x1),$("#photo_y1").val(t.y1),$("#photo_w").val(t.width),$("#photo_h").val(t.height)}})}))}})),t.on("click",(function(){a.click()}));var o=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=localStorage.getItem("reviews_config_icon_type")||"star",o="star"===n?"fa fa-".concat(n,"-half-o"):"fa fa-".concat(n),r=$(e);r.off(),r.html(""),r.css({color:localStorage.getItem("reviews_config_icon_color")}),r.raty({half:!0,readOnly:a,starType:"i",score:t,starHalf:o,starOff:"fa fa-".concat(n,"-o"),starOn:"fa fa-".concat(n),scoreName:"stars"})};function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a="/api/projectreviews";null!=t&&(a+=t),loadOnTable("#data-table-reviews","#table-reviews"),$("#tab_project_reviews").find(".no-gutters").css("display","none"),$("#table-reviews").find("thead").css("display","none"),$.ajax({method:"GET",url:a,dataType:"json",data:{project_id:e},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#table-reviews").addClass("table-striped");var t=$("#data-table-reviews");if(t.html(""),""==e.data)t.html("\n                        <tr class='text-center'>\n                            <td colspan='11' style='height: 70px;vertical-align: middle'>\n                                <div class='d-flex justify-content-center align-items-center'>\n                                    <img src='/modules/global/img/empty-state-table.svg' style='margin-right: 60px;'>\n                                    <div class='text-left'>\n                                        <h1 style='font-size: 24px; font-weight: normal; line-height: 30px; margin: 0; color: #636363;'>Nenhum review configurado</h1>\n                                        <p style='font-style: normal; font-weight: normal; font-size: 16px; line-height: 20px; color: #9A9A9A;'>Cadastre o seu primeiro review para poder\n                                        <br>gerenci√°-los nesse painel.</p>\n                                        <button type='button' style='width: auto; height: auto; padding: .429rem 1rem !important;' class='btn btn-primary add-review' data-toggle=\"modal\" data-target=\"#modal_review\">Adicionar review</button>\n                                    </div>\n                                </div>\n                            </td>\n                        </tr>\n                    ");else{var a="";$("#tab_project_reviews").find(".no-gutters").css("display","flex"),$("#table-reviews").find("thead").css("display","contents"),$("#count-project-reviews").html(e.meta.total),$.each(e.data,(function(e,n){a='\n                        <tr>\n                            <td>\n                                <img src="'.concat(n.photo||"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/user-default.png",'"\n                                class="img-fluid rounded-circle mr-2" width="35" height="35">\n                                ').concat(n.name,"\n                            </td>\n                            <td>").concat(n.description.substring(0,50),'...</td>\n                            <td>\n                                <div id="stars-').concat(n.id,'" data-score="').concat(n.stars,"\"></div>\n                            </td>\n                            <td class='text-center'>").concat(n.active_flag?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>',"</td>\n                            <td style='text-align:center'>\n                                <div class='d-flex justify-content-end align-items-center'>\n                                    <a role='button' title='Visualizar' class='mg-responsive details-review pointer' data-review=\"").concat(n.id,"\" data-target='#modal-detail-review' data-toggle='modal'><span class=\"o-eye-1\"></span></a>\n                                    <a role='button' title='Editar' class='pointer edit-review mg-responsive' data-review=\"").concat(n.id,"\"><span class='o-edit-1'></span></a>\n                                    <a role='button' title='Excluir' class='pointer delete-review mg-responsive' data-review=\"").concat(n.id,'" data-toggle="modal" data-target="#modal-delete-review"><span class=\'o-bin-1\'></span></a>\n                                </div>\n                            </td>\n                        </tr>\n                        '),t.append(a),o("#stars-"+n.id)})),$(".div-config").show(),pagination(e,"review",r)}}})}$(document).on("click",".add-review",(function(){$("#modal_review .modal-title").html("Novo review"),$(".bt-review-save").show(),$(".bt-review-update").hide();var e=$("#form_review");e.trigger("reset"),e.find("#name").val(""),e.find("#description_review").val(""),e.find("#review_stars").html(""),e.find("#previewimagereview").attr("src","/modules/global/img/projeto.svg"),e.find("#review_apply_on_plans").val("").trigger("change"),o("#review_stars",5,!1),setTimeout((function(){t.imgAreaSelect({remove:!0})}),50)})),$(document).on("click",".bt-review-save",(function(){var a=$(".bt-review-save");a.attr("disabled","disabled");var n=new FormData(document.getElementById("form_review"));n.append("project_id",e),$.ajax({method:"POST",url:"/api/projectreviews",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:n,dataType:"json",error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal_review").modal("hide"),r(),alertCustom("success",e.message),$("#review_apply_on_plans").val(null).trigger("change")},complete:function(){t.imgAreaSelect({remove:!0}),a.attr("disabled",!1)}})})),$(document).on("click",".edit-review",(function(e){e.preventDefault();var a=$(this).data("review");$("#modal_review .modal-title").html("Editar review"),$(".bt-review-save").hide(),$(".bt-review-update").show();var n=$("#form_review");n.trigger("reset"),n.find("#name").val(""),n.find("#description_review").val(""),n.find("#review_stars").html(""),n.find(".review-id").val(a),n.find("#previewimagereview").attr("src","/modules/global/img/projeto.svg"),t.imgAreaSelect({remove:!0}),$.ajax({method:"GET",url:"/api/projectreviews/"+a+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){},success:function(e){var t=e.data;n.trigger("reset"),n.find("[name=name]").val(t.name),n.find("[name=description]").val(t.description),n.find("[name=active_flag]").val(t.active_flag),n.find("#previewimagereview").attr("src",t.photo||"/modules/global/img/projeto.svg"),n.find("#review_apply_on_plans").html("");var a,r=[],i=_createForOfIteratorHelper(t.apply_on_plans);try{for(i.s();!(a=i.n()).done;){var c=a.value;r.push(c.id),n.find("#review_apply_on_plans").append('<option value="'.concat(c.id,'">').concat(c.name+(c.description?" - "+c.description:""),"</option>"))}}catch(e){i.e(e)}finally{i.f()}n.find("#review_apply_on_plans").val(r).trigger("change"),o("#review_stars",t.stars,!1),$("#modal_review").modal("show"),setTimeout((function(){n.find("#previewimagereview").imgAreaSelect({remove:!0})}),300)}})})),$(document).on("click",".delete-review",(function(e){e.preventDefault();var t=$(this).data("review");$(".btn-delete-review").unbind("click"),$(".btn-delete-review").on("click",(function(){$.ajax({method:"DELETE",url:"/api/projectreviews/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){errorAjaxResponse(e)})),success:function(e){r(),alertCustom("success",e.message)}})}))})),$(document).on("click",".bt-review-update",(function(e){e.preventDefault();var a=$(".bt-review-update");a.attr("disabled","disabled");var n=new FormData(document.getElementById("form_review"));n.append("_method","PUT");var o=$("#form_review .review-id").val();$.ajax({method:"POST",url:"/api/projectreviews/"+o,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:n,error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal_review").modal("hide"),r(),alertCustom("success",e.message)},complete:function(){t.imgAreaSelect({remove:!0}),a.attr("disabled",!1)}})})),$(document).on("click",".details-review",(function(e){e.preventDefault();var t=$(this).data("review");$.ajax({method:"GET",url:"/api/projectreviews/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=e.data;$(".review-photo").attr("src",t.photo||"https://cloudfox-documents.s3.amazonaws.com/cloudfox/defaults/user-default.png"),$(".review-name").html(t.name),$(".review-description").html(t.description),$(".review-status").html("".concat(t.active_flag?'<span class="badge badge-success text-left">Ativo</span>':'<span class="badge badge-danger">Desativado</span>')),o(".preview-stars",t.stars);var a=$(".review-apply-plans");a.html("");var n,r=_createForOfIteratorHelper(t.apply_on_plans);try{for(r.s();!(n=r.n()).done;){var i=n.value;a.append("<span>".concat(i.name,"</span><br>"))}}catch(e){r.e(e)}finally{r.f()}}})})),$("#review_apply_on_plans").select2({placeholder:"Nome do plano",multiple:!0,dropdownParent:$("#modal_review"),language:{noResults:function(){return"Nenhum review encontrado"},searching:function(){return"Procurando..."},loadingMore:function(){return"Carregando mais reviews..."}},ajax:{data:function(t){return{list:"plan",search:t.term,project_id:e,page:t.page||1}},method:"GET",url:"/api/plans/user-plans",delay:300,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processResults:function(e){if("review_apply_on_plans"===this.$element.attr("id")&&1===e.meta.current_page){e.data.unshift({id:"all",name:"Qualquer plano",description:""})}return{results:$.map(e.data,(function(e){return{id:e.id,text:e.name+(e.description?" - "+e.description:"")}})),pagination:{more:e.meta.current_page!==e.meta.last_page}}}}}),$("#review_apply_on_plans").on("select2:select",(function(){var e=$(this);(e.val().length>1&&e.val().includes("all")||e.val().includes("all")&&"all"!==e.val())&&e.val("all").trigger("change")})),$(document).on("click","#config-review",(function(t){t.preventDefault(),$.ajax({method:"GET",url:"/api/projectreviewsconfig/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=e.data,a=$("#form_config_review");a.find("[name=reviews_config_icon_color]").val(t.reviews_config_icon_color),a.find("[name=reviews_config_icon_type][value="+t.reviews_config_icon_type+"]").prop("checked",!0),a.find("[name=reviews_config_icon_type]").parent(".radio-custom").find("i").css({color:t.reviews_config_icon_color});var n=a.find(".color-options > div");n.removeClass("active"),a.find(".color-options").find('[data-color="'+String(t.reviews_config_icon_color).toLowerCase()+'"]').addClass("active"),n.off().on("click",(function(){var e=$(this).data("color");a.find("[name=reviews_config_icon_color]").val(e),a.find("[name=reviews_config_icon_type]").parent(".radio-custom").find("i").css({color:e}),n.removeClass("active"),$(this).addClass("active")})),$("#modal_config_review").modal("show")}})})),$(document).on("click",".bt-review-config-update",(function(t){t.preventDefault();var a=new FormData(document.getElementById("form_config_review"));$.ajax({method:"POST",url:"/api/projectreviewsconfig/"+e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:a,error:function(e){errorAjaxResponse(e)},success:function(e){localStorage.setItem("reviews_config_icon_type",a.get("reviews_config_icon_type")),localStorage.setItem("reviews_config_icon_color",a.get("reviews_config_icon_color")),r(),alertCustom("success",e.message),$("#modal_config_review").modal("hide")}})})),$("#modal_review").on("hidden.bs.modal",(function(){t.imgAreaSelect({remove:!0}),t.trigger("fileselect",[1,""])}))}));
