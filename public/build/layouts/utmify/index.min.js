$(document).ready((function(){$(".company-navbar").change((function(){verifyIfCompanyIsDefault($(this).val())||($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").hide(),loadOnAny("#content"),updateCompanyDefault().done((function(n){getCompaniesAndProjects().done((function(n){t=n,e(!1)}))})))}));var t="";function e(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?loadingOnScreen():loadOnAny("#content");var n=!1;t.company_default_projects&&$.each(t.company_default_projects,(function(t,e){1==e.status&&(n=!0)})),n?$.ajax({method:"GET",url:"/api/apps/utmify?company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny("#content",!0),loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(n){if($("#project_id, #select_projects_edit").html(""),fillSelectProject(t,"#project_id, #select_projects_edit"),isEmpty(n.integrations))$("#no-integration-found").show();else{$("#content").html("");for(var o=n.integrations,a=0;a<o.length;a++)i=o[a],$("#content").append('\n            <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 integration-card" project="'.concat(i.id,'">\n                <div class="card shadow card-edit" style=\'cursor:pointer;\'>\n                    <div class="d-flex align-items-center justify-content-center">\n                        <img class="card-img-top img-fluid w-full" src="').concat(i.project_photo||"/build/global/img/produto.svg",'"\n                             onerror="this.onerror=null;this.src=\'/build/global/img/produto.svg\';"\n                             alt="').concat(i.project_name,'" />\n                    </div>\n                    <div class="card-body">\n                        <div class=\'row\'>\n                            <div class=\'col-md-10\'>\n                                <h4 class="card-title">').concat(i.project_name,'</h4>\n                                <p class="card-text sm">Criado em ').concat(i.created_at,"</p>\n                            </div>\n                            <div class='col-md-2'>\n                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' project=\"").concat(i.id,'">\n                                    <img src="/build/global/img/icon-trash-new.svg" />\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '));$("#no-integration-found").hide()}var i;$("#project-empty").hide(),$("#integration-actions").show(),e&&loadOnAny("#content",!0),loadingOnScreenRemove()}}):($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").show(),loadingOnScreenRemove(),loadOnAny("#content",!0))}getCompaniesAndProjects().done((function(n){t=n,e()})),$("#btn-add-integration").on("click",(function(){$(".modal-title").html("Adicionar nova Integração com Utmify"),$("#bt_integration").addClass("btn-save"),$("#bt_integration").removeClass("btn-update"),$("#bt_integration").text("Adicionar integração"),$("#modal_add_integracao").modal("show"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$("#token").val(""),$("#project_id, #select_projects_edit").prop("selectedIndex",0).change()})),$(document).on("click",".card-edit",(function(){var t=$(this).closest(".integration-card").attr("project");$.ajax({method:"GET",url:"/api/apps/utmify/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){var e=t.data;$("#select_projects_edit").val(e.project_id),$("#integration_id").val(e.id),$("#token_edit").val(e.token),$(".modal-title").html("Editar Integração com Utmify"),$("#bt_integration").addClass("btn-update").removeClass("btn-save").text("Atualizar"),$("#form_update_integration").show(),$("#form_add_integration").hide(),$("#modal_add_integracao").modal("show")}})})),$(document).on("click",".btn-save",(function(){if(""===$("#token").val())return alertCustom("error","Dados informados inválidos"),!1;var t=new FormData(document.getElementById("form_add_integration"));loadingOnScreen();(function(t,e){return new Promise((function(n,o){$.ajax({method:"POST",url:"/api/integrations",data:{description:t,company_id:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),o(t)},success:function(t){n(t)}})}))})("GR_Solucoes_Token",$(".company-navbar").val()).then((function(n){$.ajax({method:"POST",url:"/api/apps/utmify",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:t,error:function(t){errorAjaxResponse(t),loadingOnScreenRemove()},success:function(t){e(),loadingOnScreenRemove(),alertCustom("success",t.message)}})})).catch((function(t){loadingOnScreenRemove(),console.error("Erro ao executar storeIntegration:",t)}))})),$(document).on("click",".btnCopiarLinkToken",(function(){var t=$("<input>");$("body").append(t);var e=$("#token_edit").val();t.val(e).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Token copiado!")})),$(document).on("click",".btn-update",(function(){if(""===$("#token_edit").val())return alertCustom("error","Dados informados inválidos"),!1;var t=$("#integration_id").val(),n=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/utmify/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:n,error:function(t){errorAjaxResponse(t)},success:function(t){e(),alertCustom("success",t.message)}})})),$(document).on("click",".delete-integration",(function(t){t.stopPropagation();var e=$(this).attr("project");$("#modal-delete-integration .btn-delete").attr("project",e),$("#modal-delete-integration").modal("show")})),$(document).on("click","#modal-delete-integration .btn-delete",(function(t){t.stopPropagation();var n=$(this).attr("project");$.ajax({method:"DELETE",url:"/api/apps/utmify/"+n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$('.integration-card[project="'.concat(n,'"]')).remove(),e(),alertCustom("success",t.message)}})}))}));
