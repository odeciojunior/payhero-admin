$(function(){var t="";$(document).on("click",".contetation_file",function(){t=$(this).attr("contestation"),loadOnAny("#modal-contestationFiles"),$("#modal_contestation_files").modal("show"),$("#modal-contestationFiles").show(),$.ajax({method:"GET",url:"/api/contestations/"+t+"/contestation",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){$("#modal_contestation_files").modal("hide"),errorAjaxResponse(t)},success:function(t){$("#sale_hash").html(t.data.sale_code),$("#contestation").html(t.data.sale_code),$("#payment-type").html(2===t.data.sale_payment_method?"Boleto":"Cartão "),$("#payday").html(t.data.sale_start_date),$("#company").html(t.data.company),$("#liberation").html(t.data.sale_release_date),$("#request_date").html(t.data.request_date),$("#reason").html(t.data.reason),$("#status-file").prop("checked",t.data.is_file_user_completed);var e='<select name="type" class="form-control" id="type">';t.data.files_types.forEach(function(t){e+='<option value="'.concat(t.id,'">').concat(t.option,"</option>")}),e+="</select>",$("#type-select").html(e),t.data.is_file_user_completed?$("#check-status-text").html(" Concluído").addClass("text-success"):$("#check-status-text").html(" Não concluído").removeClass("text-success"),$("#latest_files").html(""),t.data.files.length>10?$("#sendfilesform").hide():$("#sendfilesform").show(),$.each(t.data.files,function(t,e){var a='<tr id="'.concat(e.id,'">\n                        <td>\n                            ').concat(e.type_str,'\n                        </td>\n                        <td>\n                              <a href="').concat(e.file,'" target="_blank">Arquivo</a>\n                        </td>\n                        <td>\n                            ').concat(e.created_at,'\n                        </td>\n                         <td>\n                             <button type="button" title="Apagar arquivo" data-removeroute="').concat(e.remove_route,'" class="btn btn-danger btn-remove-file"  data-contestationfile="').concat(e.id,'"><i class="fa fa-trash-o"></i></button>\n                        </td>\n                     </tr>');$("#latest_files").append(a)})},complete:function(t){loadOnAny("#modal_contestation_files",!0)}})}),$("#sendfilesform").on("submit",function(e){e.preventDefault(),$("#btn-send-file").prop("disabled",!0),loadOnAny("#latest_files");var a=new FormData($("#sendfilesform")[0]);$('input[type="file"]').on("change",function(t){[].forEach.call(this.files,function(t){a.append("files[]",t)})});var n=$("#sendfilesform").attr("action");a.append("contestation",t),a.append("type",$("#type").val()),$('input[type="file"]').empty(),$("#filename").empty(""),$.ajax({type:"POST",data:a,url:n,contentType:!1,processData:!1,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},success:function(t){$("#latest_files").html(""),t.data.length>10?$("#sendfilesform").hide():$("#sendfilesform").show(),$.each(t.data,function(t,e){var a='<tr id="'.concat(e.id,'">\n                        <td>\n                            ').concat(e.type_str,'\n                        </td>\n                        <td>\n                            <a href="').concat(e.file,'" target="_blank">Arquivo</a>\n                        </td>\n                        <td>\n                            ').concat(e.created_at,'\n                        </td>\n                         <td>\n                            <button type="button" title="Apagar arquivo" data-removeroute="').concat(e.remove_route,'" class="btn btn-danger btn-remove-file"  data-contestationfile="').concat(e.id,'"><i class="fa fa-trash-o"></i></button>\n                        </td>\n                     </tr>');$("#latest_files").append(a)})},error:function(t){alertCustom("error","Erro ao enviar o arquivo, permitido apenas imagens com o limite máximo de 12MB")},complete:function(t){loadOnAny("#latest_files",!0),$("#btn-send-file").prop("disabled",!1)}})}),$(document).on("click","button.btn-remove-file",function(t){t.preventDefault(),$(this).prop("disabled",!0);var e=$(this).data("contestationfile"),a=$(this).data("removeroute");loadOnAny("#latest_files"),$.ajax({url:a,type:"GET",contentType:"application/json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},success:function(t){$("#"+e).remove(),$("#latest_files tr").length>10?$("#sendfilesform").hide():$("#sendfilesform").show()},error:function(t){alertCustom("error","Erro ao remover")},complete:function(t){loadOnAny("#latest_files",!0),$(this).prop("disabled",!1),alertCustom("success","Removido com sucesso")}})}),$(document).on("change",".check-status",function(){var e=!0;$(this).is(":checked")?(e=1,$("#check-status-text").html(" Concluído").addClass("text-success")):(e=2,$("#check-status-text").html(" Não concluído").removeClass("text-success")),$.ajax({method:"POST",url:"/api/contestations/update-is-file-completed",data:{file_is_completed:e,contestation_id:t},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t,e,a){alertCustom("success",t.message)}})}),loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)?($("#page_header").hide(),$("#project-not-empty").hide(),$("#project-empty").show()):($("#project-empty").hide(),$("#project-not-empty").show(),$("#page_header").show()),loadingOnScreenRemove()}});var e=document.querySelector("input[type=file]"),a=document.querySelector("#filename"),n=document.querySelector("div");e.addEventListener("change",function(){a.innerText=e.value.split("\\").pop()}),e.addEventListener("dragenter",function(){n.classList.add("dragover")}),e.addEventListener("dragleave",function(){n.classList.remove("dragover")})});
