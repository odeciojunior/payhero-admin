$(document).ready((function(){$(".company-navbar").change((function(){verifyIfCompanyIsDefault($(this).val())||(loadOnAny("#page-integrates"),updateCompanyDefault().done((function(e){getCompaniesAndProjects().done((function(e){t=e,$(".company_name").val(t.company_default_fullname),$("#content-error").css("display","none"),$("#content-script").css("display","none"),$("#card-table-integrate").css("display","none"),$("#pagination-integrates").css("display","none"),$.ajax({method:"GET",url:"/api/integrations?resume=true&page=1&company_id="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),loadOnAny("#page-integrates",!0)},success:function(t){isEmpty(t.data)?($(".page-header").find(".store-integrate").css("display","none"),$("#content-error").find(".store-integrate").css("display","block"),$("#content-error").css("display","block"),$("#content-script").css("display","none"),$("#card-table-integrate").css("display","none"),$("#card-integration-data").css("display","none")):($(".page-header").find(".store-integrate").css("display","block"),$("#content-error").find(".store-integrate").css("display","none"),$("#content-error").hide(),o(t),c(t,"integrates")),i(),s(),r(),loadOnAny("#page-integrates",!0)}})}))})))}));var t="";getCompaniesAndProjects().done((function(e){t=e,$(".company_name").val(t.company_default_fullname),a(),$(".store-integrate").unbind(),$(".store-integrate").on("click",(function(){loadingOnScreenRemove(),$("#btn-save-integration").unbind(),$("#btn-save-integration").on("click",(function(){var t=$("#modal-integrate").find("input[name='description']").val(),e=$("#select-enum-list").val(),n=$("#modal-integrate").find("input[name='postback']").val(),o=$(".company-navbar").val();""==t?alertCustom("error","O campo Descrição é obrigatório"):o||4!=e?4==e&&""==n?alertCustom("error","O campo Postback é obrigatório para a integração Checkout API"):(loadingOnScreen(),function(t,e,n,o){$.ajax({method:"POST",url:"/api/integrations",data:{description:t,token_type_enum:e,postback:n,company_id:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){$(".close").click(),alertCustom("success","Integração criada com sucesso!"),loadingOnScreenRemove(),a()}})}(t,e,n,o)):alertCustom("error","O campo Empresa é obrigatório para a integração Checkout API")})),$("#modal-integrate").modal("show")}))}));var e={external:"Integração externa",checkout_api:"Checkout API"},n={admin:"default",personal:"default",external:"success",checkout_api:"primary"};function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;loadingOnScreen(),$.ajax({method:"GET",url:"/api/integrations?resume=true&page="+t+"&company_id="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)?(c(t,"integrates"),$(".page-header").find(".store-integrate").css("display","none"),$("#content-error").find(".store-integrate").css("display","block"),$("#content-error").css("display","block"),$("#content-script").css("display","none"),$("#card-table-integrate").css("display","none"),$("#card-integration-data").css("display","none")):($(".page-header").find(".store-integrate").css("display","block"),$("#content-error").find(".store-integrate").css("display","none"),$("#content-error").hide(),o(t),c(t,"integrates")),i(),s(),r(),loadingOnScreenRemove()}})}function o(t){$("#content-script").css("display","block"),$("#card-table-integrate").css("display","block"),$("#card-integration-data").css("display","block"),$("#card-table-integrate").css("display","block"),$("#table-body-integrates").html(""),t.data.length>0&&-1!=t.data.findIndex((function(t){return"checkout_api"==t.integration_type}))?($("#content-script").show(),$("#input-url-antifraud").val(t.data[0].antifraud_url)):($("#content-script").hide(),$("#input-url-antifraud").val("")),$.each(t.data,(function(t,a){var o="active"!==a.status?" disabled":"";dados="",dados+="<tr>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+a.description+"</p>",dados+='<small class="text-muted">Criada em '+a.register_date+"</small>",dados+="</td>",dados+='<td class="text-center">',dados+='<span class="badge badge-'+n[a.integration_type]+' text-center">'+e[a.integration_type]+"</span>",dados+="</td>",dados+='<td style="vertical-align: middle;">',dados+='<div class="input-group input-group-lg">',dados+='<input type="text" class="form-control font-sm brr inptToken" id="inputToken-'+a.id_code+'" value="'+a.access_token+'" disabled="disabled" style="background: #F1F1F1;">',dados+='<div class="input-group-append">',dados+='<button class="btn btn-primary bg-white btnCopiarLink" data-code="'+a.id_code+'" type="button" data-placement="top" data-toggle="tooltip" title="Copiar token" style="width: 48px; height: 48px;">',dados+='<img src="/build/global/img/icon-copy-b.svg">',dados+="</button>",dados+="</div>",dados+="</div>",dados+="</td>",dados+='<td class="text-center">',dados+='<button class="btn pointer edit-integration" style="background-color:transparent;" integration="'+a.id_code+'"'+o+' title="Editar integração"><span class=""><img src="/build/global/img/pencil-icon.svg"/></span></button>',dados+='<button class="btn pointer delete-integration" style="background-color:transparent;" integration="'+a.id_code+'"'+o+' title="Deletar token"><span class=""><img src="/build/global/img/icon-trash-tale.svg"/></span></button>',dados+="</td>",dados+="</tr>",$("#table-body-integrates").append(dados)})),$("#integrations_stored").html(""+t.resume.total),$("#integrations_active").html(""+t.resume.active),$("#posts_received").html(""+t.resume.received),$("#posts_sent").html(""+t.resume.sent)}function i(){$(".edit-integration").unbind("click"),$(".edit-integration").on("click",(function(){$("#modal-edit-integration").find('input[name="description"]').val(""),$("#modal-edit-integration").find('input[name="postback"]').val("");var t=$(this).attr("integration");$("#modal-edit-integration").modal("show"),$.ajax({method:"GET",url:"/api/integrations/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(e){isEmpty(e)?alertCustom("error","Erro ao obter dados da integração"):(4==e.token_type_enum?($("#modal-edit-integration").find('input[name="postback"]').val(e.postback),$("#modal-edit-integration").find(".postback-container").show()):($("#modal-edit-integration").find(".postback-container").hide(),$("#modal-edit-integration").find('input[name="postback"]').val("")),$("#modal-edit-integration").find('input[name="description"]').val(e.description),$("#modal-edit-integration").find('input[name="token_type_enum"]').val(e.token_type_enum),function(t){$("#btn-edit-integration").unbind("click"),$("#btn-edit-integration").on("click",(function(){var e=$("#modal-edit-integration").find('input[name="description"]').val(),n=$("#modal-edit-integration").find('input[name="token_type_enum"]').val(),o=$("#modal-edit-integration").find('input[name="postback"]').val();loadingOnScreen(),$.ajax({method:"PUT",url:"api/integrations/"+t,data:{description:e,postback:o,token_type_enum:n},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){$(".close").click(),loadingOnScreenRemove(),a(),alertCustom("success",t.message)}})}))}(t))}})}))}function s(){$(".refresh-integration").unbind("click"),$(".refresh-integration").on("click",(function(){var t=$(this).attr("integration"),e="api/integrations/"+t+"/refreshtoken";$("#modal-refresh-integration").modal("show"),$("#btn-refresh-integration").unbind("click"),$("#btn-refresh-integration").on("click",(function(){loadingOnScreen(),$.ajax({method:"POST",url:e,data:{integrationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),a(),alertCustom("success",t.message)}})}))}))}function r(){$(".delete-integration").unbind("click"),$(".delete-integration").on("click",(function(){var t=$(this).attr("integration"),e="api/integrations/"+t;$("#modal-delete-integration").modal("show"),$("#btn-delete-integration").unbind("click"),$("#btn-delete-integration").on("click",(function(){loadingOnScreen(),$.ajax({method:"DELETE",url:e,data:{integrationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),a(),alertCustom("success",t.message)}})}))}))}function c(t,e){if(1==t.meta.last_page)$("#pagination-integrates").css({background:"#f4f4f4"}),$("#primeira_pagina_"+e).hide(),$("#ultima_pagina_"+e).hide();else{$("#pagination-"+e).html("");for($("#pagination-"+e).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==t.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){a(1)})),x=3;x>0;x--)t.meta.current_page-x<=1||($("#pagination-"+e).append("<button id='page_"+(t.meta.current_page-x)+"' class='btn nav-btn'>"+(t.meta.current_page-x)+"</button>"),$("#page_"+(t.meta.current_page-x)).on("click",(function(){a($(this).html())})));if(1!=t.meta.current_page&&t.meta.current_page!=t.meta.last_page){var n="<button id='current_page' class='btn nav-btn active'>"+t.meta.current_page+"</button>";$("#pagination-"+e).append(n),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)t.meta.current_page+x>=t.meta.last_page||($("#pagination-"+e).append("<button id='page_"+(t.meta.current_page+x)+"' class='btn nav-btn'>"+(t.meta.current_page+x)+"</button>"),$("#page_"+(t.meta.current_page+x)).on("click",(function(){a($(this).html())})));if("1"!=t.meta.last_page){var o="<button id='last_page' class='btn nav-btn'>"+t.meta.last_page+"</button>";$("#pagination-"+e).append(o),t.meta.current_page==t.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){a(t.meta.last_page)}))}}}$(document).on("click",".btnCopiarLink",(function(){var t=$("<input>");$("body").append(t);var e=$(this).data("code"),n=$("#inputToken-"+e).val();t.val(n).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Token copiado!")})),$(document).on("click",".btnCopiarLinkAntifraud",(function(){var t=$("<input>");$("body").append(t);var e=$("#input-url-antifraud").val();t.val(e).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Antifraud URL copiada!")})),$("#select-enum-list").on("change",(function(t){var e=t.target.value,n=$(".companies-container"),a=$(".postback-container");$("#description").val(""),4==e?(n.addClass("d-flex").removeClass("d-none"),a.addClass("d-flex").removeClass("d-none")):(n.addClass("d-none").removeClass("d-flex"),a.addClass("d-none").removeClass("d-flex"))})),window.location.href.includes("#add_checkout_api")&&($('select[name="token_type_enum"]').val(4).change(),$("#modal-integrate").modal("show"))}));
