$(document).ready(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").hide(),loadOnAny("#content"),updateCompanyDefault().done(function(n){getCompaniesAndProjects().done(function(n){e=n,t("n")})}))});var e="";function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";"y"==t?loadingOnScreen():loadOnAny("#content"),$hasProjects=!1,e.company_default_projects&&$.each(e.company_default_projects,function(e,t){1==t.status&&($hasProjects=!0)}),$hasProjects?$.ajax({method:"GET",url:"/api/apps/geradorrastreio?company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadOnAny("#content",!0),loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(o){if($("#project_id, #select_projects_edit").html(""),fillSelectProject(e,"#project_id, #select_projects_edit"),isEmpty(o.integrations))$("#no-integration-found").show();else{$("#content").html("");for(var a=o.integrations,i=0;i<a.length;i++)n(a[i]);$("#no-integration-found").hide()}$("#project-empty").hide(),$("#integration-actions").show(),"y"==t&&loadOnAny("#content",!0),loadingOnScreenRemove()}}):($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").show(),loadingOnScreenRemove(),loadOnAny("#content",!0))}function n(e){$("#content").append('\n        \n        <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 integration-card" project="'.concat(e.id,'">\n            <div class="card shadow card-edit" style=\'cursor:pointer;\'>\n\n                <div class="d-flex align-items-center justify-content-center"   >\n                <img class="card-img-top img-fluid w-full" src=')+e.project_photo+' onerror="this.onerror=null;this.src=\'/build/global/img/produto.svg\';" alt="'+e.project_name+'"/>\n                </div>\n\n\n                                    <div class="card-body">\n                                        <div class=\'row\'>\n                                            <div class=\'col-md-10\'>\n                                                <h4 class="card-title">'+e.project_name+'</h4>\n                                                <p class="card-text sm">Criado em '+e.created_at+"</p>\n                                            </div>\n                                            <div class='col-md-2'>\n                                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' project="+e.id+'>\n                                                    <img src="/build/global/img/icon-trash-new.svg" />\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ')}getCompaniesAndProjects().done(function(n){e=n,t()}),$(".check").on("click",function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)}),$("#btn-add-integration").on("click",function(){$(".modal-title").html("Adicionar nova Integração com GR Soluções"),$("#bt_integration").addClass("btn-save"),$("#bt_integration").removeClass("btn-update"),$("#bt_integration").text("Adicionar integração"),$("#modal_add_integracao").modal("show"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$("#clientid").val(""),$("#credit_flag").prop("checked",!0).val(1),$("#credit_flag_edit").prop("checked",!0).val(1),$("#pix_flag").prop("checked",!1).val(0),$("#pix_flag_edit").prop("checked",!1).val(0),$("#billet_flag_edit").prop("checked",!1).val(0),$("#billet_flag_edit").prop("checked",!1).val(0),$("#project_id, #select_projects_edit").prop("selectedIndex",0).change()}),$(document).on("click",".card-edit",function(){$(".modal-title").html("Editar Integração com GR Soluções"),$("#bt_integration").addClass("btn-update"),$("#bt_integration").removeClass("btn-save"),$("#bt_integration").text("Atualizar"),$("#form_update_integration").show(),$("#form_add_integration").hide(),$("#modal_add_integracao").modal("show");var e=$(this).closest(".integration-card").attr("project");$.ajax({method:"GET",url:"/api/apps/geradorrastreio/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t=e.data;$("#select_projects_edit").val(t.project_id),$("#integration_id").val(t.id),$("#clientid_edit").val(t.clientid),$("#token_edit").val(t.token),$("#webhook_url_edit").val(t.webhook_url),$("#credit_flag_edit").val(t.credit_flag).prop("checked",1==t.credit_flag),$("#pix_flag_edit").val(t.pix_flag).prop("checked",1==t.pix_flag),$("#billet_flag_edit").val(t.billet_flag).prop("checked",1==t.billet_flag)}})}),$(document).on("click",".btn-save",function(){if(""==$("#clientid").val())return alertCustom("error","Dados informados inválidos 1"),!1;var e=new FormData(document.getElementById("form_add_integration"));loadingOnScreen();(function(e,t){return new Promise(function(n,o){$.ajax({method:"POST",url:"/api/integrations",data:{description:e,company_id:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){n(e)}})})})("GR_Solucoes",$(".company-navbar").val()).then(function(n){$.ajax({method:"POST",url:"/api/apps/geradorrastreio",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:e,error:function(e){errorAjaxResponse(e),loadingOnScreenRemove()},success:function(e){t(),loadingOnScreenRemove(),alertCustom("success",e.message)}})}).catch(function(e){loadingOnScreenRemove(),console.error("Erro ao executar storeIntegration:",e)})}),$(document).on("click",".btnCopiarLinkToken",function(){var e=$("<input>");$("body").append(e);var t=$("#token_edit").val();e.val(t).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Token copiado!")}),$(document).on("click",".btn-update",function(){if(""==$("#clientid_edit").val())return alertCustom("error","Dados informados inválidos 3"),!1;var e=$("#integration_id").val(),n=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/geradorrastreio/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:n,error:function(e){errorAjaxResponse(e)},success:function(e){t(),alertCustom("success",e.message)}})}),$(document).on("click",".delete-integration",function(e){e.stopPropagation();var t=$(this).closest(".integration-card").attr("project");$("#modal-delete-integration .btn-delete").attr("project",t),$("#modal-delete-integration").modal("show")}),$(document).on("click","#modal-delete-integration .btn-delete",function(e){e.stopPropagation();var n=$(this).attr("project");$.ajax({method:"DELETE",url:"/api/apps/geradorrastreio/"+n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$('.integration-card[project="'.concat(n,'"]')).remove(),t(),alertCustom("success",e.message)}})})});
