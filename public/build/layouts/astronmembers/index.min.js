function _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }

function _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

$('#company-navbar').change(function () {
  if (verifyIfCompanyIsDefault()) return;
  updateCompanyDefault().done(function (data1) {
    getCompaniesAndProjects().done(function (data2) {
      window.index('n');
    });
  });
});
$(document).ready(function () {
  window.index = function () {
    var loading = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'y';
    if (loading == 'y') loadingOnScreen();else loadOnAny('#content');
    $.ajax({
      method: "GET",
      url: "/api/apps/astronmembers?company=" + $('#company-navbar').val(),
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        loadOnAny('#content', true);
        loadingOnScreenRemove();
        errorAjaxResponse(response);
      },
      success: function success(response) {
        $("#content").html("");

        if (isEmpty(response.projects)) {
          $("#project-empty").show();
          $("#integration-actions").hide();
        } else {
          $("#project_id").html("");
          var projects = response.projects; // for (let i = 0; i < projects.length; i++) {
          //     $("#project_id").append(
          //         '<option value="' +
          //             projects[i].id +
          //             '">' +
          //             projects[i].name +
          //             "</option>"
          //     );
          // }

          var _iterator = _createForOfIteratorHelper(response.projects),
              _step;

          try {
            for (_iterator.s(); !(_step = _iterator.n()).done;) {
              var project = _step.value;
              $("#project_id, #select_projects_edit").append("<option value=\"".concat(project.id, "\">").concat(project.name, "</option>"));
            }
          } catch (err) {
            _iterator.e(err);
          } finally {
            _iterator.f();
          }

          if (isEmpty(response.integrations)) {
            $("#no-integration-found").show();
          } else {
            $("#content").html("");
            var integrations = response.integrations;

            for (var i = 0; i < integrations.length; i++) {
              renderIntegration(integrations[i]);
            }

            $("#no-integration-found").hide();
          }

          $("#project-empty").hide();
          $("#integration-actions").show();
        }

        if (loading == 'y') loadingOnScreenRemove();else loadOnAny('#content', true);
      }
    });
  };

  getCompaniesAndProjects().done(function (data) {
    window.index();
  }); //checkbox

  $(".check").on("click", function () {
    if ($(this).is(":checked")) {
      $(this).val(1);
    } else {
      $(this).val(0);
    }
  }); //reset the intergation modal

  function clearForm() {
    $(":text").val("");
    $(":checkbox").prop("checked", true).val(1);
    $("#project_id").prop("selectedIndex", 0).change();
  } //draw the integration cards


  function renderIntegration(data) {
    $("#content").append("\n                            <div class=\"col-sm-6 col-md-4 col-lg-3 col-xl-3\">\n                                <div class=\"card shadow card-edit\" project=" + data.id + " style='cursor:pointer;'>\n                                    <img class=\"card-img-top img-fluid w-full\" src=" + data.project_photo + " onerror=\"this.onerror=null;this.src='/build/global/img/produto.png';\" alt=\"" + data.project_name + "\"/>\n                                    <div class=\"card-body\">\n                                        <div class='row'>\n                                            <div class='col-md-10'>\n                                                <h4 class=\"card-title\">" + data.project_name + "</h4>\n                                                <p class=\"card-text sm\">Criado em " + data.created_at + "</p>\n                                            </div>\n                                            <div class='col-md-2'>\n                                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' project=" + data.id + ">\n                                                    <span class='o-bin-1 pointer'></span>\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ");
  } //create


  $("#btn-add-integration").on("click", function () {
    $(".modal-title").html("Adicionar nova Integração com Astron Members");
    $("#bt_integration").addClass("btn-save");
    $("#bt_integration").removeClass("btn-update");
    $("#bt_integration").text("Adicionar integração");
    $("#modal_add_integracao").modal("show");
    $("#form_update_integration").hide();
    $("#form_add_integration").show();
    clearForm();
  }); //edit

  $(document).on("click", ".card-edit", function () {
    $(".modal-title").html("Editar Integração com Astron Members");
    $("#bt_integration").addClass("btn-update");
    $("#bt_integration").removeClass("btn-save");
    $("#bt_integration").text("Atualizar");
    $("#form_update_integration").show();
    $("#form_add_integration").hide();
    $("#modal_add_integracao").modal("show");
    $.ajax({
      method: "GET",
      url: "/api/apps/astronmembers/" + $(this).attr("project"),
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        $("#select_projects_edit").val(response.data.project_id);
        $("#integration_id").val(response.data.id);
        $("#link_edit").val(response.data.link);
        $("#token_edit").val(response.data.token);
        $("#boleto_generated_edit").val(response.data.boleto_generated);
        $("#boleto_generated_edit").prop("checked", $("#boleto_generated_edit").val() == "1");
        $("#boleto_paid_edit").val(response.data.boleto_paid);
        $("#boleto_paid_edit").prop("checked", $("#boleto_paid_edit").val() == "1");
        $("#credit_card_refused_edit").val(response.data.credit_card_refused);
        $("#credit_card_refused_edit").prop("checked", $("#credit_card_refused_edit").val() == "1");
        $("#credit_card_paid_edit").val(response.data.credit_card_paid);
        $("#credit_card_paid_edit").prop("checked", $("#credit_card_paid_edit").val() == "1");
        $("#abandoned_cart_edit").val(response.data.abandoned_cart);
        $("#abandoned_cart_edit").prop("checked", $("#abandoned_cart_edit").val() == "1");
        $("#pix_generated_edit").val(response.data.pix_generated);
        $("#pix_generated_edit").prop("checked", $("#pix_generated_edit").val() == "1");
        $("#pix_paid_edit").val(response.data.pix_paid);
        $("#pix_paid_edit").prop("checked", $("#pix_paid_edit").val() == "1");
        $("#pix_expired_edit").val(response.data.pix_expired);
        $("#pix_expired_edit").prop("checked", $("#pix_expired_edit").val() == "1");
      }
    });
  }); //store

  $(document).on("click", ".btn-save", function () {
    if ($("#link").val() == "") {
      alertCustom("error", "Dados informados inválidos");
      return false;
    }

    var form_data = new FormData(document.getElementById("form_add_integration"));
    $.ajax({
      method: "POST",
      url: "/api/apps/astronmembers",
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      processData: false,
      contentType: false,
      cache: false,
      data: form_data,
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        window.index();
        alertCustom("success", response.message);
      }
    });
  }); //update

  $(document).on("click", ".btn-update", function () {
    if ($("#link_edit").val() == "") {
      alertCustom("error", "Dados informados inválidos");
      return false;
    }

    var integrationId = $("#integration_id").val();
    var form_data = new FormData(document.getElementById("form_update_integration"));
    $.ajax({
      method: "POST",
      url: "/api/apps/astronmembers/" + integrationId,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      processData: false,
      contentType: false,
      cache: false,
      data: form_data,
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        window.index();
        alertCustom("success", response.message);
      }
    });
  }); // load delete modal

  $(document).on("click", ".delete-integration", function (e) {
    e.stopPropagation();
    var project = $(this).attr("project");
    $("#modal-delete-integration .btn-delete").attr("project", project);
    $("#modal-delete-integration").modal("show");
  }); //destroy

  $(document).on("click", "#modal-delete-integration .btn-delete", function (e) {
    e.stopPropagation();
    var project = $(this).attr("project");
    $.ajax({
      method: "DELETE",
      url: "/api/apps/astronmembers/" + project,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        window.index();
        alertCustom("success", response.message);
      }
    });
  });
});
