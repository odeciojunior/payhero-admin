var statusInvite={1:"success",2:"pendente",3:"warning"},statusDocumentUser={pending:"Pendente",analyzing:"Em análise",approved:"Aprovado",refused:"Recusado"},disabledCompany=!1,companyVerification=!0;$(document).ready((function(){a();var t=1;function a(){loadingOnScreen();var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=0;o=null==o?"/api/invitations?company="+sessionStorage.getItem("company_default"):"/api/invitations"+o+"&company="+sessionStorage.getItem("company_default"),$.ajax({method:"GET",url:o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(o){isEmpty(o.data)?$("#content-error").show():($("#content-error").hide(),$("#card-table-invite").css("display","block"),$("#card-invitation-data").css("display","block"),$("#card-table-invite").css("display","block"),$("#table-body-invites").html(""),$.each(o.data,(function(a,n){dados="",dados+="<tr>",dados+=9!=a?'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+(t-1)+(i+=1)+"</button></td>":'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+o.meta.to+"</button></td>",dados+='<td class="text-center" style="vertical-align: middle;">'+n.email_invited+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+n.company_name+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">',dados+='<span class="badge badge-'+statusInvite[n.status]+' text-center">'+n.status_translated+"</span>",dados+="</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+n.register_date+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+n.expiration_date+"</td>","2"!=n.status||verifyAccountFrozen()?(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+n.id+"' disabled><span class='o-reload-1'></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+n.id+"' disabled><span class='o-bin-1'></span></button></td>"):(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+n.id+"'><span class='o-reload-1'></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+n.id+"'><span class='o-bin-1'></span></button></td>"),dados+="</tr>",$("#table-body-invites").append(dados)})),e(o,"invites")),n(),$(".resend-invitation").unbind("click"),$(".resend-invitation").on("click",(function(){var t=$(this).attr("invitation");$("#modal-resend-invitation").modal("show"),$("#btn-resend-invitation").unbind("click"),$("#btn-resend-invitation").on("click",(function(){loadingOnScreen(),$.ajax({method:"POST",url:"/api/invitations/resendinvitation",data:{invitationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),a(),alertCustom("success",t.message)}})}))})),$(".delete-invitation").unbind("click"),$(".delete-invitation").on("click",(function(){var t=$(this).attr("invitation");$("#modal-delete-invitation").modal("show"),$("#btn-delete-invitation").unbind("click"),$("#btn-delete-invitation").on("click",(function(){loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/invitations/"+t,data:{invitationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),a(),alertCustom("success",t.message)}})}))})),loadingOnScreenRemove()}})}function n(){$.ajax({method:"GET",url:"/api/invitations/getinvitationdata?company="+sessionStorage.getItem("company_default"),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){$("#invitations_accepted").html(""+t.data.invitation_accepted_count),$("#invitations_sent").html(""+t.data.invitation_sent_count);var a=t.data.commission_paid.split(/\s/g);$("#commission_paid").html(a[0]+' <strong class="font-size-30">'+a[1]+"</strong>");var n=t.data.commission_pending.split(/\s/g);$("#commission_pending").html(n[0]+' <strong class="font-size-30">'+n[1]+"</strong>"),$("#invitations_amount").html(""+t.data.invitations_available),verifyAccountFrozen()&&$("#store-invite").attr("disabled",!0)}})}function e(n,e){if(1==n.meta.last_page)$("#pagination-"+e).html(""),$("#primeira_pagina_"+e).hide(),$("#ultima_pagina_"+e).hide();else{$("#pagination-"+e).html("");for($("#pagination-"+e).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==n.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){t=1,a("?page=1")})),x=3;x>0;x--)n.meta.current_page-x<=1||($("#pagination-"+e).append("<button id='page_"+(n.meta.current_page-x)+"' class='btn nav-btn'>"+(n.meta.current_page-x)+"</button>"),$("#page_"+(n.meta.current_page-x)).on("click",(function(){t=$(this).html(),a("?page="+$(this).html())})));if(1!=n.meta.current_page&&n.meta.current_page!=n.meta.last_page){var o="<button id='current_page' class='btn nav-btn active'>"+n.meta.current_page+"</button>";$("#pagination-"+e).append(o),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)n.meta.current_page+x>=n.meta.last_page||($("#pagination-"+e).append("<button id='page_"+(n.meta.current_page+x)+"' class='btn nav-btn'>"+(n.meta.current_page+x)+"</button>"),$("#page_"+(n.meta.current_page+x)).on("click",(function(){t=$(this).html(),a("?page="+$(this).html())})));if("1"!=n.meta.last_page){var i="<button id='last_page' class='btn nav-btn'>"+n.meta.last_page+"</button>";$("#pagination-"+e).append(i),n.meta.current_page==n.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){t=$(this).html(),a("?page="+n.meta.last_page)}))}}}$("#store-invite").unbind(),$("#store-invite").on("click",(function(){$.ajax({method:"GET",url:"/api/core/companies",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){if(companyVerification)if(isEmpty(t.data))loadingOnScreenRemove(),$("#modal-then-companies").hide(),$("#modal-not-approved-document-companies").hide(),$("#modal-not-companies").show();else{loadingOnScreenRemove();var n=0,e=0,o="";if(o='<select id="select-company-list" class="sirius-select">',disabledCompany=!1,$.each(t.data,(function(t,a){n++,companyIsApproved(a)?"physical person"===a.type_company?"Aprovado"!==statusDocumentUser[a.user_address_document_status]||"Aprovado"!==statusDocumentUser[a.user_personal_document_status]||"Aprovado"!==a.bank_document_translate?(disabledCompany=!1,e++,o+="<option value=".concat(a.id_code," disabled> ").concat(a.fantasy_name,"  </option>")):o+="<option value=".concat(a.id_code," >  ").concat(a.fantasy_name,"  </option>"):"juridical person"===a.type_company&&("Aprovado"!==a.address_document_translate||"Aprovado"!==a.bank_document_translate||"Aprovado"!==a.contract_document_translate||"Aprovado"!==statusDocumentUser[a.user_address_document_status]||"Aprovado"!==statusDocumentUser[a.user_personal_document_status]?(disabledCompany=!1,e++,o+="<option value=".concat(a.id_code," disabled> ").concat(a.fantasy_name,"  </option>")):o+="<option value=".concat(a.id_code," >  ").concat(a.fantasy_name,"  </option>")):e++})),o+="</select>",n===e)$("#modal-then-companies").hide(),$("#modal-not-companies").hide(),$("#modal-not-approved-document-companies").show();else{$("#modal-not-companies").hide(),$("#modal-not-approved-document-companies").hide(),$("#modal-then-companies").show(),$("#modal-reverse-title").html("Novo Convite"),$("#company-list").html("").append(o);var i="",s=sessionStorage.getItem("company_default");i="https://accounts.cloudfox.net/signup?i="+s,$("#invite-link").val(i),$("#select-company-list").on("change",(function(){i="https://accounts.cloudfox.net/signup?i="+$(this).val(),$("#invite-link").val(i),s=$(this).val()})),$("#copy-link").on("click",(function(){document.getElementById("invite-link").select(),document.execCommand("copy"),alertCustom("success","Link copiado!")})),$("#btn-send-invite").unbind(),$("#btn-send-invite").on("click",(function(){var t=$("#email").val();""==t?alertCustom("error","O campo Email do convidado é obrigatório"):""==s?alertCustom("error","O campo Empresa para receber é obrigatório"):(loadingOnScreen(),function(t,n){console.log(t),console.log(n),$.ajax({method:"POST",url:"/api/invitations",data:{email:t,company:n},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){$(".close").click(),alertCustom("success",t.message),loadingOnScreenRemove(),a()}})}(t,s))}))}}else $("#modal-not-invites-today").show()}}),$("#modal-invite").modal("show")})),$(".company_name").val(sessionStorage.getItem("company_default_name"))}));
