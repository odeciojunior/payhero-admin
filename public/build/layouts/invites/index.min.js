var statusInvite={1:"success",2:"pendente",3:"warning"},statusDocumentUser={pending:"Pendente",analyzing:"Em análise",approved:"Aprovado",refused:"Recusado"},disabledCompany=!1,companyVerification=!0;$(document).ready(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||($("#content-error").hide(),$("#store-invite").attr("disabled","disabled"),loadOnTable("#table-body-invites","#table_invites"),loadOnAny(".number",!1,{styles:{container:{minHeight:"32px",height:"auto"},loader:{width:"20px",height:"20px",borderWidth:"4px"}}}),updateCompanyDefault().done(function(n){getCompaniesAndProjects().done(function(n){t=n,$("#store-invite").removeAttr("disabled"),$(".company_name").val(t.company_default_fullname),e(),function(){loadOnTable("#table-body-invites","#table_invites"),loadOnAny(".number",!1,{styles:{container:{minHeight:"32px",height:"auto"},loader:{width:"20px",height:"20px",borderWidth:"4px"}}});var t=0;$.ajax({method:"GET",url:"/api/invitations?company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(n){isEmpty(n.data)?($("#card-table-invite").hide(),$("#table_invites").hide(),$("#content-error").show()):($("#content-error").hide(),$("#table_invites").show(),$("#card-table-invite").css("display","block"),$("#card-invitation-data").css("display","block"),$("#card-table-invite").css("display","block"),$("#table-body-invites").html(""),$.each(n.data,function(e,i){dados="",dados+="<tr>",dados+=9!=e?'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+(a-1)+(t+=1)+"</button></td>":'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+n.meta.to+"</button></td>",dados+='<td class="text-center" style="vertical-align: middle;">'+i.email_invited+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+i.company_name+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">',dados+='<span class="badge badge-'+statusInvite[i.status]+' text-center">'+i.status_translated+"</span>",dados+="</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+i.register_date+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+i.expiration_date+"</td>","2"!=i.status||verifyAccountFrozen()?(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+i.id+"' disabled><span class='o-reload-1'></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+i.id+"' disabled><span class='o-bin-1'></span></button></td>"):(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+i.id+"'><span class='o-reload-1'></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+i.id+"'><span class='o-bin-1'></span></button></td>"),dados+="</tr>",$("#table-body-invites").append(dados)}),i(n,"invites")),loadingOnScreenRemove()}})}()})}))});var t="";getCompaniesAndProjects().done(function(a){t=a,$(".company_name").val(t.company_default_fullname),n()});var a=1;function n(){loadingOnScreen();var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=0;t=null==t?"/api/invitations?company="+$(".company-navbar").val():"/api/invitations"+t+"?company="+$(".company-navbar").val(),$.ajax({method:"GET",url:t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){isEmpty(t.data)?(i(t,"invites"),$("#content-error").show()):($("#content-error").hide(),$("#card-table-invite").css("display","block"),$("#card-invitation-data").css("display","block"),$("#card-table-invite").css("display","block"),$("#table-body-invites").html(""),$.each(t.data,function(n,e){dados="",dados+="<tr>",dados+=9!=n?'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+(a-1)+(o+=1)+"</button></td>":'<td class="" style="vertical-align: middle;"><button class="btn btn-floating btn-primary btn-sm" disabled>'+t.meta.to+"</button></td>",dados+='<td class="text-center ellipsis-text" style="vertical-align: middle;">'+e.email_invited+"</td>",dados+='<td class="text-center ellipsis-text" style="vertical-align: middle;">'+e.company_name+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">',dados+='<span class="badge badge-'+statusInvite[e.status]+' text-center">'+e.status_translated+"</span>",dados+="</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+e.register_date+"</td>",dados+='<td class="text-center" style="vertical-align: middle;">'+e.expiration_date+"</td>","2"!=e.status||verifyAccountFrozen()?(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+e.id+"' disabled><span class=''><img src='/build/global/img/icons-cashback.svg'/></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+e.id+"' disabled><span class=''><img src='/build/global/img/icon-trash-tale.svg'/></span></button></td>"):(dados+="<td><button class='btn pointer resend-invitation' title='Reenviar convite' style='background-color:transparent;' invitation='"+e.id+"'><span class=''><img src='/build/global/img/icons-cashback.svg'/></span></button></td>",dados+="<td><button class='btn pointer delete-invitation' title='Excluir' style='background-color:transparent;' invitation='"+e.id+"'><span class=''><img src='/build/global/img/icon-trash-tale.svg'/></span></button></td>"),dados+="</tr>",$("#table-body-invites").append(dados)}),i(t,"invites")),e(),$(".resend-invitation").unbind("click"),$(".resend-invitation").on("click",function(){var t=$(this).attr("invitation");$("#modal-resend-invitation").modal("show"),$("#btn-resend-invitation").unbind("click"),$("#btn-resend-invitation").on("click",function(){loadingOnScreen(),$.ajax({method:"POST",url:"/api/invitations/resendinvitation",data:{invitationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),n(),alertCustom("success",t.message)}})})}),$(".delete-invitation").unbind("click"),$(".delete-invitation").on("click",function(){var t=$(this).attr("invitation");$("#modal-delete-invitation").modal("show"),$("#btn-delete-invitation").unbind("click"),$("#btn-delete-invitation").on("click",function(){loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/invitations/"+t,data:{invitationId:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){loadingOnScreenRemove(),n(),alertCustom("success",t.message)}})})}),loadingOnScreenRemove()}})}function e(){$.ajax({method:"GET",url:"/api/invitations/getinvitationdata?company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t),loadingOnScreenRemove(),loadOnAny(".number",!0)},success:function(t){$("#invitations_accepted").html(""+t.data.invitation_accepted_count),$("#invitations_sent").html(""+t.data.invitation_sent_count);var a=t.data.commission_paid.split(/\s/g);$("#commission_paid").html(a[0]+' <strong class="font-size-30">'+a[1]+"</strong>");var n=t.data.commission_pending.split(/\s/g);$("#commission_pending").html(n[0]+' <strong class="font-size-30">'+n[1]+"</strong>"),$("#invitations_amount").html(""+t.data.invitations_available),verifyAccountFrozen()&&$("#store-invite").attr("disabled",!0),loadOnAny(".number",!0)}})}function i(t,e){if(1==t.meta.last_page)$("#pagination-invites").css({background:"#f4f4f4"}),$("#pagination-"+e).html(""),$("#primeira_pagina_"+e).hide(),$("#ultima_pagina_"+e).hide();else{$("#pagination-"+e).html("");for($("#pagination-"+e).append("<button id='first_page' class='btn nav-btn'>1</button>"),1==t.meta.current_page&&($("#pagination-invites").css({background:"#ffffff"}),$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active")),$("#first_page").on("click",function(){a=1,n("?page=1")}),x=3;x>0;x--)t.meta.current_page-x<=1||($("#pagination-"+e).append("<button id='page_"+(t.meta.current_page-x)+"' class='btn nav-btn'>"+(t.meta.current_page-x)+"</button>"),$("#page_"+(t.meta.current_page-x)).on("click",function(){a=$(this).html(),n("?page="+$(this).html())}));if(1!=t.meta.current_page&&t.meta.current_page!=t.meta.last_page){var i="<button id='current_page' class='btn nav-btn active'>"+t.meta.current_page+"</button>";$("#pagination-"+e).append(i),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)t.meta.current_page+x>=t.meta.last_page||($("#pagination-"+e).append("<button id='page_"+(t.meta.current_page+x)+"' class='btn nav-btn'>"+(t.meta.current_page+x)+"</button>"),$("#page_"+(t.meta.current_page+x)).on("click",function(){a=$(this).html(),n("?page="+$(this).html())}));if("1"!=t.meta.last_page){var o="<button id='last_page' class='btn nav-btn'>"+t.meta.last_page+"</button>";$("#pagination-"+e).append(o),t.meta.current_page==t.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",function(){a=$(this).html(),n("?page="+t.meta.last_page)})}}}$("#store-invite").unbind(),$("#store-invite").on("click",function(){$.ajax({method:"GET",url:"/api/core/companies",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){if(companyVerification)if(isEmpty(t.data))loadingOnScreenRemove(),$("#modal-then-companies").hide(),$("#modal-not-approved-document-companies").hide(),$("#modal-not-companies").show();else{loadingOnScreenRemove();var a=0,e=0,i="";if(i='<select id="select-company-list" class="sirius-select">',disabledCompany=!1,$.each(t.data,function(t,n){a++,companyIsApproved(n)?"physical person"===n.type_company?"Aprovado"!==statusDocumentUser[n.user_address_document_status]||"Aprovado"!==statusDocumentUser[n.user_personal_document_status]?(disabledCompany=!1,e++,i+="<option value=".concat(n.id_code," disabled> ").concat(n.fantasy_name,"  </option>")):i+="<option value=".concat(n.id_code," >  ").concat(n.fantasy_name,"  </option>"):"juridical person"===n.type_company&&("Aprovado"!==n.address_document_translate||"Aprovado"!==n.contract_document_translate||"Aprovado"!==statusDocumentUser[n.user_address_document_status]||"Aprovado"!==statusDocumentUser[n.user_personal_document_status]?(disabledCompany=!1,e++,i+="<option value=".concat(n.id_code," disabled> ").concat(n.fantasy_name,"  </option>")):i+="<option value=".concat(n.id_code," >  ").concat(n.fantasy_name,"  </option>")):e++}),i+="</select>",a===e)$("#modal-then-companies").hide(),$("#modal-not-companies").hide(),$("#modal-not-approved-document-companies").show();else{$("#modal-not-companies").hide(),$("#modal-not-approved-document-companies").hide(),$("#modal-then-companies").show(),$("#modal-reverse-title").html("Novo Convite"),$("#company-list").html("").append(i);var o="",s=$(".company-navbar").val();o="https://accounts.azcend.com.br/signup?i="+s,$("#invite-link").val(o),$("#select-company-list").on("change",function(){o="https://accounts.azcend.com.br/signup?i="+$(this).val(),$("#invite-link").val(o),s=$(this).val()}),$("#copy-link").on("click",function(){document.getElementById("invite-link").select(),document.execCommand("copy"),alertCustom("success","Link copiado!")}),$("#btn-send-invite").unbind(),$("#btn-send-invite").on("click",function(){var t=$("#email").val();""==t?alertCustom("error","O campo Email do convidado é obrigatório"):""==s?alertCustom("error","O campo Empresa para receber é obrigatório"):(loadingOnScreen(),function(t,a){$.ajax({method:"POST",url:"/api/invitations",data:{email:t,company:a},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(t){$(".close").click(),alertCustom("success",t.message),loadingOnScreenRemove(),n()}})}(t,s))})}}else $("#modal-not-invites-today").show()}}),$("#modal-invite").modal("show")})});
