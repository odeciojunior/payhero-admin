jQuery(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||($("#type-products").find("option").not(":first").remove(),$("#filter-products").hide(),$("#filter-products-loading").show(),n(),updateCompanyDefault().done(function(e){getCompaniesAndProjects().done(function(e){renderSiriusSelect("#type-products"),$("#select-projects-1").find("option").remove(),$("#select-projects-2").find("option").remove(),$("#select-projects-3").find("option").remove(),$("#projects-list select").prop("disabled",!0).addClass("disabled"),$("#projects-list, .box-projects").addClass("d-none"),localStorage.removeItem("page"),localStorage.removeItem("filtersApplied"),s("n")})}))}),n();var e;document.referrer.match(/http(s?):\/\/[\w.-]+\/products\/\w{15}\/edit/)||localStorage.removeItem("filtersApplied");var t={1:"#2E85EC",2:"#5EE2A1",3:"#F41C1C"},o={1:"Em análise",2:"Aprovado",3:"Recusado"},a={1:"Produtos Shopify",2:"Produtos Woocommerce",3:"Produtos Nuvemshop"},c=function(){return localStorage.getItem("filtersApplied")?JSON.parse(localStorage.getItem("filtersApplied")):0};function s(){$.ajax({method:"GET",url:"/api/projects?select=true&status=active&company="+$(".company-navbar").val(),data:{status:"active"},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?(l(),removeLoadingSkeletonCards(),$("#project-empty").show(),$("#project-not-empty").hide(),$("#div-create").hide()):($("#project-empty").hide(),$("#project-not-empty").show(),verifyAccountFrozen()?$("#div-create").hide():$("#div-create").show(),"api sales"!=e.data&&($.each(a,function(t,o){var a="n",c="n",s="n";$.each(e.data,function(e,t){t.shopify?a="s":t.woocommerce?c="s":t.nuvemshop&&(s="s")}),1==t&&"s"==a&&$("#type-products").append($("<option>",{value:t,text:o})),2==t&&"s"==c&&$("#type-products").append($("<option>",{value:t,text:o})),3==t&&"s"==s&&$("#type-products").append($("<option>",{value:t,text:o}))}),$.each(e.data,function(e,t){t.shopify?$("#select-projects-1").append($("<option>",{value:t.id,text:t.name})):t.woocommerce?$("#select-projects-2").append($("<option>",{value:t.id,text:t.name})):t.nuvemshop&&$("#select-projects-3").append($("<option>",{value:t.id,text:t.name}))})),function(){if(null!=localStorage.getItem("filtersApplied")){var e=JSON.parse(localStorage.getItem("filtersApplied"));$("#type-products").val(e.getTypeProducts).trigger("change"),$("#select-projects-1").val(e.getProject_1).trigger("change"),$("#select-projects-2").val(e.getProject_2).trigger("change"),$("#select-projects-3").val(e.getProject_3).trigger("change"),$("#name").val(e.getName),$("#projects-list, .box-projects").addClass("d-none"),type=e.getTypeProducts,0!=type&&($("#projects-list #select-projects-"+type).prop("disabled",!1).removeClass("disabled"),$("#box-projects-"+type).removeClass("d-none"),$("#projects-list").removeClass("d-none"))}}(),r())}})}function r(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e=a;var c=function(){return null!=localStorage.getItem("filtersApplied")?JSON.parse(localStorage.getItem("filtersApplied")):null};if(null!=a){var s={atualPage:e};localStorage.setItem("page",JSON.stringify(s))}if(null!=localStorage.getItem("page")){var i=JSON.parse(localStorage.getItem("page"));null!=c()&&""!=c().getName?null!=localStorage.getItem("page")&&localStorage.setItem("page",JSON.stringify(i)):e=i.atualPage,i=JSON.parse(localStorage.getItem("page")),e=i.atualPage}a=e,n();var p=null!=c()?c().getTypeProducts:$("#type-products").val(),d=null!=c()?c().getName:$("#name").val(),u="";null!=c()?1==p&&c().getProject_1?u=c().getProject_1:2==p&&c().getProject_2&&(u=c().getProject_2):""!=$("#select-projects-1 option:selected").val()?u=$("#select-projects-1 option:selected").val():""!=$("#select-projects-2 option:selected").val()?u=$("#select-projects-2 option:selected").val():""!=$("#select-projects-3 option:selected").val()&&(u=$("#select-projects-3 option:selected").val()),a=null==a?"/api/products?shopify="+p+"&project="+u+"&name="+d:"/api/products"+a+"&shopify="+p+"&project="+u+"&name="+d,$.ajax({method:"GET",url:a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){if(l(),$("#filter-products").show(),isEmpty(e.data))null!=localStorage.getItem("filtersApplied")&&null!=localStorage.getItem("page")?(localStorage.removeItem("page"),$("#btn-filtro").trigger("click")):($("#data-table-products, #pagination-products").html(""),$(".products-is-empty").show());else{var a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";$('.menu_product_tooltip[style*="display: block"]').each(function(t,o){e[0]!=o&&(o.style.display="none")})};$(".products-is-empty").hide(),$("#data-table-products").html("");var c="";$.each(e.data,function(e,a){shopifyProduct=a.id_view,c='\n                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex">\n                            <div class="card shadow mb-20 mx-0" style="flex: 1 1 100%">\n                                <div style="margin: 10px 10px 0px 0px;position: absolute;right: 0px;">\n                                    <button type="button" class="menu_product" data-id="'.concat(a.id,'">&#8942;</button>\n                                </div>\n                                <img class="card-img-top product-image pointer" src="').concat(a.image,'" alt="Imagem do produto" data-link="/products/').concat(a.id,'/edit">\n                                ').concat(2==a.type_enum?'<span class="ribbon-inner ribbon-primary" style="background-color:'.concat(t[a.status_enum],';border-radius: 0px 10px 10px 0px;"> ').concat(o[a.status_enum],"\n                                        </span>"):"",'\n                                <hr class="mt-0">\n                                <div class="card-body py-0">\n                                    <h5 class="card-title">').concat(a.name,'</h5>\n                                    <h5 class="card-description">').concat(a.description,'</h5>\n                                </div>\n                                <div class="card-footer bg-transparent">\n                                    <p class="text-muted card-text sm">Criado em ').concat(a.created_at,'</p>\n                                </div>\n                            </div>\n                            <div class="menu_product_tooltip" data-id="').concat(a.id,'">\n                                <a id="bt_editar" href="/products/').concat(a.id,'/edit" class="mx-20"><span>\n                                    <img class="mr-10" src="/build/global/img/pencil-icon.svg"></span>\n                                    Editar produto</a>\n                                ').concat(0==shopifyProduct?'\n                                    <hr class="my-5">\n                                    <a href="#" class="mx-20 bt_excluir" data-id="'.concat(a.id,'"><span><img class="mr-15" src="/build/global/img/icon-trash-tale.svg"></span>Excluir produto</a>\n                                '):"","\n                            </div>\n                        </div>\n                        "),$("#data-table-products").append(c)}),$(".product-image").off("click"),$(".product-image").on("click",function(){window.location.href=$(this).attr("data-link")}),$(".menu_product").off("click"),$(".menu_product").on("click",function(){var e=$('.menu_product_tooltip[data-id="'.concat(this.dataset.id,'"]'));a(e),e.toggle()}),$(".menu_product").off("focusout"),$(".menu_product").on("focusout",function(e){$(e.relatedTarget).hasClass("menu_product")||setTimeout(function(){return a()},200)}),$(".bt_excluir").off("click"),$(".bt_excluir").on("click",function(e){e.preventDefault(),$(".bt_excluir_modal").attr("data-id",this.dataset.id),$("#modal-delete").modal()}),$(".bt_excluir_modal").off("click"),$(".bt_excluir_modal").on("click",function(e){e.preventDefault(),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/products/"+this.dataset.id,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e),$(".bt_excluir_modal").attr("data-id",""),loadingOnScreenRemove()},success:function(e){alertCustom("success",e.message),window.location="/products"}})}),$("img").on("error",function(){$(this).attr("src","https://azcend-digital-products.s3.amazonaws.com/admin/produto.svg")}),pagination(e,"products",r),$(".products-is-empty").hide()}},complete:function(e){unlockSearch($("#btn-filtro"))}})}function n(){$("#data-table-products").empty(),loadingSkeletonCards($("#data-table-products"))}function l(){$("#filter-products-loading").hide()}$(document).on("keypress",function(e){"Enter"==e.key&&$("#btn-filtro").trigger("click")}),$("#type-products").on("change",function(){$("#name").val(""),$("#select-projects-1").val($("#select-projects-1 option:first").val()),$("#select-projects-2").val($("#select-projects-2 option:first").val()),$("#select-projects-3").val($("#select-projects-3 option:first").val()),$("#projects-list select").prop("disabled",!0).addClass("disabled"),$("#projects-list, .box-projects").addClass("d-none");var e=$(this).val();0!=e?($("#projects-list").removeClass("d-none"),$("#box-projects-"+e).removeClass("d-none"),$("#box-projects-"+e+" select").prop("disabled",!1).removeClass("disabled")):($("#projects-list select").prop("disabled",!0).addClass("disabled"),$("#projects-list").addClass("d-none"))}),$("#new-product-button").on("click",function(e){e.preventDefault(),$("#new-product-modal").show()}),$(".new-product-btn").on("click",function(){$(".new-product-btn").removeClass("active"),$(this).addClass("active"),"/products/create/physical"===$(this).attr("data-add-url")&&$("#selected-option-desc").text("Em vendas de produtos físicos, será solicitado o rastreio para liberação da comissão da venda."),"/products/create/digital"===$(this).attr("data-add-url")&&$("#selected-option-desc").text("Ao selecionar produto digital, avance e preencha os dados."),$("#selected-option-url").attr("href",$(this).attr("data-add-url")),$("#next-btn-container").addClass("d-flex flex-column").show()}),$("#btn-filtro").on("click",function(){if((c().getTypeProducts!=$("#type-products option:selected").val()||c().getName!=$("#name").val()||c().getProject_1!=$("#select-projects-1 option:selected").val()||c().getProject_2!=$("#select-projects-2 option:selected").val()||c().getProject_3!=$("#select-projects-3 option:selected").val())&&null!=localStorage.getItem("page")){var e=JSON.parse(localStorage.getItem("page"));e.atualPage=null,localStorage.setItem("page",JSON.stringify(e))}var t={getTypeProducts:$("#type-products option:selected").val(),getProject_1:$("#select-projects-1 option:selected").val(),getProject_2:$("#select-projects-2 option:selected").val(),getProjects_3:$("#select-projects-3 option:selected").val(),getName:$("#name").val()};localStorage.setItem("filtersApplied",JSON.stringify(t)),elementButton=$("#btn-filtro"),"true"!=searchIsLocked(elementButton)&&(lockSearch(elementButton),r())}),getCompaniesAndProjects().done(function(e){s()})});
