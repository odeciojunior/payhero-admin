<<<<<<< HEAD
$(function () {
  // COMPORTAMENTOS DA JANELA
  $("#discount_value").mask("00%", {
    reverse: true
  });
  $("#apply_discount").on("click", function () {
    if ($("#div_discount").is(":visible")) {
      $("#div_discount").hide();
      $("#discount_value").val("");
    } else {
      $("#div_discount").show();
      $("#discount_type").on("change", function () {
        if ($("#discount_type").val() == "value") {
          $("#discount_value").mask("#.###,#0", {
            reverse: true
          }).removeAttr("maxlength");
          $("#label_discount_value").html("Valor (ex: 20,00)");
        } else {
          $("#discount_value").mask("00%", {
            reverse: true
          });
          $("#label_discount_value").html("Valor (ex: 20%)");
        }
      });
    }
  });
  $(document).on("click", "#boleto-link .copy_link", function () {
    var temp = $("<input>");
    $("#nav-tabContent").append(temp);
    temp.val($(this).attr("link")).select();
    document.execCommand("copy");
    temp.remove();
    alertCustom("success", "Link copiado!");
  });
  $(document).on("click", "#boleto-digitable-line .copy_link", function () {
    var temp = $("<input>");
    $("#nav-tabContent").append(temp);
    temp.val($(this).attr("digitable-line")).select();
    document.execCommand("copy");
    temp.remove();
    alertCustom("success", "Linha Digitável copiado!");
  });
  $(document).on("click", ".btn-copy-thank-page-url", function () {
    var temp = $("<input>");
    $(".sales-details").append(temp);
    temp.val($(this).attr("link")).select();
    document.execCommand("copy");
    temp.remove();
    alertCustom("success", "Link copiado!");
  });
  $(document).on("click", ".btn-copy-custom-text", function () {
    var temp = $("<input>");
    $("#nav-tabContent").append(temp);
    temp.val($(this).attr("link")).select();
    document.execCommand("copy");
    temp.remove();
    alertCustom("success", "Link copiado!");
  });
  $(".btn-edit-client").on("click", function () {
    var container = $(this).parent();
    container.find("input").removeClass("fake-label").prop("readonly", false);
    $(this).hide();
    container.find(".btn-save-client").show();
    container.find(".btn-close-client").show();
  });
  $(".btn-close-client").on("click", function () {
    var container = $(this).parent();
    container.find("input").addClass("fake-label").prop("readonly", true);
    $(this).hide();
    container.find(".btn-save-client").hide();
    container.find(".btn-edit-client").show();
  }); //atualiza códigos de rastreio

  $(".btn-save-client").on("click", function () {
    var _this = this;

    var container = $(this).parent();
    var input = container.find("input");
    var data = {
      id: input.attr("client"),
      name: input.attr("name"),
      value: input.val(),
      _method: "PUT"
    };
    $.ajax({
      method: "POST",
      url: "/api/customers/update",
      dataType: "json",
      data: data,
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        input.addClass("fake-label").prop("readonly", true);
        $(_this).hide();
        container.find(".btn-close-client").hide();
        container.find(".btn-edit-client").show();
        alertCustom("success", "Dados do cliente alterados com successo!");
      }
    });
  }); // FIM - COMPORTAMENTOS DA JANELA

  $(document).on("click", ".btn-edit-observation", function () {
    var container = $(this).parent();
    container.find("input").removeClass("fake-label").prop("readonly", false);
    $(this).hide();
    container.find(".btn-save-observation").show();
    container.find(".btn-close-observation").show();
  });
  $(document).on("click", ".btn-close-observation", function () {
    var container = $(this).parent();
    container.find("input").addClass("fake-label").prop("readonly", true);
    $(this).hide();
    container.find(".btn-save-observation").hide();
    container.find(".btn-edit-observation").show();
  });
  $(document).on("click", ".btn-save-observation", function () {
    var _this2 = this;

    if ($("#refund-observation").val() == "") {
      alertCustom("error", "Dados informados inválidos");
      return false;
    }

    var container = $(this).parent();
    var input = container.find("input");
    var data = {
      id: input.attr("sale"),
      name: input.attr("name"),
      value: input.val() // _method: 'PUT',

    };
    $.ajax({
      method: "POST",
      url: "/api/sales/updaterefundobservation/" + input.attr("sale"),
      dataType: "json",
      data: data,
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        input.addClass("fake-label").prop("readonly", true);
        $(_this2).hide();
        container.find(".btn-close-observation").hide();
        container.find(".btn-edit-observation").show();
        alertCustom("success", "Causa do estorno alterado com successo!");
      }
    });
  }); // MODAL DETALHES DA VENDA

  $(document).on("click", ".detalhes_venda", function () {
    var sale = $(this).attr("venda");
    loadOnAny("#modal-saleDetails");
    $("#nav-home-tab").addClass("active");
    $("#nav-home-tab").addClass("show");
    $("#nav-home").addClass("active");
    $("#nav-home").addClass("show");
    $("#nav-profile-tab").removeClass("active");
    $("#nav-profile-tab").removeClass("show");
    $("#nav-profile").removeClass("active");
    $("#nav-profile").removeClass("show");
    $("#nav-woo-tab").removeClass("active");
    $("#nav-woo").removeClass("active");
    $("#nav-woo").removeClass("show");
    $("#modal_detalhes").modal("show");
    $("#refundAmount").mask("##.###,#0", {
      reverse: true
    });
    $("#refundBilletAmount").mask("##.###,#0", {
      reverse: true
    });
    $.ajax({
      method: "GET",
      url: "/api/sales/" + sale,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        $("#modal_detalhes").modal("hide");
        errorAjaxResponse(response);
      },
      success: function success(response) {
        getSale(response.data);
        $("#refundAmount").val(response.data.total);
        $("#refundBilletAmount").text(response.data.total);
        $(".btn_refund_transaction").unbind("click");
        $(".btn_refund_transaction").on("click", function () {
          $("#refund-observation-transaction").val("");
          $("#modal_detalhes").modal("hide");
          $("#modal-refund-transaction").modal("show");
          $("#asaas_message").html("");

          if (response.data.asaas_amount_refund != "") {
            $("#asaas_message").html("<p class=\"gray\"> Esta venda j\xE1 foi antecipada, o valor a ser debitado no extrato ser\xE1 de <strong>".concat(response.data.asaas_amount_refund, "</strong></p>"));
          }

          $("#radioTotalRefund").on("click", function () {
            $(".value-partial-refund").hide();
          });
          $("#radioPartialRefund").on("click", function () {
            $(".value-partial-refund").show();
          });
          $(".btn-confirm-refund-transaction").unbind("click");
          $(".btn-confirm-refund-transaction").on("click", function () {
            var refund_observation = $("#refund-observation-transaction").val();

            if (refund_observation.length < 4) {
              alertCustom("error", "Preencha o motivo do estorno para prosseguir");
              return;
            }

            var partial = 0;

            if (document.getElementById("radioPartialRefund").checked) {
              partial = 1;
            }

            var refunded_value = $("#refundAmount").val();
            refundedClick(refunded_value, refund_observation, response.data.refund_url, partial);
          });
        });
        $(".btn_refund_billet").unbind("click");
        $(".btn_refund_billet").on("click", function () {
          $("#refund-observation-billet").val("");
          var refunded_value = response.data.total;
          $(".billet-refunded-tax-value").text(response.data.taxaReal ? response.data.taxaReal : "");
          $("#modal_detalhes").modal("hide");
          $("#modal-refund-billet").modal("show");
          $(".btn-confirm-refund-billet").unbind("click");
          $(".btn-confirm-refund-billet").on("click", function () {
            var refund_observation = $("#refund-observation-billet").val();

            if (refund_observation.length < 4) {
              alertCustom("error", "Preencha o motivo do estorno para prosseguir");
              return;
            }

            refundedBilletClick(refunded_value, refund_observation, response.data.refund_url);
          });
        });
      }
    });
  });
  $("#update-sale-observation").click(function () {
    var sale = $("#sale-code").text().substring(0, 8);
    $.ajax({
      method: "POST",
      url: "/api/sales/set-observation/" + sale,
      data: {
        observation: $("#observation").val()
      },
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content")
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        alertCustom("success", response.message);
        atualizar(currentPage);
      }
    });
  });

  function getSale(sale) {
    renderSale(sale);
    getProducts(sale);
    getClient(sale.client_id, sale.id);

    if (sale.delivery_id != "") {
      getDelivery(sale.delivery_id);
    }

    if (!sale.api_flag) {
      $(".dados-checkout").css("display", "block");
      getCheckout(sale.checkout_id);
    } else {
      $(".dados-checkout").css("display", "none");
    }

    getNotazz(sale.invoices);
  }

  function renderSale(sale) {
    //Dados da venda
    var paymentMethod = "";

    if (sale.payment_method == 1) {
      paymentMethod = "Cartão";
    } else if (sale.payment_method == 3) {
      paymentMethod = "Debito";
    } else if (sale.payment_method == 4) {
      paymentMethod = "PIX";
    } else {
      paymentMethod = "Boleto";
    }

    $("#comission-details").css("display", "flex");
    $("#sale-code").text(sale.id);

    if (!!sale.upsell) {
      $("#sale-code").append("<span class=\"text-muted font-size-16 d-block mt-1\"> Upsell \u2192 ".concat(sale.upsell, "</span>"));
    }

    if (sale.has_order_bump) {
      $("#sale-code").append("<span class=\"text-muted font-size-16 d-block mt-1\"> Order Bump </span>");
    }

    $("#payment-type").text("Pagamento via " + paymentMethod + " em " + sale.start_date + " às " + sale.hours);

    if (sale.release_date != "") {
      $("#release-date").text("Data de liberação: " + sale.release_date);
    } else {
      $("#release-date").text("");
    }

    $("#card-company").text("Empresa responsável pelo faturamento: " + sale.company_name);

    if (!isEmpty(sale.observation)) {
      $("#sale-observation").removeClass("collapse");
    } else {
      $("#sale-observation").addClass("collapse");
    }

    $("#observation").val(sale.observation); //Status

    var status = $(".modal-body #status");
    status.html("");
    status.append('<img style="width: 50px;" src="/build/global/img/cartoes/' + sale.flag + '.png">');

    switch (sale.status) {
      case 1:
        status.append("<span class='ml-2 badge badge-success'>Aprovada</span>");
        break;

      case 2:
        status.append("<span class='ml-2 badge badge-pendente'>Pendente</span>");
        break;

      case 3:
        status.append("<span class='ml-2 badge badge-danger'>Recusada</span>");
        break;

      case 4:
        status.append("<span class='ml-2 badge badge-danger'>Chargeback</span>");
        break;

      case 6:
        status.append("<span class='ml-2 badge badge-primary'>Em análise</span>");
        break;

      case 7:
        status.append("<span class='ml-2 badge badge-danger'>Estornado</span>");
        break;

      case 8:
        status.append("<span class='ml-2 badge badge-danger'>Estorno Parcial</span>");
        break;

      case 20:
        status.append("<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>");
        break;

      case 21:
        status.append("<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>");
        break;

      case 22:
        status.append("<span class='ml-2 badge badge-danger'>Estornado</span>");
        break;

      case 23:
        status.append("<span class='ml-2 badge badge-warning'>Recuperado</span>");
        break;

      case 24:
        status.append("<span class='ml-2 badge badge-antifraude'>Em disputa</span>");
        break;

      default:
        status.append("<span class='ml-2 badge badge-primary'>" + sale.status + "</span>");
        break;
    }

    if (sale.is_chargeback_recovered && sale.status == 1) {
      $("#chargeback-recovered").show();
    } else {
      $("#chargeback-recovered").hide();
    } //Valores


    $("#subtotal-value").html(sale.subTotal);
    $("#shipment-value").html(sale.shipment_value);
    $("#iof-label, #iof-value, #cambio-label, #cambio-value").hide();

    if (sale.dolar_quotation) {
      $("#cambio-label span").text("Câmbio (1 $ = R$ " + sale.dolar_quotation + "): ");
      $("#cambio-value span").text("US$ " + sale.taxa);
      $("#cambio-label, #cambio-value").show();
    }

    $("#taxas-installment-free-label, #taxa-installment-value").hide();

    if (parseFloat(sale.installment_tax_value.replace(/[^\d]/g, "")) !== 0 && sale.user_sale_type == "producer") {
      $("#taxa-installment-value").html(sale.installment_tax_value);
      $("#taxas-installment-free-label").show();
      $("#taxa-installment-value").show();
    }

    if (parseFloat(sale.discount.replace(/[^\d]/g, "")) > 0) {
      $("#discount-title").show();
      $("#discount-data").show();
      $("#desconto-value").html(sale.discount);
    } else {
      $("#discount-title").hide();
      $("#discount-data").hide();
      $("#automatic-discount-value").hide();
    }

    if (!!sale.cupom_code) {
      $("#cupom-code").html(sale.cupom_code);
      $(".cupom-info").show();
    } else {
      $(".cupom-info").hide();
    }

    $(".text-discount").html("");
    $("#automatic-discount-value").html("");

    if (parseInt(sale.automatic_discount.replace(/[^\d]/g, "")) > 0) {
      switch (sale.payment_method) {
        case 2:
          $(".text-discount").html("Desconto automático boleto");
          break;

        case 4:
          $(".text-discount").html("Desconto automático pix");
          break;

        default:
          $(".text-discount").html("Desconto automático cartão");
          break;
      }

      $(".automatic-discount-value").show();
      $(".text-discount").show();
      $("#automatic-discount-value").html(sale.automatic_discount).show();
    } else {
      $(".automatic-discount-value").hide();
      $(".text-discount").hide();
    }

    if (sale.status_name != "refunded") {
      $("#total-value").html(sale.total);
    } else {
      $("#total-value").html(" <del style=\"color: #F41C1C !important;\">".concat(sale.total, "</del>"));
    }

    if (sale.refund_value != "0,00" && sale.status == 8) {
      $(".text-partial-refund").show();
      $("#partial-refund-value").html(sale.refund_value);
      $("#partial-refund-value").show();
    } else {
      $(".text-partial-refund").hide();
      $("#partial-refund-value").hide();
    }

    if (parseInt(sale.progressive_discount.replace(/[^\d]/g, "")) > 0) {
      $("#discount-prog-title").show();
      $("#discount-prog-data span").html(sale.progressive_discount);
      $("#discount-prog-data").show();
    } else {
      $("#discount-prog-data").hide();
      $("#discount-prog-title").hide();
    }

    if (sale.status_name == "refunded") {
      $("#comission-details").css("display", "none");
    } // Taxas detalhadas


    $("#taxas-label").html(sale.tax ? sale.checkout_tax ? "Taxas (" + sale.tax + " + " + sale.transaction_tax + " + " + sale.checkout_tax + "): " : "Taxas (" + sale.tax + " + " + sale.transaction_tax + "): " : "Taxas");
    $("#taxareal-value").html(sale.taxaReal ? sale.taxaReal : "");
    $("#tax-value-total").html("Valor total: ");

    if (sale.status_name != "refunded") {
      $("#tax-value-total-value").html(sale.total_parcial);
    } else {
      $("#tax-value-total-value").html(" <del style=\"color: #F41C1C !important;\">".concat(sale.total_parcial, "</del>"));
    }

    $("#tax-percentage").html("Taxa (".concat(sale.tax, ")"));
    $("#tax-percentage-value").html("".concat(sale.taxaDiscount));
    $("#tax-fixed").html("Taxa fixa: ");
    $("#tax-fixed-value").html("".concat(sale.transaction_tax));

    if (sale.checkout_tax) {
      $("#tax-checkout").html("Taxa de checkout: ");
      $("#tax-checkout-value").html("".concat(sale.checkout_tax));
      $("#div_tax_checkout").show();
    } else {
      $("#tax-checkout").html("");
      $("#tax-checkout-value").html("");
      $("#div_tax_checkout").hide();
    }

    $("#tax-total").html("Valor total das taxas: ");
    $("#tax-total-value").html("- ".concat(sale.totalTax));
    $("#tax-comission").html("Valor recebido");
    $("#tax-comission-value").html("<b>".concat(sale.comission, "</b>"));
    $("#convertax-label, #convertax-value").hide();

    if (sale.convertax_value !== "0,00") {
      $("#convertax-value").text(sale.convertax_value ? sale.convertax_value : "");
      $("#convertax-label, #convertax-value").show();
    } // valor antecipavel


    if (sale.value_anticipable != "0,00") {
      $(".div-anticipated").show();
      $(".div-value-anticipated").html("").append("<span class='text-muted ft-12'> ".concat(sale.value_anticipable, "</span>")).show();
    } // valor cashback


    if (sale.has_cashback) {
      $("#cashback-label").removeClass("d-none");
      $("#cashback-value").removeClass("d-none").html("").append("<span class='ft-12' style=\"color: #5EE2A1;\"> + ".concat(sale.cashback_value, "</span>")).show(); // Taxas detalhadas

      $("#tax-subtotal").html("Subtotal:").parent().removeClass("d-none");
      $("#tax-subtotal-value").html(sale.total).parent().removeClass("d-none");
      $("#tax-cashback").html("Cashback:").parent().removeClass("d-none");
      $("#tax-cashback-value").html("+ ".concat(sale.cashback_value)).parent().removeClass("d-none").show();
    } else {
      $("#cashback-label").addClass("d-none");
      $("#cashback-value").addClass("d-none").html(""); // Taxas detalhadas

      $("#tax-subtotal").parent().addClass("d-none");
      $("#tax-subtotal-value").parent().addClass("d-none");
      $("#tax-cashback").parent().addClass("d-none");
      $("#tax-cashback-value").parent().addClass("d-none");
    } //comissao afiliado


    if (sale.user_sale_type == "affiliate") {
      $(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>");
      $(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>");

      if (sale.affiliate != null) {
        $(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>");
        $(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do produtor: </span>");
        $("#user-type-comission-value").html(sale.comission);
      } else {
        $(".div-user-type-comission-value").hide();
        $(".div-user-type-comission").hide();
      }
    } else {
      $(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>");
      $(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>");

      if (sale.affiliate != null) {
        $(".div-sale-by-affiliate").show().html("<h4 class='table-title'>Venda realizada pelo afiliado " + sale.affiliate + "</h4>");
        $(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>");
        $(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do afiliado: </span>");
        $("#user-type-comission-value").html(sale.affiliate_comission);
      } else {
        $(".div-sale-by-affiliate").hide();
        $(".div-affiliate-name").hide().html("");
        $(".div-user-type-comission-value").hide();
        $(".div-user-type-comission").hide();
      }

      $("#comission-value").text(sale.comission ? sale.comission : "");
    }

    if (sale.affiliate_comission != "" && sale.user_sale_type == "affiliate") {
      $("#comission-value").text(sale.affiliate_comission);
    } //Ordem Woocommerce


    if (sale.has_woocommerce_integration) {
      $("#nav-woo-tab").show();

      if (sale.woocommerce_order) {
        var order = "Status: <strong>" + sale.woocommerce_order.status + "</strong>"; // console.log(sale)

        $("#woo_order").html(order);
        $("#resendWoocommerceOrder").addClass("d-none");
        $("#resendWoocommerceOrder").removeClass("d-block");
        $("#resendWoocommerceOrderButton").attr("sale", "");
      } else {
        $("#woo_order").html("Ordem não encontrada!");

        if (sale.woocommerce_retry_order) {
          $("#resendWoocommerceOrder").removeClass("d-none");
          $("#resendWoocommerceOrder").addClass("d-block");
          $("#resendWoocommerceOrderButton").attr("sale", sale.id);
          $(".btn_new_order_woocommerce").unbind("click");
          $(".btn_new_order_woocommerce").on("click", function () {
            var sale = $(this).attr("sale");
            $("#modal-new-order-woocommerce").modal("show");
            $("#modal_detalhes").modal("hide");
            $(".btn-confirm-new-order-woocommerce").unbind("click");
            $(".btn-confirm-new-order-woocommerce").on("click", function () {
              newOrderWooClick(sale);
            });
          });
        }
      }
    } else {
      $("#nav-woo-tab").hide();
    } //Detalhes do shopify


    if (sale.has_shopify_integration) {
      if (sale.shopify_order || sale.status == 20) {
        // $('#shopify-order').text('TEM ORDER');
        $("#resendShopfyOrder").addClass("d-none");
        $("#resendShopfyOrder").removeClass("d-block");
        $("#resendeShopifyOrderButton").attr("sale", "");
      } else {
        /*
        $('#shopify-order').text('Ordem não foi gerada no shopify!');
        $('#div_details_shopify').html('<button class="btn btn-secondary btn-sm btn_new_order_shopify" sale=' + sale.id + '>Gerar ordem Shopify</button>');*/
        $("#resendShopfyOrder").removeClass("d-none");
        $("#resendShopfyOrder").addClass("d-block");
        $("#resendeShopifyOrderButton").attr("sale", sale.id);
        $(".btn_new_order_shopify").unbind("click");
        $(".btn_new_order_shopify").on("click", function () {
          var sale = $(this).attr("sale");
          $("#modal-new-order-shopify").modal("show");
          $("#modal_detalhes").modal("hide");
          $(".btn-confirm-new-order-shopify").unbind("click");
          $(".btn-confirm-new-order-shopify").on("click", function () {
            newOrderClick(sale);
          });
        });
      }

      $("#details-shopify").show();
    } else {
      $("#resendShopfyOrder").addClass("d-none");
      $("#resendShopfyOrder").removeClass("d-block");
      $("#resendeShopifyOrderButton").attr("sale", "");
    } //Detalhes da venda


    $("#nav-profile #card-company").text("Empresa: Nome da Empresa"); // + sale.company_name);

    if (sale.payment_method === 1) {
      $("#details-card #card-flag").text("Bandeira: " + sale.flag);
      $("#details-card #card-installments").text("Quantidade de parcelas: " + sale.installments_amount);
      $("#details-card").show();
      $("#details-boleto").hide();
    }

    if (sale.payment_method === 2) {
      $("#details-boleto #boleto-link a").attr("link", sale.boleto_link);
      $("#details-boleto #boleto-digitable-line a").attr("digitable-line", sale.boleto_digitable_line);
      $("#details-boleto #boleto-due").text("Vencimento: " + sale.boleto_due_date);
      $("#details-card").hide();
      $("#details-boleto").show();
    }

    if (sale.payment_method === 4) {
      $("#details-card").hide();
      $("#details-boleto").hide();
    }

    $("#checkout-attempts").hide();

    if (sale.payment_method === 1) {
      $("#checkout-attempts").text("Quantidade de tentativas: " + sale.attempts).show();
    }

    $("#div_refund").html("");

    if (sale.refund_enabled) {
      if (sale.payment_method != 2) {
        $("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_transaction" sale=' + sale.id + ">Estornar transação</button>");
      } else {
        $("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_billet" sale=' + sale.id + ">Estornar boleto</button>");
      }
    } else if (sale.already_refunded) {
      $("#div_refund").html('<a href="/sales/' + sale.id + '/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>');
    }

    if (sale.status == 7 || sale.status == 22) {
      $("#div_refund_receipt").html('<a href="/sales/' + sale.id + '/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>');
    } else {
      $("#div_refund_receipt").html("");
    }

    if (sale.status == 2 || sale.status == 1) {
      if (!sale.api_flag) {
        $("#saleReSendEmail").show();
      } else {
        $("#saleReSendEmail").hide();
      }
    } else {
      $("#saleReSendEmail").hide();
    }

    if (!sale.api_flag) {
      $("#details-api").hide();
    } else {
      $("#details-api").show();
    }

    if (sale.refund_observation != null) {
      $(".div-refund-observation").show();
      $("#refund-observation").val(sale.refund_observation).attr("sale", sale.id);

      if (sale.user_changed_observation) {
        $(".btn-edit-observation").show();
      } else {
        $(".btn-edit-observation").hide();
      }
    } else {
      $(".div-refund-observation").hide();
    }

    if (sale.thank_page_url != "") {
      $("#thank-page-url").text(sale.thank_label_text).show();
      $(".btn-copy-thank-page-url").attr("link", sale.thank_page_url);
      $(".btn-copy-thank-page-url").show();
    } else {
      $("#thank-page-url").hide();
      $(".btn-copy-thank-page-url").hide();
    }

    if (sale.delivery_id != "") {
      $("#div_delivery").css("display", "block");
    } else {
      $("#div_delivery").css("display", "none");
    }

    if (verifyAccountFrozen() == true) {
      $(".btn-edit-client").hide();
      $("#update-sale-observation").hide();
      $("#saleReSendEmail").hide();
      $("#div_refund").hide();
    } else {
      $(".btn-edit-client").show();
      $("#update-sale-observation").show();
      $("#div_refund").show();
    }
  }

  function getNotazz(invoices) {
    if (!isEmpty(invoices)) {
      var lastInvoice = invoices[invoices.length - 1];
      $.ajax({
        method: "GET",
        url: "/api/apps/notazz/invoice/" + lastInvoice,
        dataType: "json",
        headers: {
          Authorization: $('meta[name="access-token"]').attr("content"),
          Accept: "application/json"
        },
        error: function error(response) {
          errorAjaxResponse(response);
        },
        success: function success(response) {
          renderNotazz(response.data);
        }
      });
    }
  }

  function renderNotazz(invoice) {
    if (!isEmpty(invoice)) {
      //exist
      $("#data-notazz-invoices").empty();

      if (invoice.date_pending) {
        var data = "<tr>\n                                <td>\n                                    ".concat(invoice.date_pending, "\n                                </td>\n                                <td>\n                                    Pendente de envio\n                                </td>\n                                <td>\n                                    0\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");
        $("#data-notazz-invoices").append(data);
      }

      if (invoice.date_sent) {
        var return_message = invoice.return_message == null ? "Sucesso" : invoice.return_message;
        var status = invoice.return_message ? "Erro ao enviar para Notazz" : "Enviado para Notazz";
        var link = invoice.pdf ? "<a href='" + invoice.pdf + "' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>" : "";

        var _data = "<tr>\n                                <td>\n                                    ".concat(invoice.date_sent, "\n                                </td>\n                                <td>\n                                    ").concat(status, "\n                                </td>\n                                <td>\n                                    ").concat(invoice.return_http_code, "\n                                </td>\n                                <td>\n                                    ").concat(return_message, "\n                                </td>\n                                <td>\n                                    ").concat(link, "\n                                </td>\n                            </tr>");

        $("#data-notazz-invoices").append(_data);
      }

      if (invoice.date_error) {
        var _status = invoice.return_message ? "Erro ao enviar para Notazz" : "Enviado para Notazz";

        var _data2 = "<tr>\n                                <td>\n                                    ".concat(invoice.date_error, "\n                                </td>\n                                <td>\n                                    ").concat(_status, "\n                                </td>\n                                <td>\n                                    ").concat(invoice.return_http_code, "\n                                </td>\n                                <td>\n                                    ").concat(invoice.return_message, "\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");

        $("#data-notazz-invoices").append(_data2);
      }

      if (invoice.date_rejected) {
        var postback_message = invoice.postback_message == null ? "Rejeitado" : invoice.postback_message;

        var _data3 = "<tr>\n                                <td>\n                                    ".concat(invoice.date_sent, "\n                                </td>\n                                <td>\n                                    Nota fiscal rejeitada\n                                </td>\n                                <td>\n                                    ").concat(invoice.return_http_code, "\n                                </td>\n                                <td>\n                                    ").concat(postback_message, "\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");

        $("#data-notazz-invoices").append(_data3);
      }

      if (invoice.date_canceled) {
        var _link = invoice.pdf ? "<a href='" + invoice.pdf + "' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>" : "";

        var _data4 = "<tr>\n                                <td>\n                                    ".concat(invoice.date_sent, "\n                                </td>\n                                <td>\n                                    Nota fical cancelada\n                                </td>\n                                <td>\n                                    ").concat(invoice.return_http_code, "\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n                                    ").concat(_link, "\n                                </td>\n                            </tr>");

        $("#data-notazz-invoices").append(_data4);
      }

      if (invoice.return_message) {
        $("#div_notazz_schedule").html("Próxima tentativa de envio em " + invoice.schedule);
      }

      $("#div_notazz_invoice").show();
    } else {
      //not exist
      $("#div_notazz_invoice").hide();
    }
  }

  function getClient(client, sale) {
    $.ajax({
      method: "GET",
      url: "/api/customers/" + client + "/" + sale,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        renderClient(response.data);
      }
    });
  }

  function renderClient(client) {
    //Cliente
    $("#client-name").text("Nome: " + client.name);
    $("#client-telephone").val(client.telephone).attr("client", client.code).mask("+00 (00) 00000-0000");
    $("#client-email").val(client.email).attr("client", client.code);
    $("#client-document").text("CPF: " + client.document);

    if (client.fraudster) {
      $("#client-whatsapp-container").hide();
      $(".btn-edit-client").hide();
    } else {
      $(".btn-edit-client").show();
      $("#client-whatsapp-container").show();
      $("#client-whatsapp").attr("href", client.whatsapp_link);
    }
  }

  function getProducts(sale) {
    $("#table-product").html("");
    $("#data-tracking-products").html("");
    $.ajax({
      method: "GET",
      url: "/api/products/saleproducts/" + sale.id,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        if (!sale.api_flag) {
          renderProducts(response.data, sale);
        } else {
          renderProductsApi(response.data);
        }
      }
    });
  }

  function renderProductsApi(products) {
    var div = "";
    $.each(products, function (index, value) {
      div += '<div class="row justify-content-between mb-15">';
      div += '<div class="col-lg-2">';
      div += '<img src="/build/global/img/produto.svg" width="50px" height="50px" style="border-radius: 6px;">';
      div += "</div>";
      div += '<div class="col-md-5 col-lg-6">';
      div += '<h4 class="table-title m-0">' + value.name + "</h4>";
      div += "<small>" + value.description + "</small>";
      div += "</div>";
      div += '<div class="col-md-3 col-lg-2 text-right">';
      div += '<p class="sm-text text-muted">' + value.amount + "x</p>";
      div += "</div>";
      div += "</div>";
      $("#table-product").html(div);
    });
    loadOnAny("#modal-saleDetails", true);
  }

  function renderProducts(products, sale) {
    var div = "";
    var photo = "/build/global/img/produto.svg";
    $.each(products, function (index, value) {
      if (!value.photo) {
        value.photo = photo;
      }

      div += "<div class=\"row justify-content-between mb-15\">\n                        <div class=\"col-lg-2\">\n                            <img src='".concat(value.photo, "' onerror=this.src='/build/global/img/produto.svg' width='50px' height='50px' style='border-radius: 6px;'>\n                        </div>\n                        <div class=\"col-md-5 col-lg-6\">\n                            <h4 class=\"table-title m-0\">").concat(value.name, "</h4>\n                            <small>").concat(value.description, "</small>\n                        </div>\n                        <div class=\"col-md-3 col-lg-2 text-right\">\n                            <p class=\"sm-text text-muted\">").concat(value.amount, "x</p>\n                        </div>\n                    </div>");

      if (typeof value.custom_products != "undefined" && value.custom_products.length > 0) {
        div += "<!-- Customer additional information -->\n                    <div class=\"panel-group my-30\" aria-multiselectable=\"true\" role=\"tablist\">\n                        <div class=\"panel panel-custom-product\">\n                            <div class=\"panel-heading\" id=\"sale-custom-product-accordion-".concat(value.sale_id).concat(value.id).concat(index, "\" role=\"tab\">\n                                <a class=\"panel-title\" data-toggle=\"collapse\" href=\"#sale-custom-product-").concat(value.sale_id).concat(value.id).concat(index, "\"\n                                data-parent=\"#custom-product-accordion").concat(value.id, "\" aria-expanded=\"true\"\n                                aria-controls=\"exampleCollapseDefaultOne\">\n                                    <strong>Personaliza\xE7\xF5es enviadas pelo cliente</strong>\n                                </a>\n                            </div>\n                            <div class=\"panel-collapse collapse\" id=\"sale-custom-product-").concat(value.sale_id).concat(value.id).concat(index, "\"\n                                aria-labelledby=\"sale-custom-product-accordion-").concat(value.sale_id).concat(value.id).concat(index, "\" role=\"tabpanel\" style=\"\">\n                                <div class=\"panel-body\">");
        var file_name = null;
        line_temp = 0;
        $.each(value.custom_products, function (index2, custom) {
          if (line_temp != custom.line) {
            div += "<hr/>";
            line_temp = custom.line;
          }

          div += "<div class=\"row mt-2\">";

          if (typeof custom.type_enum != "undefined") {
            if (custom.type_enum != "Text") {
              file_name = custom.file_name.substr(-20);
            }

            switch (custom.type_enum) {
              case "Text":
                div += "\n                                                        <div class=\"col-md-3\">\n                                                            <img src=\"/build/global/img/custom-product/icon_text.svg\" class=\"img-fluid border-icon\">\n                                                        </div>\n                                                        <div class=\"col-md-6 px-0 py-13\">\n                                                            <h5>".concat(custom.value, "</h5>\n                                                        </div>\n                                                        <div class=\"col-md-3 pl-0 py-11\" align=\"right\">\n                                                            <a role=\"button\" class=\"copy_link btn-copy-custom-text\" style=\"cursor: pointer;\"  link=\"").concat(custom.value, "\" title=\"Copiar link\">\n                                                                <span class=\"material-icons icon-copy-1\"> content_copy </span>\n                                                            </a>\n                                                        </div>");
                break;

              case "File":
                div += "\n                                                    <div class=\"col-md-3\">\n                                                        <img src=\"/build/global/img/custom-product/icon_attachment.svg\" class=\"img-fluid border-icon\" />\n                                                    </div>\n                                                    <div class=\"col-md-6 px-0 py-13\">\n                                                        <h5>".concat(file_name, "</h5>\n                                                    </div>\n                                                    <div class=\"col-md-3 pl-0 py-11\" align=\"right\">\n                                                        <a href=\"").concat(custom.value, "\" style=\"cursor: pointer;\" download=\"").concat(file_name, "\" title=\"Baixar Arquivo\" target=\"_blank\">\n                                                            <img src=\"/build/global/img/custom-product/icon_download.png\" class=\"img-fluid\" />\n                                                        </a>\n                                                    </div>");
                break;

              case "Image":
                div += "\n                                                    <div class=\"col-md-3\">\n                                                        <img src=\"/build/global/img/custom-product/icon_image.svg\" class=\"img-fluid border-icon\">\n                                                    </div>\n                                                    <div class=\"col-md-6 px-0 py-13\">\n                                                        <h5>".concat(file_name, "</h5>\n                                                    </div>\n                                                    <div class=\"col-md-3 pl-0 py-11\" align=\"right\">\n                                                        <a href=\"").concat(custom.value, "\" style=\"cursor: pointer;\" download=\"").concat(file_name, "\" title=\"Baixar Imagem\"  target=\"_blank\">\n                                                            <img src=\"/build/global/img/custom-product/icon_download.png\" class=\"img-fluid\" />\n                                                        </a>\n                                                    </div>");
                break;
            }
          }

          div += "</div>";
        });
        div += "\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <!-- End Customer additional information -->\n                ";
      }

      $("#table-product").html(div); //Tabela de produtos Tracking Code

      if ((value.sale_status == 1 || value.sale_status == 4) && sale.delivery_id != "") {
        if (value.type_enum == 1) {
          var data = "<tr>\n                                <td>\n                                    <img src='".concat(value.photo, "'  width='35px;' style='border-radius:6px;'><br>\n                                    <span class='small ellipsis'>").concat(value.name, "</span>\n                                </td>\n                                <td>\n                                    <span class=\"small font-weight-bold\">").concat(value.tracking_code, "</span>\n                                </td>\n                                <td>\n                                    <span class='tracking-status-span small'>").concat(value.tracking_status_enum, "</span>\n                                </td>\n                                <td>\n                                    <span class='small'>").concat(value.tracking_created_at, "</span>\n                                </td>\n                            </tr>");
          $("#div_tracking_code").css("display", "block");
          $("#data-tracking-products").append(data);
        }
      } else {
        $("#div_tracking_code").css("display", "none");
      }
    });
    loadOnAny("#modal-saleDetails", true);
  }

  function getDelivery(deliveryId) {
    $.ajax({
      method: "GET",
      url: "/api/delivery/" + deliveryId,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        renderDelivery(response.data);
      }
    });
  }

  function renderDelivery(delivery) {
    $(".btn-save-trackingcode").attr("delivery", delivery.id);
    var deliveryAddress = "Endereço: " + delivery.street + ", " + delivery.number;

    if (!isEmpty(delivery.complement)) {
      deliveryAddress += ", " + delivery.complement;
    }

    $("#delivery-address").text(deliveryAddress);
    $("#delivery-neighborhood").text("Bairro: " + delivery.neighborhood);
    $("#delivery-zipcode").text("CEP: " + delivery.zip_code);
    $("#delivery-city").text("Cidade: " + delivery.city + "/" + delivery.state);
  }

  function getCheckout(checkoutId) {
    $.ajax({
      method: "GET",
      url: "/api/checkout/" + checkoutId,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        renderCheckout(response.data);
      }
    });
  }

  function renderCheckout(checkout) {
    $("#checkout-ip").text("IP: " + checkout.ip);
    $("#checkout-operational-system").text("Dispositivo: " + checkout.operational_system);
    $("#checkout-browser").text("Navegador: " + checkout.browser);
    $("#checkout-src").text("SRC: " + checkout.src);
    $("#checkout-source").text("UTM Source: " + checkout.source);
    $("#checkout-medium").text("UTM Medium: " + checkout.utm_medium);
    $("#checkout-campaign").text("UTM Campaign: " + checkout.utm_campaign);
    $("#checkout-term").text("UTM Term: " + checkout.utm_term);
    $("#checkout-content").text("UTM Content: " + checkout.utm_content); //remove o loader depois de tudo carregado

    loadOnAny("#modal-saleDetails", true);
  } // FIM - MODAL DETALHES DA VENDA
  //Estornar venda


  function refundedClick() {
    var refundedValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var refundObservation = arguments.length > 1 ? arguments[1] : undefined;
    var refundUrl = arguments.length > 2 ? arguments[2] : undefined;
    var partial = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    $(".btn-confirm-refund-transaction").prop("disabled", true);
    loadingOnScreen();
    $.ajax({
      method: "POST",
      url: refundUrl,
      data: {
        refunded_value: refundedValue,
        partial: partial,
        refund_observation: refundObservation
      },
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        loadingOnScreenRemove();
        $("#modal-refund-transaction").modal("toggle");
        errorAjaxResponse(response); //atualizar(currentPage);

        $(".btn-confirm-refund-transaction").prop("disabled", false);
      },
      success: function success(response) {
        loadingOnScreenRemove();
        $("#modal-refund-transaction").modal("toggle");
        alertCustom("success", response.message);
        $("#refund-observation-transaction").val("");

        if (window.location.pathname.includes("finances")) {
          $("#bt_filtro").trigger("click");
        }

        atualizar(currentPage);
        $(".btn-confirm-refund-transaction").prop("disabled", false);
      }
    });
  } //Estornar boleto


  function refundedBilletClick() {
    var refundedValue = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var refundObservation = arguments.length > 1 ? arguments[1] : undefined;
    var refundUrl = arguments.length > 2 ? arguments[2] : undefined;
    $(".btn-confirm-refund-billet").prop("disabled", true);
    loadingOnChart("#modal-refund-billet");
    $.ajax({
      method: "POST",
      url: refundUrl,
      data: {
        refunded_value: refundedValue,
        refund_observation: refundObservation
      },
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        loadingOnChartRemove(".sirius-loading");
        $("#modal-refund-billet").modal("toggle");
        errorAjaxResponse(response);
        atualizar(currentPage);
        $(".btn-confirm-refund-billet").prop("disabled", false);
      },
      success: function success(response) {
        loadingOnChartRemove(".sirius-loading");
        $("#modal-refund-billet").modal("toggle");
        alertCustom("success", response.message);
        $("#refund-observation-billet").val("");
        atualizar(currentPage);
        $(".btn-confirm-refund-billet").prop("disabled", false);
      }
    });
  } //Gera ordem shopify


  function newOrderClick(sale) {
    loadingOnScreen();
    $.ajax({
      method: "POST",
      url: "/api/sales/newordershopify/" + sale,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        loadingOnScreenRemove();
        errorAjaxResponse(response);
        atualizar(currentPage);
      },
      success: function success(response) {
        loadingOnScreenRemove();
        alertCustom("success", response.message);
        atualizar(currentPage);
      }
    });
  } //Gera ordem woocommerce


  function newOrderWooClick(sale) {
    loadingOnScreen();
    $.ajax({
      method: "POST",
      url: "/api/sales/neworderwoocommerce/" + sale,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        loadingOnScreenRemove();
        errorAjaxResponse(response);
        atualizar(currentPage);
      },
      success: function success(response) {
        loadingOnScreenRemove();
        alertCustom("success", response.message);
        atualizar(currentPage);
      }
    });
  }

  $(document).on("click", "#btnSaleReSendEmail", function () {
    saleReSendEmail($("#sale-code").text());
  }); // reenvia email da venda para o cliente

  function saleReSendEmail(sale) {
    var btnSaleReSendEmail = $("#btnSaleReSendEmail");

    if (!btnSaleReSendEmail.hasClass("sending")) {
      btnSaleReSendEmail.css("opacity", ".5").addClass("sending");
      $.ajax({
        method: "POST",
        url: "/api/sales/saleresendemail",
        dataType: "json",
        data: {
          sale: sale
        },
        headers: {
          Authorization: $('meta[name="access-token"]').attr("content"),
          Accept: "application/json"
        },
        error: function error(response) {
          btnSaleReSendEmail.css("opacity", "1").removeClass("sending");
          errorAjaxResponse(response);
        },
        success: function success(response) {
          btnSaleReSendEmail.css("opacity", "1").removeClass("sending");
          alertCustom("success", response.message);
        }
      });
    }
  }
  /* $('#').on('submit', function (e) {
       // validation code here
      if (!valid) {
          e.preventDefault();
      }
  });*/

});
=======
$((function(){$("#discount_value").mask("00%",{reverse:!0}),$("#apply_discount").on("click",(function(){$("#div_discount").is(":visible")?($("#div_discount").hide(),$("#discount_value").val("")):($("#div_discount").show(),$("#discount_type").on("change",(function(){"value"==$("#discount_type").val()?($("#discount_value").mask("#.###,#0",{reverse:!0}).removeAttr("maxlength"),$("#label_discount_value").html("Valor (ex: 20,00)")):($("#discount_value").mask("00%",{reverse:!0}),$("#label_discount_value").html("Valor (ex: 20%)"))})))})),$(document).on("click","#boleto-link .copy_link",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(document).on("click","#boleto-digitable-line .copy_link",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("digitable-line")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Linha Digitável copiado!")})),$(document).on("click",".btn-copy-thank-page-url",(function(){var a=$("<input>");$(".sales-details").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(document).on("click",".btn-copy-custom-text",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(".btn-edit-client").on("click",(function(){var a=$(this).parent();a.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),a.find(".btn-save-client").show(),a.find(".btn-close-client").show()})),$(".btn-close-client").on("click",(function(){var a=$(this).parent();a.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),a.find(".btn-save-client").hide(),a.find(".btn-edit-client").show()})),$(".btn-save-client").on("click",(function(){var a=this,e=$(this).parent(),t=e.find("input"),n={id:t.attr("client"),name:t.attr("name"),value:t.val(),_method:"PUT"};$.ajax({method:"POST",url:"/api/customers/update",dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(a).hide(),e.find(".btn-close-client").hide(),e.find(".btn-edit-client").show(),alertCustom("success","Dados do cliente alterados com successo!")}})})),$(document).on("click",".btn-edit-observation",(function(){var a=$(this).parent();a.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),a.find(".btn-save-observation").show(),a.find(".btn-close-observation").show()})),$(document).on("click",".btn-close-observation",(function(){var a=$(this).parent();a.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),a.find(".btn-save-observation").hide(),a.find(".btn-edit-observation").show()})),$(document).on("click",".btn-save-observation",(function(){var a=this;if(""==$("#refund-observation").val())return alertCustom("error","Dados informados inválidos"),!1;var e=$(this).parent(),t=e.find("input"),n={id:t.attr("sale"),name:t.attr("name"),value:t.val()};$.ajax({method:"POST",url:"/api/sales/updaterefundobservation/"+t.attr("sale"),dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(a).hide(),e.find(".btn-close-observation").hide(),e.find(".btn-edit-observation").show(),alertCustom("success","Causa do estorno alterado com successo!")}})})),$(document).on("click",".detalhes_venda",(function(){var a=$(this).attr("venda");loadOnAny("#modal-saleDetails"),$("#nav-home-tab").addClass("active"),$("#nav-home-tab").addClass("show"),$("#nav-home").addClass("active"),$("#nav-home").addClass("show"),$("#nav-profile-tab").removeClass("active"),$("#nav-profile-tab").removeClass("show"),$("#nav-profile").removeClass("active"),$("#nav-profile").removeClass("show"),$("#nav-woo-tab").removeClass("active"),$("#nav-woo").removeClass("active"),$("#nav-woo").removeClass("show"),$("#modal_detalhes").modal("show"),$("#refundAmount").mask("##.###,#0",{reverse:!0}),$("#refundBilletAmount").mask("##.###,#0",{reverse:!0}),$.ajax({method:"GET",url:"/api/sales/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){$("#modal_detalhes").modal("hide"),errorAjaxResponse(a)},success:function(a){!function(a){(function(a){var e="";e=1==a.payment_method?"Cartão":3==a.payment_method?"Debito":4==a.payment_method?"PIX":"Boleto";$("#comission-details").css("display","flex"),$("#sale-code").text(a.id),!a.upsell||$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Upsell → '.concat(a.upsell,"</span>"));a.has_order_bump&&$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Order Bump </span>');$("#payment-type").text("Pagamento via "+e+" em "+a.start_date+" às "+a.hours),""!=a.release_date?$("#release-date").text("Data de liberação: "+a.release_date):$("#release-date").text("");$("#card-company").text("Empresa responsável pelo faturamento: "+a.company_name),isEmpty(a.observation)?$("#sale-observation").addClass("collapse"):$("#sale-observation").removeClass("collapse");$("#observation").val(a.observation);var t=$(".modal-body #status");switch(t.html(""),t.append('<img style="width: 50px;" src="/build/global/img/cartoes/'+a.flag+'.png">'),a.status){case 1:t.append("<span class='ml-2 badge badge-success'>Aprovada</span>");break;case 2:t.append("<span class='ml-2 badge badge-pendente'>Pendente</span>");break;case 3:t.append("<span class='ml-2 badge badge-danger'>Recusada</span>");break;case 4:t.append("<span class='ml-2 badge badge-chargeback'>Chargeback</span>");break;case 6:t.append("<span class='ml-2 badge badge-primary'>Em análise</span>");break;case 7:case 22:t.append("<span class='ml-2 badge badge-danger'>Estornado</span>");break;case 8:t.append("<span class='ml-2 badge badge-danger'>Estorno Parcial</span>");break;case 20:t.append("<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>");break;case 21:t.append("<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>");break;case 23:t.append("<span class='ml-2 badge badge-warning'>Recuperado</span>");break;case 24:t.append("<span class='ml-2 badge badge-antifraude'>Em disputa</span>");break;default:t.append("<span class='ml-2 badge badge-primary'>"+a.status+"</span>")}a.is_chargeback_recovered&&1==a.status?$("#chargeback-recovered").show():$("#chargeback-recovered").hide();$("#subtotal-value").html(a.subTotal),$("#shipment-value").html(a.shipment_value),$("#iof-label, #iof-value, #cambio-label, #cambio-value").hide(),a.dolar_quotation&&($("#cambio-label span").text("Câmbio (1 $ = R$ "+a.dolar_quotation+"): "),$("#cambio-value span").text("US$ "+a.taxa),$("#cambio-label, #cambio-value").show());$("#taxas-installment-free-label, #taxa-installment-value").hide(),0!==parseFloat(a.installment_tax_value.replace(/[^\d]/g,""))&&"producer"==a.user_sale_type&&($("#taxa-installment-value").html(a.installment_tax_value),$("#taxas-installment-free-label").show(),$("#taxa-installment-value").show());parseFloat(a.discount.replace(/[^\d]/g,""))>0?($("#discount-title").show(),$("#discount-data").show(),$("#desconto-value").html(a.discount)):($("#discount-title").hide(),$("#discount-data").hide(),$("#automatic-discount-value").hide());a.cupom_code?($("#cupom-code").html(a.cupom_code),$(".cupom-info").show()):$(".cupom-info").hide();if($(".text-discount").html(""),$("#automatic-discount-value").html(""),parseInt(a.automatic_discount.replace(/[^\d]/g,""))>0){switch(a.payment_method){case 2:$(".text-discount").html("Desconto automático boleto");break;case 4:$(".text-discount").html("Desconto automático pix");break;default:$(".text-discount").html("Desconto automático cartão")}$(".automatic-discount-value").show(),$(".text-discount").show(),$("#automatic-discount-value").html(a.automatic_discount).show()}else $(".automatic-discount-value").hide(),$(".text-discount").hide();"refunded"!=a.status_name?$("#total-value").html(a.total):$("#total-value").html(' <del style="color: #F41C1C !important;">'.concat(a.total,"</del>"));"0,00"!=a.refund_value&&8==a.status?($(".text-partial-refund").show(),$("#partial-refund-value").html(a.refund_value),$("#partial-refund-value").show()):($(".text-partial-refund").hide(),$("#partial-refund-value").hide());parseInt(a.progressive_discount.replace(/[^\d]/g,""))>0?($("#discount-prog-title").show(),$("#discount-prog-data span").html(a.progressive_discount),$("#discount-prog-data").show()):($("#discount-prog-data").hide(),$("#discount-prog-title").hide());"refunded"==a.status_name&&$("#comission-details").css("display","none");$("#taxas-label").html(a.tax?a.checkout_tax?"Taxas ("+a.tax+" + "+a.transaction_tax+" + "+a.checkout_tax+"): ":"Taxas ("+a.tax+" + "+a.transaction_tax+"): ":"Taxas"),$("#taxareal-value").html(a.taxaReal?a.taxaReal:""),$("#tax-value-total").html("Valor total: "),"refunded"!=a.status_name?$("#tax-value-total-value").html(a.total_parcial):$("#tax-value-total-value").html(' <del style="color: #F41C1C !important;">'.concat(a.total_parcial,"</del>"));$("#tax-percentage").html("Taxa (".concat(a.tax,")")),$("#tax-percentage-value").html("".concat(a.taxaDiscount)),$("#tax-fixed").html("Taxa fixa: "),$("#tax-fixed-value").html("".concat(a.transaction_tax)),a.checkout_tax?($("#tax-checkout").html("Taxa de checkout: "),$("#tax-checkout-value").html("".concat(a.checkout_tax)),$("#div_tax_checkout").show()):($("#tax-checkout").html(""),$("#tax-checkout-value").html(""),$("#div_tax_checkout").hide());$("#tax-total").html("Valor total das taxas: "),$("#tax-total-value").html("- ".concat(a.totalTax)),$("#tax-comission").html("Valor recebido"),$("#tax-comission-value").html("<b>".concat(a.comission,"</b>")),$("#convertax-label, #convertax-value").hide(),"0,00"!==a.convertax_value&&($("#convertax-value").text(a.convertax_value?a.convertax_value:""),$("#convertax-label, #convertax-value").show());"0,00"!=a.value_anticipable&&($(".div-anticipated").show(),$(".div-value-anticipated").html("").append("<span class='text-muted ft-12'> ".concat(a.value_anticipable,"</span>")).show());a.has_cashback?($("#cashback-label").removeClass("d-none"),$("#cashback-value").removeClass("d-none").html("").append("<span class='ft-12' style=\"color: #5EE2A1;\"> + ".concat(a.cashback_value,"</span>")).show(),$("#tax-subtotal").html("Subtotal:").parent().removeClass("d-none"),$("#tax-subtotal-value").html(a.total).parent().removeClass("d-none"),$("#tax-cashback").html("Cashback:").parent().removeClass("d-none"),$("#tax-cashback-value").html("+ ".concat(a.cashback_value)).parent().removeClass("d-none").show()):($("#cashback-label").addClass("d-none"),$("#cashback-value").addClass("d-none").html(""),$("#tax-subtotal").parent().addClass("d-none"),$("#tax-subtotal-value").parent().addClass("d-none"),$("#tax-cashback").parent().addClass("d-none"),$("#tax-cashback-value").parent().addClass("d-none"));"affiliate"==a.user_sale_type?($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=a.affiliate?($(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do produtor: </span>"),$("#user-type-comission-value").html(a.comission)):($(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide())):($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=a.affiliate?($(".div-sale-by-affiliate").show().html("<h4 class='table-title'>Venda realizada pelo afiliado "+a.affiliate+"</h4>"),$(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do afiliado: </span>"),$("#user-type-comission-value").html(a.affiliate_comission)):($(".div-sale-by-affiliate").hide(),$(".div-affiliate-name").hide().html(""),$(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide()),$("#comission-value").text(a.comission?a.comission:""));""!=a.affiliate_comission&&"affiliate"==a.user_sale_type&&$("#comission-value").text(a.affiliate_comission);if(a.has_woocommerce_integration)if($("#nav-woo-tab").show(),a.woocommerce_order){var n="Status: <strong>"+a.woocommerce_order.status+"</strong>";$("#woo_order").html(n),$("#resendWoocommerceOrder").addClass("d-none"),$("#resendWoocommerceOrder").removeClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale","")}else $("#woo_order").html("Ordem não encontrada!"),a.woocommerce_retry_order&&($("#resendWoocommerceOrder").removeClass("d-none"),$("#resendWoocommerceOrder").addClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale",a.id),$(".btn_new_order_woocommerce").unbind("click"),$(".btn_new_order_woocommerce").on("click",(function(){var a=$(this).attr("sale");$("#modal-new-order-woocommerce").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-woocommerce").unbind("click"),$(".btn-confirm-new-order-woocommerce").on("click",(function(){!function(a){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/neworderwoocommerce/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a),atualizar(currentPage)},success:function(a){loadingOnScreenRemove(),alertCustom("success",a.message),atualizar(currentPage)}})}(a)}))})));else $("#nav-woo-tab").hide();a.has_shopify_integration?(a.shopify_order||20==a.status?($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale","")):($("#resendShopfyOrder").removeClass("d-none"),$("#resendShopfyOrder").addClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",a.id),$(".btn_new_order_shopify").unbind("click"),$(".btn_new_order_shopify").on("click",(function(){var a=$(this).attr("sale");$("#modal-new-order-shopify").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-shopify").unbind("click"),$(".btn-confirm-new-order-shopify").on("click",(function(){!function(a){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/newordershopify/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a),atualizar(currentPage)},success:function(a){loadingOnScreenRemove(),alertCustom("success",a.message),atualizar(currentPage)}})}(a)}))}))),$("#details-shopify").show()):($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",""));$("#nav-profile #card-company").text("Empresa: Nome da Empresa"),1===a.payment_method&&($("#details-card #card-flag").text("Bandeira: "+a.flag),$("#details-card #card-installments").text("Quantidade de parcelas: "+a.installments_amount),$("#details-card").show(),$("#details-boleto").hide());2===a.payment_method&&($("#details-boleto #boleto-link a").attr("link",a.boleto_link),$("#details-boleto #boleto-digitable-line a").attr("digitable-line",a.boleto_digitable_line),$("#details-boleto #boleto-due").text("Vencimento: "+a.boleto_due_date),$("#details-card").hide(),$("#details-boleto").show());4===a.payment_method&&($("#details-card").hide(),$("#details-boleto").hide());$("#checkout-attempts").hide(),1===a.payment_method&&$("#checkout-attempts").text("Quantidade de tentativas: "+a.attempts).show();$("#div_refund").html(""),a.refund_enabled?2!=a.payment_method?$("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_transaction" sale='+a.id+">Estornar transação</button>"):$("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_billet" sale='+a.id+">Estornar boleto</button>"):a.already_refunded&&$("#div_refund").html('<a href="/sales/'+a.id+'/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>');7==a.status||22==a.status?$("#div_refund_receipt").html('<a href="/sales/'+a.id+'/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>'):$("#div_refund_receipt").html("");2==a.status||1==a.status?a.api_flag?$("#saleReSendEmail").hide():$("#saleReSendEmail").show():$("#saleReSendEmail").hide();a.api_flag?$("#details-api").show():$("#details-api").hide();null!=a.refund_observation?($(".div-refund-observation").show(),$("#refund-observation").val(a.refund_observation).attr("sale",a.id),a.user_changed_observation?$(".btn-edit-observation").show():$(".btn-edit-observation").hide()):$(".div-refund-observation").hide();""!=a.thank_page_url?($("#thank-page-url").text(a.thank_label_text).show(),$(".btn-copy-thank-page-url").attr("link",a.thank_page_url),$(".btn-copy-thank-page-url").show()):($("#thank-page-url").hide(),$(".btn-copy-thank-page-url").hide());""!=a.delivery_id?$("#div_delivery").css("display","block"):$("#div_delivery").css("display","none");1==verifyAccountFrozen()?($(".btn-edit-client").hide(),$("#update-sale-observation").hide(),$("#saleReSendEmail").hide(),$("#div_refund").hide()):($(".btn-edit-client").show(),$("#update-sale-observation").show(),$("#div_refund").show())})(a),function(a){$("#table-product").html(""),$("#data-tracking-products").html(""),$.ajax({method:"GET",url:"/api/products/saleproducts/"+a.id,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(e){var t,n;a.api_flag?(t=e.data,n="",$.each(t,(function(a,e){n+='<div class="row justify-content-between mb-15">',n+='<div class="col-lg-2">',n+='<img src="/build/global/img/produto.svg" width="50px" height="50px" style="border-radius: 6px;">',n+="</div>",n+='<div class="col-md-5 col-lg-6">',n+='<h4 class="table-title m-0">'+e.name+"</h4>",n+="<small>"+e.description+"</small>",n+="</div>",n+='<div class="col-md-3 col-lg-2 text-right">',n+='<p class="sm-text text-muted">'+e.amount+"x</p>",n+="</div>",n+="</div>",$("#table-product").html(n)})),loadOnAny("#modal-saleDetails",!0)):function(a,e){var t="",n="/build/global/img/produto.svg";$.each(a,(function(a,o){if(o.photo||(o.photo=n),t+='\n                <div class="row justify-content-between mb-15">\n                    <div class="col-lg-2">\n                        <img src=\''.concat(o.photo,"' onerror=this.src='/build/global/img/produto.png' width='50px' height='50px' style='border-radius: 6px;'>\n                    </div>\n\n                    <div class=\"col-md-5 col-lg-6\">\n                        <h4 class=\"table-title m-0\">").concat(o.name,"</h4>\n                        <small>").concat(o.description,'</small>\n                    </div>\n\n                    <div class="col-md-3 col-lg-2 text-right">\n                        <p class="sm-text text-muted">').concat(o.amount,"x</p>\n                    </div>\n                </div>"),void 0!==o.custom_products&&o.custom_products.length>0){t+='\x3c!-- Customer additional information --\x3e\n                    <div class="panel-group my-30" aria-multiselectable="true" role="tablist">\n                        <div class="panel panel-custom-product">\n                            <div class="panel-heading" id="sale-custom-product-accordion-'.concat(o.sale_id).concat(o.id).concat(a,'" role="tab">\n                                <a class="panel-title" data-toggle="collapse" href="#sale-custom-product-').concat(o.sale_id).concat(o.id).concat(a,'"\n                                data-parent="#custom-product-accordion').concat(o.id,'" aria-expanded="true"\n                                aria-controls="exampleCollapseDefaultOne">\n                                    <strong>Personalizações enviadas pelo cliente</strong>\n                                </a>\n                            </div>\n                            <div class="panel-collapse collapse" id="sale-custom-product-').concat(o.sale_id).concat(o.id).concat(a,'"\n                                aria-labelledby="sale-custom-product-accordion-').concat(o.sale_id).concat(o.id).concat(a,'" role="tabpanel" style="">\n                                <div class="panel-body">');var s=null;line_temp=0,$.each(o.custom_products,(function(a,e){if(line_temp!=e.line&&(t+="<hr/>",line_temp=e.line),t+='<div class="row mt-2">',void 0!==e.type_enum)switch("Text"!=e.type_enum&&(s=e.file_name.substr(-20)),e.type_enum){case"Text":t+='\n                                                        <div class="col-md-3">\n                                                            <img src="/build/global/img/custom-product/icon_text.svg" class="img-fluid border-icon">\n                                                        </div>\n                                                        <div class="col-md-6 px-0 py-13">\n                                                            <h5>'.concat(e.value,'</h5>\n                                                        </div>\n                                                        <div class="col-md-3 pl-0 py-11" align="right">\n                                                            <a role="button" class="copy_link btn-copy-custom-text" style="cursor: pointer;"  link="').concat(e.value,'" title="Copiar link">\n                                                                <span class="material-icons icon-copy-1"> content_copy </span>\n                                                            </a>\n                                                        </div>');break;case"File":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_attachment.svg" class="img-fluid border-icon" />\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(e.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Arquivo" target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>');break;case"Image":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_image.svg" class="img-fluid border-icon">\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(e.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Imagem"  target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>')}t+="</div>"})),t+="\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \x3c!-- End Customer additional information --\x3e\n                "}switch($("#table-product").html(t),e.status){case 1:"<span class='ml-2 badge badge-success'>Aprovada</span>";break;case 2:"<span class='ml-2 badge badge-pendente'>Pendente</span>";break;case 3:"<span class='ml-2 badge badge-danger'>Recusada</span>";break;case 4:"<span class='ml-2 badge badge-chargeback'>Chargeback</span>";break;case 6:"<span class='ml-2 badge badge-primary'>Em análise</span>";break;case 7:case 22:"<span class='ml-2 badge badge-danger'>Estornado</span>";break;case 8:"<span class='ml-2 badge badge-danger'>Estorno Parcial</span>";break;case 20:"<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>";break;case 21:"<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>";break;case 23:"<span class='ml-2 badge badge-warning'>Recuperado</span>";break;case 24:"<span class='ml-2 badge badge-antifraude'>Em disputa</span>";break;default:"<span class='ml-2 badge badge-primary'>"+e.status+"</span>"}if(1!=o.sale_status&&4!=o.sale_status||""==e.delivery_id)$("#div_tracking_code").css("display","none");else if(1==o.type_enum){var i="<tr>\n                                <td>\n                                    <img src='".concat(o.photo,"'  width='35px;' style='border-radius:6px;'><br>\n                                    <span class='small ellipsis'>").concat(o.name,'</span>\n                                </td>\n                                <td>\n                                    <span class="small font-weight-bold">').concat(o.tracking_code,"</span>\n                                </td>\n                                <td>\n                                    <span class='tracking-status-span small'>").concat(o.tracking_status_enum,"</span>\n                                </td>\n                                <td>\n                                    <span class='small'>").concat(o.tracking_created_at,"</span>\n                                </td>\n                            </tr>");$("#div_tracking_code").css("display","block"),$("#data-tracking-products").append(i)}})),loadOnAny("#modal-saleDetails",!0)}(e.data,a)}})}(a),function(a,e){$.ajax({method:"GET",url:"/api/customers/"+a+"/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){$("#client-name").text("Nome: "+a.name),$("#client-telephone").val(a.telephone).attr("client",a.code).mask("+00 (00) 00000-0000"),$("#client-email").val(a.email).attr("client",a.code),$("#client-document").text("CPF: "+a.document),a.fraudster?($("#client-whatsapp-container").hide(),$(".btn-edit-client").hide()):($(".btn-edit-client").show(),$("#client-whatsapp-container").show(),$("#client-whatsapp").attr("href",a.whatsapp_link))}(a.data)}})}(a.client_id,a.id),""!=a.delivery_id&&(e=a.delivery_id,$.ajax({method:"GET",url:"/api/delivery/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){$(".btn-save-trackingcode").attr("delivery",a.id);var e="Endereço: "+a.street+", "+a.number;isEmpty(a.complement)||(e+=", "+a.complement),$("#delivery-address").text(e),$("#delivery-neighborhood").text("Bairro: "+a.neighborhood),$("#delivery-zipcode").text("CEP: "+a.zip_code),$("#delivery-city").text("Cidade: "+a.city+"/"+a.state)}(a.data)}}));var e;a.api_flag?$(".dados-checkout").css("display","none"):($(".dados-checkout").css("display","block"),t=a.checkout_id,$.ajax({method:"GET",url:"/api/checkout/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){var e;e=a.data,$("#checkout-ip").text("IP: "+e.ip),$("#checkout-operational-system").text("Dispositivo: "+e.operational_system),$("#checkout-browser").text("Navegador: "+e.browser),$("#checkout-src").text("SRC: "+e.src),$("#checkout-source").text("UTM Source: "+e.source),$("#checkout-medium").text("UTM Medium: "+e.utm_medium),$("#checkout-campaign").text("UTM Campaign: "+e.utm_campaign),$("#checkout-term").text("UTM Term: "+e.utm_term),$("#checkout-content").text("UTM Content: "+e.utm_content),loadOnAny("#modal-saleDetails",!0)}}));var t;!function(a){if(!isEmpty(a)){var e=a[a.length-1];$.ajax({method:"GET",url:"/api/apps/notazz/invoice/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){if(isEmpty(a))$("#div_notazz_invoice").hide();else{if($("#data-notazz-invoices").empty(),a.date_pending){var e="<tr>\n                                <td>\n                                    ".concat(a.date_pending,"\n                                </td>\n                                <td>\n                                    Pendente de envio\n                                </td>\n                                <td>\n                                    0\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(e)}if(a.date_sent){var t=null==a.return_message?"Sucesso":a.return_message,n=a.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",o=a.pdf?"<a href='"+a.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",s="\n                    <tr>\n                        <td>\n                            ".concat(a.date_sent,"\n                        </td>\n\n                        <td>\n                            ").concat(n,"\n                        </td>\n\n                        <td>\n                            ").concat(a.return_http_code,"\n                        </td>\n\n                        <td>\n                            ").concat(t,"\n                        </td>\n\n                        <td>\n                            ").concat(o,"\n                        </td>\n\n                    </tr>");$("#data-notazz-invoices").append(s)}if(a.date_error){var i=a.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",l="<tr>\n                                <td>\n                                    ".concat(a.date_error,"\n                                </td>\n                                <td>\n                                    ").concat(i,"\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(a.return_message,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(l)}if(a.date_rejected){var c=null==a.postback_message?"Rejeitado":a.postback_message,d="<tr>\n                                <td>\n                                    ".concat(a.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fiscal rejeitada\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(c,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(d)}if(a.date_canceled){var r=a.pdf?"<a href='"+a.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",u="<tr>\n                                <td>\n                                    ".concat(a.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fical cancelada\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n                                    ").concat(r,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(u)}a.return_message&&$("#div_notazz_schedule").html("Próxima tentativa de envio em "+a.schedule),$("#div_notazz_invoice").show()}}(a.data)}})}}(a.invoices)}(a.data),$("#refundAmount").val(a.data.total),$("#refundBilletAmount").text(a.data.total),$(".btn_refund_transaction").unbind("click"),$(".btn_refund_transaction").on("click",(function(){$("#refund-observation-transaction").val(""),$("#modal_detalhes").modal("hide"),$("#modal-refund-transaction").modal("show"),$("#asaas_message").html(""),""!=a.data.asaas_amount_refund&&$("#asaas_message").html('<p class="gray"> Esta venda já foi antecipada, o valor a ser debitado no extrato será de <strong>'.concat(a.data.asaas_amount_refund,"</strong></p>")),$("#radioTotalRefund").on("click",(function(){$(".value-partial-refund").hide()})),$("#radioPartialRefund").on("click",(function(){$(".value-partial-refund").show()})),$(".btn-confirm-refund-transaction").unbind("click"),$(".btn-confirm-refund-transaction").on("click",(function(){var e=$("#refund-observation-transaction").val();if(e.length<4)alertCustom("error","Preencha o motivo do estorno para prosseguir");else{var t=0;document.getElementById("radioPartialRefund").checked&&(t=1),function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$(".btn-confirm-refund-transaction").prop("disabled",!0),loadingOnScreen(),$.ajax({method:"POST",url:t,data:{refunded_value:a,partial:n,refund_observation:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),$("#modal-refund-transaction").modal("toggle"),errorAjaxResponse(a),$(".btn-confirm-refund-transaction").prop("disabled",!1)},success:function(a){loadingOnScreenRemove(),$("#modal-refund-transaction").modal("toggle"),alertCustom("success",a.message),$("#refund-observation-transaction").val(""),window.location.pathname.includes("finances")&&$("#bt_filtro").trigger("click"),atualizar(currentPage),$(".btn-confirm-refund-transaction").prop("disabled",!1)}})}($("#refundAmount").val(),e,a.data.refund_url,t)}}))})),$(".btn_refund_billet").unbind("click"),$(".btn_refund_billet").on("click",(function(){$("#refund-observation-billet").val("");var e=a.data.total;$(".billet-refunded-tax-value").text(a.data.taxaReal?a.data.taxaReal:""),$("#modal_detalhes").modal("hide"),$("#modal-refund-billet").modal("show"),$(".btn-confirm-refund-billet").unbind("click"),$(".btn-confirm-refund-billet").on("click",(function(){var t=$("#refund-observation-billet").val();t.length<4?alertCustom("error","Preencha o motivo do estorno para prosseguir"):function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;$(".btn-confirm-refund-billet").prop("disabled",!0),loadingOnChart("#modal-refund-billet"),$.ajax({method:"POST",url:t,data:{refunded_value:a,refund_observation:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-billet").modal("toggle"),errorAjaxResponse(a),atualizar(currentPage),$(".btn-confirm-refund-billet").prop("disabled",!1)},success:function(a){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-billet").modal("toggle"),alertCustom("success",a.message),$("#refund-observation-billet").val(""),atualizar(currentPage),$(".btn-confirm-refund-billet").prop("disabled",!1)}})}(e,t,a.data.refund_url)}))}))}})})),$("#update-sale-observation").click((function(){var a=$("#sale-code").text().substring(0,8);$.ajax({method:"POST",url:"/api/sales/set-observation/"+a,data:{observation:$("#observation").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content")},error:function(a){errorAjaxResponse(a)},success:function(a){alertCustom("success",a.message),atualizar(currentPage)}})})),$(document).on("click","#btnSaleReSendEmail",(function(){var a,e;a=$("#sale-code").text(),(e=$("#btnSaleReSendEmail")).hasClass("sending")||(e.css("opacity",".5").addClass("sending"),$.ajax({method:"POST",url:"/api/sales/saleresendemail",dataType:"json",data:{sale:a},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){e.css("opacity","1").removeClass("sending"),errorAjaxResponse(a)},success:function(a){e.css("opacity","1").removeClass("sending"),alertCustom("success",a.message)}}))}))}));
>>>>>>> master
