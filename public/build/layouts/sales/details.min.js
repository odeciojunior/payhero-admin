$((function(){$("#discount_value").mask("00%",{reverse:!0}),$("#apply_discount").on("click",(function(){$("#div_discount").is(":visible")?($("#div_discount").hide(),$("#discount_value").val("")):($("#div_discount").show(),$("#discount_type").on("change",(function(){"value"==$("#discount_type").val()?($("#discount_value").mask("#.###,#0",{reverse:!0}).removeAttr("maxlength"),$("#label_discount_value").html("Valor (ex: 20,00)")):($("#discount_value").mask("00%",{reverse:!0}),$("#label_discount_value").html("Valor (ex: 20%)"))})))})),$(document).on("click","#boleto-link .copy_link",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(document).on("click","#boleto-digitable-line .copy_link",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("digitable-line")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Linha Digitável copiado!")})),$(document).on("click",".btn-copy-thank-page-url",(function(){var a=$("<input>");$(".sales-details").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(document).on("click",".btn-copy-custom-text",(function(){var a=$("<input>");$("#nav-tabContent").append(a),a.val($(this).attr("link")).select(),document.execCommand("copy"),a.remove(),alertCustom("success","Link copiado!")})),$(".btn-edit-client").on("click",(function(){var a=$(this).parent();a.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),a.find(".btn-save-client").show(),a.find(".btn-close-client").show()})),$(".btn-close-client").on("click",(function(){var a=$(this).parent();a.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),a.find(".btn-save-client").hide(),a.find(".btn-edit-client").show()})),$(".btn-save-client").on("click",(function(){var a=this,e=$(this).parent(),t=e.find("input"),n={id:t.attr("client"),name:t.attr("name"),value:t.val(),_method:"PUT"};$.ajax({method:"POST",url:"/api/customers/update",dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(a).hide(),e.find(".btn-close-client").hide(),e.find(".btn-edit-client").show(),alertCustom("success","Dados do cliente alterados com successo!")}})})),$(document).on("click",".btn-edit-observation",(function(){var a=$(this).parent();a.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),a.find(".btn-save-observation").show(),a.find(".btn-close-observation").show()})),$(document).on("click",".btn-close-observation",(function(){var a=$(this).parent();a.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),a.find(".btn-save-observation").hide(),a.find(".btn-edit-observation").show()})),$(document).on("click",".btn-save-observation",(function(){var a=this;if(""==$("#refund-observation").val())return alertCustom("error","Dados informados inválidos"),!1;var e=$(this).parent(),t=e.find("input"),n={id:t.attr("sale"),name:t.attr("name"),value:t.val()};$.ajax({method:"POST",url:"/api/sales/updaterefundobservation/"+t.attr("sale"),dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(a).hide(),e.find(".btn-close-observation").hide(),e.find(".btn-edit-observation").show(),alertCustom("success","Causa do estorno alterado com successo!")}})})),$(document).on("click",".detalhes_venda",(function(){var a=$(this).attr("venda");loadOnAny("#modal-saleDetails"),$("#nav-home-tab").addClass("active"),$("#nav-home-tab").addClass("show"),$("#nav-home").addClass("active"),$("#nav-home").addClass("show"),$("#nav-profile-tab").removeClass("active"),$("#nav-profile-tab").removeClass("show"),$("#nav-profile").removeClass("active"),$("#nav-profile").removeClass("show"),$("#nav-woo-tab").removeClass("active"),$("#nav-woo").removeClass("active"),$("#nav-woo").removeClass("show"),$("#modal_detalhes").modal("show"),$("#refundAmount").mask("##.###,#0",{reverse:!0}),$("#refundBilletAmount").mask("##.###,#0",{reverse:!0}),$.ajax({method:"GET",url:"/api/sales/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){$("#modal_detalhes").modal("hide"),errorAjaxResponse(a)},success:function(a){!function(a){(function(a){var e="";e=1==a.payment_method?"Cartão":3==a.payment_method?"Debito":4==a.payment_method?"PIX":"Boleto";$("#comission-details").css("display","flex"),$("#sale-code").text(a.id),!a.upsell||$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Upsell → '.concat(a.upsell,"</span>"));a.has_order_bump&&$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Order Bump </span>');$("#payment-type").text("Pagamento via "+e+" em "+a.start_date+" às "+a.hours),""!=a.release_date?$("#release-date").text("Data de liberação: "+a.release_date):$("#release-date").text("");$("#card-company").text("Empresa responsável pelo faturamento: "+a.company_name),isEmpty(a.observation)?$("#sale-observation").addClass("collapse"):$("#sale-observation").removeClass("collapse");$("#observation").val(a.observation);var t=$(".modal-body #status");switch(t.html(""),t.append('<img style="width: 50px;" src="/build/global/img/cartoes/'+a.flag+'.png">'),a.status){case 1:t.append("<span class='ml-2 badge badge-success'>Aprovada</span>");break;case 2:t.append("<span class='ml-2 badge badge-pendente'>Pendente</span>");break;case 3:t.append("<span class='ml-2 badge badge-danger'>Recusada</span>");break;case 4:t.append("<span class='ml-2 badge badge-chargeback'>Chargeback</span>");break;case 6:t.append("<span class='ml-2 badge badge-primary'>Em análise</span>");break;case 7:case 22:t.append("<span class='ml-2 badge badge-danger'>Estornado</span>");break;case 8:t.append("<span class='ml-2 badge badge-danger'>Estorno Parcial</span>");break;case 20:t.append("<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>");break;case 21:t.append("<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>");break;case 23:t.append("<span class='ml-2 badge badge-warning'>Recuperado</span>");break;case 24:t.append("<span class='ml-2 badge badge-antifraude'>Em disputa</span>");break;default:t.append("<span class='ml-2 badge badge-primary'>"+a.status+"</span>")}a.is_chargeback_recovered&&1==a.status?$("#chargeback-recovered").show():$("#chargeback-recovered").hide();$("#subtotal-value").html(a.subTotal),$("#shipment-value").html(a.shipment_value),$("#iof-label, #iof-value, #cambio-label, #cambio-value").hide(),a.dolar_quotation&&($("#cambio-label span").text("Câmbio (1 $ = R$ "+a.dolar_quotation+"): "),$("#cambio-value span").text("US$ "+a.taxa),$("#cambio-label, #cambio-value").show());$("#taxas-installment-free-label, #taxa-installment-value").hide(),0!==parseFloat(a.installment_tax_value.replace(/[^\d]/g,""))&&"producer"==a.user_sale_type&&($("#taxa-installment-value").html(a.installment_tax_value),$("#taxas-installment-free-label").show(),$("#taxa-installment-value").show());parseFloat(a.discount.replace(/[^\d]/g,""))>0?($("#discount-title").show(),$("#discount-data").show(),$("#desconto-value").html(a.discount)):($("#discount-title").hide(),$("#discount-data").hide(),$("#automatic-discount-value").hide());a.cupom_code?($("#cupom-code").html(a.cupom_code),$(".cupom-info").show()):$(".cupom-info").hide();if($(".text-discount").html(""),$("#automatic-discount-value").html(""),parseInt(a.automatic_discount.replace(/[^\d]/g,""))>0){switch(a.payment_method){case 2:$(".text-discount").html("Desconto automático boleto");break;case 4:$(".text-discount").html("Desconto automático pix");break;default:$(".text-discount").html("Desconto automático cartão")}$(".automatic-discount-value").show(),$(".text-discount").show(),$("#automatic-discount-value").html(a.automatic_discount).show()}else $(".automatic-discount-value").hide(),$(".text-discount").hide();"refunded"!=a.status_name?$("#total-value").html(a.total):$("#total-value").html(' <del style="color: #F41C1C !important;">'.concat(a.total,"</del>"));"0,00"!=a.refund_value&&8==a.status?($(".text-partial-refund").show(),$("#partial-refund-value").html(a.refund_value),$("#partial-refund-value").show()):($(".text-partial-refund").hide(),$("#partial-refund-value").hide());parseInt(a.progressive_discount.replace(/[^\d]/g,""))>0?($("#discount-prog-title").show(),$("#discount-prog-data span").html(a.progressive_discount),$("#discount-prog-data").show()):($("#discount-prog-data").hide(),$("#discount-prog-title").hide());"refunded"==a.status_name&&$("#comission-details").css("display","none");$("#taxas-label").html(a.tax?a.checkout_tax?"Taxas ("+a.tax+" + "+a.transaction_tax+" + "+a.checkout_tax+"): ":"Taxas ("+a.tax+" + "+a.transaction_tax+"): ":"Taxas"),$("#taxareal-value").html(a.taxaReal?a.taxaReal:""),$("#tax-value-total").html("Valor total: "),"refunded"!=a.status_name?$("#tax-value-total-value").html(a.total_parcial):$("#tax-value-total-value").html(' <del style="color: #F41C1C !important;">'.concat(a.total_parcial,"</del>"));$("#tax-percentage").html("Taxa (".concat(a.tax,")")),$("#tax-percentage-value").html("".concat(a.taxaDiscount)),$("#tax-fixed").html("Taxa fixa: "),$("#tax-fixed-value").html("".concat(a.transaction_tax)),a.checkout_tax?($("#tax-checkout").html("Taxa de checkout: "),$("#tax-checkout-value").html("".concat(a.checkout_tax)),$("#div_tax_checkout").show()):($("#tax-checkout").html(""),$("#tax-checkout-value").html(""),$("#div_tax_checkout").hide());$("#tax-total").html("Valor total das taxas: "),$("#tax-total-value").html("- ".concat(a.totalTax)),$("#tax-comission").html("Valor recebido"),$("#tax-comission-value").html("<b>".concat(a.comission,"</b>")),$("#convertax-label, #convertax-value").hide(),"0,00"!==a.convertax_value&&($("#convertax-value").text(a.convertax_value?a.convertax_value:""),$("#convertax-label, #convertax-value").show());"0,00"!=a.value_anticipable&&($(".div-anticipated").show(),$(".div-value-anticipated").html("").append("<span class='text-muted ft-12'> ".concat(a.value_anticipable,"</span>")).show());a.has_cashback?($("#cashback-label").removeClass("d-none"),$("#cashback-value").removeClass("d-none").html("").append("<span class='ft-12' style=\"color: #5EE2A1;\"> + ".concat(a.cashback_value,"</span>")).show(),$("#tax-subtotal").html("Subtotal:").parent().removeClass("d-none"),$("#tax-subtotal-value").html(a.total).parent().removeClass("d-none"),$("#tax-cashback").html("Cashback:").parent().removeClass("d-none"),$("#tax-cashback-value").html("+ ".concat(a.cashback_value)).parent().removeClass("d-none").show()):($("#cashback-label").addClass("d-none"),$("#cashback-value").addClass("d-none").html(""),$("#tax-subtotal").parent().addClass("d-none"),$("#tax-subtotal-value").parent().addClass("d-none"),$("#tax-cashback").parent().addClass("d-none"),$("#tax-cashback-value").parent().addClass("d-none"));"affiliate"==a.user_sale_type?($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=a.affiliate?($(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do produtor: </span>"),$("#user-type-comission-value").html(a.comission)):($(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide())):($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=a.affiliate?($(".div-sale-by-affiliate").show().html("<h4 class='table-title'>Venda realizada pelo afiliado "+a.affiliate+"</h4>"),$(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do afiliado: </span>"),$("#user-type-comission-value").html(a.affiliate_comission)):($(".div-sale-by-affiliate").hide(),$(".div-affiliate-name").hide().html(""),$(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide()),$("#comission-value").text(a.comission?a.comission:""));""!=a.affiliate_comission&&"affiliate"==a.user_sale_type&&$("#comission-value").text(a.affiliate_comission);if(a.has_woocommerce_integration)if($("#nav-woo-tab").show(),a.woocommerce_order){var n="Status: <strong>"+a.woocommerce_order.status+"</strong>";$("#woo_order").html(n),$("#resendWoocommerceOrder").addClass("d-none"),$("#resendWoocommerceOrder").removeClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale","")}else $("#woo_order").html("Ordem não encontrada!"),a.woocommerce_retry_order&&($("#resendWoocommerceOrder").removeClass("d-none"),$("#resendWoocommerceOrder").addClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale",a.id),$(".btn_new_order_woocommerce").unbind("click"),$(".btn_new_order_woocommerce").on("click",(function(){var a=$(this).attr("sale");$("#modal-new-order-woocommerce").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-woocommerce").unbind("click"),$(".btn-confirm-new-order-woocommerce").on("click",(function(){!function(a){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/neworderwoocommerce/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a),atualizar(currentPage)},success:function(a){loadingOnScreenRemove(),alertCustom("success",a.message),atualizar(currentPage)}})}(a)}))})));else $("#nav-woo-tab").hide();a.has_shopify_integration?(a.shopify_order||20==a.status?($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale","")):($("#resendShopfyOrder").removeClass("d-none"),$("#resendShopfyOrder").addClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",a.id),$(".btn_new_order_shopify").unbind("click"),$(".btn_new_order_shopify").on("click",(function(){var a=$(this).attr("sale");$("#modal-new-order-shopify").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-shopify").unbind("click"),$(".btn-confirm-new-order-shopify").on("click",(function(){!function(a){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/newordershopify/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a),atualizar(currentPage)},success:function(a){loadingOnScreenRemove(),alertCustom("success",a.message),atualizar(currentPage)}})}(a)}))}))),$("#details-shopify").show()):($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",""));$("#nav-profile #card-company").text("Empresa: Nome da Empresa"),1===a.payment_method&&($("#details-card #card-flag").text("Bandeira: "+a.flag),$("#details-card #card-installments").text("Quantidade de parcelas: "+a.installments_amount),$("#details-card").show(),$("#details-boleto").hide());2===a.payment_method&&($("#details-boleto #boleto-link a").attr("link",a.boleto_link),$("#details-boleto #boleto-digitable-line a").attr("digitable-line",a.boleto_digitable_line),$("#details-boleto #boleto-due").text("Vencimento: "+a.boleto_due_date),$("#details-card").hide(),$("#details-boleto").show());4===a.payment_method&&($("#details-card").hide(),$("#details-boleto").hide());$("#checkout-attempts").hide(),1===a.payment_method&&$("#checkout-attempts").text("Quantidade de tentativas: "+a.attempts).show();$("#div_refund").html(""),a.refund_enabled?2!=a.payment_method?$("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_transaction" sale='+a.id+">Estornar transação</button>"):$("#div_refund").html('<button class="btn btn-danger btn-sm btn_refund_billet" sale='+a.id+">Estornar boleto</button>"):a.already_refunded&&$("#div_refund").html('<a href="/sales/'+a.id+'/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>');7==a.status||22==a.status?$("#div_refund_receipt").html('<a href="/sales/'+a.id+'/refundreceipt" class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>'):$("#div_refund_receipt").html("");2==a.status||1==a.status?a.api_flag?$("#saleReSendEmail").hide():$("#saleReSendEmail").show():$("#saleReSendEmail").hide();a.api_flag?$("#details-api").show():$("#details-api").hide();null!=a.refund_observation?($(".div-refund-observation").show(),$("#refund-observation").val(a.refund_observation).attr("sale",a.id),a.user_changed_observation?$(".btn-edit-observation").show():$(".btn-edit-observation").hide()):$(".div-refund-observation").hide();""!=a.thank_page_url?($("#thank-page-url").text(a.thank_label_text).show(),$(".btn-copy-thank-page-url").attr("link",a.thank_page_url),$(".btn-copy-thank-page-url").show()):($("#thank-page-url").hide(),$(".btn-copy-thank-page-url").hide());""!=a.delivery_id?$("#div_delivery").css("display","block"):$("#div_delivery").css("display","none");1==verifyAccountFrozen()?($(".btn-edit-client").hide(),$("#update-sale-observation").hide(),$("#saleReSendEmail").hide(),$("#div_refund").hide()):($(".btn-edit-client").show(),$("#update-sale-observation").show(),$("#div_refund").show())})(a),function(a){$("#table-product").html(""),$("#data-tracking-products").html(""),$.ajax({method:"GET",url:"/api/products/saleproducts/"+a.id,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(e){var t,n;a.api_flag?(t=e.data,n="",$.each(t,(function(a,e){n+='<div class="row justify-content-between mb-15">',n+='<div class="col-lg-2">',n+='<img src="/build/global/img/produto.svg" width="50px" height="50px" style="border-radius: 6px;">',n+="</div>",n+='<div class="col-md-5 col-lg-6">',n+='<h4 class="table-title m-0">'+e.name+"</h4>",n+="<small>"+e.description+"</small>",n+="</div>",n+='<div class="col-md-3 col-lg-2 text-right">',n+='<p class="sm-text text-muted">'+e.amount+"x</p>",n+="</div>",n+="</div>",$("#table-product").html(n)})),loadOnAny("#modal-saleDetails",!0)):function(a,e){var t="",n="/build/global/img/produto.svg";$.each(a,(function(a,o){if(o.photo||(o.photo=n),t+='\n                <div class="row justify-content-between mb-15">\n                    <div class="col-lg-2">\n                        <img src=\''.concat(o.photo,"' onerror=this.src='/build/global/img/produto.png' width='50px' height='50px' style='border-radius: 6px;'>\n                    </div>\n\n                    <div class=\"col-md-5 col-lg-6\">\n                        <h4 class=\"table-title m-0\">").concat(o.name,"</h4>\n                        <small>").concat(o.description,'</small>\n                    </div>\n\n                    <div class="col-md-3 col-lg-2 text-right">\n                        <p class="sm-text text-muted">').concat(o.amount,"x</p>\n                    </div>\n                </div>"),void 0!==o.custom_products&&o.custom_products.length>0){t+='\x3c!-- Customer additional information --\x3e\n                    <div class="panel-group my-30" aria-multiselectable="true" role="tablist">\n                        <div class="panel panel-custom-product">\n                            <div class="panel-heading" id="sale-custom-product-accordion-'.concat(o.sale_id).concat(o.id).concat(a,'" role="tab">\n                                <a class="panel-title" data-toggle="collapse" href="#sale-custom-product-').concat(o.sale_id).concat(o.id).concat(a,'"\n                                data-parent="#custom-product-accordion').concat(o.id,'" aria-expanded="true"\n                                aria-controls="exampleCollapseDefaultOne">\n                                    <strong>Personalizações enviadas pelo cliente</strong>\n                                </a>\n                            </div>\n                            <div class="panel-collapse collapse" id="sale-custom-product-').concat(o.sale_id).concat(o.id).concat(a,'"\n                                aria-labelledby="sale-custom-product-accordion-').concat(o.sale_id).concat(o.id).concat(a,'" role="tabpanel" style="">\n                                <div class="panel-body">');var s=null;line_temp=0,$.each(o.custom_products,(function(a,e){if(line_temp!=e.line&&(t+="<hr/>",line_temp=e.line),t+='<div class="row mt-2">',void 0!==e.type_enum)switch("Text"!=e.type_enum&&(s=e.file_name.substr(-20)),e.type_enum){case"Text":t+='\n                                                        <div class="col-md-3">\n                                                            <img src="/build/global/img/custom-product/icon_text.svg" class="img-fluid border-icon">\n                                                        </div>\n                                                        <div class="col-md-6 px-0 py-13">\n                                                            <h5>'.concat(e.value,'</h5>\n                                                        </div>\n                                                        <div class="col-md-3 pl-0 py-11" align="right">\n                                                            <a role="button" class="copy_link btn-copy-custom-text" style="cursor: pointer;"  link="').concat(e.value,'" title="Copiar link">\n                                                                <span class="material-icons icon-copy-1"> content_copy </span>\n                                                            </a>\n                                                        </div>');break;case"File":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_attachment.svg" class="img-fluid border-icon" />\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(e.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Arquivo" target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>');break;case"Image":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_image.svg" class="img-fluid border-icon">\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(e.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Imagem"  target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>')}t+="</div>"})),t+="\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \x3c!-- End Customer additional information --\x3e\n                "}var i;switch($("#table-product").html(t),e.status){case 1:i="<span class='ml-2 badge badge-success'>Aprovada</span>";break;case 2:i="<span class='ml-2 badge badge-pendente'>Pendente</span>";break;case 3:i="<span class='ml-2 badge badge-danger'>Recusada</span>";break;case 4:i="<span class='ml-2 badge badge-chargeback'>Chargeback</span>";break;case 6:i="<span class='ml-2 badge badge-primary'>Em análise</span>";break;case 7:case 22:i="<span class='ml-2 badge badge-danger'>Estornado</span>";break;case 8:i="<span class='ml-2 badge badge-danger'>Estorno Parcial</span>";break;case 20:i="<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>";break;case 21:i="<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>";break;case 23:i="<span class='ml-2 badge badge-warning'>Recuperado</span>";break;case 24:i="<span class='ml-2 badge badge-antifraude'>Em disputa</span>";break;default:i="<span class='ml-2 badge badge-primary'>"+e.status+"</span>"}if(1!=o.sale_status&&4!=o.sale_status||""==e.delivery_id)$("#div_tracking_code").css("display","none");else{var l='\n                    <tr>\n                        <td class="d-flex align-items-center">\n\n                            <img src=\''.concat(o.photo,"'  width='35px;' style='border-radius:6px;'>\n\n                            <span class='ml-3 small ellipsis font-weight-bold font-size-14'>\n                                ").concat(o.name,'\n                            </span>\n                        </td>\n\n                        <td class="pl-2">\n                            <span class="small font-size-16">\n                                ').concat(o.tracking_code,"\n                            </span>\n                        </td>\n\n                        <td>\n                            ").concat(i,"\n                        </td>\n\n                        <td>\n                            <span class='small font-size-16'>\n                                ").concat(o.tracking_created_at,"\n                            </span>\n                        </td>\n\n                    </tr>");$("#div_tracking_code").css("display","block"),$("#data-tracking-products").append(l)}})),loadOnAny("#modal-saleDetails",!0)}(e.data,a)}})}(a),function(a,e){$.ajax({method:"GET",url:"/api/customers/"+a+"/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){$("#client-name").text("Nome: "+a.name),$("#client-telephone").val(a.telephone).attr("client",a.code).mask("+00 (00) 00000-0000"),$("#client-email").val(a.email).attr("client",a.code),$("#client-document").text("CPF: "+a.document),a.fraudster?($("#client-whatsapp-container").hide(),$(".btn-edit-client").hide()):($(".btn-edit-client").show(),$("#client-whatsapp-container").show(),$("#client-whatsapp").attr("href",a.whatsapp_link))}(a.data)}})}(a.client_id,a.id),""!=a.delivery_id&&(e=a.delivery_id,$.ajax({method:"GET",url:"/api/delivery/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){$(".btn-save-trackingcode").attr("delivery",a.id);var e="Endereço: "+a.street+", "+a.number;isEmpty(a.complement)||(e+=", "+a.complement),$("#delivery-address").text(e),$("#delivery-neighborhood").text("Bairro: "+a.neighborhood),$("#delivery-zipcode").text("CEP: "+a.zip_code),$("#delivery-city").text("Cidade: "+a.city+"/"+a.state)}(a.data)}}));var e;a.api_flag?$(".dados-checkout").css("display","none"):($(".dados-checkout").css("display","block"),t=a.checkout_id,$.ajax({method:"GET",url:"/api/checkout/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){var e;e=a.data,$("#checkout-ip").text("IP: "+e.ip),$("#checkout-operational-system").text("Dispositivo: "+e.operational_system),$("#checkout-browser").text("Navegador: "+e.browser),$("#checkout-src").text("SRC: "+e.src),$("#checkout-source").text("UTM Source: "+e.source),$("#checkout-medium").text("UTM Medium: "+e.utm_medium),$("#checkout-campaign").text("UTM Campaign: "+e.utm_campaign),$("#checkout-term").text("UTM Term: "+e.utm_term),$("#checkout-content").text("UTM Content: "+e.utm_content),loadOnAny("#modal-saleDetails",!0)}}));var t;!function(a){if(!isEmpty(a)){var e=a[a.length-1];$.ajax({method:"GET",url:"/api/apps/notazz/invoice/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){!function(a){if(isEmpty(a))$("#div_notazz_invoice").hide();else{if($("#data-notazz-invoices").empty(),a.date_pending){var e="<tr>\n                                <td>\n                                    ".concat(a.date_pending,"\n                                </td>\n                                <td>\n                                    Pendente de envio\n                                </td>\n                                <td>\n                                    0\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(e)}if(a.date_sent){var t=null==a.return_message?"Sucesso":a.return_message,n=a.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",o=a.pdf?"<a href='"+a.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",s="\n                    <tr>\n                        <td>\n                            ".concat(a.date_sent,"\n                        </td>\n\n                        <td>\n                            ").concat(n,"\n                        </td>\n\n                        <td>\n                            ").concat(a.return_http_code,"\n                        </td>\n\n                        <td>\n                            ").concat(t,"\n                        </td>\n\n                        <td>\n                            ").concat(o,"\n                        </td>\n\n                    </tr>");$("#data-notazz-invoices").append(s)}if(a.date_error){var i=a.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",l="<tr>\n                                <td>\n                                    ".concat(a.date_error,"\n                                </td>\n                                <td>\n                                    ").concat(i,"\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(a.return_message,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(l)}if(a.date_rejected){var c=null==a.postback_message?"Rejeitado":a.postback_message,d="<tr>\n                                <td>\n                                    ".concat(a.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fiscal rejeitada\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(c,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(d)}if(a.date_canceled){var r=a.pdf?"<a href='"+a.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",u="<tr>\n                                <td>\n                                    ".concat(a.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fical cancelada\n                                </td>\n                                <td>\n                                    ").concat(a.return_http_code,"\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n                                    ").concat(r,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(u)}a.return_message&&$("#div_notazz_schedule").html("Próxima tentativa de envio em "+a.schedule),$("#div_notazz_invoice").show()}}(a.data)}})}}(a.invoices)}(a.data),$("#refundAmount").val(a.data.total),$("#refundBilletAmount").text(a.data.total),$(".btn_refund_transaction").unbind("click"),$(".btn_refund_transaction").on("click",(function(){$("#refund-observation-transaction").val(""),$("#modal_detalhes").modal("hide"),$("#modal-refund-transaction").modal("show"),$("#asaas_message").html(""),""!=a.data.asaas_amount_refund&&$("#asaas_message").html('<p class="gray"> Esta venda já foi antecipada, o valor a ser debitado no extrato será de <strong>'.concat(a.data.asaas_amount_refund,"</strong></p>")),$("#radioTotalRefund").on("click",(function(){$(".value-partial-refund").hide()})),$("#radioPartialRefund").on("click",(function(){$(".value-partial-refund").show()})),$(".btn-confirm-refund-transaction").unbind("click"),$(".btn-confirm-refund-transaction").on("click",(function(){var e=$("#refund-observation-transaction").val();if(e.length<4)alertCustom("error","Preencha o motivo do estorno para prosseguir");else{var t=0;document.getElementById("radioPartialRefund").checked&&(t=1),function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$(".btn-confirm-refund-transaction").prop("disabled",!0),loadingOnScreen(),$.ajax({method:"POST",url:t,data:{refunded_value:a,partial:n,refund_observation:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnScreenRemove(),$("#modal-refund-transaction").modal("toggle"),errorAjaxResponse(a),$(".btn-confirm-refund-transaction").prop("disabled",!1)},success:function(a){loadingOnScreenRemove(),$("#modal-refund-transaction").modal("toggle"),alertCustom("success",a.message),$("#refund-observation-transaction").val(""),window.location.pathname.includes("finances")&&$("#bt_filtro").trigger("click"),atualizar(currentPage),$(".btn-confirm-refund-transaction").prop("disabled",!1)}})}($("#refundAmount").val(),e,a.data.refund_url,t)}}))})),$(".btn_refund_billet").unbind("click"),$(".btn_refund_billet").on("click",(function(){$("#refund-observation-billet").val("");var e=a.data.total;$(".billet-refunded-tax-value").text(a.data.taxaReal?a.data.taxaReal:""),$("#modal_detalhes").modal("hide"),$("#modal-refund-billet").modal("show"),$(".btn-confirm-refund-billet").unbind("click"),$(".btn-confirm-refund-billet").on("click",(function(){var t=$("#refund-observation-billet").val();t.length<4?alertCustom("error","Preencha o motivo do estorno para prosseguir"):function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;$(".btn-confirm-refund-billet").prop("disabled",!0),loadingOnChart("#modal-refund-billet"),$.ajax({method:"POST",url:t,data:{refunded_value:a,refund_observation:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-billet").modal("toggle"),errorAjaxResponse(a),atualizar(currentPage),$(".btn-confirm-refund-billet").prop("disabled",!1)},success:function(a){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-billet").modal("toggle"),alertCustom("success",a.message),$("#refund-observation-billet").val(""),atualizar(currentPage),$(".btn-confirm-refund-billet").prop("disabled",!1)}})}(e,t,a.data.refund_url)}))}))}})})),$("#update-sale-observation").click((function(){var a=$("#sale-code").text().substring(0,8);$.ajax({method:"POST",url:"/api/sales/set-observation/"+a,data:{observation:$("#observation").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content")},error:function(a){errorAjaxResponse(a)},success:function(a){alertCustom("success",a.message),atualizar(currentPage)}})})),$(document).on("click","#btnSaleReSendEmail",(function(){var a,e;a=$("#sale-code").text(),(e=$("#btnSaleReSendEmail")).hasClass("sending")||(e.css("opacity",".5").addClass("sending"),$.ajax({method:"POST",url:"/api/sales/saleresendemail",dataType:"json",data:{sale:a},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){e.css("opacity","1").removeClass("sending"),errorAjaxResponse(a)},success:function(a){e.css("opacity","1").removeClass("sending"),alertCustom("success",a.message)}}))}))}));
