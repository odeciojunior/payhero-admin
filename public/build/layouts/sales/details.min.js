$((function(){$("#discount_value").mask("00%",{reverse:!0}),$("#apply_discount").on("click",(function(){$("#div_discount").is(":visible")?($("#div_discount").hide(),$("#discount_value").val("")):($("#div_discount").show(),$("#discount_type").on("change",(function(){"value"==$("#discount_type").val()?($("#discount_value").mask("#.###,#0",{reverse:!0}).removeAttr("maxlength"),$("#label_discount_value").html("Valor (ex: 20,00)")):($("#discount_value").mask("00%",{reverse:!0}),$("#label_discount_value").html("Valor (ex: 20%)"))})))})),$(document).on("click","#boleto-link .copy_link",(function(){var e=$("<input>");$("#nav-tabContent").append(e),e.val($(this).attr("link")).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Link copiado!")})),$(document).on("click","#boleto-digitable-line .copy_link",(function(){var e=$("<input>");$("#nav-tabContent").append(e),e.val($(this).attr("digitable-line")).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Linha Digitável copiado!")})),$(document).on("click",".btn-copy-thank-page-url",(function(){var e=$("<input>");$(".sales-details").append(e),e.val($(this).attr("link")).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Link copiado!")})),$(document).on("click",".btn-copy-custom-text",(function(){var e=$("<input>");$("#nav-tabContent").append(e),e.val($(this).attr("link")).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Link copiado!")})),$(".btn-edit-client").on("click",(function(){var e=$(this).parent();e.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),e.find(".btn-save-client").show(),e.find(".btn-close-client").show()})),$(".btn-close-client").on("click",(function(){var e=$(this).parent();e.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),e.find(".btn-save-client").hide(),e.find(".btn-edit-client").show()})),$(".btn-save-client").on("click",(function(){var e=this,a=$(this).parent(),t=a.find("input"),n={id:t.attr("client"),name:t.attr("name"),value:t.val(),_method:"PUT"};$.ajax({method:"POST",url:"/api/customers/update",dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(e).hide(),a.find(".btn-close-client").hide(),a.find(".btn-edit-client").show(),alertCustom("success","Dados do cliente alterados com successo!")}})})),$(document).on("click",".btn-edit-observation",(function(){var e=$(this).parent();e.find("input").removeClass("fake-label").prop("readonly",!1),$(this).hide(),e.find(".btn-save-observation").show(),e.find(".btn-close-observation").show()})),$(document).on("click",".btn-close-observation",(function(){var e=$(this).parent();e.find("input").addClass("fake-label").prop("readonly",!0),$(this).hide(),e.find(".btn-save-observation").hide(),e.find(".btn-edit-observation").show()})),$(document).on("click",".btn-save-observation",(function(){var e=this;if(""==$("#refund-observation").val())return alertCustom("error","Dados informados inválidos"),!1;var a=$(this).parent(),t=a.find("input"),n={id:t.attr("sale"),name:t.attr("name"),value:t.val()};$.ajax({method:"POST",url:"/api/sales/updaterefundobservation/"+t.attr("sale"),dataType:"json",data:n,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(n){t.addClass("fake-label").prop("readonly",!0),$(e).hide(),a.find(".btn-close-observation").hide(),a.find(".btn-edit-observation").show(),alertCustom("success","Causa do estorno alterado com successo!")}})})),$(document).on("click",".detalhes_venda",(function(){var e=$(this).attr("venda");loadOnAny("#modal-saleDetails"),$("#nav-home-tab").addClass("active"),$("#nav-home-tab").addClass("show"),$("#nav-home").addClass("active"),$("#nav-home").addClass("show"),$("#nav-profile-tab").removeClass("active"),$("#nav-profile-tab").removeClass("show"),$("#nav-profile").removeClass("active"),$("#nav-profile").removeClass("show"),$("#nav-woo-tab").removeClass("active"),$("#nav-woo").removeClass("active"),$("#nav-woo").removeClass("show"),$("#modal_detalhes").modal("show"),$("#refundAmount").mask("##.###,#0",{reverse:!0}),$("#refundBilletAmount").mask("##.###,#0",{reverse:!0}),$.ajax({method:"GET",url:"/api/sales/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){$("#modal_detalhes").modal("hide"),errorAjaxResponse(e)},success:function(e){!function(e){(function(e){var a="";a=1==e.payment_method?"Cartão":3==e.payment_method?"Debito":4==e.payment_method?"PIX":"Boleto";$("#comission-details").css("display","flex"),$("#sale-code").text(e.id),!e.upsell||$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Upsell → '.concat(e.upsell,"</span>"));e.has_order_bump&&$("#sale-code").append('<span class="text-muted font-size-16 d-block mt-1"> Order Bump </span>');$("#payment-type").text("Pagamento via "+a+" em "+e.start_date+" às "+e.hours),""!=e.release_date?$("#release-date").text("Data de liberação: "+e.release_date):$("#release-date").text("");$("#card-company").text("Empresa responsável pelo faturamento: "+e.company_name),isEmpty(e.observation)?$("#sale-observation").addClass("collapse"):$("#sale-observation").removeClass("collapse");$("#observation").val(e.observation);var t=$(".modal-body #status");switch(t.html(""),t.append('<img style="width: 50px;" src="/build/global/img/cartoes/'+e.flag+'.png">'),e.status){case 1:t.append("<span class='ml-2 badge badge-success'>Aprovada</span>");break;case 2:t.append("<span class='ml-2 badge badge-pendente'>Pendente</span>");break;case 3:t.append("<span class='ml-2 badge badge-danger'>Recusada</span>");break;case 4:t.append("<span class='ml-2 badge badge-danger'>Chargeback</span>");break;case 6:t.append("<span class='ml-2 badge badge-primary'>Em análise</span>");break;case 7:case 22:t.append("<span class='ml-2 badge badge-danger'>Estornado</span>");break;case 8:t.append("<span class='ml-2 badge badge-danger'>Estorno Parcial</span>");break;case 20:t.append("<span class='ml-2 badge badge-antifraude'>Revisão Antifraude</span>");break;case 21:t.append("<span class='ml-2 badge badge-danger'>Cancelado Antifraude</span>");break;case 23:t.append("<span class='ml-2 badge badge-warning'>Recuperado</span>");break;case 24:t.append("<span class='ml-2 badge badge-antifraude'>Em disputa</span>");break;default:t.append("<span class='ml-2 badge badge-primary'>"+e.status+"</span>")}e.is_chargeback_recovered&&1==e.status?$("#chargeback-recovered").show():$("#chargeback-recovered").hide();$("#subtotal-value").html(e.subTotal),$("#shipment-value").html(e.shipment_value),$("#iof-label, #iof-value, #cambio-label, #cambio-value").hide(),e.dolar_quotation&&($("#cambio-label span").text("Câmbio (1 $ = R$ "+e.dolar_quotation+"): "),$("#cambio-value span").text("US$ "+e.taxa),$("#cambio-label, #cambio-value").show());$("#taxas-installment-free-label, #taxa-installment-value").hide(),0!==parseFloat(e.installment_tax_value.replace(/[^\d]/g,""))&&"producer"==e.user_sale_type&&($("#taxa-installment-value").html(e.installment_tax_value),$("#taxas-installment-free-label").show(),$("#taxa-installment-value").show());parseFloat(e.discount.replace(/[^\d]/g,""))>0?($("#discount-title").show(),$("#discount-data").show(),$("#desconto-value").html(e.discount)):($("#discount-title").hide(),$("#discount-data").hide(),$("#automatic-discount-value").hide());e.cupom_code?($("#cupom-code").html(e.cupom_code),$(".cupom-info").show()):$(".cupom-info").hide();if($(".text-discount").html(""),$("#automatic-discount-value").html(""),parseInt(e.automatic_discount.replace(/[^\d]/g,""))>0){switch(e.payment_method){case 2:$(".text-discount").html("Desconto automático boleto");break;case 4:$(".text-discount").html("Desconto automático pix");break;default:$(".text-discount").html("Desconto automático cartão")}$(".automatic-discount-value").show(),$(".text-discount").show(),$("#automatic-discount-value").html(e.automatic_discount).show()}else $(".automatic-discount-value").hide(),$(".text-discount").hide();"refunded"!=e.status_name?$("#total-value").html(e.total):$("#total-value").html(' <del style="color: #F41C1C !important;">'.concat(e.total,"</del>"));"0,00"!=e.refund_value&&8==e.status?($(".text-partial-refund").show(),$("#partial-refund-value").html(e.refund_value),$("#partial-refund-value").show()):($(".text-partial-refund").hide(),$("#partial-refund-value").hide());parseInt(e.progressive_discount.replace(/[^\d]/g,""))>0?($("#discount-prog-title").show(),$("#discount-prog-data span").html(e.progressive_discount),$("#discount-prog-data").show()):($("#discount-prog-data").hide(),$("#discount-prog-title").hide());"refunded"==e.status_name&&$("#comission-details").css("display","none");$("#taxas-label").html(e.percentage_rate?"Taxas ("+e.percentage_rate+"% + "+e.transaction_rate+"): ":"Taxas"),$("#taxareal-value").html(e.taxaReal?e.taxaReal:""),$("#tax-value-total").html("Valor total: "),"refunded"!=e.status_name?$("#tax-value-total-value").html(e.total_parcial):$("#tax-value-total-value").html(' <del style="color: #F41C1C !important;">'.concat(e.total_parcial,"</del>"));$("#tax-percentage").html("Taxa (".concat(e.percentage_rate,"%)")),$("#tax-percentage-value").html("".concat(e.taxaDiscount)),$("#tax-fixed").html("Taxa fixa: "),$("#tax-fixed-value").html("".concat(e.transaction_rate)),$("#tax-total").html("Valor total das taxas: "),$("#tax-total-value").html("- ".concat(e.totalTax)),$("#tax-comission").html("Valor recebido"),$("#tax-comission-value").html("<b>".concat(e.comission,"</b>")),$("#convertax-label, #convertax-value").hide(),"0,00"!==e.convertax_value&&($("#convertax-value").text(e.convertax_value?e.convertax_value:""),$("#convertax-label, #convertax-value").show());"0,00"!=e.value_anticipable&&($(".div-anticipated").show(),$(".div-value-anticipated").html("").append("<span class='text-muted ft-12'> ".concat(e.value_anticipable,"</span>")).show());e.has_cashback?($("#cashback-label").removeClass("d-none"),$("#cashback-value").removeClass("d-none").html("").append("<span class='ft-12' style=\"color: #5EE2A1;\"> + ".concat(e.cashback_value,"</span>")).show(),$("#tax-subtotal").html("Subtotal:").parent().removeClass("d-none"),$("#tax-subtotal-value").html(e.total).parent().removeClass("d-none"),$("#tax-cashback").html("Cashback:").parent().removeClass("d-none"),$("#tax-cashback-value").html("+ ".concat(e.cashback_value)).parent().removeClass("d-none").show()):($("#cashback-label").addClass("d-none"),$("#cashback-value").addClass("d-none").html(""),$("#tax-subtotal").parent().addClass("d-none"),$("#tax-subtotal-value").parent().addClass("d-none"),$("#tax-cashback").parent().addClass("d-none"),$("#tax-cashback-value").parent().addClass("d-none"));"affiliate"==e.user_sale_type?($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=e.affiliate?($(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do produtor: </span>"),$("#user-type-comission-value").html(e.comission)):($(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide())):($(".div-main-comission-value").html("<h4 id='comission-value' class='table-title'></h4>"),$(".div-main-comission").html("<h4 class='table-title'>Comissão: </h4>"),null!=e.affiliate?($(".div-sale-by-affiliate").show().html("<h4 class='table-title'>Venda realizada pelo afiliado "+e.affiliate+"</h4>"),$(".div-user-type-comission-value").show().html("<span id='user-type-comission-value' class='text-muted ft-12'></span>"),$(".div-user-type-comission").show().html("<span class='text-muted ft-12'>Comissão do afiliado: </span>"),$("#user-type-comission-value").html(e.affiliate_comission)):($(".div-sale-by-affiliate").hide(),$(".div-affiliate-name").hide().html(""),$(".div-user-type-comission-value").hide(),$(".div-user-type-comission").hide()),$("#comission-value").text(e.comission?e.comission:""));""!=e.affiliate_comission&&"affiliate"==e.user_sale_type&&$("#comission-value").text(e.affiliate_comission);if(e.has_woocommerce_integration)if($("#nav-woo-tab").show(),e.woocommerce_order){var n="Status: <strong>"+e.woocommerce_order.status+"</strong>";$("#woo_order").html(n),$("#resendWoocommerceOrder").addClass("d-none"),$("#resendWoocommerceOrder").removeClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale","")}else $("#woo_order").html("Ordem não encontrada!"),e.woocommerce_retry_order&&($("#resendWoocommerceOrder").removeClass("d-none"),$("#resendWoocommerceOrder").addClass("d-block"),$("#resendWoocommerceOrderButton").attr("sale",e.id),$(".btn_new_order_woocommerce").unbind("click"),$(".btn_new_order_woocommerce").on("click",(function(){var e=$(this).attr("sale");$("#modal-new-order-woocommerce").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-woocommerce").unbind("click"),$(".btn-confirm-new-order-woocommerce").on("click",(function(){!function(e){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/neworderwoocommerce/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e),atualizar(currentPage)},success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),atualizar(currentPage)}})}(e)}))})));else $("#nav-woo-tab").hide();e.has_shopify_integration?(e.shopify_order||20==e.status?($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale","")):($("#resendShopfyOrder").removeClass("d-none"),$("#resendShopfyOrder").addClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",e.id),$(".btn_new_order_shopify").unbind("click"),$(".btn_new_order_shopify").on("click",(function(){var e=$(this).attr("sale");$("#modal-new-order-shopify").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-new-order-shopify").unbind("click"),$(".btn-confirm-new-order-shopify").on("click",(function(){!function(e){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/newordershopify/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e),atualizar(currentPage)},success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),atualizar(currentPage)}})}(e)}))}))),$("#details-shopify").show()):($("#resendShopfyOrder").addClass("d-none"),$("#resendShopfyOrder").removeClass("d-block"),$("#resendeShopifyOrderButton").attr("sale",""));$("#nav-profile #card-copany").text("Empresa: Nome da Empresa"),1===e.payment_method&&($("#details-card #card-flag").text("Bandeira: "+e.flag),$("#details-card #card-installments").text("Quantidade de parcelas: "+e.installments_amount),$("#details-card").show(),$("#details-boleto").hide());2===e.payment_method&&($("#details-boleto #boleto-link a").attr("link",e.boleto_link),$("#details-boleto #boleto-digitable-line a").attr("digitable-line",e.boleto_digitable_line),$("#details-boleto #boleto-due").text("Vencimento: "+e.boleto_due_date),$("#details-card").hide(),$("#details-boleto").show());4===e.payment_method&&($("#details-card").hide(),$("#details-boleto").hide());$("#checkout-attempts").hide(),1===e.payment_method&&$("#checkout-attempts").text("Quantidade de tentativas: "+e.attempts).show();1!=e.payment_method&&3!=e.payment_method&&(4!=e.payment_method||e.has_withdrawal)||1!=e.status&&8!=e.status&&24!=e.status||!e.userPermissionRefunded?$("#div_refund_transaction").html(""):e.has_contestation?$("#div_refund_transaction").html('<button disabled class="btn btn-danger btn-sm">Estorno desabilitado, venda está em disputa</button>'):$("#div_refund_transaction").html('<button class="btn btn-danger btn-sm btn_refund_transaction" sale='+e.id+">Estornar transação</button>");7==e.status?$("#div_refund_receipt").html('<a class="btn btn-sm btn-primary" target="_blank" style="color:white">Comprovante de estorno</a>'):$("#div_refund_receipt").html("");2==e.status||1==e.status?e.api_flag?$("#saleReSendEmail").hide():$("#saleReSendEmail").show():$("#saleReSendEmail").hide();e.api_flag?$("#details-api").show():$("#details-api").hide();2!=e.payment_method||1!=e.status||!e.userPermissionRefunded||"BeYEwR3AdgdKykA"!=e.gateway_id&&"ODzj6aGnOgwlK9J"!=e.gateway_id?$("#div_refund_billet").html(""):$("#div_refund_billet").html('<button class="btn btn-danger btn-sm btn_refund_billet" sale='+e.id+">Estornar boleto</button>");null!=e.refund_observation?($(".div-refund-observation").show(),$("#refund-observation").val(e.refund_observation).attr("sale",e.id),e.user_changed_observation?$(".btn-edit-observation").show():$(".btn-edit-observation").hide()):$(".div-refund-observation").hide();""!=e.thank_page_url?($("#thank-page-url").text(e.thank_label_text).show(),$(".btn-copy-thank-page-url").attr("link",e.thank_page_url),$(".btn-copy-thank-page-url").show()):($("#thank-page-url").hide(),$(".btn-copy-thank-page-url").hide());""!=e.delivery_id?$("#div_delivery").css("display","block"):$("#div_delivery").css("display","none");1==verifyAccountFrozen()?($(".btn-edit-client").hide(),$("#update-sale-observation").hide(),$("#saleReSendEmail").hide(),$("#div_refund_transaction").hide(),$("#div_refund_billet").hide()):($(".btn-edit-client").show(),$("#update-sale-observation").show(),$("#div_refund_transaction").show(),$("#div_refund_billet").show())})(e),function(e){$("#table-product").html(""),$("#data-tracking-products").html(""),$.ajax({method:"GET",url:"/api/products/saleproducts/"+e.id,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(a){var t,n;e.api_flag?(t=a.data,n="",$.each(t,(function(e,a){n+='<div class="row justify-content-between mb-15">',n+='<div class="col-lg-2">',n+='<img src="/build/global/img/produto.svg" width="50px" height="50px" style="border-radius: 6px;">',n+="</div>",n+='<div class="col-md-5 col-lg-6">',n+='<h4 class="table-title m-0">'+a.name+"</h4>",n+="<small>"+a.description+"</small>",n+="</div>",n+='<div class="col-md-3 col-lg-2 text-right">',n+='<p class="sm-text text-muted">'+a.amount+"x</p>",n+="</div>",n+="</div>",$("#table-product").html(n)})),loadOnAny("#modal-saleDetails",!0)):function(e,a){var t="",n="/build/global/img/produto.svg";$.each(e,(function(e,o){if(o.photo||(o.photo=n),t+='<div class="row justify-content-between mb-15">\n                        <div class="col-lg-2">\n                            <img src=\''.concat(o.photo,"' onerror=this.src='/build/global/img/produto.png' width='50px' height='50px' style='border-radius: 6px;'>\n                        </div>\n                        <div class=\"col-md-5 col-lg-6\">\n                            <h4 class=\"table-title m-0\">").concat(o.name,"</h4>\n                            <small>").concat(o.description,'</small>\n                        </div>\n                        <div class="col-md-3 col-lg-2 text-right">\n                            <p class="sm-text text-muted">').concat(o.amount,"x</p>\n                        </div>\n                    </div>"),void 0!==o.custom_products&&o.custom_products.length>0){t+='\x3c!-- Customer additional information --\x3e\n                    <div class="panel-group my-30" aria-multiselectable="true" role="tablist">\n                        <div class="panel panel-custom-product">\n                            <div class="panel-heading" id="sale-custom-product-accordion-'.concat(o.sale_id).concat(o.id).concat(e,'" role="tab">\n                                <a class="panel-title" data-toggle="collapse" href="#sale-custom-product-').concat(o.sale_id).concat(o.id).concat(e,'"\n                                data-parent="#custom-product-accordion').concat(o.id,'" aria-expanded="true"\n                                aria-controls="exampleCollapseDefaultOne">\n                                    <strong>Personalizações enviadas pelo cliente</strong>\n                                </a>\n                            </div>\n                            <div class="panel-collapse collapse" id="sale-custom-product-').concat(o.sale_id).concat(o.id).concat(e,'"\n                                aria-labelledby="sale-custom-product-accordion-').concat(o.sale_id).concat(o.id).concat(e,'" role="tabpanel" style="">\n                                <div class="panel-body">');var s=null;line_temp=0,$.each(o.custom_products,(function(e,a){if(line_temp!=a.line&&(t+="<hr/>",line_temp=a.line),t+='<div class="row mt-2">',void 0!==a.type_enum)switch("Text"!=a.type_enum&&(s=a.file_name.substr(-20)),a.type_enum){case"Text":t+='\n                                                        <div class="col-md-3">\n                                                            <img src="/build/global/img/custom-product/icon_text.svg" class="img-fluid border-icon">\n                                                        </div>\n                                                        <div class="col-md-6 px-0 py-13">\n                                                            <h5>'.concat(a.value,'</h5>\n                                                        </div>\n                                                        <div class="col-md-3 pl-0 py-11" align="right">\n                                                            <a role="button" class="copy_link btn-copy-custom-text" style="cursor: pointer;"  link="').concat(a.value,'" title="Copiar link">\n                                                                <span class="material-icons icon-copy-1"> content_copy </span>\n                                                            </a>\n                                                        </div>');break;case"File":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_attachment.svg" class="img-fluid border-icon" />\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(a.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Arquivo" target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>');break;case"Image":t+='\n                                                    <div class="col-md-3">\n                                                        <img src="/build/global/img/custom-product/icon_image.svg" class="img-fluid border-icon">\n                                                    </div>\n                                                    <div class="col-md-6 px-0 py-13">\n                                                        <h5>'.concat(s,'</h5>\n                                                    </div>\n                                                    <div class="col-md-3 pl-0 py-11" align="right">\n                                                        <a href="').concat(a.value,'" style="cursor: pointer;" download="').concat(s,'" title="Baixar Imagem"  target="_blank">\n                                                            <img src="/build/global/img/custom-product/icon_download.png" class="img-fluid" />\n                                                        </a>\n                                                    </div>')}t+="</div>"})),t+="\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    \x3c!-- End Customer additional information --\x3e\n                "}if($("#table-product").html(t),1!=o.sale_status&&4!=o.sale_status||""==a.delivery_id)$("#div_tracking_code").css("display","none");else{var i="<tr>\n                                <td>\n                                    <img src='".concat(o.photo,"'  width='35px;' style='border-radius:6px;'><br>\n                                    <span class='small ellipsis'>").concat(o.name,'</span>\n                                </td>\n                                <td>\n                                    <span class="small font-weight-bold">').concat(o.tracking_code,"</span>\n                                </td>\n                                <td>\n                                    <span class='tracking-status-span small'>").concat(o.tracking_status_enum,"</span>\n                                </td>\n                                <td>\n                                    <span class='small'>").concat(o.tracking_created_at,"</span>\n                                </td>\n                            </tr>");$("#div_tracking_code").css("display","block"),$("#data-tracking-products").append(i)}})),loadOnAny("#modal-saleDetails",!0)}(a.data,e)}})}(e),function(e,a){$.ajax({method:"GET",url:"/api/customers/"+e+"/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){!function(e){$("#client-name").text("Nome: "+e.name),$("#client-telephone").val(e.telephone).attr("client",e.code).mask("+00 (00) 00000-0000"),$("#client-email").val(e.email).attr("client",e.code),$("#client-document").text("CPF: "+e.document),e.fraudster?($("#client-whatsapp-container").hide(),$(".btn-edit-client").hide()):($(".btn-edit-client").show(),$("#client-whatsapp-container").show(),$("#client-whatsapp").attr("href",e.whatsapp_link))}(e.data)}})}(e.client_id,e.id),""!=e.delivery_id&&(a=e.delivery_id,$.ajax({method:"GET",url:"/api/delivery/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){!function(e){$(".btn-save-trackingcode").attr("delivery",e.id);var a="Endereço: "+e.street+", "+e.number;isEmpty(e.complement)||(a+=", "+e.complement),$("#delivery-address").text(a),$("#delivery-neighborhood").text("Bairro: "+e.neighborhood),$("#delivery-zipcode").text("CEP: "+e.zip_code),$("#delivery-city").text("Cidade: "+e.city+"/"+e.state)}(e.data)}}));var a;e.api_flag?$(".dados-checkout").css("display","none"):($(".dados-checkout").css("display","block"),t=e.checkout_id,$.ajax({method:"GET",url:"/api/checkout/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var a;a=e.data,$("#checkout-ip").text("IP: "+a.ip),$("#checkout-operational-system").text("Dispositivo: "+a.operational_system),$("#checkout-browser").text("Navegador: "+a.browser),$("#checkout-src").text("SRC: "+a.src),$("#checkout-source").text("UTM Source: "+a.source),$("#checkout-medium").text("UTM Medium: "+a.utm_medium),$("#checkout-campaign").text("UTM Campaign: "+a.utm_campaign),$("#checkout-term").text("UTM Term: "+a.utm_term),$("#checkout-content").text("UTM Content: "+a.utm_content),loadOnAny("#modal-saleDetails",!0)}}));var t;!function(e){if(!isEmpty(e)){var a=e[e.length-1];$.ajax({method:"GET",url:"/api/apps/notazz/invoice/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){!function(e){if(isEmpty(e))$("#div_notazz_invoice").hide();else{if($("#data-notazz-invoices").empty(),e.date_pending){var a="<tr>\n                                <td>\n                                    ".concat(e.date_pending,"\n                                </td>\n                                <td>\n                                    Pendente de envio\n                                </td>\n                                <td>\n                                    0\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(a)}if(e.date_sent){var t=null==e.return_message?"Sucesso":e.return_message,n=e.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",o=e.pdf?"<a href='"+e.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",s="<tr>\n                                <td>\n                                    ".concat(e.date_sent,"\n                                </td>\n                                <td>\n                                    ").concat(n,"\n                                </td>\n                                <td>\n                                    ").concat(e.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(t,"\n                                </td>\n                                <td>\n                                    ").concat(o,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(s)}if(e.date_error){var i=e.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",l="<tr>\n                                <td>\n                                    ".concat(e.date_error,"\n                                </td>\n                                <td>\n                                    ").concat(i,"\n                                </td>\n                                <td>\n                                    ").concat(e.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(e.return_message,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(l)}if(e.date_rejected){var c=null==e.postback_message?"Rejeitado":e.postback_message,d="<tr>\n                                <td>\n                                    ".concat(e.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fiscal rejeitada\n                                </td>\n                                <td>\n                                    ").concat(e.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(c,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(d)}if(e.date_canceled){var r=e.pdf?"<a href='"+e.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",u="<tr>\n                                <td>\n                                    ".concat(e.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fical cancelada\n                                </td>\n                                <td>\n                                    ").concat(e.return_http_code,"\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n                                    ").concat(r,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(u)}e.return_message&&$("#div_notazz_schedule").html("Próxima tentativa de envio em "+e.schedule),$("#div_notazz_invoice").show()}}(e.data)}})}}(e.invoices)}(e.data),$("#refundAmount").val(e.data.total),$("#refundBilletAmount").text(e.data.total),$(".btn_refund_transaction").unbind("click"),$(".btn_refund_transaction").on("click",(function(){$("#refund_observation").val("");var a=$(this).attr("sale");$("#modal_detalhes").modal("hide"),$("#modal-refund-transaction").modal("show"),$("#asaas_message").html(""),""!=e.data.asaas_amount_refund&&$("#asaas_message").html('<p class="gray"> Esta venda já foi antecipada, o valor a ser debitado no extrato será de <strong>'.concat(e.data.asaas_amount_refund,"</strong></p>")),$("#radioTotalRefund").on("click",(function(){$(".value-partial-refund").hide()})),$("#radioPartialRefund").on("click",(function(){$(".value-partial-refund").show()})),$(".btn-confirm-refund-transaction").unbind("click"),$(".btn-confirm-refund-transaction").on("click",(function(){var e=0;document.getElementById("radioPartialRefund").checked&&(e=1);var t=$("#refundAmount").val();!function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0;loadingOnChart("#modal-refund"),$.ajax({method:"POST",url:"/api/sales/refund/"+e,data:{refunded_value:a,partial:t,refund_observation:n},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-transaction").modal("toggle"),errorAjaxResponse(e),atualizar(currentPage)},success:function(e){loadingOnChartRemove(".sirius-loading"),$("#modal-refund-transaction").modal("toggle"),alertCustom("success",e.message),$("#refund_observation").val(""),atualizar(currentPage)}})}(a,t,e,$("#refund_observation").val())}))})),$(".btn_refund_billet").unbind("click"),$(".btn_refund_billet").on("click",(function(){var a=$(this).attr("sale"),t=e.data.total;$(".billet-refunded-tax-value").text(e.data.taxaReal?e.data.taxaReal:""),$("#modal-refund-billet").modal("show"),$("#modal_detalhes").modal("hide"),$(".btn-confirm-refund-billet").unbind("click"),$(".btn-confirm-refund-billet").on("click",(function(){!function(e,a){loadingOnScreen(),$.ajax({method:"POST",url:"/api/sales/refund/billet/"+e,data:{refunded_value:a},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e),atualizar(currentPage)},success:function(e){loadingOnScreenRemove(),alertCustom("success",e.message),atualizar(currentPage)}})}(a,t)}))}))}})})),$("#update-sale-observation").click((function(){var e=$("#sale-code").text().substring(0,8);$.ajax({method:"POST",url:"/api/sales/set-observation/"+e,data:{observation:$("#observation").val()},headers:{Authorization:$('meta[name="access-token"]').attr("content")},error:function(e){errorAjaxResponse(e)},success:function(e){alertCustom("success",e.message),atualizar(currentPage)}})})),$(document).on("click","#btnSaleReSendEmail",(function(){var e,a;e=$("#sale-code").text(),(a=$("#btnSaleReSendEmail")).hasClass("sending")||(a.css("opacity",".5").addClass("sending"),$.ajax({method:"POST",url:"/api/sales/saleresendemail",dataType:"json",data:{sale:e},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){a.css("opacity","1").removeClass("sending"),errorAjaxResponse(e)},success:function(e){a.css("opacity","1").removeClass("sending"),alertCustom("success",e.message)}}))}))}));
