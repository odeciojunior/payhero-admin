$(document).ready((function(){$(".company-navbar").change((function(){verifyIfCompanyIsDefault($(this).val())||(loadOnAny(".page-content"),updateCompanyDefault().done((function(a){getCompaniesAndProjects().done((function(a){a,$("#project-affiliate").find("option").not(":first").remove(),$("#project-affiliate-request").find("option").not(":first").remove(),t("n")}))})))}));getCompaniesAndProjects().done((function(a){a,t()}));var a={1:"success",2:"danger"};function e(a,e){if("true"!=searchIsLocked(a))switch(lockSearch(a),console.log(a.attr("block_search")),e){case 1:i();break;case 2:n()}}function t(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";"y"==a?loadingOnScreen():loadOnAny(".page-content"),$("#tab-affiliates").trigger("click"),$.ajax({method:"GET",url:"/api/projects?affiliate=true&status=active&company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadOnAny(".page-content",!0),loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){isEmpty(a.data)?($("#project-empty").show(),$("#project-not-empty").hide(),$("#project-affiliate").append($("<option>",{value:0,text:"Nenhuma loja encontrado"})),$("#project-affiliate-request").append($("<option>",{value:0,text:"Nenhuma loja encontrado"}))):($("#project-empty").hide(),$("#project-not-empty").show(),$.each(a.data,(function(a,e){0==e.affiliated&&($("#project-affiliate").append($("<option>",{value:e.id,text:e.name})),$("#project-affiliate-request").append($("<option>",{value:e.id,text:e.name})))})),i(),n()),loadOnAny(".page-content",!0),loadingOnScreenRemove()}})}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=$("#project-affiliate").val(),n=$("#name-affiliate").val();t=t||null,n=n||null,e=null==e?"/api/affiliates/getaffiliates?project="+t+"&name="+n+"&company="+$(".company-navbar").val():"/api/affiliates/getaffiliates"+e+"&project="+t+"&name="+n+"&company="+$(".company-navbar").val(),loadOnTable("#body-table-affiliates",".table-affiliate"),$.ajax({method:"GET",url:e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(e){$("#body-table-affiliates").html(""),""==e.data?$("#body-table-affiliates").html("<tr class='text-center'><td colspan='8' style='height: 257px; vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#body-table-affiliates").attr("img-empty")+"'> Nenhum afiliado encontrado</td></tr>"):$.each(e.data,(function(e,t){""!=t.percentage&&"0"!=t.percentage||(t.percentage="0%"),data="",data+="<tr>",data+='<td class="" style="vertical-align: middle;">'+t.name+"</td>",data+='<td class="" style="vertical-align: middle;">'+t.project_name+"</td>",data+='<td class="" style="vertical-align: middle;">'+t.date+"</td>",data+='<td class="text-center" style="vertical-align: middle;">'+t.percentage+"</td>",data+='<td class="text-center" ><span class="badge badge-'+a[t.status]+'">'+t.status_translated+"</span></td>",data+="<td class='text-center text-nowrap'>",data+="<a title='Visualizar' class='mg-responsive pointer details-affiliate' affiliate='"+t.id+"'><span class=''><img src='/build/global/img/icon-eye.svg'/></span></a>",data+="<a title='Editar' class='mg-responsive pointer edit-affiliate'    affiliate='"+t.id+"'><span class=''><img src='build/global/img/pencil-icon.svg'/></span></a>",data+="<a title='Excluir' class='mg-responsive pointer delete-affiliate' affiliate='"+t.id+"'><span class=''><img src='/build/global/img/icon-trash-tale.svg'/></span></a>",data+="</td>",data+="</tr>",$("#body-table-affiliates").append(data)})),$(".table-affiliate").addClass("table-striped"),$(".table-affiliate").addClass("mb-0"),pagination(e,"affiliates",i),$(".delete-affiliate").on("click",(function(a){if(a.preventDefault(),!verifyAccountFrozen()){var e=$(this).attr("affiliate");$("#modal-delete-affiliate").modal("show"),$("#modal-delete-affiliate .btn-delete").unbind("click"),$("#modal-delete-affiliate .btn-delete").on("click",(function(){$("#modal-delete").modal("hide"),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/affiliates/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){function e(){return a.apply(this,arguments)}return e.toString=function(){return a.toString()},e}((function(a){loadingOnScreenRemove(),errorAjaxResponse(a)})),success:function(a){loadingOnScreenRemove(),i()}})}))}})),$(document).on("click",".edit-affiliate",(function(){var a=$(this).attr("affiliate");verifyAccountFrozen()||$.ajax({method:"GET",url:"/api/affiliates/"+a+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(e){""!=e.data.percentage&&"0"!=e.data.percentage||(e.data.percentage="0%"),$("#modal-edit-affiliate .affiliate-id").val(a),$("#modal-edit-affiliate .affiliate-name").val(e.data.name),$("#modal-edit-affiliate .affiliate-percentage").val(e.data.percentage),1==e.data.status?$("#modal-edit-affiliate .affiliate-status").prop("selectedIndex",0).change():2==e.data.status&&$("#modal-edit-affiliate .affiliate-status").prop("selectedIndex",1).change(),$("#modal-edit-affiliate").modal("show")}})})),$(document).on("click",".details-affiliate",(function(){var e=$(this).attr("affiliate");$.ajax({method:"GET",url:"/api/affiliates/"+e+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(e){""!=e.data.percentage&&"0"!=e.data.percentage||(e.data.percentage="0%"),$("#modal-show-affiliate .affiliate-name").text(e.data.name),$("#modal-show-affiliate .affiliate-email").text(e.data.email),$("#modal-show-affiliate .affiliate-company").text(e.data.company),$("#modal-show-affiliate .affiliate-project").text(e.data.project_name),$("#modal-show-affiliate .affiliate-phone").text(e.data.cellphone),$("#modal-show-affiliate .affiliate-percent").text(e.data.percentage),$("#modal-show-affiliate .affiliate-date").text(e.data.date),$("#modal-show-affiliate .affiliate-status").html('<span class="badge badge-'+a[e.data.status]+'">'+e.data.status_translated+"</span>"),$("#modal-show-affiliate .affiliate-percentage").text(e.data.percentage),$("#modal-show-affiliate .affiliate-percentage").text(e.data.percentage),$("#modal-show-affiliate").modal("show")}})})),$("#modal-edit-affiliate .btn-update").unbind("click"),$("#modal-edit-affiliate .btn-update").on("click",(function(){var a=new FormData(document.getElementById("form-update-affiliate")),e=$("#modal-edit-affiliate .affiliate-id").val();loadingOnScreen(),$.ajax({method:"POST",url:"/api/affiliates/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:a,processData:!1,contentType:!1,cache:!1,error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){loadingOnScreenRemove(),alertCustom("success","Afiliado atualizado com sucesso"),i()}})}))},complete:function(a){unlockSearch($("#btn-filter-affiliates"))}})}function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=$("#project-affiliate-request").val(),t=$("#name-affiliate-request").val();e=e||null,t=t||null,a=null==a?"/api/affiliates/getaffiliaterequests?project="+e+"&name="+t+"&company="+$(".company-navbar").val():"/api/affiliates/getaffiliaterequests"+a+"&project="+e+"&name="+t+"&company="+$(".company-navbar").val(),loadOnTable("#body-table-affiliate-requests",".table-affiliate-request"),$.ajax({method:"GET",url:a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){$("#body-table-affiliate-requests").html(""),""==a.data?$("#body-table-affiliate-requests").html("<tr class='text-center'><td colspan='8' style='height: 257px; vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#body-table-affiliate-requests").attr("img-empty")+"'>Nenhuma solicitação de afiliação encontrada</td></tr>"):$.each(a.data,(function(a,e){data="",data+="<tr>",data+='<td class="" style="vertical-align: middle;">'+e.name+"</td>",data+='<td class="" style="vertical-align: middle;">'+e.email+"</td>",data+='<td class="" style="vertical-align: middle;">'+e.project_name+"</td>",data+='<td class="" style="vertical-align: middle;">'+e.date+"</td>",data+="<td class='text-center text-nowrap'>",3!=e.status&&0==verifyAccountFrozen()&&(data+="<a title='Aprovar' class='text-white ml-2 mb-1 mt-1 badge badge-success pointer evaluate-affiliate' affiliate='"+e.id+"' status='3'>Aprovar</a>",4!=e.status&&(data+="<a title='Recusar' class='text-white ml-2 mb-1 mt-1 badge badge-danger pointer evaluate-affiliate' affiliate='"+e.id+"' status='4'>Recusar</a>")),data+="</td>",data+="</tr>",$("#body-table-affiliate-requests").append(data)})),$(".table-affiliate-request").addClass("table-striped"),$(".table-affiliate-request").addClass("mb-0"),pagination(a,"affiliates-request",n),$(".evaluate-affiliate").on("click",(function(){var a=$(this).attr("affiliate"),e=$(this).attr("status");loadingOnScreen(),$.ajax({method:"POST",url:"/api/affiliates/evaluateaffiliaterequest",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{status:e,affiliate:a},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){loadingOnScreenRemove(),alertCustom("success","Solicitação de afiliação atualizada com sucesso"),i(),n()}})}))},complete:function(a){unlockSearch($("#btn-filter-affiliates-request"))}})}$("#btn-filter-affiliates").on("click",(function(){e($("#btn-filter-affiliates"),1)})),$("#btn-filter-affiliates-request").on("click",(function(){e($("#btn-filter-affiliates-request"),2)}))}));
