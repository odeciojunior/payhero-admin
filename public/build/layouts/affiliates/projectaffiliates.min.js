$(document).ready((function(){$(".company-navbar").change((function(){verifyIfCompanyIsDefault($(this).val())||(loadOnAny(".page-content"),updateCompanyDefault().done((function(a){getCompaniesAndProjects().done((function(a){a,$("#project-affiliate").find("option").not(":first").remove(),$("#project-affiliate-request").find("option").not(":first").remove(),e("n")}))})))}));getCompaniesAndProjects().done((function(a){a,e()}));var a={1:"success",2:"disable"};function t(a,t){if("true"!=searchIsLocked(a))switch(lockSearch(a),t){case 1:i();break;case 2:n()}}function e(){"y"==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y")?loadingOnScreen():loadOnAny(".page-content"),$("#tab-affiliates").trigger("click"),$.ajax({method:"GET",url:"/api/projects?affiliate=true&status=active&company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){loadOnAny(".page-content",!0),loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){isEmpty(a.data)?($("#project-empty").show(),$("#project-not-empty").hide(),$("#project-affiliate").append($("<option>",{value:0,text:"Nenhuma loja encontrado"})),$("#project-affiliate-request").append($("<option>",{value:0,text:"Nenhuma loja encontrado"}))):($("#project-empty").hide(),$("#project-not-empty").show(),$.each(a.data,(function(a,t){0==t.affiliated&&($("#project-affiliate").append($("<option>",{value:t.id,text:t.name})),$("#project-affiliate-request").append($("<option>",{value:t.id,text:t.name})))})),i(),n()),loadOnAny(".page-content",!0),loadingOnScreenRemove()}})}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=$("#project-affiliate").val(),n=$("#name-affiliate").val();e=e||null,n=n||null,t=null==t?"/api/affiliates/getaffiliates?project="+e+"&name="+n+"&company="+$(".company-navbar").val():"/api/affiliates/getaffiliates"+t+"&project="+e+"&name="+n+"&company="+$(".company-navbar").val(),loadOnTable("#body-table-affiliates",".table-affiliate"),$("#pagination-affiliates").children().attr("disabled","disabled"),$.ajax({method:"GET",url:t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(t){$("#body-table-affiliates").html(""),""==t.data?$("#body-table-affiliates").html("<tr class='text-center'><td colspan='8' style='height: 257px; vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#body-table-affiliates").attr("img-empty")+"'> Nenhum afiliado encontrado</td></tr>"):($.each(t.data,(function(t,e){var i=e.date.split(" "),n=i[0],l=i[1];""!=e.percentage&&"0"!=e.percentage||(e.percentage="0%"),data="",data+="<tr>",data+='<td class="ellipsis-text" style="vertical-align: middle;"><span class="fullInformation" data-toggle="tooltip" data-placement="top" title="'+e.name+'">'+e.name+"</span>",data+='<td class="ellipsis-text" style="vertical-align: middle;"><span class="fullInformation" data-toggle="tooltip" data-placement="top" title="'+e.project_name+'">'+e.project_name+"</span>",data+='<td class="" style="vertical-align: middle;">'+n+'<br> <span class="subdescription font-size-12">'+l+"</span> </td>",data+='<td class="text-center" style="vertical-align: middle;">'+e.percentage+"</td>",data+='<td class="text-center" ><span class="badge badge-'+a[e.status]+'">'+e.status_translated+"</span></td>",data+="<td class='text-center text-nowrap'>",data+="<a title='Visualizar' class='mg-responsive pointer details-affiliate' affiliate='"+e.id+"'><span class=''><img src='/build/global/img/icon-eye.svg'/></span></a>",data+="<a title='Editar' class='mg-responsive pointer edit-affiliate'    affiliate='"+e.id+"'><span class=''><img src='build/global/img/pencil-icon.svg'/></span></a>",data+="<a title='Excluir' class='mg-responsive pointer delete-affiliate' affiliate='"+e.id+"'><span class=''><img src='/build/global/img/icon-trash-tale.svg'/></span></a>",data+="</td>",data+="</tr>",$("#body-table-affiliates").append(data)})),$(".fullInformation").tooltip(),$(".fullInformation").tooltip()),$(".table-affiliate").addClass("table-striped"),$(".table-affiliate").addClass("mb-0"),pagination(t,"affiliates",i),$(".delete-affiliate").on("click",(function(a){if(a.preventDefault(),!verifyAccountFrozen()){var t=$(this).attr("affiliate");$("#modal-delete-affiliate").modal("show"),$("#modal-delete-affiliate .btn-delete").unbind("click"),$("#modal-delete-affiliate .btn-delete").on("click",(function(){$("#modal-delete").modal("hide"),loadingOnScreen(),$.ajax({method:"DELETE",url:"/api/affiliates/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){function t(){return a.apply(this,arguments)}return t.toString=function(){return a.toString()},t}((function(a){loadingOnScreenRemove(),errorAjaxResponse(a)})),success:function(a){loadingOnScreenRemove(),i()}})}))}})),$(document).on("click",".edit-affiliate",(function(){var a=$(this).attr("affiliate");verifyAccountFrozen()||$.ajax({method:"GET",url:"/api/affiliates/"+a+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(t){""!=t.data.percentage&&"0"!=t.data.percentage||(t.data.percentage="0%"),$("#modal-edit-affiliate .affiliate-id").val(a),$("#modal-edit-affiliate .affiliate-name").val(t.data.name),$("#modal-edit-affiliate .affiliate-percentage").val(t.data.percentage),1==t.data.status?$("#modal-edit-affiliate .affiliate-status").prop("selectedIndex",0).change():2==t.data.status&&$("#modal-edit-affiliate .affiliate-status").prop("selectedIndex",1).change(),$("#modal-edit-affiliate").modal("show")}})})),$(document).on("click",".details-affiliate",(function(){var t=$(this).attr("affiliate");$.ajax({method:"GET",url:"/api/affiliates/"+t+"/edit",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(t){""!=t.data.percentage&&"0"!=t.data.percentage||(t.data.percentage="0%"),$("#modal-show-affiliate .affiliate-name").text(t.data.name),$("#modal-show-affiliate .affiliate-email").text(t.data.email),$("#modal-show-affiliate .affiliate-company").text(t.data.company),$("#modal-show-affiliate .affiliate-project").text(t.data.project_name),$("#modal-show-affiliate .affiliate-phone").text(t.data.cellphone),$("#modal-show-affiliate .affiliate-percent").text(t.data.percentage),$("#modal-show-affiliate .affiliate-date").text(t.data.date),$("#modal-show-affiliate .affiliate-status").html('<span class="badge badge-'+a[t.data.status]+'">'+t.data.status_translated+"</span>"),$("#modal-show-affiliate .affiliate-percentage").text(t.data.percentage),$("#modal-show-affiliate .affiliate-percentage").text(t.data.percentage),$("#modal-show-affiliate").modal("show")}})})),$("#modal-edit-affiliate .btn-update").unbind("click"),$("#modal-edit-affiliate .btn-update").on("click",(function(){var a=new FormData(document.getElementById("form-update-affiliate")),t=$("#modal-edit-affiliate .affiliate-id").val();loadingOnScreen(),$.ajax({method:"POST",url:"/api/affiliates/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:a,processData:!1,contentType:!1,cache:!1,error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){loadingOnScreenRemove(),alertCustom("success","Afiliado atualizado com sucesso"),i()}})}))},complete:function(a){unlockSearch($("#btn-filter-affiliates"))}})}function n(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=$("#project-affiliate-request").val(),e=$("#name-affiliate-request").val();t=t||null,e=e||null,a=null==a?"/api/affiliates/getaffiliaterequests?project="+t+"&name="+e+"&company="+$(".company-navbar").val():"/api/affiliates/getaffiliaterequests"+a+"&project="+t+"&name="+e+"&company="+$(".company-navbar").val(),loadOnTable("#body-table-affiliate-requests",".table-affiliate-request"),$("#pagination-affiliates-request").children().attr("disabled","disabled"),$.ajax({method:"GET",url:a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(a){errorAjaxResponse(a)},success:function(a){$("#body-table-affiliate-requests").html(""),""==a.data?$("#body-table-affiliate-requests").html("<tr class='text-center'><td colspan='8' style='height: 257px; vertical-align: middle;'><img style='width:124px;margin-right:12px;' src='"+$("#body-table-affiliate-requests").attr("img-empty")+"'>Nenhuma solicitação de afiliação encontrada</td></tr>"):$.each(a.data,(function(a,t){var e=t.date.split(" "),i=e[0],n=e[1],l="";l+="<tr>",l+='<td class="ellipsis-text" style="vertical-align: middle;"><span class="fullInformation" data-toggle="tooltip" data-placement="top" title="'+t.name+'">'+t.name+"</span>",l+='<td class="ellipsis-text" style="vertical-align: middle;"><span class="fullInformation" data-toggle="tooltip" data-placement="top" title="'+t.email+'">'+t.email+"</span>",l+='<td class="ellipsis-text" style="vertical-align: middle;"><span class="fullInformation" data-toggle="tooltip" data-placement="top" title="'+t.project_name+'">'+t.project_name+"</span>",l+='<td class="" style="vertical-align: middle;">'+i+'<br> <span class="subdescription font-size-12">'+n+"</span> </td>",l+="<td class='text-center text-nowrap'>",3!=t.status&&0==verifyAccountFrozen()&&(l+="<a title='Aprovar' class='text-white ml-2 mb-1 mt-1 badge badge-success pointer evaluate-affiliate' affiliate='"+t.id+"' status='3'>Aprovar</a>",4!=t.status&&(l+="<a title='Recusar' class='text-white ml-2 mb-1 mt-1 badge badge-danger pointer evaluate-affiliate' affiliate='"+t.id+"' status='4'>Recusar</a>")),l+="</td>",l+="</tr>",$("#body-table-affiliate-requests").append(l)})),$(".table-affiliate-request").addClass("table-striped"),$(".table-affiliate-request").addClass("mb-0"),pagination(a,"affiliates-request",n),$(".evaluate-affiliate").on("click",(function(){var a=$(this).attr("affiliate"),t=$(this).attr("status");loadingOnScreen(),$.ajax({method:"POST",url:"/api/affiliates/evaluateaffiliaterequest",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},data:{status:t,affiliate:a},error:function(a){loadingOnScreenRemove(),errorAjaxResponse(a)},success:function(a){loadingOnScreenRemove(),alertCustom("success","Solicitação de afiliação atualizada com sucesso"),i(),n()}})}))},complete:function(a){unlockSearch($("#btn-filter-affiliates-request"))}})}$("#btn-filter-affiliates").on("click",(function(){t($("#btn-filter-affiliates"),1)})),$("#btn-filter-affiliates-request").on("click",(function(){t($("#btn-filter-affiliates-request"),2)}))}));
