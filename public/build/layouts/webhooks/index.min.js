$(document).ready((function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;loadingOnScreen(),$.ajax({method:"GET",url:"/api/webhooks?resume=true&page="+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($(".page-header").find(".store-webhook").css("display","none"),$("#content-error").find(".store-webhook").css("display","block"),$("#content-error").css("display","block"),$("#card-table-webhook").css("display","none"),$("#card-webhook-data").css("display","none")):($(".page-header").find(".store-webhook").css("display","block"),$("#content-error").find(".store-webhook").css("display","none"),$("#content-error").hide(),a(e),n(e,"webhooks")),o(),t(),loadingOnScreenRemove()}})}function a(e){$("#card-table-webhook").css("display","block"),$("#card-webhook-data").css("display","block"),$("#table-body-webhook").html(""),$.each(e.data,(function(e,a){dados="",dados+="<tr>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+a.description+"</p>",dados+='<small class="text-muted">Criada em '+a.register_date+"</small>",dados+="</td>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+a.url+"</p>",dados+='<small class="text-muted">'+a.company_name+"</small>",dados+="</td>",dados+='<td class="text-center">',dados+='<button class="btn pointer edit-webhook" style="background-color:transparent;" webhook="'+a.id+'" title="Editar webhook"><span class="o-edit-1"></span></button>',dados+='<button class="btn pointer delete-webhook" style="background-color:transparent;" webhook="'+a.id+'" title="Deletar webhook"><span class="o-bin-1"></span></button>',dados+="</td>",dados+="</tr>",$("#table-body-webhook").append(dados)}))}function o(){$(".edit-webhook").unbind("click"),$(".edit-webhook").on("click",(function(){var a=$(this).attr("webhook");$.ajax({method:"GET",url:"/api/webhooks/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){if(isEmpty(o.data))alertCustom("error","Erro ao obter dados do webhook");else{var t=o.data;$("#modal-edit-webhook").find('input[name="description"]').val(t.description),$("#modal-edit-webhook").find('input[name="url"]').val(t.url),$("#modal-edit-webhook .sirius-select").prop("selectedIndex",t.company_id).trigger("change"),$("#modal-edit-webhook .sirius-select-text").text(t.company_name),$("#modal-edit-webhook").modal("show"),function(a){$("#btn-edit-webhook").unbind("click"),$("#btn-edit-webhook").on("click",(function(){var o=$("#modal-edit-webhook").find('input[name="description"]').val(),t=$("#modal-edit-webhook").find('input[name="url"]').val(),n=$("#companies_edit").val();loadingOnScreen(),$.ajax({method:"PUT",url:"api/webhooks/"+a,data:{company_id:n,description:o,url:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(a){$(".close").click(),loadingOnScreenRemove(),e(),alertCustom("success",a.message)}})}))}(a)}}})}))}function t(){$(".delete-webhook").unbind("click"),$(".delete-webhook").on("click",(function(){var a=$(this).attr("webhook"),o="api/webhooks/"+a;$("#modal-delete-webhook").modal("show"),$("#btn-delete-webhook").unbind("click"),$("#btn-delete-webhook").on("click",(function(){loadingOnScreen(),$.ajax({method:"DELETE",url:o,data:{webhookId:a},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(a){loadingOnScreenRemove(),e(),alertCustom("success",a.message)}})}))}))}function n(a,o){if(1==a.meta.last_page)$("#primeira_pagina_"+o).hide(),$("#ultima_pagina_"+o).hide();else{$("#pagination-"+o).html("");for($("#pagination-"+o).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==a.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){e(1)})),x=3;x>0;x--)a.meta.current_page-x<=1||($("#pagination-"+o).append("<button id='page_"+(a.meta.current_page-x)+"' class='btn nav-btn'>"+(a.meta.current_page-x)+"</button>"),$("#page_"+(a.meta.current_page-x)).on("click",(function(){e($(this).html())})));if(1!=a.meta.current_page&&a.meta.current_page!=a.meta.last_page){var t="<button id='current_page' class='btn nav-btn active'>"+a.meta.current_page+"</button>";$("#pagination-"+o).append(t),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)a.meta.current_page+x>=a.meta.last_page||($("#pagination-"+o).append("<button id='page_"+(a.meta.current_page+x)+"' class='btn nav-btn'>"+(a.meta.current_page+x)+"</button>"),$("#page_"+(a.meta.current_page+x)).on("click",(function(){e($(this).html())})));if("1"!=a.meta.last_page){var n="<button id='last_page' class='btn nav-btn'>"+a.meta.last_page+"</button>";$("#pagination-"+o).append(n),a.meta.current_page==a.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){e(a.meta.last_page)}))}}}e(),$(".store-webhook").unbind(),$(".store-webhook").on("click",(function(){loadingOnScreenRemove(),$("#btn-save-webhook").unbind(),$("#btn-save-webhook").on("click",(function(){var a=$("#modal-webhook").find("input[name='description']").val(),o=$("#modal-webhook").find("input[name='url']").val(),t=$("#companies").val();""==a?alertCustom("error","Digite um nome para seu webhook"):t?""==o?alertCustom("error","Digite uma URL v√°lida"):(loadingOnScreen(),function(a,o,t){$.ajax({method:"POST",url:"/api/webhooks",data:{company_id:t,description:a,url:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(a){$(".close").click(),alertCustom("success","Webhook criado com sucesso!"),$(":text").val(""),$("#companies, #companies_edit").prop("selectedIndex",0).trigger("change"),loadingOnScreenRemove(),e()}})}(a,o,t)):alertCustom("error","Selecione uma empresa")})),$("#modal-webhook").modal("show")})),loadingOnScreen(),$.ajax({method:"GET",url:"/api/core/companies?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)||$.each(e.data,(function(e,a){companyIsApproved(a)&&$("#companies, #companies_edit").append($("<option>",{value:a.id,text:a.name}))})),loadingOnScreenRemove()}})}));
