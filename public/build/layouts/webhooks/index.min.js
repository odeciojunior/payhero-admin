$(document).ready((function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;$.ajax({method:"GET",url:"/api/webhooks?resume=true&page="+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){loadingOnScreen()},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($(".page-header").find(".store-webhook").css("display","none"),$("#content-error").find(".store-webhook").css("display","block"),$("#content-error").css("display","block"),$("#card-table-webhook").css("display","none"),$("#card-webhook-data").css("display","none")):($(".page-header").find(".store-webhook").css("display","block"),$("#content-error").find(".store-webhook").css("display","none"),$("#content-error").hide(),o(e),t(e,"webhooks"))},complete:function(){loadingOnScreenRemove()}})}function o(e){$("#card-table-webhook").css("display","block"),$("#card-webhook-data").css("display","block"),$("#table-body-webhook").html(""),$.each(e.data,(function(e,o){dados="",dados+="<tr>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+o.description+"</p>",dados+='<small class="text-muted">Criada em '+o.register_date+"</small>",dados+="</td>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+o.url+"</p>",dados+='<small class="text-muted">'+o.company_name+"</small>",dados+="</td>",dados+='<td class="text-center">',dados+='<button type="button" class="btn pointer edit-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Editar webhook"><span class="o-edit-1"></span></button>',dados+='<button type="button" class="btn pointer delete-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Deletar webhook"><span class="o-bin-1"></span></button>',dados+="</td>",dados+="</tr>",$("#table-body-webhook").append(dados)}))}function a(e){var o,a,t;return"store"==e?(o=$("#modal-webhook #description").val(),a=$("#modal-webhook #companies").val(),t=$("#modal-webhook #url").val()):"update"==e&&(o=$("#modal-edit-webhook #description_edit").val(),a=$("#modal-edit-webhook #companies_edit").val(),t=$("#modal-edit-webhook #url_edit").val()),isEmpty(o)?(alertCustom("error","Digite um nome para seu webhook"),!1):isEmpty(a)?(alertCustom("error","Selecione uma empresa"),!1):isEmpty(t)?(alertCustom("error","Digite uma URL"),!1):{description:o,company_id:a,url:t}}function t(o,a){if(1==o.meta.last_page)$("#primeira_pagina_"+a).hide(),$("#ultima_pagina_"+a).hide();else{$("#pagination-"+a).html("");for($("#pagination-"+a).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==o.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){e(1)})),x=3;x>0;x--)o.meta.current_page-x<=1||($("#pagination-"+a).append("<button id='page_"+(o.meta.current_page-x)+"' class='btn nav-btn'>"+(o.meta.current_page-x)+"</button>"),$("#page_"+(o.meta.current_page-x)).on("click",(function(){e($(this).html())})));if(1!=o.meta.current_page&&o.meta.current_page!=o.meta.last_page){var t="<button id='current_page' class='btn nav-btn active'>"+o.meta.current_page+"</button>";$("#pagination-"+a).append(t),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)o.meta.current_page+x>=o.meta.last_page||($("#pagination-"+a).append("<button id='page_"+(o.meta.current_page+x)+"' class='btn nav-btn'>"+(o.meta.current_page+x)+"</button>"),$("#page_"+(o.meta.current_page+x)).on("click",(function(){e($(this).html())})));if("1"!=o.meta.last_page){var n="<button id='last_page' class='btn nav-btn'>"+o.meta.last_page+"</button>";$("#pagination-"+a).append(n),o.meta.current_page==o.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){e(o.meta.last_page)}))}}}function n(){$(":text").val(""),$("#companies, #companies_edit").prop("selectedIndex",0).trigger("change")}e(),$.ajax({method:"GET",url:"/api/core/companies?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)||$.each(e.data,(function(e,o){companyIsApproved(o)&&$("#companies, #companies_edit").append($("<option>",{value:o.id,text:o.name}))}))}}),$(".store-webhook").on("click",(function(){$("#modal-webhook").modal("show")})),$("#btn-save-webhook").on("click",(function(){var o=a("store");o?function(o){$.ajax({method:"POST",url:"/api/webhooks",data:{description:o.description,company_id:o.company_id,url:o.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){$("#modal-webhook").modal("hide"),alertCustom("success","Webhook criado com sucesso"),n(),e()},complete:function(){loadingOnScreenRemove()}})}(o):errorAjaxResponse("")})),$("#table-body-webhook").on("click",".edit-webhook",(function(){var e=$(this).attr("webhook");$.ajax({method:"GET",url:"/api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){if(isEmpty(o.data))alertCustom("error","Erro ao obter dados do webhook");else{var a=o.data;$("#modal-edit-webhook #description_edit").val(a.description),$("#modal-edit-webhook #url_edit").val(a.url),$("#modal-edit-webhook #companies_edit").find("option").each((function(){if($(this).val()==a.company_id)return $("#modal-edit-webhook .sirius-select").prop("selectedIndex",$(this).index()).trigger("change"),$("#modal-edit-webhook .sirius-select-text").text(a.company_name),!1})),$("#modal-edit-webhook #webhook_id").val(e),$("#modal-edit-webhook").modal("show")}}})})),$("#modal-edit-webhook").on("click","#btn-edit-webhook",(function(){var o=a("update");o?function(o){var a=$("#modal-edit-webhook #webhook_id").val();$.ajax({method:"PUT",url:"api/webhooks/"+a,data:{description:o.description,company_id:o.company_id,url:o.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){$("#modal-edit-webhook").modal("hide"),alertCustom("success",o.message),n(),e()},complete:function(){loadingOnScreenRemove()}})}(o):errorAjaxResponse("")})),$("#table-body-webhook").on("click",".delete-webhook",(function(){$("#modal-delete-webhook #webhook_id").val($(this).attr("webhook")),$("#modal-delete-webhook").modal("show")})),$("#modal-delete-webhook").on("click","#btn-delete-webhook",(function(){var o=$("#modal-delete-webhook #webhook_id").val();$.ajax({method:"DELETE",url:"api/webhooks/"+o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){$("#modal-delete-webhook").modal("hide"),alertCustom("success",o.message),n(),e()},complete:function(){loadingOnScreenRemove()}})}))}));
