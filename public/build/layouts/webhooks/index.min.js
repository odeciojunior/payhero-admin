$(document).ready((function(){var e={external:"Webhook externo",checkout_api:"Checkout API"},o={admin:"default",personal:"default",external:"success",checkout_api:"primary"};function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;loadingOnScreen(),$.ajax({method:"GET",url:"/api/webhooks?resume=true&page="+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($(".page-header").find(".store-webhook").css("display","none"),$("#content-error").find(".store-webhook").css("display","block"),$("#content-error").css("display","block"),$("#content-script").css("display","none"),$("#card-table-webhook").css("display","none"),$("#card-webhook-data").css("display","none")):($(".page-header").find(".store-webhook").css("display","block"),$("#content-error").find(".store-webhook").css("display","none"),$("#content-error").hide(),t(e),c(e,"webhooks")),n(),s(),i(),loadingOnScreenRemove()}})}function t(a){$("#content-script").css("display","block"),$("#card-table-webhook").css("display","block"),$("#card-webhook-data").css("display","block"),$("#card-table-webhook").css("display","block"),$("#table-body-webhook").html(""),a.data.length>0&&-1!=a.data.findIndex((function(e){return"checkout_api"==e.webhook_type}))?($("#content-script").show(),$("#input-url-antifraud").val(a.data[0].antifraud_url)):($("#content-script").hide(),$("#input-url-antifraud").val("")),$.each(a.data,(function(a,t){var n="active"!==t.status?" disabled":"";dados="",dados+="<tr>",dados+='<td class="" style="vertical-align: middle;">',dados+='<p class="description mb-0 mr-1">'+t.description+"</p>",dados+='<small class="text-muted">Criada em '+t.register_date+"</small>",dados+="</td>",dados+='<td class="text-center">',dados+='<span class="badge badge-'+o[t.webhook_type]+' text-center">'+e[t.webhook_type]+"</span>",dados+="</td>",dados+='<td style="vertical-align: middle;">',dados+='<div class="input-group input-group-lg">',dados+='<input type="text" class="form-control font-sm brr inptToken" id="inputToken-'+t.id_code+'" value="'+t.access_token+'" disabled="disabled" style="background: #F1F1F1;">',dados+='<div class="input-group-append">',dados+='<button class="btn btn-primary bg-white btnCopiarLink" data-code="'+t.id_code+'" type="button" data-placement="top" data-toggle="tooltip" title="Copiar token" style="width: 48px; height: 48px;">',dados+='<img src="/build/global/img/icon-copy-b.svg">',dados+="</button>",dados+="</div>",dados+="</div>",dados+="</td>",dados+='<td class="text-center">',dados+='<button class="btn pointer edit-webhook" style="background-color:transparent;" webhook="'+t.id_code+'"'+n+' title="Editar webhook"><span class="o-edit-1"></span></button>',dados+='<button class="btn pointer delete-webhook" style="background-color:transparent;" webhook="'+t.id_code+'"'+n+' title="Deletar token"><span class="o-bin-1"></span></button>',dados+="</td>",dados+="</tr>",$("#table-body-webhook").append(dados)})),$("#webhooks_stored").html(""+a.resume.total),$("#webhooks_active").html(""+a.resume.active),$("#posts_received").html(""+a.resume.received),$("#posts_sent").html(""+a.resume.sent)}function n(){$(".edit-webhook").unbind("click"),$(".edit-webhook").on("click",(function(){$("#modal-edit-webhook").find('input[name="description"]').val(""),$("#modal-edit-webhook").find('input[name="postback"]').val("");var e=$(this).attr("webhook");$("#modal-edit-webhook").modal("show"),$.ajax({method:"GET",url:"/api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){isEmpty(o)?alertCustom("error","Erro ao obter dados do webhook"):(4==o.token_type_enum?($("#modal-edit-webhook").find('input[name="postback"]').val(o.postback),$("#modal-edit-webhook").find(".postback-container").show()):($("#modal-edit-webhook").find(".postback-container").hide(),$("#modal-edit-webhook").find('input[name="postback"]').val("")),$("#modal-edit-webhook").find('input[name="description"]').val(o.description),$("#modal-edit-webhook").find('input[name="token_type_enum"]').val(o.token_type_enum),function(e){$("#btn-edit-webhook").unbind("click"),$("#btn-edit-webhook").on("click",(function(){var o=$("#modal-edit-webhook").find('input[name="description"]').val(),t=$("#modal-edit-webhook").find('input[name="token_type_enum"]').val(),n=$("#modal-edit-webhook").find('input[name="postback"]').val();loadingOnScreen(),$.ajax({method:"PUT",url:"api/webhooks/"+e,data:{description:o,postback:n,token_type_enum:t},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){$(".close").click(),loadingOnScreenRemove(),a(),alertCustom("success",e.message)}})}))}(e))}})}))}function s(){$(".refresh-webhook").unbind("click"),$(".refresh-webhook").on("click",(function(){var e=$(this).attr("webhook"),o="api/webhooks/"+e+"/refreshtoken";$("#modal-refresh-webhook").modal("show"),$("#btn-refresh-webhook").unbind("click"),$("#btn-refresh-webhook").on("click",(function(){loadingOnScreen(),$.ajax({method:"POST",url:o,data:{webhookId:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),a(),alertCustom("success",e.message)}})}))}))}function i(){$(".delete-webhook").unbind("click"),$(".delete-webhook").on("click",(function(){var e=$(this).attr("webhook"),o="api/webhooks/"+e;$("#modal-delete-webhook").modal("show"),$("#btn-delete-webhook").unbind("click"),$("#btn-delete-webhook").on("click",(function(){loadingOnScreen(),$.ajax({method:"DELETE",url:o,data:{webhookId:e},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){loadingOnScreenRemove(),a(),alertCustom("success",e.message)}})}))}))}function c(e,o){if(1==e.meta.last_page)$("#primeira_pagina_"+o).hide(),$("#ultima_pagina_"+o).hide();else{$("#pagination-"+o).html("");for($("#pagination-"+o).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==e.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){a(1)})),x=3;x>0;x--)e.meta.current_page-x<=1||($("#pagination-"+o).append("<button id='page_"+(e.meta.current_page-x)+"' class='btn nav-btn'>"+(e.meta.current_page-x)+"</button>"),$("#page_"+(e.meta.current_page-x)).on("click",(function(){a($(this).html())})));if(1!=e.meta.current_page&&e.meta.current_page!=e.meta.last_page){var t="<button id='current_page' class='btn nav-btn active'>"+e.meta.current_page+"</button>";$("#pagination-"+o).append(t),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)e.meta.current_page+x>=e.meta.last_page||($("#pagination-"+o).append("<button id='page_"+(e.meta.current_page+x)+"' class='btn nav-btn'>"+(e.meta.current_page+x)+"</button>"),$("#page_"+(e.meta.current_page+x)).on("click",(function(){a($(this).html())})));if("1"!=e.meta.last_page){var n="<button id='last_page' class='btn nav-btn'>"+e.meta.last_page+"</button>";$("#pagination-"+o).append(n),e.meta.current_page==e.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){a(e.meta.last_page)}))}}}a(),$(".store-webhook").unbind(),$(".store-webhook").on("click",(function(){loadingOnScreenRemove(),$("#btn-save-webhook").unbind(),$("#btn-save-webhook").on("click",(function(){var e=$("#modal-webhook").find("input[name='description']").val(),o=$("#select-enum-list").val(),t=$("#modal-webhook").find("input[name='postback']").val(),n=$("#companies").val();""==e?alertCustom("error","O campo descrição é obrigatório"):4!=o||n?4==o&&""==t?alertCustom("error","O campo postback é obrigatório"):(loadingOnScreen(),function(e,o,t,n){$.ajax({method:"POST",url:"/api/webhooks",data:{description:e,token_type_enum:o,postback:t,company_id:n},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){$(".close").click(),alertCustom("success","Webhook criado com sucesso!"),loadingOnScreenRemove(),a()}})}(e,o,t,n)):alertCustom("error","O campo empresa é obrigatório")})),$("#modal-webhook").modal("show")})),loadingOnScreen(),$.ajax({method:"GET",url:"/api/core/companies?select=true",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)||$.each(e.data,(function(e,o){companyIsApproved(o)&&$("#companies").append($("<option>",{value:o.id,text:o.name}))})),loadingOnScreenRemove()}}),$(document).on("click",".btnCopiarLink",(function(){var e=$("<input>");$("body").append(e);var o=$(this).data("code"),a=$("#inputToken-"+o).val();e.val(a).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Token copiado!")})),$(document).on("click",".btnCopiarLinkAntifraud",(function(){var e=$("<input>");$("body").append(e);var o=$("#input-url-antifraud").val();e.val(o).select(),document.execCommand("copy"),e.remove(),alertCustom("success","Antifraud URL copiada!")})),$("#select-enum-list").on("change",(function(e){var o=e.target.value,a=$(".companies-container"),t=$(".postback-container");$("#description").val(""),4==o?(a.addClass("d-flex").removeClass("d-none"),t.addClass("d-flex").removeClass("d-none")):(a.addClass("d-none").removeClass("d-flex"),t.addClass("d-none").removeClass("d-flex"))})),window.location.href.includes("#add_checkout_api")&&($('select[name="token_type_enum"]').val(4).change(),$("#modal-webhook").modal("show"))}));
