<<<<<<< HEAD
$(document).ready(function () {
  $(".company-navbar").change(function () {
    if (verifyIfCompanyIsDefault($(this).val())) return;
    loadOnAny("#page-webhooks", false);
    updateCompanyDefault().done(function (data1) {
      getCompaniesAndProjects().done(function (data2) {
        companiesAndProjects = data2;
        $(".company_name").val(companiesAndProjects.company_default_fullname);
        refreshWebhooks(1, false);
      });
    });
  });
  var companiesAndProjects = "";
  getCompaniesAndProjects().done(function (data) {
    companiesAndProjects = data;
    $(".company_name").val(companiesAndProjects.company_default_fullname);
    refreshWebhooks();
  });

  function refreshWebhooks() {
    var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;
    var reload = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;
    $.ajax({
      method: "GET",
      url: "/api/webhooks?resume=true&page=" + page + "&company_id=" + $(".company-navbar").val(),
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      beforeSend: function beforeSend() {
        if (reload) {
          loadOnAny("#page-webhooks", false);
        }
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        if (isEmpty(response.data)) {
          $(".page-header").find(".store-webhook").css("display", "none");
          $("#content-error").find(".store-webhook").css("display", "block");
          $("#content-error").css("display", "block");
          $("#content-script").css("display", "none");
          $("#card-table-webhook").css("display", "none");
          $("#card-webhook-data").css("display", "none");
        } else {
          $(".page-header").find(".store-webhook").css("display", "block");
          $("#content-error").find(".store-webhook").css("display", "none");
          $("#content-error").hide();
          $("#content-script").show();
          updateWebhookTableData(response);
          pagination(response, "webhooks");
        }
      },
      complete: function complete() {
        loadOnAny("#page-webhooks", true);
        loadingOnScreenRemove();
      }
    });
  }

  function updateWebhookTableData(response) {
    $("#content-script").css("display", "block");
    $("#card-table-webhook").css("display", "block");
    $("#card-webhook-data").css("display", "block");
    $("#table-body-webhook").html("");
    $.each(response.data, function (index, value) {
      dados = "";
      dados += "<tr>";
      dados += '<td class="" style="vertical-align: middle;">';
      dados += '<p class="description mb-0 mr-1">' + value.description + "</p>";
      dados += '<small class="text-muted">Criada em ' + value.register_date + "</small>";
      dados += "</td>";
      dados += '<td class="" style="vertical-align: middle;">';
      dados += '<p class="description mb-0 mr-1">' + value.url + "</p>";
      dados += '<small class="text-muted">' + value.company_name + "</small>";
      dados += "</td>";
      dados += '<td class="text-center">';
      dados += '<button type="button" class="btn pointer edit-webhook" style="background-color:transparent;" webhook="' + value.id + '"' + ' title="Editar webhook"><span class="o-edit-1"></span></button>';
      dados += '<button type="button" class="btn pointer delete-webhook" style="background-color:transparent;" webhook="' + value.id + '"' + ' title="Deletar webhook"><span class="o-bin-1"></span></button>';
      dados += "</td>";
      dados += "</tr>";
      $("#table-body-webhook").append(dados);
    });
  }

  $(".store-webhook").on("click", function () {
    $("#modal-webhook").modal("show");
  });
  $("#btn-save-webhook").on("click", function () {
    var data = validate("store");
    data ? storeWebhook(data) : errorAjaxResponse("");
  });

  function storeWebhook(data) {
    $.ajax({
      method: "POST",
      url: "/api/webhooks",
      data: {
        description: data.description,
        company_id: data.company_id,
        url: data.url
      },
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      beforeSend: function beforeSend() {
        loadOnAny("#modal-webhook #modal-loader", false);
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        $("#modal-webhook").modal("hide");
        alertCustom("success", response.message);
        clearForm();
        refreshWebhooks();
      },
      complete: function complete() {
        loadOnAny("#modal-webhook #modal-loader", true);
      }
    });
  }

  $("#table-body-webhook").on("click", ".edit-webhook", function () {
    var webhookId = $(this).attr("webhook");
    $.ajax({
      method: "GET",
      url: "/api/webhooks/" + webhookId,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        if (!isEmpty(response.data)) {
          var webhook = response.data;
          $("#modal-edit-webhook #description_edit").val(webhook.description);
          $("#modal-edit-webhook #url_edit").val(webhook.url);
          $("#modal-edit-webhook #webhook_id").val(webhookId);
          $("#modal-edit-webhook").modal("show");
        } else {
          alertCustom("error", "Erro ao obter dados do webhook");
        }
      }
    });
  });
  $("#modal-edit-webhook").on("click", "#btn-edit-webhook", function () {
    var data = validate("update");
    data ? updateWebhook(data) : errorAjaxResponse("");
  });

  function updateWebhook(data) {
    var webhookId = $("#modal-edit-webhook #webhook_id").val();
    $.ajax({
      method: "PUT",
      url: "api/webhooks/" + webhookId,
      data: {
        description: data.description,
        company_id: data.company_id,
        url: data.url
      },
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      beforeSend: function beforeSend() {
        loadOnAny("#modal-edit-webhook #modal-loader", false);
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        $("#modal-edit-webhook").modal("hide");
        alertCustom("success", response.message);
        clearForm();
        refreshWebhooks();
      },
      complete: function complete() {
        loadOnAny("#modal-edit-webhook #modal-loader", true);
      }
    });
  }

  function validate(event) {
    var description, company_id, url;

    if (event == "store") {
      description = $("#modal-webhook #description").val();
      company_id = $(".company-navbar").val();
      url = $("#modal-webhook #url").val();
    } else if (event == "update") {
      description = $("#modal-edit-webhook #description_edit").val();
      company_id = $(".company-navbar").val();
      url = $("#modal-edit-webhook #url_edit").val();
    }

    if (isEmpty(description)) {
      alertCustom("error", "Digite uma descrição para seu webhook");
      return false;
    }

    if (isEmpty(company_id)) {
      alertCustom("error", "Selecione uma empresa");
      return false;
    }

    if (isEmpty(url)) {
      alertCustom("error", "Digite uma URL");
      return false;
    }

    return {
      description: description,
      company_id: company_id,
      url: url
    };
  }

  $("#table-body-webhook").on("click", ".delete-webhook", function () {
    $("#modal-delete-webhook #webhook_id").val($(this).attr("webhook"));
    $("#modal-delete-webhook").modal("show");
  });
  $("#modal-delete-webhook").on("click", "#btn-delete-webhook", function () {
    var webhookId = $("#modal-delete-webhook #webhook_id").val();
    $.ajax({
      method: "DELETE",
      url: "api/webhooks/" + webhookId,
      dataType: "json",
      headers: {
        Authorization: $('meta[name="access-token"]').attr("content"),
        Accept: "application/json"
      },
      error: function error(response) {
        errorAjaxResponse(response);
      },
      success: function success(response) {
        $("#modal-delete-webhook").modal("hide");
        alertCustom("success", response.message);
        clearForm();
        refreshWebhooks();
      }
    });
  });

  function pagination(response, model) {
    if (response.meta.last_page == 1) {
      $("#first_page").hide();
      $("#last_page").hide();
    } else {
      $("#pagination-" + model).html("");
      var first_page = "<button id='first_page' class='btn nav-btn'>1</button>";
      $("#pagination-" + model).append(first_page);

      if (response.meta.current_page == "1") {
        $("#first_page").attr("disabled", true).addClass("nav-btn").addClass("active");
      }

      $("#first_page").on("click", function () {
        refreshWebhooks(1);
      });

      for (x = 3; x > 0; x--) {
        if (response.meta.current_page - x <= 1) {
          continue;
        }

        $("#pagination-" + model).append("<button id='page_" + (response.meta.current_page - x) + "' class='btn nav-btn'>" + (response.meta.current_page - x) + "</button>");
        $("#page_" + (response.meta.current_page - x)).on("click", function () {
          refreshWebhooks($(this).html());
        });
      }

      if (response.meta.current_page != 1 && response.meta.current_page != response.meta.last_page) {
        var current_page = "<button id='current_page' class='btn nav-btn active'>" + response.meta.current_page + "</button>";
        $("#pagination-" + model).append(current_page);
        $("#current_page").attr("disabled", true).addClass("nav-btn").addClass("active");
      }

      for (x = 1; x < 4; x++) {
        if (response.meta.current_page + x >= response.meta.last_page) {
          continue;
        }

        $("#pagination-" + model).append("<button id='page_" + (response.meta.current_page + x) + "' class='btn nav-btn'>" + (response.meta.current_page + x) + "</button>");
        $("#page_" + (response.meta.current_page + x)).on("click", function () {
          refreshWebhooks($(this).html());
        });
      }

      if (response.meta.last_page != "1") {
        var last_page = "<button id='last_page' class='btn nav-btn'>" + response.meta.last_page + "</button>";
        $("#pagination-" + model).append(last_page);

        if (response.meta.current_page == response.meta.last_page) {
          $("#last_page").attr("disabled", true).addClass("nav-btn").addClass("active");
        }

        $("#last_page").on("click", function () {
          refreshWebhooks(response.meta.last_page);
        });
      }
    }
  }

  function clearForm() {
    $("#modal-edit-webhook #webhook_id, #modal-delete-webhook #webhook_id, #description, #description_edit, #url, #url_edit").val("");
  }
});
=======
$(document).ready((function(){$(".company-navbar").change((function(){verifyIfCompanyIsDefault($(this).val())||(loadOnAny("#page-webhooks",!1),updateCompanyDefault().done((function(a){getCompaniesAndProjects().done((function(a){e=a,$(".company_name").val(e.company_default_fullname),o(1,!1)}))})))}));var e="";function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];$.ajax({method:"GET",url:"/api/webhooks?resume=true&page="+e+"&company_id="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){o&&loadOnAny("#page-webhooks",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($(".page-header").find(".store-webhook").css("display","none"),$("#content-error").find(".store-webhook").css("display","block"),$("#content-error").css("display","block"),$("#content-script").css("display","none"),$("#card-table-webhook").css("display","none"),$("#card-webhook-data").css("display","none")):($(".page-header").find(".store-webhook").css("display","block"),$("#content-error").find(".store-webhook").css("display","none"),$("#content-error").hide(),$("#content-script").show(),a(e),n(e,"webhooks"))},complete:function(){loadOnAny("#page-webhooks",!0),loadingOnScreenRemove()}})}function a(e){$("#content-script").css("display","block"),$("#card-table-webhook").css("display","block"),$("#card-webhook-data").css("display","block"),$("#table-body-webhook").html(""),$.each(e.data,(function(e,o){dados="",dados+="<tr>",dados+='<td class="ellipsis-text">',dados+=o.description+"<br>",dados+='<span class="subdescription font-size-12">Criada em '+o.register_date+"</span>",dados+="</td>",dados+='<td class="ellipsis-text">',dados+=o.url+"<br>",dados+='<span class="subdescription font-size-12">'+o.company_name+"</span>",dados+="</td>",dados+='<td class="text-right">',dados+='<button type="button" class="btn pointer edit-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Editar webhook"><span class=""><img src="/build/global/img/icon-eye.svg"></span></button>',dados+='<button type="button" class="btn pointer delete-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Deletar webhook"><span class=""><img src="/build/global/img/icon-trash-tale.svg"></span></button>',dados+="</td>",dados+="</tr>",$("#table-body-webhook").append(dados)}))}function t(e){var o,a,t;return"store"==e?(o=$("#modal-webhook #description").val(),a=$(".company-navbar").val(),t=$("#modal-webhook #url").val()):"update"==e&&(o=$("#modal-edit-webhook #description_edit").val(),a=$(".company-navbar").val(),t=$("#modal-edit-webhook #url_edit").val()),isEmpty(o)?(alertCustom("error","Digite uma descrição para seu webhook"),!1):isEmpty(a)?(alertCustom("error","Selecione uma empresa"),!1):isEmpty(t)?(alertCustom("error","Digite uma URL"),!1):{description:o,company_id:a,url:t}}function n(e,a){if(1==e.meta.last_page)$("#first_page").hide(),$("#last_page").hide(),$("#pagination-container-webhooks").removeClass("d-flex").addClass("d-none");else{$("#pagination-"+a).html("");for($("#pagination-"+a).append("<button id='first_page' class='btn nav-btn'>1</button>"),"1"==e.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",(function(){o(1)})),x=3;x>0;x--)e.meta.current_page-x<=1||($("#pagination-"+a).append("<button id='page_"+(e.meta.current_page-x)+"' class='btn nav-btn'>"+(e.meta.current_page-x)+"</button>"),$("#page_"+(e.meta.current_page-x)).on("click",(function(){o($(this).html())})));if(1!=e.meta.current_page&&e.meta.current_page!=e.meta.last_page){var t="<button id='current_page' class='btn nav-btn active'>"+e.meta.current_page+"</button>";$("#pagination-"+a).append(t),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)e.meta.current_page+x>=e.meta.last_page||($("#pagination-"+a).append("<button id='page_"+(e.meta.current_page+x)+"' class='btn nav-btn'>"+(e.meta.current_page+x)+"</button>"),$("#page_"+(e.meta.current_page+x)).on("click",(function(){o($(this).html())})));if("1"!=e.meta.last_page){var n="<button id='last_page' class='btn nav-btn'>"+e.meta.last_page+"</button>";$("#pagination-"+a).append(n),e.meta.current_page==e.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",(function(){o(e.meta.last_page)}))}$("#pagination-container-webhooks").removeClass("d-none").addClass("d-flex")}}function s(){$("#modal-edit-webhook #webhook_id, #modal-delete-webhook #webhook_id, #description, #description_edit, #url, #url_edit").val("")}getCompaniesAndProjects().done((function(a){e=a,$(".company_name").val(e.company_default_fullname),o()})),$(".store-webhook").on("click",(function(){$("#modal-webhook").modal("show")})),$("#btn-save-webhook").on("click",(function(){var e=t("store");e?function(e){$.ajax({method:"POST",url:"/api/webhooks",data:{description:e.description,company_id:e.company_id,url:e.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){loadOnAny("#modal-webhook #modal-loader",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-webhook").modal("hide"),alertCustom("success",e.message),s(),o()},complete:function(){loadOnAny("#modal-webhook #modal-loader",!0)}})}(e):errorAjaxResponse("")})),$("#table-body-webhook").on("click",".edit-webhook",(function(){var e=$(this).attr("webhook");$.ajax({method:"GET",url:"/api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){if(isEmpty(o.data))alertCustom("error","Erro ao obter dados do webhook");else{var a=o.data;$("#modal-edit-webhook #description_edit").val(a.description),$("#modal-edit-webhook #url_edit").val(a.url),$("#modal-edit-webhook #webhook_id").val(e),$("#modal-edit-webhook").modal("show")}}})})),$("#modal-edit-webhook").on("click","#btn-edit-webhook",(function(){var e=t("update");e?function(e){var a=$("#modal-edit-webhook #webhook_id").val();$.ajax({method:"PUT",url:"api/webhooks/"+a,data:{description:e.description,company_id:e.company_id,url:e.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){loadOnAny("#modal-edit-webhook #modal-loader",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-edit-webhook").modal("hide"),alertCustom("success",e.message),s(),o()},complete:function(){loadOnAny("#modal-edit-webhook #modal-loader",!0)}})}(e):errorAjaxResponse("")})),$("#table-body-webhook").on("click",".delete-webhook",(function(){$("#modal-delete-webhook #webhook_id").val($(this).attr("webhook")),$("#modal-delete-webhook").modal("show")})),$("#modal-delete-webhook").on("click","#btn-delete-webhook",(function(){var e=$("#modal-delete-webhook #webhook_id").val();$.ajax({method:"DELETE",url:"api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-delete-webhook").modal("hide"),alertCustom("success",e.message),s(),o()}})}))}));
>>>>>>> master
