$(document).ready(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||(loadOnAny("#page-webhooks",!1),updateCompanyDefault().done(function(a){getCompaniesAndProjects().done(function(a){e=a,$(".company_name").val(e.company_default_fullname),o(1,!1)})}))});var e="";function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];$.ajax({method:"GET",url:"/api/webhooks?resume=true&page="+e+"&company_id="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){a&&loadOnAny("#page-webhooks",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){isEmpty(e.data)?($(".page-header").find(".store-webhook").css("display","none"),$("#content-error").find(".store-webhook").css("display","block"),$("#content-error").css("display","block"),$("#content-script").css("display","none"),$("#card-table-webhook").css("display","none"),$("#card-webhook-data").css("display","none")):($(".page-header").find(".store-webhook").css("display","block"),$("#content-error").find(".store-webhook").css("display","none"),$("#content-error").hide(),$("#content-script").show(),function(e){$("#content-script").css("display","block"),$("#card-table-webhook").css("display","block"),$("#card-webhook-data").css("display","block"),$("#table-body-webhook").html(""),$.each(e.data,function(e,o){var a="";a+="<tr>",a+='<td class="ellipsis-text">',a+=o.description+"<br>",a+='<span class="subdescription font-size-12">Criada em '+o.register_date+"</span>",a+="</td>",a+='<td class="ellipsis-text">',a+=o.url+"<br>",a+='<span class="subdescription font-size-12">'+o.company_name+"</span>",a+="</td>",a+='<td class="text-right">',a+='<button type="button" class="btn pointer edit-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Editar webhook"><span class=""><img src="/build/global/img/icon-eye.svg"></span></button>',a+='<button type="button" class="btn pointer delete-webhook" style="background-color:transparent;" webhook="'+o.id+'" title="Deletar webhook"><span class=""><img src="/build/global/img/icon-trash-tale.svg"></span></button>',a+="</td>",a+="</tr>",$("#table-body-webhook").append(a)})}(e),function(e,a){if(1==e.meta.last_page)$("#first_page").hide(),$("#last_page").hide(),$("#pagination-container-webhooks").removeClass("d-flex").addClass("d-none");else{$("#pagination-"+a).html("");var t="<button id='first_page' class='btn nav-btn'>1</button>";for($("#pagination-"+a).append(t),"1"==e.meta.current_page&&$("#first_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#first_page").on("click",function(){o(1)}),x=3;x>0;x--)e.meta.current_page-x<=1||($("#pagination-"+a).append("<button id='page_"+(e.meta.current_page-x)+"' class='btn nav-btn'>"+(e.meta.current_page-x)+"</button>"),$("#page_"+(e.meta.current_page-x)).on("click",function(){o($(this).html())}));if(1!=e.meta.current_page&&e.meta.current_page!=e.meta.last_page){var n="<button id='current_page' class='btn nav-btn active'>"+e.meta.current_page+"</button>";$("#pagination-"+a).append(n),$("#current_page").attr("disabled",!0).addClass("nav-btn").addClass("active")}for(x=1;x<4;x++)e.meta.current_page+x>=e.meta.last_page||($("#pagination-"+a).append("<button id='page_"+(e.meta.current_page+x)+"' class='btn nav-btn'>"+(e.meta.current_page+x)+"</button>"),$("#page_"+(e.meta.current_page+x)).on("click",function(){o($(this).html())}));if("1"!=e.meta.last_page){var s="<button id='last_page' class='btn nav-btn'>"+e.meta.last_page+"</button>";$("#pagination-"+a).append(s),e.meta.current_page==e.meta.last_page&&$("#last_page").attr("disabled",!0).addClass("nav-btn").addClass("active"),$("#last_page").on("click",function(){o(e.meta.last_page)})}$("#pagination-container-webhooks").removeClass("d-none").addClass("d-flex")}}(e,"webhooks"))},complete:function(){loadOnAny("#page-webhooks",!0),loadingOnScreenRemove()}})}function a(e){var o,a,t;return"store"==e?(o=$("#modal-webhook #description").val(),a=$(".company-navbar").val(),t=$("#modal-webhook #url").val()):"update"==e&&(o=$("#modal-edit-webhook #description_edit").val(),a=$(".company-navbar").val(),t=$("#modal-edit-webhook #url_edit").val()),isEmpty(o)?(alertCustom("error","Digite uma descrição para seu webhook"),!1):isEmpty(a)?(alertCustom("error","Selecione uma empresa"),!1):isEmpty(t)?(alertCustom("error","Digite uma URL"),!1):{description:o,company_id:a,url:t}}function t(){$("#modal-edit-webhook #webhook_id, #modal-delete-webhook #webhook_id, #description, #description_edit, #url, #url_edit").val("")}getCompaniesAndProjects().done(function(a){e=a,$(".company_name").val(e.company_default_fullname),o()}),$(".store-webhook").on("click",function(){$("#modal-webhook").modal("show")}),$("#btn-save-webhook").on("click",function(){var e=a("store");e?function(e){$.ajax({method:"POST",url:"/api/webhooks",data:{description:e.description,company_id:e.company_id,url:e.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){loadOnAny("#modal-webhook #modal-loader",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-webhook").modal("hide"),alertCustom("success",e.message),t(),o()},complete:function(){loadOnAny("#modal-webhook #modal-loader",!0)}})}(e):errorAjaxResponse("")}),$("#table-body-webhook").on("click",".edit-webhook",function(){var e=$(this).attr("webhook");$.ajax({method:"GET",url:"/api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(o){if(isEmpty(o.data))alertCustom("error","Erro ao obter dados do webhook");else{var a=o.data;$("#modal-edit-webhook #description_edit").val(a.description),$("#modal-edit-webhook #url_edit").val(a.url),$("#modal-edit-webhook #webhook_id").val(e),$("#modal-edit-webhook #x-signature-edit").val(a.signature),$("#modal-edit-webhook").modal("show")}}})}),$("#modal-edit-webhook").on("click","#btn-edit-webhook",function(){var e=a("update");e?function(e){var a=$("#modal-edit-webhook #webhook_id").val();$.ajax({method:"PUT",url:"api/webhooks/"+a,data:{description:e.description,company_id:e.company_id,url:e.url},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},beforeSend:function(){loadOnAny("#modal-edit-webhook #modal-loader",!1)},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-edit-webhook").modal("hide"),alertCustom("success",e.message),t(),o()},complete:function(){loadOnAny("#modal-edit-webhook #modal-loader",!0)}})}(e):errorAjaxResponse("")}),$("#table-body-webhook").on("click",".delete-webhook",function(){$("#modal-delete-webhook #webhook_id").val($(this).attr("webhook")),$("#modal-delete-webhook").modal("show")}),$("#modal-delete-webhook").on("click","#btn-delete-webhook",function(){var e=$("#modal-delete-webhook #webhook_id").val();$.ajax({method:"DELETE",url:"api/webhooks/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$("#modal-delete-webhook").modal("hide"),alertCustom("success",e.message),t(),o()}})})});
