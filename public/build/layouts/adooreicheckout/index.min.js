$(document).ready(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").hide(),loadOnAny("#content"),updateCompanyDefault().done(function(o){getCompaniesAndProjects().done(function(o){e=o,t(!1)})}))});var e="";function t(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t?loadingOnScreen():loadOnAny("#content");$.ajax({method:"GET",url:"/api/apps/adooreicheckout",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadOnAny("#content",!0),loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(o){if($("#project_id, #select_projects_edit").html(""),fillSelectProject(e,"#project_id, #select_projects_edit"),isEmpty(o.integrations))$("#no-integration-found").show();else{$("#content").html("");var n=o.integrations[0];a=n,$("#content").append('\n            <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3 integration-card" id_code="'.concat(a.id_code,'">\n                <div class="d-flex align-items-center justify-content-center"   >\n                    <img class="card-img-top img-fluid w-full" src="/build/global/img/adoorei.png"/>\n                </div>\n                <div class="card shadow card-edit" style=\'cursor:pointer;\'>\n                    <div class="card-body">\n                        <div class=\'row\'>\n                            <div class=\'col-md-10\'>\n                                <p>Clique aqui consultar o token</p>\n                                <p class="card-text sm">Criado em ').concat(a.register_date,"</p>\n                            </div>\n                            <div class='col-md-2'>\n                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' id_code=\"").concat(a.id_code,'">\n                                    <img src="/build/global/img/icon-trash-new.svg" />\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ')),$("#no-integration-found").hide()}var a;$("#project-empty").hide(),$("#integration-actions").show(),t&&loadOnAny("#content",!0),loadingOnScreenRemove()}})}getCompaniesAndProjects().done(function(o){e=o,t()}),$("#btn-add-integration").on("click",function(){$(".modal-title").html("Adicionar nova Integração com Adoorei Checkout"),$("#bt_integration").addClass("btn-save"),$("#bt_integration").removeClass("btn-update"),$("#bt_integration").text("Adicionar integração"),$("#bt_integration").show(),$("#modal_add_integracao").modal("show"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$("#token").val(""),$("#webhook").val("")}),$(document).on("click",".card-edit",function(){$.ajax({method:"GET",url:"/api/apps/adooreicheckout/",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){var t,o=e.integrations[0],n=e.Webhooks[0],a=$("#x-signature-div");$("#token_edit").val(o.access_token),$("#integration_id").val(o.id_code),$("#webhook_edit").val(null!==(t=n.url)&&void 0!==t?t:null),a.hide(),n.signature.length>0&&($("#x-signature-edit").val(n.signature),a.show()),$(".modal-title").html("Integração com Adoorei Checkout"),$("#bt_integration").addClass("btn-update"),$("#bt_integration").removeClass("btn-save"),$("#bt_integration").text("Atualizar"),$("#form_update_integration").show(),$("#form_add_integration").hide(),$("#modal_add_integracao").modal("show")}})}),$(".btn-copy").on("click",function(){var e=$(this).prev("input");copyTextToClipboard(e,"Copiado com sucesso!")}),$(document).on("click",".btn-save",function(){if(""===$("#token").val())return alertCustom("error","Dados informados inválidos"),!1;var e=new FormData(document.getElementById("form_add_integration"));loadingOnScreen();(function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise(function(n,a){$.ajax({method:"POST",url:"/api/integrations",data:{description:e,company_id:t,platform_enum:o},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e),a(e)},success:function(e){n(e)}})})})("Adoorei_Checkout",$(".company-navbar").val(),"ADOOREI_CHECKOUT").then(function(o){$.ajax({method:"POST",url:"/api/apps/adooreicheckout",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:e,error:function(e){errorAjaxResponse(e),loadingOnScreenRemove()},success:function(e){t(),loadingOnScreenRemove(),alertCustom("success",e.message)}})}).catch(function(e){loadingOnScreenRemove(),console.error("Erro ao executar storeIntegration:",e)})}),$(document).on("click",".btn-update",function(){if(""==$("#webhook_edit").val())return alertCustom("error","Webhook é obrigatório"),!1;var e=$("#integration_id").val(),o=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/adooreicheckout/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:o,error:function(e){errorAjaxResponse(e)},success:function(e){t(),alertCustom("success",e.message)}})}),$(document).on("click",".delete-integration",function(e){e.stopPropagation();var t=$(this).attr("id_code");$("#modal-delete-integration .btn-delete").attr("id_code",t),$("#modal-delete-integration").modal("show")}),$(document).on("click","#modal-delete-integration .btn-delete",function(e){e.stopPropagation();var o=$(this).attr("id_code");$.ajax({method:"DELETE",url:"/api/apps/adooreicheckout/"+o,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){$('.integration-card[id_code="'.concat(o,'"]')).remove(),t(),alertCustom("success",e.message)}})})});
