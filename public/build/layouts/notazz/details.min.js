$(function(){$("#discount_value").mask("00%",{reverse:!0}),$("#apply_discount").on("click",function(){$("#div_discount").is(":visible")?($("#div_discount").hide(),$("#discount_value").val("")):($("#div_discount").show(),$("#discount_type").on("change",function(){"value"==$("#discount_type").val()?($("#discount_value").mask("#.###,#0",{reverse:!0}).removeAttr("maxlength"),$("#label_discount_value").html("Valor (ex: 20,00)")):($("#discount_value").mask("00%",{reverse:!0}),$("#label_discount_value").html("Valor (ex: 20%)"))}))}),$(document).on("click","#boleto-link .copy_link",function(){var t=$("<input>");$("#nav-tabContent").append(t),t.val($(this).attr("link")).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Link copiado!")}),$(document).on("click","#boleto-digitable-line .copy_link",function(){var t=$("<input>");$("#nav-tabContent").append(t),t.val($(this).attr("digitable-line")).select(),document.execCommand("copy"),t.remove(),alertCustom("success","Linha Digitável copiado!")}),$(document).on("click",".btn-edit-trackingcode",function(){var t=$(this).parent().parent().find("#tracking_code"),a=t.parent().find(".tracking-code-span"),e=$(this),n=e.parent().find(".btn-save-trackingcode"),o=$(this).parent().find(".btn-close-tracking");e.hide("fast"),n.show("fast"),o.show("fast"),a.hide("fast"),t.show("fast")}),$(document).on("click",".btn-close-tracking",function(){var t=$(this).parent().parent().find("#tracking_code"),a=t.parent().find(".tracking-code-span"),e=$(this).parent().find(".btn-edit-trackingcode"),n=$(this).parent().find(".btn-save-trackingcode");$(this).hide("fast"),n.hide("fast"),t.hide("fast"),e.show("fast"),a.show("fast")}),$(document).on("click",".detalhes_venda",function(){var t=$(this).attr("sale");loadOnAny("#modal-saleDetails"),$("#modal_detalhes").modal("show"),$.ajax({method:"GET",url:"/api/sales/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){!function(t){(function(t){$("#sale-code").text(t.id),$("#payment-type").text("Pagamento via "+(2===t.payment_method?"Boleto":"Cartão "+t.flag)+" em "+t.start_date+" às "+t.hours),""!=t.release_date?$("#release-date").text("Data de liberação: "+t.release_date):$("#release-date").text("");var a=$(".modal-body #status");switch(a.html(""),a.append('<img style="width: 50px;" src="/build/global/img/cartoes/'+t.flag+'.png">'),t.status){case 1:a.append("<span class='badge badge-success'>Aprovada</span>");break;case 2:a.append("<span class='badge badge-pendente'>Pendente</span>");break;case 3:a.append("<span class='badge badge-danger'>Recusada</span>");break;case 4:a.append("<span class='badge badge-danger'>Estornada</span>");break;case 6:a.append("<span class='badge badge-primary'>Em análise</span>");break;default:a.append("<span class='badge badge-primary'>"+t.status+"</span>")}$("#subtotal-value").html("R$ "+t.subTotal),$("#shipment-value").html("R$ "+t.shipment_value),$("#iof-label, #iof-value, #cambio-label, #cambio-value").hide(),t.dolar_quotation&&($("#cambio-label span").text("Câmbio (1 $ = R$ "+t.dolar_quotation+"): "),$("#cambio-value span").text("US$ "+t.taxa),$("#cambio-label, #cambio-value").show());$("#taxas-installment-free-label, #taxa-installment-value").hide(),"0,00"!==t.installment_tax_value&&($("#taxa-installment-value").html("R$ "+t.installment_tax_value),$("#taxas-installment-free-label").show(),$("#taxa-installment-value").show());$("#desconto-value").html("R$ "+t.discount),$("#total-value").html("R$ "+t.total),$("#taxas-label").text(t.tax?"Taxas ("+t.tax+" + "+t.transaction_tax+"): ":"Taxas"),$("#taxareal-value").text(t.taxaReal?t.taxaReal:""),$("#convertax-label, #convertax-value").hide(),"0,00"!==t.convertax_value&&($("#convertax-value").text(t.convertax_value?t.convertax_value:""),$("#convertax-label, #convertax-value").show());$("#comission-value").text(t.comission?t.comission:""),1===t.payment_method&&($("#details-card #card-flag").text("Bandeira: "+t.flag),$("#details-card #card-installments").text("Quantidade de parcelas: "+t.installments_amount),$("#details-card").show(),$("#details-boleto").hide());2===t.payment_method&&($("#details-boleto #boleto-link a").attr("link",t.boleto_link),$("#details-boleto #boleto-digitable-line a").attr("digitable-line",t.boleto_digitable_line),$("#details-boleto #boleto-due").text("Vencimento: "+t.boleto_due_date),$("#details-card").hide(),$("#details-boleto").show());$("#checkout-attempts").hide(),1===t.payment_method&&$("#checkout-attempts").text("Quantidade de tentativas: "+t.attempts).show()})(t),n=t.client_id,$.ajax({method:"GET",url:"/api/customers/"+n,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){!function(t){$("#client-name").text("Nome: "+t.name),$("#client-telephone").text("Telefone: "+t.telephone),$("#client-whatsapp").attr("href",t.whatsapp_link),$("#client-email").text("Email: "+t.email),$("#client-document").text("CPF: "+t.document)}(t.data)}}),function(t){$.ajax({method:"GET",url:"/api/products/saleproducts/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(a){!function(t,a){$("#table-product").html(""),$("#data-tracking-products").html("");var e="",n="/build/global/img/produto.svg";$.each(t,function(t,o){if(o.photo||(o.photo=n),e+='<div class="row align-items-baseline justify-content-between mb-15">\n                        <div class="col-lg-2">\n                            <img src=\''.concat(o.photo,"' width='50px' style='border-radius: 6px;'>\n                        </div>\n                        <div class=\"col-lg-5\">\n                            <h4 class=\"table-title\">").concat(o.name,'</h4>\n                        </div>\n                        <div class="col-lg-3 text-right">\n                            <p class="sm-text text-muted">').concat(o.amount,"x</p>\n                        </div>\n                    </div>"),$("#table-product").html(e),1==o.sale_status){var s="<tr>\n                                <td>\n                                    <img src='".concat(o.photo,"'  width='35px;' style='border-radius:6px;'><br>\n                                    <span class='small' style='display: inline-block; width: 60px;white-space: nowrap;overflow: hidden !important;text-overflow: ellipsis;'>").concat(o.name,"</span>\n                                </td>\n                                <td>\n                                    <span class='tracking-code-span small ellipsis'>").concat(o.tracking_code,"</span>\n                                    <input class='form-control' id='tracking_code' name='tracking_code' value='").concat(o.tracking_code,"' style='display:none;'/>\n                                </td>\n                                <td>\n                                    <span class='tracking-status-span small'>").concat(o.tracking_status_enum,"</span>\n                                </td>\n                                <td>\n                                    <a class='pointer btn-edit-trackingcode p-5' title='Editar Código de rastreio' product-code='").concat(o.id,"'><i class='icon wb-edit' aria-hidden='true' style='color:#f1556f;'></i></a>\n                                    <a class='pointer btn-save-trackingcode p-3 mb-15' title='Salvar Código de rastreio' sale='").concat(a,"' product-code='").concat(o.id,"' style='display:none;'><i class=\"material-icons gradient\" style=\"font-size:17px;\">save</i></a>\n                                    <a class='pointer btn-close-tracking' title='Fechar' style='display:none;'><i class='material-icons gradient mt-5'>close</i></a>\n                                </td>\n                            </tr>");$("#div_tracking_code").css("display","block"),$("#data-tracking-products").append(s)}else $("#div_tracking_code").css("display","none")})}(a.data,t)}})}(t.id),e=t.delivery_id,$.ajax({method:"GET",url:"/api/delivery/"+e,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){var a;a=t.data,$(".btn-save-trackingcode").attr("delivery",a.id),$("#delivery-address").text("Endereço: "+a.street+", "+a.number),$("#delivery-zipcode").text("CEP: "+a.zip_code),$("#delivery-city").text("Cidade: "+a.city+"/"+a.state)}}),a=t.checkout_id,$.ajax({method:"GET",url:"/api/checkout/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){var a;a=t.data,$("#checkout-ip").text("IP: "+a.ip),$("#checkout-operational-system").text("Dispositivo: "+a.operational_system),$("#checkout-browser").text("Navegador: "+a.browser),$("#checkout-src").text("SRC: "+a.src),$("#checkout-source").text("UTM Source: "+a.source),$("#checkout-medium").text("UTM Medium: "+a.utm_medium),$("#checkout-campaign").text("UTM Campaign: "+a.utm_campaign),$("#checkout-term").text("UTM Term: "+a.utm_term),$("#checkout-content").text("UTM Content: "+a.utm_content),loadOnAny("#modal-saleDetails",!0)}}),function(t){if(!isEmpty(t)){var a=t[t.length-1];$.ajax({method:"GET",url:"/api/apps/notazz/invoice/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){!function(t){if(isEmpty(t))$("#div_notazz_invoice").hide();else{if($("#data-notazz-invoices").empty(),t.date_pending){var a="<tr>\n                                <td>\n                                    ".concat(t.date_pending,"\n                                </td>\n                                <td>\n                                    Pendente de envio\n                                </td>\n                                <td>\n                                    0\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(a)}if(t.date_sent){var e=null==t.return_message?"Sucesso":t.return_message,n=t.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz",o=t.pdf?"<a href='"+t.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"",s="<tr>\n                                <td>\n                                    ".concat(t.date_sent,"\n                                </td>\n                                <td>\n                                    ").concat(n,"\n                                </td>\n                                <td>\n                                    ").concat(t.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(e,"\n                                </td>\n                                <td>\n                                    ").concat(o,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(s)}if(t.date_error){n=t.return_message?"Erro ao enviar para Notazz":"Enviado para Notazz";var c="<tr>\n                                <td>\n                                    ".concat(t.date_error,"\n                                </td>\n                                <td>\n                                    ").concat(n,"\n                                </td>\n                                <td>\n                                    ").concat(t.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(t.return_message,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(c)}if(t.date_rejected){var i=null==t.postback_message?"Rejeitado":t.postback_message,d="<tr>\n                                <td>\n                                    ".concat(t.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fiscal rejeitada\n                                </td>\n                                <td>\n                                    ").concat(t.return_http_code,"\n                                </td>\n                                <td>\n                                    ").concat(i,"\n                                </td>\n                                <td>\n\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(d)}if(t.date_canceled){o=t.pdf?"<a href='"+t.pdf+"' class='copy_link' style='cursor:pointer;' target='_blank'><span class='material-icons icon-copy-1'> content_copy </span></a>":"";var r="<tr>\n                                <td>\n                                    ".concat(t.date_sent,"\n                                </td>\n                                <td>\n                                    Nota fical cancelada\n                                </td>\n                                <td>\n                                    ").concat(t.return_http_code,"\n                                </td>\n                                <td>\n                                    Sucesso\n                                </td>\n                                <td>\n                                    ").concat(o,"\n                                </td>\n                            </tr>");$("#data-notazz-invoices").append(r)}t.return_message&&$("#div_notazz_schedule").html("Próxima tentativa de envio em "+t.schedule),$("#div_notazz_invoice").show()}}(t.data)}})}}(t.invoices);var a;var e;var n}(t.data)}})}),$(document).on("click",".btn-save-trackingcode",function(){var t=$(this),a=$(this).parent().parent().find("#tracking_code"),e=a.val(),n=$(this).attr("product-code"),o=$(this).attr("sale");if(""==e)return alertCustom("error","Dados informados inválidos"),!1;$.ajax({method:"POST",url:"/api/tracking",data:{tracking_code:e,sale_id:o,product_id:n},dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(e){var n=a.parents().next("td").find(".tracking-status-span"),o=a.parent().find(".tracking-code-span"),s=t.parent().find(".btn-edit-trackingcode"),c=t.parent().find(".btn-close-tracking");o.html(e.data.tracking_code),n.html(e.data.tracking_status),a.val(e.data.tracking_code),a.hide("fast"),o.show("fast"),t.hide("fast"),s.show("fast"),c.hide("fast"),alertCustom("success",e.message)}})})});
