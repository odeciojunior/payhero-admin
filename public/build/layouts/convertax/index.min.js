$(document).ready(function(){$(".company-navbar").change(function(){verifyIfCompanyIsDefault($(this).val())||($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").hide(),loadOnAny("#content"),updateCompanyDefault().done(function(a){getCompaniesAndProjects().done(function(a){t=a,e("n")})}))});var t="";function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";"y"==e?loadingOnScreen():($("#content").html(""),loadOnAny("#content")),$hasProjects=!1,t.company_default_projects&&$.each(t.company_default_projects,function(t,e){1==e.status&&($hasProjects=!0)}),$hasProjects?$.ajax({method:"GET",url:"/api/apps/convertax?company="+$(".company-navbar").val(),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){loadOnAny("#content",!0),loadingOnScreenRemove(),errorAjaxResponse(t)},success:function(n){if($("#select_projects").html(""),fillSelectProject(t,"#select_projects"),isEmpty(n.data))$("#no-integration-found").show();else{$("#content").html("");for(var o=n.data,i=0;i<o.length;i++)a(o[i]);$("#no-integration-found").hide()}$("#project-empty").hide(),$("#integration-actions").show(),"y"==e&&loadingOnScreenRemove(),loadOnAny("#content",!0)}}):($("#integration-actions").hide(),$("#no-integration-found").hide(),$("#project-empty").show(),loadingOnScreenRemove(),loadOnAny("#content",!0))}function a(t){$("#content").append('\n                            <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3">\n                                <div class="card shadow card-edit" project='+t.id+' style=\'cursor:pointer;\'>\n\n                <div class="d-flex align-items-center justify-content-center"   >\n                <img class="card-img-top img-fluid w-full" src='+t.project_photo+' onerror="this.onerror=null;this.src=\'/build/global/img/produto.svg\';" alt="'+t.project_name+'"/>\n                </div>\n\n                                    <div class="card-body">\n                                        <div class=\'row\'>\n                                            <div class=\'col-md-10\'>\n                                                <h4 class="card-title">'+t.project_name+'</h4>\n                                                <p class="card-text sm">Criado em '+t.created_at+"</p>\n                                            </div>\n                                            <div class='col-md-2'>\n                                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' project="+t.id+'>\n                                                    <img src="/build/global/img/icon-trash-new.svg" />\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ')}getCompaniesAndProjects().done(function(a){t=a,e()}),$(".check").on("click",function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)}),$("#btn-add-integration").on("click",function(){$(".modal-title").html("Adicionar nova Integração com ConvertaX"),$("#bt_integration").addClass("btn-save"),$("#bt_integration").removeClass("btn-update"),$("#bt_integration").text("Adicionar integração"),$("#modal_add_integracao").modal("show"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$(":text").val(""),$(":checkbox").prop("checked",!0).val(1),$("#select_projects").prop("selectedIndex",0).change()}),$(document).on("click",".card-edit",function(){$(".modal-title").html("Editar Integração com ConvertaX"),$("#bt_integration").addClass("btn-update"),$("#bt_integration").removeClass("btn-save"),$("#bt_integration").text("Atualizar"),$("#form_update_integration").show(),$("#form_add_integration").hide(),$("#modal_add_integracao").modal("show"),$.ajax({method:"GET",url:"/api/apps/convertax/"+$(this).attr("project"),dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(e){$("#select_projects_edit").html(""),fillSelectProject(t,"#select_projects_edit",e.data.project_id),$("#integration_id").val(e.data.id),$("#link_edit").val(e.data.link),$("#value_edit").val(e.data.value),$("#value_edit").unmask(),$("#value_edit").mask("#.###,#0",{reverse:!0}),$("#boleto_generated_edit").val(e.data.boleto_generated),$("#boleto_generated_edit").prop("checked","1"==$("#boleto_generated_edit").val()),$("#boleto_paid_edit").val(e.data.boleto_paid),$("#boleto_paid_edit").prop("checked","1"==$("#boleto_paid_edit").val()),$("#credit_card_refused_edit").val(e.data.credit_card_refused),$("#credit_card_refused_edit").prop("checked","1"==$("#credit_card_refused_edit").val()),$("#credit_card_paid_edit").val(e.data.credit_card_paid),$("#credit_card_paid_edit").prop("checked","1"==$("#credit_card_paid_edit").val()),$("#abandoned_cart_edit").val(e.data.abandoned_cart),$("#abandoned_cart_edit").prop("checked","1"==$("#abandoned_cart_edit").val())}})}),$(document).on("click",".btn-save",function(){if(""==$("#link").val())return alertCustom("error","Dados informados inválidos"),!1;var t=new FormData(document.getElementById("form_add_integration"));$.ajax({method:"POST",url:"/api/apps/convertax",dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:t,error:function(t){errorAjaxResponse(t)},success:function(t){e(),alertCustom("success",t.message)}})}),$(document).on("click",".btn-update",function(){if(""==$("#link_edit").val())return alertCustom("error","Dados informados inválidos"),!1;var t=$("#integration_id").val(),a=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/convertax/"+t,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:a,error:function(t){errorAjaxResponse(t)},success:function(t){e(),alertCustom("success",t.message)}})}),$(document).on("click",".delete-integration",function(t){t.stopPropagation();var e=$(this).attr("project");$("#modal-delete-integration .btn-delete").attr("project",e),$("#modal-delete-integration").modal("show")}),$(document).on("click","#modal-delete-integration .btn-delete",function(t){t.stopPropagation();var a=$(this).attr("project");$.ajax({method:"DELETE",url:"/api/apps/convertax/"+a,dataType:"json",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(t){errorAjaxResponse(t)},success:function(t){e("n"),alertCustom("success",t.message)}})})});
