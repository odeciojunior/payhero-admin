$("#company-navbar").change((function(){verifyIfCompanyIsDefault()||($("#select_projects, #select_projects_edit").find("option").remove(),updateCompanyDefault().done((function(e){getCompaniesAndProjects().done((function(e){companies=e.companies,$.each(companies,(function(t,a){e.company_default==a.id&&$.each(a.projects,(function(e,t){$("#select_projects, #select_projects_edit").append($("<option>",{value:t.id,text:t.name}))}))})),window.index("n")}))})))})),$(document).ready((function(){getCompaniesAndProjects().done((function(e){loadingOnScreen(),$.ajax({method:"GET",url:"/api/projects?select=true&company="+$("#company-navbar").val(),data:{status:"active"},headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadOnAny("#content",!0),loadingOnScreenRemove(),errorAjaxResponse(e)},success:function(e){if(loadOnAny("#content",!0),loadingOnScreenRemove(),isEmpty(e.data))return $("#project-empty").show(),void $("#integration-actions").hide();$("#select_projects").html(""),$(e.data).each((function(e,t){1===t.status&&$("#select_projects").append("<option value='"+t.id+"'>"+t.name+"</option>")})),$(".modal-title").html("Adicionar nova Integração com ConvertaX"),$("#bt_integration").addClass("btn-save").text("Adicionar integração"),$("#form_update_integration").hide(),$("#form_add_integration").show(),$("#value").mask("#.###,#0",{reverse:!0}),$(".check").on("click",(function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)})),$(":checkbox").is(":checked")?$(":checkbox").val(1):$(":checkbox").val(0),$(".btn-save").unbind("click"),$(".btn-save").on("click",(function(){if(""==$("#link").val()||""==$("#value").val())return alertCustom("error","Dados informados inválidos"),!1;var e=new FormData(document.getElementById("form_add_integration"));$.ajax({method:"POST",url:"/api/apps/convertax",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:e,error:function e(t){if(422===t.status)for(e in t.errors)alertCustom("error",String(t.errors[e]));else alertCustom("error",t.responseJSON.message)},success:function(e){$("#no-integration-found").hide(),window.index(),alertCustom("success",e.message)}})})),$("#project-empty").hide(),$("#integration-actions").show(),window.index()}})})),window.index=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"y";"y"==e?loadingOnScreen():loadOnAny("#content"),$.ajax({method:"GET",url:"/api/apps/convertax?company="+$("#company-navbar").val(),headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){loadOnAny("#content",!0),errorAjaxResponse(e)},success:function(e){$("#content").html(""),0===Object.keys(e.data).length?$("#no-integration-found").show():($("#no-integration-found").hide(),$(e.data).each((function(e,t){$("#content").append('\n                            <div class="col-sm-6 col-md-4 col-lg-3 col-xl-3">\n                                <div class="card shadow card-edit" project='.concat(t.id,' style=\'cursor:pointer;\'>\n                                    <img class="card-img-top img-fluid w-full" src="').concat(t.project_photo?t.project_photo:"/build/global/img/produto.png",'"/>\n                                    <div class="card-body">\n                                        <div class=\'row\'>\n                                            <div class=\'col-md-10\'>\n                                                <h4 class="card-title">').concat(t.project_name,'</h4>\n                                                <p class="card-text sm">Criado em ').concat(t.created_at,"</p>\n                                            </div>\n                                            <div class='col-md-2'>\n                                                <a role='button' title='Excluir' class='delete-integration float-right mt-35' project=\"").concat(t.id,"\" data-toggle='modal' data-target='#modal-delete' type='a'>\n                                                    <span class='o-bin-1 pointer'></span>\n                                                </a>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        "))})),$(".card-edit").unbind("click"),$(".card-edit").on("click",(function(){var e=$(this).attr("project");$.ajax({method:"GET",url:"/api/projects/user-projects",headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(t){$("#select_projects_edit").html(""),$(t.data).each((function(e,t){$("#select_projects_edit").append("<option value='"+t.id+"'>"+t.name+"</option>")})),$(".modal-title").html("Editar Integração com ConvertaX"),$.ajax({method:"GET",url:"/api/apps/convertax/"+e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(){},success:function(e){$("#select_projects_edit").val(e.data.project_id),$("#integration_id").val(e.data.id),$("#link_edit").val(e.data.link),$("#value_edit").val(e.data.value),$("#value_edit").unmask(),$("#value_edit").mask("#.###,#0",{reverse:!0}),$("#boleto_generated_edit").val(e.data.boleto_generated),"1"==$("#boleto_generated_edit").val()?$("#boleto_generated_edit").attr("checked","checked"):$("#boleto_generated_edit").attr(""),$("#boleto_paid_edit").val(e.data.boleto_paid),"1"==$("#boleto_paid_edit").val()?$("#boleto_paid_edit").attr("checked","checked"):$("#boleto_paid_edit").attr(""),$("#credit_card_refused_edit").val(e.data.credit_card_refused),"1"==$("#credit_card_refused_edit").val()?$("#credit_card_refused_edit").attr("checked","checked"):$("#credit_card_refused_edit").attr(""),$("#credit_card_paid_edit").val(e.data.credit_card_paid),"1"==$("#credit_card_paid_edit").val()?$("#credit_card_paid_edit").attr("checked","checked"):$("#credit_card_paid_edit").attr(""),$("#abandoned_cart_edit").val(e.data.abandoned_cart),"1"==$("#abandoned_cart_edit").val()?$("#abandoned_cart_edit").attr("checked","checked"):$("#abandoned_cart_edit").attr(""),$("#modal_add_integracao").modal("show"),$("#form_add_integration").hide(),$("#form_update_integration").show(),$("#bt_integration").addClass("btn-update"),$("#bt_integration").removeClass("btn-save"),$("#bt_integration").text("Atualizar"),$("#btn-modal").show(),$(".check").on("click",(function(){$(this).is(":checked")?$(this).val(1):$(this).val(0)})),$(".btn-update").unbind("click"),$(".btn-update").on("click",(function(){if(""==$("#link_edit").val()||""==$("#value_edit").val())return alertCustom("error","Dados informados inválidos"),!1;var e=$("#integration_id").val(),t=new FormData(document.getElementById("form_update_integration"));$.ajax({method:"POST",url:"/api/apps/convertax/"+e,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},processData:!1,contentType:!1,cache:!1,data:t,error:function(e){errorAjaxResponse(e)},success:function(e){window.index(),alertCustom("success",e.message)}})}))}})}})})),$(".delete-integration").unbind("click"),$(document).on("click",".delete-integration",(function(e){e.preventDefault();var t=$(this).attr("project");$('a[class="delete-integration float-right mt-35"][ project="'+t+'"]').parent().parent().parent().parent().parent().find(".card-edit").unbind("click"),$("#modal-delete-integration .btn-delete").attr("project",t),$("#modal-delete-integration").modal("show")})),$("#modal-delete-integration .btn-delete").on("click",(function(e){e.stopPropagation();var t=$(this).attr("project");$('a[class="delete-integration float-right mt-35"][ project="'+t+'"]').parent().parent().parent().parent().parent().find(".card-edit").unbind("click"),$.ajax({method:"DELETE",url:"/api/apps/convertax/"+t,headers:{Authorization:$('meta[name="access-token"]').attr("content"),Accept:"application/json"},error:function(e){errorAjaxResponse(e)},success:function(e){window.index(),alertCustom("success",e.message)}})})),loadOnAny("#content",!0))}})},$("#btn-add-integration").on("click",(function(){$("#modal_add_integracao").modal("show")}))}));
